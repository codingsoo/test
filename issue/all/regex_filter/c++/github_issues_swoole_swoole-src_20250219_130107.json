[
  {
    "number": 5654,
    "title": "Swoole HTTP server doesn't trigger ManagerStart event",
    "created_at": "2025-01-05T06:06:09Z",
    "closed_at": "2025-02-14T10:26:18Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5654",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nLaunched my script `php server.php` with the following code:\r\n```php\r\n<?php\r\n$server = new \\Swoole\\Http\\Server('0.0.0.0', 9501);\r\n\r\n$server->on('ManagerStart', function (\\Swoole\\Server $server) {\r\n    echo \"ManagerStart\\n\";\r\n    \\Swoole\\Process::signal(SIGUSR1, function () use ($server) {\r\n        $server->reload();\r\n    });\r\n});\r\n\r\n$server->on('Connect', function (\\Swoole\\Server $server, int $fd, int $reactorId) {\r\n    echo \"Connect\\n\";\r\n});\r\n\r\n$server->on('Request', function ($request, $response) {\r\n    echo \"Request\\n\";\r\n    $response->header('Content-Type', 'text/html; charset=utf-8');\r\n    $response->end('<h1>Rand. #' . rand(1000, 9999) . '</h1>');\r\n});\r\n\r\n$server->start();\r\n```\r\n\r\nThen sent `SIGUSR1` from the console:\r\n```\r\nkill -SIGUSR1 $(pgrep -f \"php server.php\")\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n\"ManagerStart\" in the console. Then reloading after receiving `SIGUSR1`.\r\n\r\n3. What did you see instead?\r\n\r\n\"ManagerStart\" isn't printed in the console. `SIGUSR1` shows an error:\r\n```\r\nWARNING swoole_signalfd_event_callback() (ERRNO 721): Unable to find callback function for signal User defined signal 1: 10\r\n```\r\n\r\nHowever, \"Connect\" and \"Request\" messages are displayed correctly.\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 6.0.0\r\nBuilt => Dec 17 2024 05:36:37\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1f  31 Mar 2020\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\npcre => enabled\r\nc-ares => 1.15.0\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\ncoroutine_pgsql => enabled\r\ncoroutine_sqlite => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_library => On => On\r\nswoole.enable_fiber_mock => Off => Off\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n**uname -a**\r\n```Linux us 5.4.0-204-generic #224-Ubuntu SMP Thu Dec 5 13:38:28 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux```\r\n\r\n**php -v**\r\n```\r\nPHP 8.3.15 (cli) (built: Dec 24 2024 06:09:34) (NTS)\r\nCopyright (c) The PHP Group\r\nZend Engine v4.3.15, Copyright (c) Zend Technologies\r\n    with Zend OPcache v8.3.15, Copyright (c), by Zend Technologies\r\n```\r\n\r\nI didn't compiled Swoole with GCC, I installed it with\r\n```\r\nsudo apt install php8.3-swoole\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5654/comments",
    "author": "Ser5",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2025-01-05T14:35:33Z",
        "body": "Please set the value of worker_num to be greater than 1.\r\n```php\r\n$server->set([\r\n    'worker_num' => 4\r\n]);\r\n```"
      },
      {
        "user": "Ser5",
        "created_at": "2025-01-06T00:35:56Z",
        "body": "@NathanFreeman , hey, thank you! I tried your advice - but got even more confusing results.\r\n\r\nHere is my current test script:\r\n```php\r\n<?php\r\n$server = new \\Swoole\\Http\\Server('0.0.0.0', 9501);\r\n\r\n$server->set([\r\n    'worker_num' => 4,\r\n]);\r\n\r\n$server->on('ManagerStart', function (\\Swoole\\Server $server) {\r\n    echo \"ManagerStart\\n\";\r\n    \\Swoole\\Process::signal(SIGUSR1, function () use ($server) {\r\n        echo \"SIGUSR1 callback\\n\";\r\n        $server->reload();\r\n    });\r\n});\r\n\r\n$server->on('Request', function ($request, $response) {\r\n    echo \"Request\\n\";\r\n    $response->header('Content-Type', 'text/html; charset=utf-8');\r\n    $response->end('<h1>Rand. #' . rand(1000, 9999) . '</h1>');\r\n});\r\n\r\n$server->start();\r\n```\r\n\r\nWhen I launch it, I see this:\r\n```\r\nphp server.php\r\nManagerStart\r\nPHP Warning:  Swoole\\Process::signal(): signal [10] processor has been registered by the system in /var/www/custom/htdocs/server.php on line 10\r\n```\r\n\r\nThen I try to change the text in response to any other value and send the signal:\r\n```kill -SIGUSR1 $(pgrep -f \"php server.php\")```\r\n\r\nI get this messages:\r\n```\r\n[2025-01-06 05:26:23 *2891.1]   WARNING swoole_signalfd_event_callback() (ERRNO 721): Unable to find callback function for signal User defined signal 1: 10\r\n[2025-01-06 05:26:23 $2889.0]   INFO    Server is reloading all workers now\r\n[2025-01-06 05:26:23 *2892.2]   WARNING swoole_signalfd_event_callback() (ERRNO 721): Unable to find callback function for signal User defined signal 1: 10\r\n[2025-01-06 05:26:23 *2890.0]   WARNING swoole_signalfd_event_callback() (ERRNO 721): Unable to find callback function for signal User defined signal 1: 10\r\n[2025-01-06 05:26:23 *2893.3]   WARNING swoole_signalfd_event_callback() (ERRNO 721): Unable to find callback function for signal User defined signal 1: 10\r\n```\r\n\r\nThe text from `echo \"SIGUSR1 callback\\n\";` isn't displayed.\r\n\r\nUpon reloading the page I see that the output in the browser don't change - it still shows \"Rand. #something\".\r\n\r\nSwoole triggers \"ManagerStart\", warns that the signal processor has been registered, says that the workers are reloaded - but doesn't actually reload them."
      },
      {
        "user": "NathanFreeman",
        "created_at": "2025-01-06T04:36:10Z",
        "body": "You don't need to manually listen for the SIGUSR1 signal, as Swoole has already taken care of it for you. You just need to send the SIGUSR1 signal to the master process to restart the worker processes. The SIGUSR2 signal is used to restart both the worker and task processes."
      },
      {
        "user": "Ser5",
        "created_at": "2025-01-06T06:50:12Z",
        "body": "@NathanFreeman , yes, it seems Swoole tries to reload workers, but unsuccessfully.\r\n\r\n```php\r\n<?php\r\n$server = new \\Swoole\\Http\\Server('0.0.0.0', 9501);\r\n\r\n$server->set(['worker_num' => 4]);\r\n\r\n$server->on('Request', function ($request, $response) {\r\n    $response->header('Content-Type', 'text/html; charset=utf-8');\r\n    $response->end('<h1>Rand. #' . rand(1000, 9999) . '</h1>');\r\n});\r\n\r\n$server->start();\r\n```\r\n\r\nUpon sending `SIGUSR1` I still see the errors:\r\n```\r\n[2025-01-06 11:47:36 $7312.0]   INFO    Server is reloading all workers now\r\n[2025-01-06 11:47:36 *7314.1]   WARNING swoole_signalfd_event_callback() (ERRNO 721): Unable to find callback function for signal User defined signal 1: 10\r\n[2025-01-06 11:47:36 *7316.3]   WARNING swoole_signalfd_event_callback() (ERRNO 721): Unable to find callback function for signal User defined signal 1: 10\r\n[2025-01-06 11:47:36 *7313.0]   WARNING swoole_signalfd_event_callback() (ERRNO 721): Unable to find callback function for signal User defined signal 1: 10\r\n[2025-01-06 11:47:36 *7315.2]   WARNING swoole_signalfd_event_callback() (ERRNO 721): Unable to find callback function for signal User defined signal 1: 10\r\n```\r\n\r\nSwoole is missing something responsible for processing `SIGUSR1`."
      },
      {
        "user": "Ser5",
        "created_at": "2025-01-06T06:54:15Z",
        "body": "@NathanFreeman , by the way: when I started developing test scripts for Swoole, reloading did work. But after a few hours it disappeared and I started getting those errors. I can't imagine what caused this. Weird."
      },
      {
        "user": "NathanFreeman",
        "created_at": "2025-01-06T07:18:30Z",
        "body": "You only need to send the signal to the master process; the child processes do not listen for the SIGUSR1 signal, so it won't have any effect."
      },
      {
        "user": "Ser5",
        "created_at": "2025-01-06T07:50:10Z",
        "body": "Should I see the changes in the script in the browser upon sending `SIGUSR1`?\r\n\r\nFor example, if I first write\r\n```$response->end('<h1>Rand. #' . rand(1000, 9999) . '</h1>');```\r\n\r\nthen change it to \r\n```$response->end('<h1>Changed response rand. #' . rand(1000, 9999) . '</h1>');```\r\n\r\nthen send `SIGUSR1`.\r\n\r\nCurrently I don't see that any response changes. I only see them after restarting the server script."
      },
      {
        "user": "NathanFreeman",
        "created_at": "2025-01-06T08:34:46Z",
        "body": "This is the expected behavior because the child process is forked from the parent process, so the code of the parent process remains unchanged"
      },
      {
        "user": "Ser5",
        "created_at": "2025-01-06T16:10:23Z",
        "body": "Well, then can you please tell me how to reload the server without dropping the connections, like **nginx** `nginx -s reload`? It's required for hot reloading in dev mode and for updating the code on prod."
      },
      {
        "user": "NathanFreeman",
        "created_at": "2025-01-08T06:26:26Z",
        "body": "Swoole does not support hot reload; you can only reload PHP files in the workerStart event.\r\n```php\r\n// test.php\r\nfunction response($response) {\r\n    $response->end('Hello World');\r\n}\r\n```\r\n\r\n```php\r\n$server->on('WorkerStart', function (\\Swoole\\Server $server) {\r\n    require \"test.php\";\r\n});\r\n\r\n$server->on('Request', function ($request, $response) {\r\n    test($response);\r\n});\r\n\r\n$server->start();\r\n```\r\n\r\n"
      }
    ]
  },
  {
    "number": 5645,
    "title": "Add partitioned cookie support",
    "created_at": "2024-12-29T14:49:22Z",
    "closed_at": "2024-12-30T04:20:05Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5645",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\nI am trying to set partitioned cookie via Laravel Octane\r\n\r\n\r\n2. What did you expect to see?\r\nSet-Cookie header should be with \"partitioned\"\r\n\r\n\r\n3. What did you see instead?\r\nSet-Cookie header withou \"partitioned\"\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n6.0.0\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\nLinux dbb271a627bd 6.12.4-200.fc41.x86_64 #1 SMP PREEMPT_DYNAMIC Mon Dec  9 20:01:35 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nPHP 8.3.14 (cli) (built: Nov 25 2024 18:07:16) (NTS)\r\nCopyright (c) The PHP Group\r\nZend Engine v4.3.14, Copyright (c) Zend Technologies\r\n    with Zend OPcache v8.3.14, Copyright (c), by Zend Technologies\r\n    with Xdebug v3.4.0, Copyright (c) 2002-2024, by Derick Rethans\r\n\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/11/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none:amdgcn-amdhsa\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 11.4.0-1ubuntu1~22.04' --with-bugurl=file:///usr/share/doc/gcc-11/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++,m2 --prefix=/usr --with-gcc-major-version-only --program-suffix=-11 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-plugin --enable-default-pie --with-system-zlib --enable-libphobos-checking=release --with-target-system-zlib=auto --enable-objc-gc=auto --enable-multiarch --disable-werror --enable-cet --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none=/build/gcc-11-XeT9lY/gcc-11-11.4.0/debian/tmp-nvptx/usr,amdgcn-amdhsa=/build/gcc-11-XeT9lY/gcc-11-11.4.0/debian/tmp-gcn/usr --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu --with-build-config=bootstrap-lto-lean --enable-link-serialization=2\r\nThread model: posix\r\nSupported LTO compression algorithms: zlib zstd\r\ngcc version 11.4.0 (Ubuntu 11.4.0-1ubuntu1~22.04)\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5645/comments",
    "author": "jamesRUS52",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2024-12-30T00:58:32Z",
        "body": "```php\r\nuse Swoole\\Http\\Cookie;\r\n$http->on('request', function ($request, $response) {\r\n    $cookie = new Cookie();\r\n    $cookie->withName('test')\r\n        ->withValue('123456789')\r\n        ->withExpires(time() + 3600)\r\n        ->withPath('/path')\r\n        ->withDomain('example.com')\r\n        ->withSecure(true)\r\n        ->withHttpOnly(true)\r\n        ->withSameSite('None')\r\n        ->withPartitioned(true);\r\n    $response->cookie($cookie);\r\n    $response->end(\"<h1>Hello Swoole. #\".rand(1000, 9999).\"</h1>\");\r\n});\r\n\r\n\r\n```"
      }
    ]
  },
  {
    "number": 5598,
    "title": "WebSocker Server's Connection (fd) Overflow Issue due to continuous increment of Connection Number",
    "created_at": "2024-11-29T07:56:37Z",
    "closed_at": "2024-12-04T06:28:11Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5598",
    "body": "### Issue Description:\r\n\r\n1. If there are three connections, say, 1, 2 and 3 and if connection number 3 reconnects (disconnects and connects again), then the connection id it receives is 4. So integer 3 is available but not re-assignable to next connections. This behavior will create many gap. \r\n\r\n2. Secondly, $fd (connection id) may have a maximum value that can store in it. We think that a value greater than that max value will lead to \"overflow\" in $fd.\r\n\r\n\r\nIs there any work around this risk ? OR, at that point you will want us to restart the WebSocket Server ?\r\n\r\n### What version of Swoole are you using (show your php --ri swoole)?\r\n```\r\nSwoole => enabled\r\nAuthor => Swoole Team <[team@swoole.com](mailto:team@swoole.com)>\r\nVersion => 5.1.2\r\nBuilt => Aug 15 2024 12:06:11\r\ncoroutine => enabled with thread context\r\ndebug => enabled\r\ntrace_log => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 3.0.2 15 Mar 2022\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\npcre => enabled\r\nc-ares => 1.18.1\r\nzlib => 1.2.11\r\nbrotli => E16777225/D16777225\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\ncoroutine_pgsql => enabled\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_fiber_mock => Off => Off\r\nswoole.enable_preemptive_scheduler => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n### What is your machine environment used (show your uname -a & php -v & gcc -v) ?\r\n- PHP 8.3.12 (cli) (built: Sep 27 2024 03:53:05) (NTS)\r\n- gcc version 11.4.0 (Ubuntu 11.4.0-1ubuntu1 22.04)\r\n- Linux directlv16-ThinkPad-E15-Gen-4 6.8.0-45-generic 45~22.04.1-Ubuntu SMP PREEMPT_DYNAMIC Wed Sep 11 15:25:05 UTC 2 x86_64 x86_64 x86_64 GNU/Linux",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5598/comments",
    "author": "mohsin-devdksa",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2024-12-04T06:28:11Z",
        "body": "fd is an int64 number with an extremely large range, so it can be assumed that duplicates will not occur. If the actual fd from the operating system were exposed to PHP and not handled correctly, it could lead to errors in reading data."
      }
    ]
  },
  {
    "number": 5580,
    "title": "Create a Swoole WebSocket server that subscribes to new messages from Redis using Redis Pub/Sub.",
    "created_at": "2024-11-21T20:06:44Z",
    "closed_at": "2024-11-26T08:54:34Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5580",
    "body": "Hi everyone, could someone tell how to send an event from a process to server. I am creating a WebSocket server with Redis pub/sub and subscribing to a Redis channel in the WebSocket server process, but how to pass data to server?\r\nOr is there another approach?\r\nIf I write the subscribing code in the workerStart event, the webSocket server will not accept new connections. \r\n```\r\n$this->server->on(\"workerStart\", function ($server, $workerId) use ($redis) {\r\n    $redis->subscribe(['chat_channel'], function ($redis, $channel, $message) {\r\n        foreach ($this->server->connections as $fd) {\r\n              $this->server->push($fd, json_encode($message));\r\n        }\r\n    });\r\n});\r\n```\r\nI guess this is because the phpredis client is blocking, but how to write a code that will accept messages from Redis and broadcast them to connected users? \r\n\r\nI am really struggling with this. Please help if you know how to solve it.  Thank you very much!\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n```\r\nphp --ri swoole\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 6.0.0-dev\r\nBuilt => Oct  7 2024 17:07:28\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nhttp2 => enabled\r\njson => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nbrotli => E16781312/D16781312\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_library => On => On\r\nswoole.enable_fiber_mock => Off => Off\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n```\r\nLinux developer-v3 5.4.0-26-generic #30-Ubuntu SMP Mon Apr 20 16:58:30 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nPHP 8.3.14 (cli) (built: Nov 21 2024 05:47:02) (NTS)\r\n\r\n``` \r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5580/comments",
    "author": "AnyutaH",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2024-11-23T16:38:43Z",
        "body": "You can use a custom process to do this.\r\n```\r\n$server = new Swoole\\Websocket\\Server('127.0.0.1', 9502, SWOOLE_PROCESS);\r\n\r\n$process = new Swoole\\Process(function() use ($server) {\r\n    $redis->subscribe(['chat_channel'], function ($redis, $channel, $message) {\r\n        foreach ($server->connections as $fd) {\r\n              $server->push($fd, json_encode($message));\r\n        }\r\n    });\r\n});\r\n$server->addProcess($process);\r\n\r\n.....\r\n$server->start();"
      },
      {
        "user": "AnyutaH",
        "created_at": "2024-11-23T21:00:35Z",
        "body": "Yes, it worked with SWOOLE_PROCESS set on server, thank you very much @NathanFreeman "
      },
      {
        "user": "matyhtf",
        "created_at": "2024-11-26T08:54:34Z",
        "body": "It is recommended to use the `isEstablished` method to determine whether the connection is an active WebSocket connection.\r\n\r\n```php\r\n$server = new Swoole\\Websocket\\Server('127.0.0.1', 9502, SWOOLE_PROCESS);\r\n\r\n$process = new Swoole\\Process(function() use ($server) {\r\n    $redis->subscribe(['chat_channel'], function ($redis, $channel, $message) {\r\n        foreach ($server->connections as $fd) {\r\n              if ($server->isEstablished($fd)) {\r\n                  $server->push($fd, json_encode($message));\r\n              }\r\n        }\r\n    });\r\n});\r\n$server->addProcess($process);\r\n\r\n.....\r\n$server->start();\r\n```"
      },
      {
        "user": "AnyutaH",
        "created_at": "2024-11-26T10:37:19Z",
        "body": "Ok, thanks a lot @matyhtf "
      }
    ]
  },
  {
    "number": 5545,
    "title": "\"PHP Deprecated\" warning",
    "created_at": "2024-10-25T15:18:39Z",
    "closed_at": "2024-10-26T00:11:41Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5545",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nRunning code:\r\n```php\r\n\r\nnamespace test;\r\n\r\nuse Swoole\\Runtime;\r\n\r\nRuntime::enableCoroutine(true, SWOOLE_HOOK_TCP);\r\n\r\ngo(function () {\r\n  $redis = new \\Redis();\r\n\r\n  if (!$redis->connect('127.0.0.1', 6379)) {\r\n    throw new \\RedisException(\"Unable to connect to Redis\", 2);\r\n  }\r\n\r\n  echo \"Redis connected\\n\";\r\n});\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n> Redis connected\r\n\r\n3. What did you see instead?\r\n\r\n> PHP Deprecated:  Swoole\\Event::rshutdown(): Event::wait() in shutdown function is deprecated in Unknown on line 0\r\n>\r\n> Deprecated: Swoole\\Event::rshutdown(): Event::wait() in shutdown function is deprecated in Unknown on line 0\r\n> Redis connected\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n**`> php --ri swoole`**\r\n> \r\n> swoole\r\n> \r\n> Swoole => enabled\r\n> Author => Swoole Team <team@swoole.com>\r\n> Version => 5.1.4\r\n> Built => Sep 17 2024 22:29:47\r\n> coroutine => enabled with boost asm context\r\n> eventfd => enabled\r\n> kqueue => enabled\r\n> cpu_affinity => enabled\r\n> spinlock => enabled\r\n> rwlock => enabled\r\n> http2 => enabled\r\n> json => enabled\r\n> zlib => 1.3\r\n> mutex_timedlock => enabled\r\n> pthread_barrier => enabled\r\n> mysqlnd => enabled\r\n> async_redis => enabled\r\n> \r\n> Directive => Local Value => Master Value\r\n> swoole.enable_coroutine => On => On\r\n> swoole.enable_library => Off => Off\r\n> swoole.enable_fiber_mock => Off => Off\r\n> swoole.enable_preemptive_scheduler => On => On\r\n> swoole.display_errors => On => On\r\n> swoole.use_shortname => On => On\r\n> swoole.unixsock_buffer_size => 2621440 => 2621440\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n**`> uname -a`**\r\n> FreeBSD web 14.1-RELEASE-p5 FreeBSD 14.1-RELEASE-p5 GENERIC amd64\r\n\r\n**`> php -v`**\r\n> PHP 8.3.12 (cli) (built: Sep 29 2024 01:11:14) (NTS)\r\n> Copyright (c) The PHP Group\r\n> Zend Engine v4.3.12, Copyright (c) Zend Technologies\r\n>     with Zend OPcache v8.3.12, Copyright (c), by Zend Technologies\r\n\r\n**`> gcc -v`**\r\n> Using built-in specs.\r\n> COLLECT_GCC=gcc\r\n> COLLECT_LTO_WRAPPER=/usr/local/libexec/gcc13/gcc/x86_64-portbld-freebsd14.0/13.3.0/lto-wrapper\r\n> Target: x86_64-portbld-freebsd14.0\r\n> Configured with: /wrkdirs/usr/ports/lang/gcc13/work/gcc-13.3.0/configure --enable-multilib --with-build-config=bootstrap-debug --disable-nls --enable-gnu-indirect-function --enable-host-shared --enable-plugin --libdir=/usr/local/lib/gcc13 --libexecdir=/usr/local/libexec/gcc13 --program-suffix=13 --with-as=/usr/local/bin/as --with-gmp=/usr/local --with-gxx-include-dir=/usr/local/lib/gcc13/include/c++/ --with-gxx-libcxx-include-dir=/usr/include/c++/v1 --with-ld=/usr/local/bin/ld --with-pkgversion='FreeBSD Ports Collection' --with-system-zlib --without-zstd --enable-languages=c,c++,objc,fortran,jit --prefix=/usr/local --localstatedir=/var --mandir=/usr/local/share/man --infodir=/usr/local/share/info/gcc13 --build=x86_64-portbld-freebsd14.0\r\n> Thread model: posix\r\n> Supported LTO compression algorithms: zlib\r\n> gcc version 13.3.0 (FreeBSD Ports Collection)",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5545/comments",
    "author": "mozart77",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2024-10-25T15:53:34Z",
        "body": "```php\r\n\r\nnamespace test;\r\n\r\nuse Swoole\\Runtime;\r\nuse function Swoole\\Coroutine\\run;\r\nuse function Swoole\\Coroutine\\go;\r\n\r\nRuntime::enableCoroutine(true, SWOOLE_HOOK_TCP);\r\n\r\nrun(function(){\r\n    $redis = new \\Redis();\r\n    if (!$redis->connect('127.0.0.1', 6379)) {\r\n        throw new \\RedisException(\"Unable to connect to Redis\", 2);\r\n    }\r\n    echo \"Redis connected\\n\";\r\n});\r\n```\r\n\r\nTry it like this."
      },
      {
        "user": "mozart77",
        "created_at": "2024-10-25T16:07:32Z",
        "body": "> ```\r\n> use Swoole\\Runtime;\r\n> use function Swoole\\Coroutine\\run;\r\n> use function Swoole\\Coroutine\\go;\r\n> \r\n> Runtime::enableCoroutine(true, SWOOLE_HOOK_TCP);\r\n> \r\n> run(function(){\r\n>     $redis = new \\Redis();\r\n>     if (!$redis->connect('127.0.0.1', 6379)) {\r\n>         throw new \\RedisException(\"Unable to connect to Redis\", 2);\r\n>     }\r\n>     echo \"Redis connected\\n\";\r\n> });\r\n> ```\r\n\r\nThe result:\r\n\r\n> PHP Fatal error:  Uncaught Error: Call to undefined function Swoole\\Coroutine\\run() in /usr/local/www/test/q.php:11\r\n> Stack trace:\r\n> #0 {main}\r\n>   thrown in /usr/local/www/test/q.php on line 11\r\n> \r\n> Fatal error: Uncaught Error: Call to undefined function Swoole\\Coroutine\\run() in /usr/local/www/test/q.php:11\r\n> Stack trace:\r\n> #0 {main}\r\n>   thrown in /usr/local/www/test/q.php on line 11"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2024-10-25T16:39:50Z",
        "body": "```php\r\nnamespace test;\r\n\r\nuse Swoole\\Runtime;\r\n\r\nRuntime::enableCoroutine(true, SWOOLE_HOOK_TCP);\r\n\r\ngo(function () {\r\n  $redis = new \\Redis();\r\n\r\n  if (!$redis->connect('127.0.0.1', 6379)) {\r\n    throw new \\RedisException(\"Unable to connect to Redis\", 2);\r\n  }\r\n\r\n  echo \"Redis connected\\n\";\r\n});\r\nSwoole\\Event::wait();\r\n```\r\n\r\nIt seems that the value of the configuration `swoole.enable_library` is set to Off, which is why it prompts that the function does not exist. So try adding `Swoole\\Event::wait();` at the end of this code."
      },
      {
        "user": "mozart77",
        "created_at": "2024-10-25T16:42:27Z",
        "body": "That's it! Works! Thank you!"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2024-10-25T16:42:27Z",
        "body": "I need to supplement this section with details in the Swoole documentation."
      }
    ]
  },
  {
    "number": 5505,
    "title": "Reload the Swoole/Process code inside its callback on Swoole\\Server->reload()",
    "created_at": "2024-10-08T17:12:44Z",
    "closed_at": "2024-10-17T10:14:32Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5505",
    "body": "**1. What did you do? If possible, provide a simple script for reproducing the error.**\r\nHi, I have a use case where I want to reload a custom process (Swoole\\Process). According to the documentation, reload() has no effect on custom user processes. Is there any way to ensure that the code in the custom process is also reloaded when calling reload()?\r\n\r\nI attempted the following approach (which didn’t work):\r\n\r\na) Create the Swoole\\Process inside the onWorkerStart event.\r\nb) Before calling $server->reload(), kill the custom process.\r\nc) Create a new Swoole\\Process when the onWorkerStart event is triggered again.\r\n\r\n```php\r\n// Create process in workerStart event when server starts or reload\r\n$this->server->on('workerstart', function($server, $worker_id) {\r\n    if ($worker_id == 1) {\r\n        $server->proc = new Process(function ($process) {\r\n            // Business logic code here\r\n        },false, SOCK_DGRAM, true);\r\n\r\n        $server->addProcess($server->proc);\r\n    }\r\n});\r\n\r\n// Kill the process before reload\r\n$this->server->on('message', function($webSocketServer, $frame) {\r\n    // Before reload kill process\r\n    if ($webSocketServer->worker_id == 1) {\r\n        Process::kill($webSocketServer->proc->pid, SIGTERM);\r\n    }\r\n\r\n    $reloadStatus = $webSocketServer->reload();\r\n    echo (($reloadStatus === true) ? PHP_EOL.'Code Reloaded'.PHP_EOL  :  PHP_EOL.'Code Not Reloaded').PHP_EOL;\r\n\r\n\r\n    // Other business logic\r\n});\r\n```\r\n\r\nHowever, I discovered that we cannot create a Swoole\\Process inside the onWorkerStart event. So, I tried another approach where I created the Swoole\\Process in the main process. The idea was to store the process PID into Swoole\\Coroutine\\Table and fetch it before reload() to kill the process. But, as you know, reload() only affects worker and task processes not the main process.\r\nAdditionally, when I create a new process and try to retrieve its PID, I don’t receive it.\r\n\r\n```php\r\n$proc = new Process(function ($process) {\r\n    // Business logic code here\r\n},false, SOCK_DGRAM, true);\r\n\r\n$id = $this->server->addProcess($proc);\r\n\r\necho PHP_EOL . 'Process PID: ' . $proc->pid;\r\necho PHP_EOL . 'Process ID: '. $proc->id;\r\n\r\n```\r\nMy question is: is there any method or technique that allows us to reload the code changes inside a custom Swoole\\Process, added through `$server->addProcess($proc)`  when calling reload(), and how can I reliably retrieve the PID of a newly created custom process in the parent process just as we get its id from $server->addProcess() ?\r\n\r\n**2. What did you expect to see?**\r\nreload() function should also reload the code of the Swoole\\Process\r\n\r\n**3. What did you see instead?**\r\nreload() function does not reload the code of Swoole\\Process\r\n\r\n**4. What version of Swoole are you using (show your `php --ri swoole`)?**\r\n\r\n```\r\nSwoole => enabled\r\nAuthor => Swoole Team <[team@swoole.com](mailto:team@swoole.com)>\r\nVersion => 5.1.2\r\nBuilt => Aug 15 2024 12:06:11\r\ncoroutine => enabled with thread context\r\ndebug => enabled\r\ntrace_log => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 3.0.2 15 Mar 2022\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\npcre => enabled\r\nc-ares => 1.18.1\r\nzlib => 1.2.11\r\nbrotli => E16777225/D16777225\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\ncoroutine_pgsql => enabled\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_fiber_mock => Off => Off\r\nswoole.enable_preemptive_scheduler => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n**5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?**\r\n\r\n- PHP 8.3.12 (cli) (built: Sep 27 2024 03:53:05) (NTS)\r\n- gcc version 11.4.0 (Ubuntu 11.4.0-1ubuntu1 22.04) \r\n- Linux directlv16-ThinkPad-E15-Gen-4 6.8.0-45-generic  45~22.04.1-Ubuntu SMP PREEMPT_DYNAMIC Wed Sep 11 15:25:05 UTC 2 x86_64 x86_64 x86_64 GNU/Linux",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5505/comments",
    "author": "mohsin-devdksa",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2024-10-10T01:44:16Z",
        "body": "I will take a look later."
      },
      {
        "user": "NathanFreeman",
        "created_at": "2024-10-12T04:58:49Z",
        "body": "```php\r\n$proc = new Process(function ($process) {\r\n    // Business logic code here\r\n},false, SOCK_DGRAM, true);\r\n\r\n$id = $this->server->addProcess($proc);\r\n\r\n$this->server->on('message', function($webSocketServer, $frame) use ($proc) {\r\n    // Before reload kill process\r\n    if ($webSocketServer->worker_id == 1) {\r\n        Process::kill($proc->pid, SIGTERM);\r\n    }\r\n\r\n    $reloadStatus = $webSocketServer->reload();\r\n    echo (($reloadStatus === true) ? PHP_EOL.'Code Reloaded'.PHP_EOL  :  PHP_EOL.'Code Not Reloaded').PHP_EOL;\r\n\r\n\r\n    // Other business logic\r\n});\r\n```\r\n\r\nYou need to add the user processes before executing `$server->start`; using `addProcess` after the server has started will have no effect.\r\n\r\n\r\n"
      },
      {
        "user": "devDeveloperMohsin",
        "created_at": "2024-10-16T17:32:06Z",
        "body": "**Thanks, @NathanFreeman , for your help**\r\nWe found a workaround to reload code inside a custom User Process in Swoole, which is similar to your suggestion. Here’s the breakdown of how it works:\r\n\r\nWhen the Swoole server is running, it creates user processes with **new PIDs (Process IDs)**. We leverage this behavior to reload user processes by utilizing the **BeforeReload** event.\r\n\r\nDuring this event, we terminate the existing user processes, which forces Swoole to create new ones with fresh PIDs. As a result, any updated code is applied to the new processes.\r\n\r\n**Important:** Inside the process, if we write the business logic directly, it won't be reloaded. Instead, we must include the business logic from a separate file inside the process’s handler function. This ensures the logic gets reloaded when the new process is created.\r\n\r\n------------\r\n### 1. Killing Processes in BeforeReload Event:\r\nIn the BeforeReload event, we kill the current user processes so that Swoole can recreate them with new PIDs. We achieve this by iterating over the processes, killing them, and removing their PID files.\r\n\r\n```php\r\n<?php\r\n    $this->server->on('BeforeReload', function($server) {\r\n        // Iterate through the custom processes and terminate them\r\n        foreach($this->customProcessCallbacks as $key => $callback) {\r\n            $processPidFile = __DIR__ . '/process_pids/' . $key . '.pid';\r\n\r\n            // Check if the PID file exists and kill the process\r\n            if (file_exists($processPidFile)) {\r\n                $pid = shell_exec('cat ' . $processPidFile);\r\n                Process::kill((int) $pid, SIGTERM); // Terminate the process\r\n​\r\n                // Remove the PID file\r\n                unlink($processPidFile);\r\n            }\r\n        }\r\n    });\r\n?>\r\n​\r\n```\r\n### 2. Creating the Process and Handling Business Logic:\r\nHere, we create the custom process and add it to the server. The key trick is to include the business logic file inside the handle() function. This ensures that when Swoole reloads the process, the new code will be picked up.\r\n```php\r\n<?php\r\n\t$processCallback = new ProcessCallback();\r\n\t// Add the process callback to an array that holds custom processes\r\n\t$this->customProcessCallbacks['test_process'] = [$processCallback, 'handle'];\r\n\r\n\t// Create the process and add it to the server\r\n\t$testProcess = new Process($this->customProcessCallbacks['test_process'], false, SOCK_DGRAM, true);\r\n\t$this->server->addProcess($testProcess);\r\n\r\n\t$this->server->start(); // Start the server\r\n?>\r\n\r\n```\r\n### 3. Process Callback Class:\r\nIn the ProcessCallback class, we use the include statement to import the business logic from external files. This way, when Swoole creates a new process, the updated logic will be loaded.\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Timer;\r\n\r\nclass ProcessCallback\r\n{\r\n    public function handle()\r\n    {\r\n        // Include the main business logic\r\n        include('path/to/business-logic-file.php');\r\n\r\n        // Set a timer to execute business logic periodically\r\n        Timer::tick(2000, function () {\r\n            include('path/to/timer-business-logic-file.php');\r\n        });\r\n    }\r\n}\r\n?>\r\n\r\n```\r\n\r\n------------\r\n\r\n#  How It Works:\r\n### 1. Killing and Recreating Processes:\r\nIn the BeforeReload event, we kill the existing user processes.\r\nWhen Swoole reloads, it automatically creates new processes, each with a new PID.\r\n\r\n### 2. Reloading Business Logic:\r\nTo ensure the latest business logic is applied, we use include inside the handle() function of the process. This will load the business logic from external files, ensuring it gets reloaded when a new process is created.\r\n"
      },
      {
        "user": "LIngMax",
        "created_at": "2024-10-17T07:47:39Z",
        "body": "    if(function_exists('opcache_reset'))opcache_reset();\r\n    if(function_exists('apc_clear_cache'))apc_clear_cache();"
      },
      {
        "user": "matyhtf",
        "created_at": "2024-10-17T10:14:30Z",
        "body": "You can send a signal to a custom process within the `beforeReload` event. \r\n\r\nIn the custom process, use `pcntl_signal` to listen for signals, and exit the process upon receiving the signal. \r\n\r\nAfter the custom process exits, the underlying system will restart a new instance of the custom process."
      }
    ]
  },
  {
    "number": 5487,
    "title": "Swoole\\Thread\\ArrayList和Queue  是否可以考虑下清空并返回剩余的数据?",
    "created_at": "2024-09-20T09:26:05Z",
    "closed_at": "2024-09-20T09:33:55Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5487",
    "body": "Swoole\\Thread\\Map()->clean(): void\r\nSwoole\\Thread\\ArrayList()->clean()\r\nSwoole\\Thread\\Queue()->clean(): void\r\nArrayList和Queue  清空返回剩余的数据\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5487/comments",
    "author": "LIngMax",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2024-09-20T09:33:55Z",
        "body": "Map 和 ArrayList 可以使用 toArray 转为数组。Queue 无法遍历\r\n\r\n"
      }
    ]
  },
  {
    "number": 5473,
    "title": "`Swoole\\Http\\Response::sendfile` 在phar环境报错",
    "created_at": "2024-09-10T06:27:35Z",
    "closed_at": "2024-09-10T11:58:32Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5473",
    "body": "swoole 5.0.2 和 6.0.0 都存在 \r\n\r\n复现代码\r\n```\r\n<?php\r\n\r\nuse Swoole\\Http\\Response;\r\n\r\nSwoole\\Coroutine::set(['hook_flags' => SWOOLE_HOOK_ALL]);\r\n\r\n$http = new Swoole\\Http\\Server('0.0.0.0', 9901);\r\n\r\n$http->on('Request', function ($request, Response $response) {\r\n\r\n$file = \"phar:///Users/hyperf-skeleton-phar/hyperf-skeleton.phar/runtime/container/http.json\";\r\n    $stat = stat($file);\r\n    var_dump($stat);\r\n    $response->sendfile($file);\r\n});\r\n\r\n$http->start();\r\n```\r\n\r\n命令行打印\r\n```\r\narray(26) {\r\n  [0]=>\r\n  int(12)\r\n  [1]=>\r\n  int(54066)\r\n  [2]=>\r\n  int(33060)\r\n  [3]=>\r\n  int(1)\r\n  [4]=>\r\n  int(0)\r\n  [5]=>\r\n  int(0)\r\n  [6]=>\r\n  int(-1)\r\n  [7]=>\r\n  int(6982)\r\n  [8]=>\r\n  int(1725948884)\r\n  [9]=>\r\n  int(1725948884)\r\n  [10]=>\r\n  int(1725948884)\r\n  [11]=>\r\n  int(-1)\r\n  [12]=>\r\n  int(-1)\r\n  [\"dev\"]=>\r\n  int(12)\r\n  [\"ino\"]=>\r\n  int(54066)\r\n  [\"mode\"]=>\r\n  int(33060)\r\n  [\"nlink\"]=>\r\n  int(1)\r\n  [\"uid\"]=>\r\n  int(0)\r\n  [\"gid\"]=>\r\n  int(0)\r\n  [\"rdev\"]=>\r\n  int(-1)\r\n  [\"size\"]=>\r\n  int(6982)\r\n  [\"atime\"]=>\r\n  int(1725948884)\r\n  [\"mtime\"]=>\r\n  int(1725948884)\r\n  [\"ctime\"]=>\r\n  int(1725948884)\r\n  [\"blksize\"]=>\r\n  int(-1)\r\n  [\"blocks\"]=>\r\n  int(-1)\r\n}\r\nPHP Warning:  Swoole\\Http\\Response::sendfile(): stat(phar:///Users/hyperf-skeleton-phar/hyperf-skeleton.phar/runtime/container/http.json) failed, Error: No such file or directory[2] in /Users/http.php on line 14\r\n```\r\n\r\n\r\n使用phar打包好的代码, 会出现这样的错误\r\n直接使用stat函数, 是正常的\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5473/comments",
    "author": "tw2066",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2024-09-10T11:58:32Z",
        "body": "`sendfile` 不支持 phar，直接使用 `Response::end()`"
      }
    ]
  },
  {
    "number": 5472,
    "title": "swoole日志出现 received the wrong data[619 bytes] from socket #12913707 报错",
    "created_at": "2024-09-09T03:27:48Z",
    "closed_at": "2024-09-09T08:42:24Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5472",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n背景：抓包可以在swoole服务端看到请求（swoole已收到请求），业务层没有处理。（偶现，不稳定复现，全天均有，swoole运行700多天）\r\n\r\nswoole日志报错：\r\nWARNING swWorker_discard_data (ERROR 1007): [1]received the wrong data[916 bytes] from socket #5573675\r\nWARNING swWorker_discard_data (ERROR 1007): [1]received the wrong data[660 bytes] from socket #2427947\r\nWARNING swWorker_discard_data (ERROR 1007): [1]received the wrong data[1428 bytes] from socket #6622251\r\nWARNING swWorker_discard_data (ERROR 1007): [1]received the wrong data[619 bytes] from socket #12913707\r\n\r\n\r\n2. What did you expect to see?\r\nswoole接受到请求后，业务层处理请求，并正常返回。\r\n\r\n\r\n3. What did you see instead?\r\n\r\n观察swoole日志：\r\n\r\nWARNING swWorker_discard_data (ERROR 1007): [1]received the wrong data[916 bytes] from socket #5573675\r\nWARNING swWorker_discard_data (ERROR 1007): [1]received the wrong data[660 bytes] from socket #2427947\r\nWARNING swWorker_discard_data (ERROR 1007): [1]received the wrong data[1428 bytes] from socket #6622251\r\nWARNING swWorker_discard_data (ERROR 1007): [1]received the wrong data[619 bytes] from socket #12913707\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n=========\\\r\n\r\nswoole:\r\nswoole support => enabled\r\nVersion => 2.0.10\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\nepoll => enabled\r\neventfd => enabled\r\ntimerfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nasync redis client => enabled\r\nasync http/websocket client => enabled\r\nopenssl => enabled\r\nLinux Native AIO => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => On => On\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n=========\r\nphp :\r\nPHP 5.6.24 (cli) (built: Sep  9 2016 18:46:13) \r\nCopyright (c) 1997-2016 The PHP Group\r\nZend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\ncat /etc/redhat-* : CentOS Linux release 6.2 (Final)\r\nuname -a : Linux XXX 4.14.105-19-0019 #1 SMP Fri Jan 15 11:39:34 CST 2021 x86_64 x86_64 x86_64 GNU/Linux\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5472/comments",
    "author": "Evil-9527",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2024-09-09T08:42:24Z",
        "body": "这表示执行了 Server::close() 之后，依然收到了来自客户端发送的数据，底层会丢弃，并抛出此错误。\r\n如果是 HTTP 服务器，可能是错误的不符合 HTTP RFC 的请求。\r\n\r\n此错误可忽略。"
      },
      {
        "user": "Evil-9527",
        "created_at": "2024-09-09T09:07:58Z",
        "body": "> 这表示执行了 Server::close() 之后，依然收到了来自客户端发送的数据，底层会丢弃，并抛出此错误。 如果是 HTTP 服务器，可能是错误的不符合 HTTP RFC 的请求。\r\n> \r\n> 此错误可忽略。\r\n\r\n如何复现这个报错？\r\n如何修复这个问题？如何确定修复策略有效？（观察到swoole高版本源码（如4.0.X版本），报错的逻辑没有变更。）\r\n\r\n补充信息：\r\n报错类型：偶现报错、不稳定复现、swoole运行700多天\r\nclient感知：client不添加超时时间，client会一直等。"
      },
      {
        "user": "matyhtf",
        "created_at": "2024-09-20T00:30:55Z",
        "body": "比如 content-length 与实际 body 不一致，就会有类似的问题。建议你前置一个 nginx 来挡掉非正常请求"
      }
    ]
  },
  {
    "number": 5459,
    "title": "http协议服务器，怎么设置请求超时呢？",
    "created_at": "2024-08-23T02:47:18Z",
    "closed_at": "2024-08-23T07:53:07Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5459",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n类似于 php-fpm 的 max_execution_time 配置，能够控制请求的时间\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5459/comments",
    "author": "lushaobo",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2024-08-23T07:53:08Z",
        "body": "没有类似的设置，建议增加一个定时器，在超时后执行 `Response::end()` ，但无法终止正在执行的 `onRequest` 任务"
      },
      {
        "user": "lushaobo",
        "created_at": "2024-08-23T08:03:23Z",
        "body": "好的，多谢。"
      }
    ]
  },
  {
    "number": 5450,
    "title": "Links for &$var don't work",
    "created_at": "2024-08-18T12:23:10Z",
    "closed_at": "2024-08-19T08:53:54Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5450",
    "body": "```\r\n<?php\r\nuse Swoole\\WebSocket\\Server as WebSocketServer;\r\n\r\n$cons = [];\r\n\r\n$wsServer = new WebSocketServer(\"0.0.0.0\", 8443, SWOOLE_PROCESS, SWOOLE_SOCK_TCP | SWOOLE_SSL);\r\n$wsServer->set([\r\n    'ssl_cert_file' => '/www/wwwroot/ssl/ssl_cert.pem',\r\n    'ssl_key_file'  => '/www/wwwroot/ssl/ssl_key.pem',\r\n    'daemonize' => false,\r\n    'ssl_verify_peer' => false\r\n]);\r\n\r\n$wsServer->on('start', function (WebSocketServer $server) {\r\n    echo \"Swoole WebSocket server started at ws://0.0.0.0:8443 \\n\";\r\n});\r\n\r\n$wsServer->on('open', function (WebSocketServer $server, $request) use (&$cons) {\r\n    $cons[$request->fd] = time();\r\n    echo \"open \".count($cons).\" \\n\";\r\n});\r\n\r\n$wsServer->on('message', function (WebSocketServer $server, $frame) use (&$cons) {\r\n    echo \"message \".count($cons).\" \\n\";\r\n});\r\n\r\n$wsServer->on('close', function (WebSocketServer $server, $fd) use (&$cons) {\r\n});\r\n\r\n$wsServer->start();\r\n```\r\n\r\nResult:\r\n\r\n```\r\nopen 1\r\nopen 1\r\nmessage 1\r\nmessage 1\r\n```\r\n\r\nI tested a lot, the links just don't work, it must be:\r\n\r\n```\r\nopen 1\r\nopen 2\r\nmessage 1\r\nmessage 2\r\n```\r\n\r\nI am 100% sure that I have 2 successful connections, each of which successfully sent one message.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5450/comments",
    "author": "ExchangeAssets",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2024-08-19T08:53:54Z",
        "body": "PHP's global variables are only effective within the current process. You need to set the number of worker processes to 1 and use the SWOOLE_BASE mode."
      }
    ]
  },
  {
    "number": 5431,
    "title": "Can not change settings for other opened port",
    "created_at": "2024-08-02T12:59:10Z",
    "closed_at": "2024-08-23T08:04:17Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5431",
    "body": "I have this simple example:\r\n\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Server;\r\n\r\n$server = new \\Swoole\\Http\\Server(\"0.0.0.0\", 7101);\r\n$port2 = $server->addListener(\"0.0.0.0\", 7102, SWOOLE_SOCK_TCP);\r\n\r\n$server->set([\r\n                 'enable_delay_receive' => false,\r\n             ]);\r\n\r\n$port2->set([\r\n                'worker_num' => 2,\r\n                'max_request' => 100,\r\n                'enable_delay_receive' => true,\r\n            ]);\r\n\r\n$server->on('request', function ($request, $response) {\r\n    var_dump($request);\r\n});\r\n\r\n$port2->on('connect', function (Server $server, $fd, $reactorId) {\r\n    var_dump($server->setting);\r\n});\r\n\r\n$port2->on('receive', function (Server $server, $fd, $reactorId, $data) {\r\n    var_dump($data);\r\n});\r\n\r\n$server->start();\r\n```\r\n\r\nWhen I connect to TCP port 7102 with telnet, I get this settings:\r\n\r\n```\r\narray(9) {\r\n  [\"enable_delay_receive\"]=> bool(false)\r\n  [\"worker_num\"]=> int(1)\r\n  [\"task_worker_num\"]=> int(0)\r\n  [\"output_buffer_size\"]=> int(4294967295)\r\n  [\"max_connection\"]=> int(100000)\r\n  [\"open_http_protocol\"]=> bool(true)\r\n  [\"open_mqtt_protocol\"]=> bool(false)\r\n  [\"open_eof_check\"]=> bool(false)\r\n  [\"open_length_check\"]=> bool(false)\r\n}\r\n```\r\nI am interested in `enable_delay_receive` attribute, but also other settings are overriden. It should have different settings.\r\n\r\nMy environment:\r\n\r\nSwoole (compiled from git in docker container)\r\n\r\n```\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 5.1.3\r\nBuilt => Jul 24 2024 11:33:02\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 3.0.13 30 Jan 2024\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\nzlib => 1.2.13\r\nbrotli => E16777225/D16777225\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\ncoroutine_pgsql => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_fiber_mock => Off => Off\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\nPHP\r\n\r\n```\r\nPHP 8.3.9 (cli) (built: Jul 23 2024 07:41:00) (NTS)\r\nCopyright (c) The PHP Group\r\nZend Engine v4.3.9, Copyright (c) Zend Technologies\r\n    with Zend OPcache v8.3.9, Copyright (c), by Zend Technologies\r\n```\r\n\r\nGCC\r\n\r\n```\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/12/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none:amdgcn-amdhsa\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Debian 12.2.0-14' --with-bugurl=file:///usr/share/doc/gcc-12/README.Bugs --enable-languages=c,ada,c++,go,d,fortran,objc,obj-c++,m2 --prefix=/usr --with-gcc-major-version-only --program-suffix=-12 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-plugin --enable-default-pie --with-system-zlib --enable-libphobos-checking=release --with-target-system-zlib=auto --enable-objc-gc=auto --enable-multiarch --disable-werror --enable-cet --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none=/build/gcc-12-bTRWOB/gcc-12-12.2.0/debian/tmp-nvptx/usr,amdgcn-amdhsa=/build/gcc-12-bTRWOB/gcc-12-12.2.0/debian/tmp-gcn/usr --enable-offload-defaulted --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\nSupported LTO compression algorithms: zlib zstd\r\ngcc version 12.2.0 (Debian 12.2.0-14)\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5431/comments",
    "author": "grencik",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2024-08-03T12:19:50Z",
        "body": "```php\r\n$port2->on('connect', function (Server $server, $fd, $reactorId) use ($port2){\r\n    var_dump($port2->setting);\r\n});\r\n```"
      },
      {
        "user": "grencik",
        "created_at": "2024-08-05T05:53:16Z",
        "body": "> ```\r\n> $port2->on('connect', function (Server $server, $fd, $reactorId) use ($port2){\r\n>     var_dump($port2->setting);\r\n> });\r\n> ```\r\n\r\nTrue, I had it wrong. But still, when I set `enable_delay_receive` to true on $port2 it is ignored, until I set `enable_delay_receive` to true on $server. But I want to have different settings for different ports."
      },
      {
        "user": "matyhtf",
        "created_at": "2024-08-23T08:04:17Z",
        "body": "This option is a global setting and cannot be configured individually per port. After setting it, accepting connections will only trigger the `onConnect` event and will not receive data; must invoke `Server::resume()` to enable data reception."
      }
    ]
  },
  {
    "number": 5403,
    "title": "Critically Urgent: Cloud Deployment Architecture for Swoole in Multi-process / Multi-threaded Mode",
    "created_at": "2024-07-11T11:03:45Z",
    "closed_at": "2025-02-19T10:08:00Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5403",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nDevelopment using Swoole in Multi-process mode, instead of Base (single process) mode\r\n\r\n2. What did you expect to see?\r\n\r\nI expect to see an offering on a Third-party Cloud that can offer multi-process (non-Containerized) Deployment Architecture which fits to my multi-process requirements ? like, dedicated CPU Cores OR vCPUs (I think in Third-party Clouds, the \"vCPUs\" are more like OS-Threads, but not actual CPUs). \r\n\r\nIf no Cloud offers such Multi-process / Multi-threaded Deployment Architecture, then advise if we should go for a on-premise Deployments ? tailored to our custom needs.\r\n\r\n3. What did you see instead?\r\n\r\nI feel that Containerized Deployment Architecture may not fit to such multi-process / multi-threaded architecture (like Swoole in Multi-process mode, Go Lang, Netty / VertX (Java / Kotlin) and .NET (Core) ), because a Container maps to one single OS-process; a container can not offer a multi-process architecture. (I further think that in order to simulate multi-process architecture from Containers, we have to use multiple containers with gRPC / HTTP2 between them which has network layer over-heads and has management / DevOps cost). \r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n5.1.3\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\nUbuntu 22\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5403/comments",
    "author": "fakharksa",
    "comments": [
      {
        "user": "praswicaksono",
        "created_at": "2024-08-07T15:21:17Z",
        "body": "You can easily deploy multiprocess swoole in your vps/hardware right? I think you can utilize some deployment script like `deployer` to deploy to multipler server if needed"
      },
      {
        "user": "matyhtf",
        "created_at": "2025-02-19T10:08:00Z",
        "body": "I didn't fully understand your point. For Swoole's multi-process configuration, if coroutines are used, it operates in a fully asynchronous non-blocking manner, and should be set to 1-4 times the number of CPU cores. If no asynchronous IO is used, running in synchronous blocking mode, the number of processes should be set based on concurrency levels; for instance, if the server could handle up to 100 concurrent connections, then at least 100 worker processes should be configured."
      }
    ]
  },
  {
    "number": 5389,
    "title": "Manage connections at 1 second intervals from within the websocket task, close connections etc.",
    "created_at": "2024-06-30T02:58:24Z",
    "closed_at": "2024-07-04T09:43:56Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5389",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n```php\r\n$server = new Swoole\\Websocket\\Server('0.0.0.0', 82);\r\n\r\n$server->set([\r\n    //'worker_num' => (int) swoole_cpu_num(),\r\n    'task_worker_num' => 3,\r\n    'task_enable_coroutine' => true,\r\n]);\r\n\r\n$server->on('Task', function ($server, $TaskInfo) {\r\n\r\n    while (true) {\r\n        Swoole\\Coroutine::sleep(1);\r\n        echo \">>> task ! \\n\";\r\n\r\n        foreach ($server->connections as $Client) {\r\n\r\n            echo \">> - -- connn!! \\n\";\r\n            $ClientInfo = $server->getClientInfo($Client);\r\n\r\n            if ($ClientInfo <> false) {\r\n                echo \"--2--\\n\";\r\n                print_r($ClientInfo);\r\n            }\r\n        }\r\n    }\r\n\r\n});\r\n\r\n$server->on('start', function ($server) {\r\n    echo \"Websocket Server is started at ws://127.0.0.1:9502\\n\";\r\n\r\n    $server->task(\"\");\r\n});\r\n\r\n$server->on('open', function ($server, $req) {\r\n    echo \"connection open: {$req->fd}\\n\";\r\n});\r\n\r\n$server->on('message', function ($server, $frame) {\r\n    echo \"received message: {$frame->data}\\n\";\r\n    $server->push($frame->fd, json_encode(['hello', 'world']));\r\n});\r\n\r\n$server->on('close', function ($server, $fd) {\r\n    echo \"connection close: {$fd}\\n\";\r\n});\r\n\r\n$server->start();\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\nthe last v5.0.0.0-dev was working properly, I compiled it manually in centos 7.\r\n\r\nbut swoole-cli doesn't work anymore,\r\nineffective in server->connections task,\r\nif I keep the FDs on the table, then\r\n$server->getClientInfo($fd); -> always return false\r\nso getClientInfo from task is not working,\r\nI am closing the manual connection in task, \r\nthis code block is not working for this reason.\r\n\r\nData communication between tasks and processes created from this kind of code is extremely problematic and tedious, examples are very few, frankly, I'm struggling, it makes more sense to use structures like nodejs go, swoole should make good optimization in this regard and cancel the use of tables (because the table automatically reserves space from memory at startup and this space becomes unused, a big problem in microservices)\r\nshould improve access to variables, that is, if swoole does these messaging operations properly on its own side, the programmer does not have to deal with their mechanisms. (what I mean here is access to global variables and objects from the task and process, access to global variables and objects from the non-local, non-local function in any unit, write from function to global, etc.)\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nswoole-cli 5.1.3 on centos7\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\nLinux F.x 3.10.0-1160.118.1.el7.x86_64 #1 SMP Wed Apr 24 16:01:50 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5389/comments",
    "author": "okoca55",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2024-07-01T01:14:06Z",
        "body": "```php\r\n$server = new Swoole\\Websocket\\Server('0.0.0.0', 82, SWOOLE_PROCESS);\r\n```"
      },
      {
        "user": "okoca55",
        "created_at": "2024-07-02T03:43:31Z",
        "body": "> ```\r\n> $server = new Swoole\\Websocket\\Server('0.0.0.0', 82, SWOOLE_PROCESS);\r\n> ```\r\n\r\nThanks for the reply and help."
      }
    ]
  },
  {
    "number": 5250,
    "title": "make test error report",
    "created_at": "2024-02-13T16:19:36Z",
    "closed_at": "2024-02-18T04:04:10Z",
    "labels": [
      "question",
      "installation"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5250",
    "body": "```\r\n=====================================================================\r\nBORKED TEST SUMMARY\r\n---------------------------------------------------------------------\r\nFatal error: Uncaught Error: Undefined constant \"SWOOLE_BASE\" in /home/codefiles/swoole-src-5.1.2/tests/include/config.php:38\r\nStack trace:\r\n#0 /home/codefiles/swoole-src-5.1.2/tests/include/bootstrap.php(10): require_once()\r\n#1 /home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug38334.skip.php(6): require('/home/codefiles...')\r\n#2 {main}\r\n  thrown in /home/codefiles/swoole-src-5.1.2/tests/include/config.php on line 38 [/home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug38334.phpt]\r\nFatal error: Uncaught Error: Undefined constant \"SWOOLE_BASE\" in /home/codefiles/swoole-src-5.1.2/tests/include/config.php:38\r\nStack trace:\r\n#0 /home/codefiles/swoole-src-5.1.2/tests/include/bootstrap.php(10): require_once()\r\n#1 /home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug44327_2_2.skip.php(7): require('/home/codefiles...')\r\n#2 {main}\r\n  thrown in /home/codefiles/swoole-src-5.1.2/tests/include/config.php on line 38 [/home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug44327_2_2.phpt]\r\nFatal error: Uncaught Error: Undefined constant \"SWOOLE_BASE\" in /home/codefiles/swoole-src-5.1.2/tests/include/config.php:38\r\nStack trace:\r\n#0 /home/codefiles/swoole-src-5.1.2/tests/include/bootstrap.php(10): require_once()\r\n#1 /home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug44327_2_2.skip.php(7): require('/home/codefiles...')\r\n#2 {main}\r\n  thrown in /home/codefiles/swoole-src-5.1.2/tests/include/config.php on line 38 [/home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug44327_3_2.phpt]\r\nFatal error: Uncaught Error: Undefined constant \"SWOOLE_BASE\" in /home/codefiles/swoole-src-5.1.2/tests/include/config.php:38\r\nStack trace:\r\n#0 /home/codefiles/swoole-src-5.1.2/tests/include/bootstrap.php(10): require_once()\r\n#1 /home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug70862_1.skip.php(6): require('/home/codefiles...')\r\n#2 {main}\r\n  thrown in /home/codefiles/swoole-src-5.1.2/tests/include/config.php on line 38 [/home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug70862_1.phpt]\r\nFatal error: Uncaught Error: Undefined constant \"SWOOLE_BASE\" in /home/codefiles/swoole-src-5.1.2/tests/include/config.php:38\r\nStack trace:\r\n#0 /home/codefiles/swoole-src-5.1.2/tests/include/bootstrap.php(10): require_once()\r\n#1 /home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug44327_2_2.skip.php(7): require('/home/codefiles...')\r\n#2 {main}\r\n  thrown in /home/codefiles/swoole-src-5.1.2/tests/include/config.php on line 38 [/home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug78192_2.phpt]\r\nFatal error: Uncaught Error: Undefined constant \"SWOOLE_BASE\" in /home/codefiles/swoole-src-5.1.2/tests/include/config.php:38\r\nStack trace:\r\n#0 /home/codefiles/swoole-src-5.1.2/tests/include/bootstrap.php(10): require_once()\r\n#1 /home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug44327_2_2.skip.php(7): require('/home/codefiles...')\r\n#2 {main}\r\n  thrown in /home/codefiles/swoole-src-5.1.2/tests/include/config.php on line 38 [/home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug79664_2.phpt]\r\nFatal error: Uncaught Error: Undefined constant \"SWOOLE_BASE\" in /home/codefiles/swoole-src-5.1.2/tests/include/config.php:38\r\nStack trace:\r\n#0 /home/codefiles/swoole-src-5.1.2/tests/include/bootstrap.php(10): require_once()\r\n#1 /home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug44327_2_2.skip.php(7): require('/home/codefiles...')\r\n#2 {main}\r\n  thrown in /home/codefiles/swoole-src-5.1.2/tests/include/config.php on line 38 [/home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug_44159_sqlite_version_2.phpt]\r\nFatal error: Uncaught Error: Undefined constant \"SWOOLE_BASE\" in /home/codefiles/swoole-src-5.1.2/tests/include/config.php:38\r\nStack trace:\r\n#0 /home/codefiles/swoole-src-5.1.2/tests/include/bootstrap.php(10): require_once()\r\n#1 /home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug_63916_2.skip.php(7): require('/home/codefiles...')\r\n#2 {main}\r\n  thrown in /home/codefiles/swoole-src-5.1.2/tests/include/config.php on line 38 [/home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug_63916_2.phpt]\r\nFatal error: Uncaught Error: Undefined constant \"SWOOLE_BASE\" in /home/codefiles/swoole-src-5.1.2/tests/include/config.php:38\r\nStack trace:\r\n#0 /home/codefiles/swoole-src-5.1.2/tests/include/bootstrap.php(10): require_once()\r\n#1 /home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug44327_2_2.skip.php(7): require('/home/codefiles...')\r\n#2 {main}\r\n  thrown in /home/codefiles/swoole-src-5.1.2/tests/include/config.php on line 38 [/home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/open_basedir.phpt]\r\nFatal error: Uncaught Error: Undefined constant \"SWOOLE_BASE\" in /home/codefiles/swoole-src-5.1.2/tests/include/config.php:38\r\nStack trace:\r\n#0 /home/codefiles/swoole-src-5.1.2/tests/include/bootstrap.php(10): require_once()\r\n#1 /home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug70862_1.skip.php(6): require('/home/codefiles...')\r\n#2 {main}\r\n  thrown in /home/codefiles/swoole-src-5.1.2/tests/include/config.php on line 38 [/home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/pdo_fetch_func_001_1.phpt]\r\nFatal error: Uncaught Error: Undefined constant \"SWOOLE_BASE\" in /home/codefiles/swoole-src-5.1.2/tests/include/config.php:38\r\nStack trace:\r\n#0 /home/codefiles/swoole-src-5.1.2/tests/include/bootstrap.php(10): require_once()\r\n#1 /home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/bug44327_2_2.skip.php(7): require('/home/codefiles...')\r\n#2 {main}\r\n  thrown in /home/codefiles/swoole-src-5.1.2/tests/include/config.php on line 38 [/home/codefiles/swoole-src-5.1.2/tests/swoole_pdo_sqlite/pdo_sqlite_filename_uri.phpt]\r\n=====================================================================\r\n```\r\n\r\ndoes anyone knows if these test reports are normal? Compilation did not indicate failure, but 'make test' resulted in an error.\"",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5250/comments",
    "author": "FunnyRyan",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2024-02-14T02:59:51Z",
        "body": "`php -m` to check if the swoole.so extension is loaded.\r\nIf not, execute the following command. \r\n`echo \"extension=swoole.so\" >> /path/to/your/php.ini`"
      }
    ]
  },
  {
    "number": 5245,
    "title": "CURLOPT_SHARE option is not supported in Swoole 5.0.3",
    "created_at": "2024-02-01T07:55:04Z",
    "closed_at": "2024-02-18T04:04:48Z",
    "labels": [
      "question",
      "installation",
      "Incompatibility"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5245",
    "body": "When I want to use OpenTelementry on event \"Receive\" of TCP  Swoole socket\r\nIt shows me this error:\r\nOpenTelemetry: [error] Export failure [exception] swoole_curl_setopt(): option[10100] is not supported",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5245/comments",
    "author": "karevan",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2024-02-03T11:07:57Z",
        "body": "When compiling swoole, add --enable-swoole-curl to use the native curl."
      }
    ]
  },
  {
    "number": 5235,
    "title": "MySQL server fails connection at ./init of test",
    "created_at": "2024-01-17T20:53:03Z",
    "closed_at": "2024-01-24T07:25:30Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5235",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n$ ./configure && make -j`nproc` \r\nmodified php.ini with extension=swoole\r\n$ sudo make install\r\n$ cd tests\r\n$ php ./init\r\n\r\n2. What did you expect to see?\r\nI expected the mySQL server is completely ready, and being able to run unit tests.\r\n\r\n3. What did you see instead?\r\n$ php ./init \r\n```\r\n[DB-init] initialization MySQL database...\r\n\r\nDeprecated: Method Swoole\\Coroutine\\MySQL::__construct() is deprecated in /home/qbit/swoole-src/tests/init on line 42\r\n[DB-init] Connect failed! Error#2002: SQLSTATE[HY000] [2002] Connection refused\r\n\r\nFatal error: Uncaught Swoole\\ExitException: swoole exit in /home/qbit/swoole-src/tests/init:52\r\nStack trace:\r\n#0 [internal function]: {closure}()\r\n#1 {main}\r\n  thrown in /home/qbit/swoole-src/tests/init on line 52\r\n```\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n5.1.1\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\nLinux 6.5.0-14-generic \r\nUbuntu 22.04.1 x86_64\r\nphp 8.4.0\r\nclang-15.0.6\r\n\r\nThank you!\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5235/comments",
    "author": "junwha",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2024-01-24T07:25:30Z",
        "body": "You need to modify the `tests/include/config.php` file, Set database username and password"
      }
    ]
  },
  {
    "number": 5226,
    "title": " Uncaught Swoole\\Error: cURL is executing, cannot be operated in",
    "created_at": "2023-12-28T10:20:00Z",
    "closed_at": "2024-01-16T11:34:07Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5226",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n队列下执行会报这个错误\r\n\r\n```\r\nPHP Fatal error:  Uncaught Swoole\\Error: cURL is executing, cannot be operated in /var/www/backend/vendor/symfony/http-client/CurlHttpClient.php:329\r\nStack trace:\r\n#0 /var/www/backend/vendor/symfony/http-client/CurlHttpClient.php(329): curl_multi_exec(Resource id #699, 0)\r\n#1 /var/www/backend/vendor/symfony/http-client/Internal/HttplugWaitLoop.php(65): Symfony\\Component\\HttpClient\\CurlHttpClient->stream(Object(SplObjectStorage), NULL)\r\n#2 /var/www/backend/vendor/symfony/http-client/HttplugClient.php(130): Symfony\\Component\\HttpClient\\Internal\\HttplugWaitLoop->wait(Object(Symfony\\Component\\HttpClient\\Response\\CurlResponse))\r\n#3 /var/www/backend/vendor/guzzlehttp/promises/src/Promise.php(248): Symfony\\Component\\HttpClient\\HttplugClient::Symfony\\Component\\HttpClient\\{closure}(true)\r\n#4 /var/www/backend/vendor/guzzlehttp/promises/src/Promise.php(224): GuzzleHttp\\Promise\\Promise->invokeWaitFn()\r\n#5 /var/www/backend/vendor/guzzlehttp/promises/src/Promise.php(269): GuzzleHttp\\Promise\\Promise->waitIfPending()\r\n#6 /var/www/backend/vendor/guzzl in /var/www/backend/vendor/symfony/http-client/CurlHttpClient.php on line 329\r\n```\r\n\r\n\r\n2. What version of Swoole are you using (show your `php --ri swoole`)?\r\n```\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.8.13\r\nBuilt => Nov 29 2023 01:46:49\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.1w  11 Sep 2023\r\ndtls => enabled\r\ncurl-native => enabled\r\nzlib => 1.2.12\r\nbrotli => E16777225/D16777225\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n\r\n3. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n`php -v`\r\n\r\nPHP 7.4.27 (cli) (built: Dec 16 2021 22:42:18) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v3.4.0, Copyright (c) Zend Technologies\r\n    with Zend OPcache v7.4.27, Copyright (c), by Zend Technologies\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5226/comments",
    "author": "cloud-arrow",
    "comments": [
      {
        "user": "cloud-arrow",
        "created_at": "2023-12-28T10:29:40Z",
        "body": "@matyhtf  大佬帮忙看一下，🙏"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2023-12-28T10:32:18Z",
        "body": "看起来像是两个协程用了同一个curl连接"
      },
      {
        "user": "cloud-arrow",
        "created_at": "2023-12-28T11:13:15Z",
        "body": "> 看起来像是两个协程用了同一个curl连接\r\n\r\n不是吧，共用同一个连接，我记得是报这种错误的 \r\nFatal error: Uncaught Swoole\\Error: Socket#6 has already been bound to another coroutine#2, reading or writing of the same socket in coroutine#3 at the same time is not allowed \r\n\r\n@NathanFreeman "
      },
      {
        "user": "NathanFreeman",
        "created_at": "2023-12-28T11:29:37Z",
        "body": "没错，是多个协程共用一个curl连接\r\n```c++\r\n    Coroutine *check_bound_co() {\r\n        if (co) {\r\n            swoole_fatal_error(SW_ERROR_CO_HAS_BEEN_BOUND, \"cURL is executing, cannot be operated\");\r\n            return nullptr;\r\n        }\r\n        return Coroutine::get_current_safe();\r\n    }\r\n```"
      },
      {
        "user": "cloud-arrow",
        "created_at": "2023-12-28T11:52:36Z",
        "body": "> 没错，是多个协程共用一个curl连接\r\n> \r\n> ```c++\r\n>     Coroutine *check_bound_co() {\r\n>         if (co) {\r\n>             swoole_fatal_error(SW_ERROR_CO_HAS_BEEN_BOUND, \"cURL is executing, cannot be operated\");\r\n>             return nullptr;\r\n>         }\r\n>         return Coroutine::get_current_safe();\r\n>     }\r\n> ```\r\n\r\n你好，那这个要怎么解决？ @NathanFreeman "
      },
      {
        "user": "NathanFreeman",
        "created_at": "2023-12-28T13:55:10Z",
        "body": "检查一下代码是哪里出问题或者找不到问题代码在哪就关闭协程"
      },
      {
        "user": "matyhtf",
        "created_at": "2024-01-16T11:34:35Z",
        "body": "两个协程公用了同一个 curl 句柄导致"
      },
      {
        "user": "qiqizjl",
        "created_at": "2024-01-29T10:02:56Z",
        "body": "我们也同样出现了这个问题  怀疑是symfony/http-client这个库的问题？"
      }
    ]
  },
  {
    "number": 5208,
    "title": "swoole报错sendto to reactor failed, Error; No buffer space available[105)",
    "created_at": "2023-11-30T02:30:04Z",
    "closed_at": "2023-12-08T00:21:52Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5208",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n(2023-10-30 11:22:32 *1026,4] WARNING sFactoryProcess finish(:473): sendto to reactor failed, Error; No buffer space available[105)\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.23\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\nPHP 7.3.28 (cli)\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5208/comments",
    "author": "desertfoxfj",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2023-12-08T00:21:52Z",
        "body": "升级一下版本，新版本已解决。发送的数据太大，内核缺少连续内存空间存储数据。"
      }
    ]
  },
  {
    "number": 5201,
    "title": "Timer::tick prevents server from stopping. SIGTERM is getting ignored",
    "created_at": "2023-11-26T19:46:45Z",
    "closed_at": "2024-01-16T11:40:29Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5201",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nI have this code in my websocket server:\r\n\r\n```\r\nTimer::tick(1000, fn() => $this->cleanup());\r\n```\r\n\r\nCalling `kill PID` on master process will be ignored. When tick is removed from code - kill PID works\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n```\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 5.1.1\r\nBuilt => Nov 26 2023 19:04:32\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 3.0.11 19 Sep 2023\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\nc-ares => 1.18.1\r\nzlib => 1.2.13\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_fiber_mock => Off => Off\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n```\r\nLinux f57a4d431535 6.4.16-linuxkit #1 SMP PREEMPT Thu Nov 16 10:49:20 UTC 2023 aarch64 GNU/Linux\r\n\r\nPHP 8.2.12 (cli) (built: Nov 21 2023 14:57:12) (NTS)\r\nCopyright (c) The PHP Group\r\nZend Engine v4.2.12, Copyright (c) Zend Technologies\r\n\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/aarch64-linux-gnu/12/lto-wrapper\r\nTarget: aarch64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Debian 12.2.0-14' --with-bugurl=file:///usr/share/doc/gcc-12/README.Bugs --enable-languages=c,ada,c++,go,d,fortran,objc,obj-c++,m2 --prefix=/usr --with-gcc-major-version-only --program-suffix=-12 --program-prefix=aarch64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-libquadmath --disable-libquadmath-support --enable-plugin --enable-default-pie --with-system-zlib --enable-libphobos-checking=release --with-target-system-zlib=auto --enable-objc-gc=auto --enable-multiarch --enable-fix-cortex-a53-843419 --disable-werror --enable-checking=release --build=aarch64-linux-gnu --host=aarch64-linux-gnu --target=aarch64-linux-gnu\r\nThread model: posix\r\nSupported LTO compression algorithms: zlib zstd\r\ngcc version 12.2.0 (Debian 12.2.0-14\r\n\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5201/comments",
    "author": "zip-fa",
    "comments": [
      {
        "user": "zip-fa",
        "created_at": "2023-11-26T19:54:03Z",
        "body": "I thought i can register some event/signal handler, and then call Timer::clearAll(), but i had no success.\r\n\r\nTried Process\\signal:\r\n\r\n```\r\n\\Swoole\\Process::signal(SIGTERM, function () {\r\n            var_dump('sigterm!');\r\n            Timer::clearAll();\r\n        });\r\n```\r\n\r\nreceived this warning:\r\n\r\n```\r\nWarning: Swoole\\Process::signal(): signal [15] processor has been registered by the system in /app.php on line 18\r\n```\r\n\r\n... and callback is never executed\r\n\r\n`$server->on('shutdown')` is not triggered in my case too."
      },
      {
        "user": "NathanFreeman",
        "created_at": "2023-12-06T10:20:29Z",
        "body": "In Swoole\\Server, it is not possible to set certain signal listeners, such as `SIGTERM` and `SIGALAM`."
      },
      {
        "user": "zip-fa",
        "created_at": "2023-12-06T10:45:57Z",
        "body": "Okay, but when i add Timer in my server, it cant be stopped gracefully. It delays deployments etc. Can this be fixed on your side? Can you guys add logic to kill every timer when SIGTERM received?"
      },
      {
        "user": "matyhtf",
        "created_at": "2024-01-16T11:40:29Z",
        "body": "@zip-fa You should listen to the `workerExit` event and perform cleanup in this event callback\r\n\r\n```php\r\n\r\n$serv = new Swoole\\Server(\"0.0.0.0\", 9501);\r\n\r\n$serv->on('WorkerExit', function ($serv, $workerId){\r\n\t$this->cleanup();\r\n});\r\n\r\n$serv->start();\r\n```"
      },
      {
        "user": "zip-fa",
        "created_at": "2024-01-16T11:50:25Z",
        "body": "This doesn't resolve my issue, since i have specific code and workerExit is not suitable.\r\nEven if i move my code, Timer::tick() issue will not be resolved. Can this be reopened? @matyhtf "
      },
      {
        "user": "kingIZZZY",
        "created_at": "2024-02-19T18:11:19Z",
        "body": "+1\r\nCreating Timers such as `Timer::tick(...)` before starting the server\r\nEven if doing `Timer::clear(...)`\r\n$server->shutdown() does not work\r\nThe process remains stuck and does not shutdown"
      }
    ]
  },
  {
    "number": 5195,
    "title": "使用Swoole\\Process::exec()报错：PHP Warning: sr/bin/php) failed, Error: Argument list too long[7]",
    "created_at": "2023-11-20T06:47:38Z",
    "closed_at": "2023-11-21T03:33:20Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5195",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n```php\r\n$workerNum = 2;//线程数\r\n\r\n$pool      = new Swoole\\Process\\Pool($workerNum);\r\n\r\n$pool->on(\"WorkerStart\", function ($pool, $workerId) use ($database, $params, $logger,$workerNum) {\r\n    try {\r\n    $mysqli = new Mysqli($database['host'], $database['username'], $database['password'], $database['dbname']);\r\n    $table  = 'excel_task';\r\n    $rest_service = new ResetService();\r\n    while (true) {\r\n\r\n            //利用swoole线程池\r\n            $sql = \"\r\n                select user_id,\r\n                   executable_path,\r\n                   action_name,\r\n                   args_json,\r\n                   id\r\n              from `excel_task`\r\n             where flag= 0\r\n               and action_name is not null\r\n               and mod(id,$workerNum)=$workerId\r\n               and `executable_path` IS NULL \r\n             ORDER BY `id` asc;\r\n                \";\r\n            $result = $mysqli->query($sql);\r\n            $res    = $result->fetch_row();\r\n\r\n            if ($res) {\r\n                $v           = $res;\r\n                $process     = $pool->getProcess();\r\n                $executable  = $v[1] ?? $params['config']['application']['appDir'] . 'cli.php';\r\n                $action      = explode(',', $v[2]);\r\n                $task_name   = $action[0];\r\n                $action_name = $action[1];\r\n                $arg1        = $v[3];\r\n                $arg2        = $v[4];\r\n                if (empty($action_name)){\r\n                    $args = [$executable, $task_name, $arg1,$arg2];\r\n                    $process->exec(PHP_BINDIR . '/php', $args); // exec 系统调用\r\n                }else{\r\n                    $args = [$executable, $task_name, $action_name, $arg1,$arg2];\r\n                    $process->exec(PHP_BINDIR . '/php', $args); // exec 系统调用\r\n                    \r\n\r\n                }\r\n\r\n            } else {\r\n                sleep(1);\r\n\r\n            }\r\n\r\n    }\r\n    } catch (\\Exception $e) {\r\n        $logger->write_log(\"=================begin hubbonusAction \" . time() . \"==========\", 'info');\r\n        exit;\r\n    }\r\n});\r\n$pool->start();\r\n$logger->write_log(\"=================begin hubbonusAction \" . time() . \"==========\", 'info');\r\n```\r\n\r\n3. What did you expect to see?\r\n$process->exec() 正常调起新进程\r\n\r\n\r\n4. What did you see instead?\r\nPHP Warning:\r\nSwoole Process::exec(): execv(/usr/bin/php) failed, Error: Argument list too long[7]\r\n\r\n\r\n5. What version of Swoole are you using (show your `php --ri swoole`)?\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.7.1\r\nBuilt => Aug 26 2021 21:33:45\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n6. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\nuname -a \r\nLinux my-alimy-ard-bi-pro-5-186 4.15.0-144-generic #148-Ubuntu SMP Sat May 8 02:33:43 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nphp -v\r\nPHP 7.2.34-23+ubuntu18.04.1+deb.sury.org+1 (cli) (built: Jul  1 2021 16:06:47) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.2.34-23+ubuntu18.04.1+deb.sury.org+1, Copyright (c) 1999-2018, by Zend Technologies\r\n\r\ngcc -v\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/7/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 7.5.0-3ubuntu1~18.04' --with-bugurl=file:///usr/share/doc/gcc-7/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-7 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 7.5.0 (Ubuntu 7.5.0-3ubuntu1~18.04)\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5195/comments",
    "author": "wangsijia",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2023-11-21T03:33:20Z",
        "body": "命令参数无法传递太长的内容，建议使用标准输入输出与进程交互，而不是将所有内容都放到 `argv` 中。"
      },
      {
        "user": "wangsijia",
        "created_at": "2023-11-21T03:43:25Z",
        "body": "> 命令参数无法传递太长的内容，建议使用标准输入输出与进程交互，而不是将所有内容都放到 `argv` 中。\r\n\r\n您说的这个怎么实现呢？能举个简单的例子吗？"
      }
    ]
  },
  {
    "number": 5126,
    "title": "HTTP连接池使用Swoole\\Coroutine\\Http\\Client，请求结束后有清理内存的方法吗？",
    "created_at": "2023-08-15T05:10:24Z",
    "closed_at": "2023-08-16T01:31:36Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5126",
    "body": "如果使用Swoole\\Coroutine\\Http\\Client对象，请求结束后放入连接池中，那么响应的body等数据是否会一直在内存中直到下次使用的时候才释放上次请求的内存？如果是这样的话，有没有方法可以在请求结束的时候先释放掉内存再把连接放入连接池？\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5126/comments",
    "author": "omigafu",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2023-08-15T12:23:48Z",
        "body": "在下次请求之前，会自动将这些数据全部重置为默认值。"
      }
    ]
  },
  {
    "number": 5120,
    "title": "mysql协程客户端prepare未能在错误执行的sql语句中关闭stmt对象",
    "created_at": "2023-08-04T09:18:53Z",
    "closed_at": "2023-08-16T01:56:06Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5120",
    "body": "### 问题描述\r\nmysql协程客户端执行prepare语句后，如果产生错误，未能对stmt进行关闭\r\n\r\n### Swoole版本，PHP版本，以及操作系统版本信息\r\nswoole 4.8.10\r\nphp 7.4.33\r\nunbuntu 18.04\r\n\r\n### 相关代码\r\n```php\r\nuse Swoole\\Coroutine\\MySQL;\r\nuse function Swoole\\Coroutine\\run;\r\n\r\nrun(function () {\r\n    $db = new MySQL();\r\n    $ret1 = $db->connect([\r\n        'host'     => '127.0.0.1',\r\n        'port'     => 3307,\r\n        'user'     => 'root',\r\n        'password' => 'root',\r\n        'database' => 'yisa_oe_fusion',\r\n    ]);\r\n    $stmt = $db->prepare('SELECT * FROM user WHERE id=?');\r\n    if ($stmt == false) {\r\n        var_dump($db->errno, $db->error);\r\n    } else {\r\n        $ret2 = $stmt->execute(array(1));\r\n        var_dump($ret2);\r\n    }\r\n});\r\n```\r\n```shell\r\n\r\nMariaDB [(none)]> show global status like '%com_stmt%';\r\n+-------------------------+-------+\r\n| Variable_name           | Value |\r\n+-------------------------+-------+\r\n| Com_stmt_close          | 2032  |\r\n| Com_stmt_execute        | 2071  |\r\n| Com_stmt_fetch          | 0     |\r\n| Com_stmt_prepare        | 2073  |\r\n| Com_stmt_reprepare      | 0     |\r\n| Com_stmt_reset          | 0     |\r\n| Com_stmt_send_long_data | 0     |\r\n+-------------------------+-------+\r\n7 rows in set (0.000 sec)\r\n\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5120/comments",
    "author": "numst",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2023-08-16T01:56:06Z",
        "body": "@numst 直接使用 runtime hook + pdo mysql 吧，这个客户端不再维护了。"
      }
    ]
  },
  {
    "number": 5105,
    "title": "Debian vs Alpine images",
    "created_at": "2023-07-25T07:46:45Z",
    "closed_at": "2023-08-16T01:37:32Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5105",
    "body": "I wanted to ask, is there some big difference between this two official images, because for development I've used Debian, but for production is Alpine, and now after entering production, several things pops up:\r\n1. Server just stops responding, but totally random. Sometimes in few hours, sometimes in few days, but it always has around 500.000 REST requests per day. Service is very simple, passing REST to GRPC service, no DB, Curl or Redis used.\r\n2. is_integer fails on Alpine, when number is bigger than 32-bit integer, even host is 64-bit\r\n3. bcmath isn't included in Alpine image by default, but in Debian it is\r\n\r\nGRPC service is tested, handled all possible problems: unable to connect, no response, broken connection, grpc error etc...\r\nSwoole used is 5.0.3, PHP 8.1, process mode",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5105/comments",
    "author": "ipejasinovic",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2023-08-04T02:58:17Z",
        "body": "Please set php `error_log` , set the `log_file` for swoole, whether there is a fatal error and observe the `dmesg` log of the OS, whether there is a crash"
      }
    ]
  },
  {
    "number": 5071,
    "title": "为什么think-swoole设置的链接池为100，最后链接数据会超过100？",
    "created_at": "2023-06-13T09:43:54Z",
    "closed_at": "2023-06-20T11:53:05Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5071",
    "body": "thinkphp6\r\nswoole版本 Version => 4.8.11\r\nthinkphp config/swoole.php 设置\r\n` \r\n  'coroutine'=>[\r\n        'enable'=>true,\r\n        'flags' => SWOOLE_HOOK_ALL\r\n    ],\r\n//连接池\r\n    'pool'       => [\r\n        'db'    => [\r\n            'enable'        => true,\r\n            'max_active'    => 100,\r\n            'max_wait_time' => 5,\r\n        ],\r\n        'cache' => [\r\n            'enable' => true,\r\n            'max_active' => 100,\r\n            'max_wait_time' => 20,\r\n        ],\r\n        //自定义连接池\r\n    ],`\r\n\r\n\r\n项目运行2天后去查看tcp链接数量\r\n[root@php-swoole-54999bf74c-vl4cz /]# netstat -n | awk '/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}'\r\nESTABLISHED 1758\r\nTIME_WAIT 878\r\n\r\nredis链接的内部服务器，使用命令查询\r\n`netstat -nat | grep 192.168.0.230:6379`\r\n\r\n查看链接6379端口的链接跟查询tcp链接数量相差不大\r\n\r\n为什么会超过链接池设置的大小呢？我看think-swoole扩展也是使用的swoole的链接池\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5071/comments",
    "author": "Funny-dot",
    "comments": [
      {
        "user": "he426100",
        "created_at": "2023-06-17T02:13:37Z",
        "body": "max_active * worker_num"
      }
    ]
  },
  {
    "number": 5052,
    "title": "swoole mqtt subscribe.php 使用一段时间后 $buffer = $client->recv();  接收不到mqtt消息了",
    "created_at": "2023-05-12T07:33:11Z",
    "closed_at": "2023-05-13T12:55:19Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5052",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n我使用 swoole mqtt的subscribe.php 在后台运行一段时间(1-2天)后，就会死掉，下面的ping 还是执行，但是 recv函数收不到 消息。\r\n运行这个程序，我使用  docker exec -it emqtt-bench ./emqtt_bench conn -h xxx  -p 1883 -c -20000 --username xxx --password xxx 进行压力测试的话，大概到 15000左右就会报错，同时后面 subscribe.php中的 recv 接收不了新的数据了\r\n\r\n2. What did you expect to see?\r\n\r\n我希望 报错后可以继续运行， recv 可以继续收到后面的消息\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.8.12\r\nBuilt => Oct 15 2022 15:04:22\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.0.2k-fips  26 Jan 2017\r\nhttp2 => enabled\r\ncurl-native => enabled\r\npcre => enabled\r\nc-ares => 1.10.0\r\nzlib => 1.2.7\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\nLinux iZwz92v9xcjoph6qyuhvp9Z 3.10.0-1160.45.1.el7.x86_64 #1 SMP Wed Oct 13 17:20:51 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\r\nPHP 7.3.13 (cli) (built: Oct 28 2022 11:10:13) ( NTS )\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5052/comments",
    "author": "dengweicai",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2023-05-13T12:55:19Z",
        "body": "检查 Client recv 返回值和错误码，增加断线重连的逻辑"
      }
    ]
  },
  {
    "number": 5041,
    "title": "undefined symbol: curl_multi_ce",
    "created_at": "2023-05-01T06:03:29Z",
    "closed_at": "2023-05-05T02:20:36Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5041",
    "body": "`PHP Warning:  PHP Startup: Unable to load dynamic library 'swoole.so' (tried: /usr/lib64/php/modules/swoole.so (/usr/lib64/php/modules/swoole.so: undefined symbol: curl_multi_ce), /usr/lib64/php/modules/swoole.so.so (/usr/lib64/php/modules/swoole.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0`\r\n\r\nSwoole：5.0.3\r\n系统：AlmaLinux 9.1\r\nLinux内核：5.14.0-162.23.1.el9_1.x86_64\r\nPHP：8.2.5\r\nGCC：Package gcc-11.3.1-2.1.el9.alma.x86_64 is already installed.\r\nOpenSSL：Package openssl-1:3.0.1-47.el9_1.x86_64 is already installed.\r\nCurl：Package libcurl-7.76.1-19.el9_1.2.x86_64 is already installed.\r\n我已经安装了openssl和curl软件包，PHP也加载了这两个模块，但是当我将swoole.so引入php.ini后，输入PHP -m命令报错以上内容\r\n\r\n编译安装选项 --enable-openssl --enable-swoole-curl --enable-brotli --enable-debug",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5041/comments",
    "author": "Rodots",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2023-05-03T08:54:51Z",
        "body": "不用在php.ini里面写`extension=swoole.so`，跟其它用pecl安装的扩展一样，写一份独立的swoole.ini，让php.ini自动引用就行，其中要保证curl要在swoole之前加载"
      },
      {
        "user": "matyhtf",
        "created_at": "2023-05-05T02:20:36Z",
        "body": "把 extension=swoole.so 放到 extension=curl.so 后面"
      },
      {
        "user": "fundawang",
        "created_at": "2023-08-21T04:57:38Z",
        "body": "我觉得开启了`enable-swoole-curl`的时候，应该链接到 libcurl，不能指望 php-curl 的extension把curl装进来。"
      },
      {
        "user": "jingjingxyk",
        "created_at": "2023-08-21T05:21:54Z",
        "body": "@fundawang  这是 链接顺序的问题。先链接liubcurl ，swoole 才能连接到 libcurl  。\r\n\r\nswoole 扩展依赖curl 扩展，curl扩展依赖库libcurl"
      }
    ]
  },
  {
    "number": 5017,
    "title": "swoole进程中使用协程死锁问题",
    "created_at": "2023-03-29T10:07:31Z",
    "closed_at": "2023-04-14T09:53:57Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5017",
    "body": "### 现象\r\nswoole进程中，创建协程，使用协程客户端从服务端收取消息，结果报错`[FATAL ERROR]: all coroutines (count: 1) are asleep - deadlock!`\r\n\r\n### 简化代码\r\n\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Process;\r\n\r\nclass DeadLock\r\n{\r\n    public function startProcess()\r\n    {\r\n        $t = new Swoole\\Process(function () {\r\n            swoole_async_set(['enable_coroutine' => true]);\r\n            go(function (){\r\n                for (; ;) {\r\n                    Swoole\\Coroutine\\System::sleep(1);\r\n                    var_dump('dd');\r\n                }\r\n            });\r\n        });\r\n        $t->start();\r\n    }\r\n}\r\n\r\n$proc = new Process(function () {\r\n    swoole_async_set(['enable_coroutine' => false]);\r\n    $cls = new DeadLock();\r\n    //$cls->startProcess(); 1. 此处调用不报错\r\n    \\Swoole\\Timer::after(1000, function () use ($cls) {\r\n        $cls->startProcess(); //2. 此处调用会报错\r\n    });\r\n});\r\n$proc->start();\r\n```\r\n\r\n### 环境信息\r\nphp版本：7.2.34\r\nswoole版本：\r\n```\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.8.9\r\nBuilt => May 10 2022 20:17:44\r\ncoroutine => enabled with boost asm context\r\nkqueue => enabled\r\nrwlock => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 262144 => 262144\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5017/comments",
    "author": "suuhui",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2023-03-30T13:28:12Z",
        "body": "```php\r\n<?php\r\n\r\nuse Swoole\\Process;\r\nuse Swoole\\Event;\r\n\r\nclass DeadLock\r\n{\r\n    public function startProcess()\r\n    {\r\n        $t = new Swoole\\Process(function () {\r\n            swoole_async_set(['enable_coroutine' => true]);\r\n            go(function (){\r\n                for (; ;) {\r\n                        Swoole\\Coroutine\\System::sleep(1);\r\n                        var_dump('dd');\r\n                }\r\n            });\r\n            Swoole\\Event::wait();\r\n        });\r\n        $t->start();\r\n        Process::wait();\r\n    }\r\n}\r\n\r\n\r\n$proc = new Process(function () {\r\n    swoole_async_set(['enable_coroutine' => false]);\r\n    $cls = new DeadLock();\r\n    //$cls->startProcess();\r\n    \\Swoole\\Timer::after(1000, function () use ($cls) {\r\n            $cls->startProcess();\r\n    });\r\n    Event::wait();\r\n});\r\nvar_dump($proc->start());\r\nProcess::wait();\r\n```\r\n\r\n你可以试试这么写，现在是推荐在文件末尾加上`Swoole\\Event::wait()`启动事件机制。"
      },
      {
        "user": "suuhui",
        "created_at": "2023-03-31T04:21:39Z",
        "body": "@NathanFreeman 这样写就可以了，能讲解下为什么不加`Swoole\\Event::wait()`就报错吗"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2023-04-01T03:45:12Z",
        "body": "这个其实是因为如果不加`Swoole\\Event::wait()`，依靠`php_swoole_register_shutdown_function`注册的函数执行事件机制的话在一些特定的场景下总有一些奇奇怪怪的问题。"
      }
    ]
  },
  {
    "number": 5011,
    "title": "Swoole 5.0.1 在User Process中遍历 $server->connections 为空，而在onReceive遍历不为空，这是Bug吗？",
    "created_at": "2023-03-16T01:28:37Z",
    "closed_at": "2023-03-16T02:31:14Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5011",
    "body": null,
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5011/comments",
    "author": "MsZhu",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2023-03-16T02:31:14Z",
        "body": "5.0 默认使用 BASE 模式，你可以改为 PROCESS"
      },
      {
        "user": "MsZhu",
        "created_at": "2023-03-16T09:36:13Z",
        "body": "嗯，改了就对了，得回头多理解下下，谢谢大神解答！~"
      }
    ]
  },
  {
    "number": 5006,
    "title": "swoole5.0.1  workerStart中使用$server->push报错",
    "created_at": "2023-03-10T03:35:48Z",
    "closed_at": "2023-03-10T06:30:39Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5006",
    "body": "\r\nPHP Warning:  Swoole\\WebSocket\\Server::push(): the connected client of connection[1] is not a websocket client or closed in ",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5006/comments",
    "author": "mf04",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2023-03-10T03:44:10Z",
        "body": "`workerStart`事件发生的时候，`worker`进程才刚刚启动，都没有客户端连接，所以不能用这个函数"
      },
      {
        "user": "mf04",
        "created_at": "2023-03-10T04:18:09Z",
        "body": "4.8.9可以，莫名奇妙升级之后，就不好使了。workerStart中异步获取的数据，不存在你说的没有客户端连接的问题"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2023-03-10T05:12:32Z",
        "body": "还有可能就是这个连接已经不存在或者没有经过websocket handshake，所以就会这个报错。\r\n或者提供可复现的最小化代码，我这边看看。"
      },
      {
        "user": "matyhtf",
        "created_at": "2023-03-10T06:30:39Z",
        "body": "请注意查看更新日志，5.0 之后默认运行模式改为了 SWOOLE_BASE"
      }
    ]
  },
  {
    "number": 5004,
    "title": "Connect EVENT: \"Invalid frame header\"",
    "created_at": "2023-03-09T01:46:31Z",
    "closed_at": "2023-03-09T04:21:30Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5004",
    "body": "### Invalid frame header\r\nPlease answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n客户端连接时，突然发现报“**Invalid frame header**”\r\n\r\n服务端直接进入 Close事件\r\n\r\n2. What did you expect to see?\r\n当时啥都正常，不过这个问题之前也出现多很多次，Invalid frame header，后来解决了，忘记怎么解决了。（各种搜也是没有结果，所以今天提一个issue记录一下最后解决办法，以备后查。）\r\n\r\n3. What did you see instead?\r\n连接提示“Error”\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nVersion => 4.4.17\r\nBuilt => Jun 29 2020 18:34:48\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.0.2k-fips  26 Jan 2017\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => 1.2.7\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n都很标准的环境，昨天可以，今天就不行。\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5004/comments",
    "author": "tengdengming",
    "comments": [
      {
        "user": "tengdengming",
        "created_at": "2023-03-09T01:56:06Z",
        "body": "### 注意注意，不是配置问题，不是代码逻辑问题。Invalid frame header\r\n是通讯事件编程正常逻辑理解的问题。在Connect，或者OnOpen事件注册逻辑中，有时候为了做一些测试或者同步阻塞的操作时，将业务逻辑写到了默认事件中，导致上下文句柄逻辑生命周期怪圈。\r\n\r\n比如我在测试的时候为了测回一个包，简单的将send发送写在了OnOpen事件处理域的协程处理单元，在协程又global全局调用主类的send方法。导致连接事件中去执行一个基于连接以后的发送调用，然后就出现了### Invalid frame header\r\n。是不是有点奇怪，（它是不会明确的告诉你错在哪里）\r\n\r\n拿掉后即可恢复正常，这个问题碰到过2次以上，但是时间久了，写别的去了就忘记了。\r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2023-03-09T04:21:30Z",
        "body": "不要使用 `Server::send()` 方法，这是原始的 `tcp send`，改为使用 `Server::push()`"
      },
      {
        "user": "tengdengming",
        "created_at": "2023-03-13T07:03:27Z",
        "body": "学习了，TCP层面的用Server::push()。 @matyhtf 。另外请教一下，可以在哪里看到这种异常信息日志？"
      }
    ]
  },
  {
    "number": 5003,
    "title": "can not make test, error",
    "created_at": "2023-03-08T23:38:03Z",
    "closed_at": "2023-03-09T04:20:02Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5003",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nmake test script does not work property.\r\nkawada@plt-batman-y13001:~/app/swoole-src/tests$ ./start.sh base|head\r\n\r\n=====================================================================\r\nPHP         : /usr/bin/php\r\nPHP_SAPI    : cli\r\nPHP_VERSION : 8.1.2\r\nZEND_VERSION: 4.1.2\r\nPHP_OS      : Linux - Linux plt-batman-y13001.i1.dev.v6.internal-gmo 5.15.0-41-generic #44-Ubuntu SMP Wed Jun 22 14:20:53 UTC 2022 x86_64\r\nINI actual  : /etc/php/8.1/cli/php.ini\r\nMore .INIs  : /etc/php/8.1/cli/conf.d/10-opcache.ini,/etc/php/8.1/cli/conf.d/10-pdo.ini,/etc/php/8.1/cli/conf.d/15-xml.ini,/etc/php/8.1/cli/conf.d/20-bcmath.ini,/etc/php/8.1/cli/conf.d/20-calendar.ini,/etc/php/8.1/cli\r\n/conf.d/20-ctype.ini,/etc/php/8.1/cli/conf.d/20-dom.ini,/etc/php/8.1/cli/conf.d/20-exif.ini,/etc/php/8.1/cli/conf.d/20-ffi.ini,/etc/php/8.1/cli/conf.d/20-fileinfo.ini,/etc/php/8.1/cli/conf.d/20-ftp.ini,/etc/php/8.1/cl\r\ni/conf.d/20-gettext.ini,/etc/php/8.1/cli/conf.d/20-iconv.ini,/etc/php/8.1/cli/conf.d/20-mbstring.ini,/etc/php/8.1/cli/conf.d/20-phar.ini,/etc/php/8.1/cli/conf.d/20-posix.ini,/etc/php/8.1/cli/conf.d/20-readline.ini,/et\r\nc/php/8.1/cli/conf.d/20-shmop.ini,/etc/php/8.1/cli/conf.d/20-simplexml.ini,/etc/php/8.1/cli/conf.d/20-sockets.ini,/etc/php/8.1/cli/conf.d/20-sysvmsg.ini,/etc/php/8.1/cli/conf.d/20-sysvsem.ini,/etc/php/8.1/cli/conf.d/2\r\n0-sysvshm.ini,/etc/php/8.1/cli/conf.d/20-tokenizer.ini,/etc/php/8.1/cli/conf.d/20-xmlreader.ini,/etc/php/8.1/cli/conf.d/20-xmlwriter.ini,/etc/php/8.1/cli/conf.d/20-xsl.ini\r\nCWD         : /home/kawada/app/swoole-src/tests\r\nkawada@plt-batman-y13001:~/app/swoole-src/tests$ ./start.sh base|head -30\r\n=====================================================================\r\nRunning selected tests.\r\nTEST 1/1104 [swoole_atomic/atomic.phpt]\r\n\r\n========DIFF========\r\n001+ Warning: require(/home/kawada/app/swoole-src/tests/include/lib/vendor/autoload.php): Failed to open stream: No such file or directory in /home/kawada/app/swoole-src/tests/include/bootstrap.php on line 53\r\n003+ Fatal error: Uncaught Error: Failed opening required '/home/kawada/app/swoole-src/tests/include/lib/vendor/autoload.php' (include_path='.:/usr/share/php') in /home/kawada/app/swoole-src/tests/include/bootstrap.ph\r\np:53\r\n004+ Stack trace:\r\n005+ #0 /home/kawada/app/swoole-src/tests/swoole_atomic/atomic.php(2): require()\r\n006+ #1 {main}\r\n007+   thrown in /home/kawada/app/swoole-src/tests/include/bootstrap.php on line 53\r\n========DONE========\r\n[FAIL] swoole_atomic: add/sub/get/cmpset [swoole_atomic/atomic.phpt]\r\nTEST 2/1104 [swoole_atomic/dtor_in_child.phpt]\r\n\r\n2. What did you expect to see?\r\n\r\ntests/include/lib/vendor/autoload.php  files does not exist.\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5003/comments",
    "author": "warpkwd",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2023-03-09T01:34:24Z",
        "body": "```shell\r\ncd ./test/include/lib\r\ncomposer install\r\n```"
      }
    ]
  },
  {
    "number": 4952,
    "title": "websocket server 内存消耗",
    "created_at": "2023-01-09T12:09:06Z",
    "closed_at": "2023-01-10T07:14:14Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4952",
    "body": "\r\n使用官网下载的 swoole-cli 和 ws 的 例子\r\n\r\n```php\r\n<?php\r\n\r\n$server = new Swoole\\Websocket\\Server('127.0.0.1', 9502, SWOOLE_BASE);\r\n\r\n$server->on('start', function ($server) {\r\n    echo \"Websocket Server is started at ws://127.0.0.1:9502\\n\";\r\n});\r\n\r\n$server->on('open', function ($server, $req) {\r\n    echo \"connection open: {$req->fd}\\n\";\r\n});\r\n\r\n$server->on('message', function ($server, $frame) {\r\n    echo \"received message: {$frame->data}\\n\";\r\n    $server->push($frame->fd, json_encode(['hello', 'world']));\r\n});\r\n\r\n$server->on('close', function ($server, $fd) {\r\n    echo \"connection close: {$fd}\\n\";\r\n});\r\n\r\n$server->start();\r\n\r\n```\r\n\r\n使用单进程模式\r\n\r\n`swoole-cli ws.php` 开启server\r\n\r\n另编写ws 客户端， 实测 server 在链接 1800+ 的链接后， 应128M 内存限制而崩溃\r\n\r\n是否合理？ 太占内存了\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4952/comments",
    "author": "suconghou",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2023-01-09T12:12:20Z",
        "body": "用的是x86还是aarch64版本的swoole-cli？"
      },
      {
        "user": "suconghou",
        "created_at": "2023-01-09T12:50:39Z",
        "body": "测试 swoole-cli-v5.0.1-linux-x64 和 swoole-cli-v4.8.12-linux-x64  均是如此"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2023-01-09T13:25:56Z",
        "body": "128M用于运行swoole来说太小了，使用 swoole-cli -dmemory_limit=1024M your_code.php 增大运行内存。"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2023-01-09T13:26:33Z",
        "body": "如果你1800+的连接都没有断开的话，维持的这些连接的也是需要内存的。"
      },
      {
        "user": "suconghou",
        "created_at": "2023-01-09T14:20:14Z",
        "body": "按照这个计算2w的链接，就需要1.5G内存了，这个占用是很大的了， 无论对比go还是node都是非常差的数据"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2023-01-09T16:36:35Z",
        "body": "你可以写一个php的脚本去压测它。\r\n我的服务器是2核4G的，memory_limit为980M，可以维持14000+连接。"
      },
      {
        "user": "suconghou",
        "created_at": "2023-01-10T02:22:43Z",
        "body": "使用 `swoole-cli -dmemory_limit` 配置不同的`memory_limit` ,观察服务崩溃时的链接数量\r\n\r\n| 内存限制 | 实际能承受的链接数 |\r\n|----- | ----- |\r\n| 800M | 11900 |\r\n| 1000M  | 15000 | \r\n| 1200M | 18000 |\r\n| 1400M | 21100 |\r\n\r\n\r\n只能说这个性能不是太好\r\n\r\n\r\n\r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2023-01-10T04:23:01Z",
        "body": "你可以将 php 栈、c 栈尺寸调小，减少内存占用"
      },
      {
        "user": "suconghou",
        "created_at": "2023-01-10T04:54:44Z",
        "body": "请问有什么配置可以调吗，还是需要修改代码，重新编译"
      },
      {
        "user": "suconghou",
        "created_at": "2023-01-10T06:08:24Z",
        "body": "配置 `ulimit -s 64` 和 `Swoole\\Coroutine::set(['stack_size' => 64*1024, 'c_stack_size' => 64*1024]);`\r\n\r\n并没有效果\r\n\r\n@matyhtf \r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2023-01-10T06:48:09Z",
        "body": "只维持长连接，还是存在消息收发？也就是每个连接都会发送数据吗？"
      },
      {
        "user": "suconghou",
        "created_at": "2023-01-10T07:02:56Z",
        "body": "每个链接都 有收，有发"
      },
      {
        "user": "matyhtf",
        "created_at": "2023-01-10T07:14:14Z",
        "body": "64k 乘以 10000 等于 640M ，大约1万个连接需要600M内存，2万个需要1.2G内存。这仅仅是创建协程的 PHP 栈内存开销，实际上还有很多地方需要内存，比如接收缓存区、发送缓存区等等。\r\n\r\n维持连接的开销并不高，但是存在数据收发的活跃连接是需要占用比较多内存的。"
      }
    ]
  },
  {
    "number": 4950,
    "title": "swoolecli cgywin websocket服务器 push 二进制流后内存不会释放 越来越多最后就炸了 SWOOLE_BASE",
    "created_at": "2023-01-07T10:58:58Z",
    "closed_at": "2023-01-17T05:29:42Z",
    "labels": [
      "question",
      "waiting for user action"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4950",
    "body": "```php\r\npublic function SendBinaryToSocket(int $fd,array $data,string $binary)\r\n    {\r\n        if($this->server->exist($fd))\r\n        {\r\n            $jsonData = json_encode($data,320);\r\n            $jsonLength = strlen($jsonData);\r\n            $binaryLength = strlen($binary);\r\n            $sendData = pack(\"II\",$jsonLength,$binaryLength);\r\n            $sendData .= pack(\"A*\",$jsonData);\r\n            $sendData .= pack(\"A*\",$binary);\r\n            $result = $this->server->push($fd,$sendData,WEBSOCKET_OPCODE_BINARY); \r\n            unset($sendData);\r\n            return $result;\r\n        }    \r\n        return 0;\r\n    }\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4950/comments",
    "author": "w099099w",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2023-01-09T14:11:00Z",
        "body": "尝试一下增大memory_limit的大小"
      },
      {
        "user": "matyhtf",
        "created_at": "2023-01-10T04:21:02Z",
        "body": "持续发送是不是积压了太多数据在缓存区，触发了 send_yield"
      },
      {
        "user": "w099099w",
        "created_at": "2023-01-14T09:26:29Z",
        "body": "应该不是积压 发送2次后不发的情况内存也不会回落 发的数据是file_get_contents 读取的文件 每个100Kb左右 发320次"
      },
      {
        "user": "matyhtf",
        "created_at": "2023-01-16T04:40:49Z",
        "body": "那不一定是内存泄漏，你需要观察到一个很长时间周期内稳定的内存增长才算。\r\n\r\n你的 memory_limit 当前设置是多少，建议先调整到一个比较大的数值，然后再观察，在程序启动初期内存会增长到一个比较高的数值，然后会稳定在这个范围。\r\n"
      },
      {
        "user": "w099099w",
        "created_at": "2023-01-17T02:13:38Z",
        "body": "256M 的时候也会占满 图片总共就30M 而且都是发的重复的发一次增个10多M 转发数据也不会就是file_get_contents 得到的数据发送成opcode_binary就会一直往上增 opcode_text也会稳定在14M左右的占用这个是正常的我就一个连接发送的数据都一样理论上不应该出现会一直增而且不发不下降的情况"
      },
      {
        "user": "matyhtf",
        "created_at": "2023-01-17T05:20:24Z",
        "body": "已使用的你代码，进行了压测，未发现内存泄露。你可以打印一下 `Server::stats()` 以及客户端连接的 `Server::getClientInfo()`的内容，查看是否存在发送堆积。\r\n\r\n代码\r\n----\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Http\\Response;\r\nuse Swoole\\Http\\Request;\r\nuse Swoole\\WebSocket\\Server;\r\n\r\nfunction SendBinaryToSocket($server, int $fd, array $data, string $binary)\r\n{\r\n    if ($server->exist($fd)) {\r\n        $jsonData = json_encode($data, 320);\r\n        $jsonLength = strlen($jsonData);\r\n        $binaryLength = strlen($binary);\r\n        $sendData = pack(\"II\", $jsonLength, $binaryLength);\r\n        $sendData .= pack(\"A*\", $jsonData);\r\n        $sendData .= pack(\"A*\", $binary);\r\n        $result = $server->push($fd, $sendData, WEBSOCKET_OPCODE_BINARY);\r\n        unset($sendData);\r\n        return $result;\r\n    }\r\n    return 0;\r\n}\r\n\r\n$server = new Server(\"0.0.0.0\", 9501, SWOOLE_BASE);\r\n$server->set([\r\n    'websocket_compression' => true,\r\n]);\r\n\r\n$server->on('open', function (Server $_server, Request $request) {\r\n    echo \"server#{$_server->worker_pid}: handshake success with fd#{$request->fd}\\n\";\r\n    var_dump($_server->exist($request->fd), $_server->getClientInfo($request->fd));\r\n    $fd = $request->fd;\r\n    global $server;\r\n    while (true) {\r\n        Co::sleep(1);\r\n        SendBinaryToSocket($server,\r\n            $request->fd,\r\n            ['fd' => $fd, 'data' => random_bytes(random_int(1024, 128 * 1024))],\r\n            random_bytes(random_int(1024, 4 * 1024)));\r\n    }\r\n});\r\n$server->on('message', function (Server $_server, $frame) {\r\n});\r\n$server->on('close', function ($_server, $fd) {\r\n    echo \"client {$fd} closed\\n\";\r\n});\r\n$server->on('request', function (Request $request, Response $response) {\r\n    $response->end(<<<HTML\r\n<h1>Swoole WebSocket Server</h1>\r\n<script>\r\nvar wsServer = 'ws://127.0.0.1:9501';\r\nvar websocket = new WebSocket(wsServer);\r\nwebsocket.onopen = function (evt) {\r\n\tconsole.log(\"Connected to WebSocket server.\");\r\n};\r\nwebsocket.onclose = function (evt) {\r\n\tconsole.log(\"Disconnected\");\r\n};\r\nwebsocket.onmessage = function (evt) {\r\n\tconsole.log('Retrieved data from server: ' + evt.data);\r\n};\r\nwebsocket.onerror = function (evt, e) {\r\n\tconsole.log('Error occured: ' + evt.data);\r\n};\r\n</script>\r\nHTML\r\n    );\r\n});\r\n$server->start();\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2023-01-17T05:29:42Z",
        "body": "若怀疑某个函数有内存泄露，可以使用 `memory_get_usage()` 在执行前后，打印内存尺寸变化。"
      }
    ]
  },
  {
    "number": 4837,
    "title": "\"task_id (destination Task Worker Id\") in $server->task() is mapping wrongly",
    "created_at": "2022-09-22T17:00:10Z",
    "closed_at": "2022-09-23T00:06:58Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4837",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nIn Swoole configuration, i configured two Worker processes and four Task Worker processes. \r\nSo ids of Worker processes is 0 and 1, and Task Worker processes is from 2 to 5.\r\nI called \r\n$server->task($data, 2, callback() {})\r\n\r\n\r\n2. What did you expect to see?\r\nI expect that the argument 2 in the $server->task() should map to  Task Worker Process with Id 2; the first Task Worker Process.\r\n\r\n\r\n3. What did you see instead?\r\nThe argument 2 in the $server->task() is actually map to  Task Worker Process with Id 3; the second Task Worker Process.\r\n\r\nIn other words, if i pass argument 2 in the call $server->task(), it means second Task Worker having Id as 3, not 'the first Task Worker having Id as 2)\r\n\r\nI think the $server->task() should take the actual ID number of the Task Worker, not the number of order of the Task Worker in the list of Task Workers.\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nOpenSwoole 4.11.1\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\nLinux (Ubuntu 22.04), PHP version 8.1.10\r\n\r\n**GCC -V Output;**\r\n\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/11/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none:amdgcn-amdhsa\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 11.2.0-19ubuntu1' --with-bugurl=file:///usr/share/doc/gcc-11/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++,m2 --prefix=/usr --with-gcc-major-version-only --program-suffix=-11 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-plugin --enable-default-pie --with-system-zlib --enable-libphobos-checking=release --with-target-system-zlib=auto --enable-objc-gc=auto --enable-multiarch --disable-werror --enable-cet --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none=/build/gcc-11-gBFGDP/gcc-11-11.2.0/debian/tmp-nvptx/usr,amdgcn-amdhsa=/build/gcc-11-gBFGDP/gcc-11-11.2.0/debian/tmp-gcn/usr --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu --with-build-config=bootstrap-lto-lean --enable-link-serialization=2\r\nThread model: posix\r\nSupported LTO compression algorithms: zlib zstd\r\ngcc version 11.2.0 (Ubuntu 11.2.0-19ubuntu1) \r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4837/comments",
    "author": "fakharak",
    "comments": [
      {
        "user": "deminy",
        "created_at": "2022-09-22T20:00:04Z",
        "body": "The 2nd argument is the ID of the task worker to which the task is assigned. If it is -1, Swoole will randomly pick an idle task worker.\r\n\r\nPlease note that task ID starts from `0`; it ranges from `0` to `$server>setting[\\Swoole\\Constant::OPTION_TASK_WORKER_NUM] - 1]`. For your case, task IDs range from 0 to 3 (four task worker processes in total)."
      }
    ]
  },
  {
    "number": 4817,
    "title": "swoole异步任务提示没有空闲的worker",
    "created_at": "2022-08-28T05:31:15Z",
    "closed_at": "2022-08-31T07:43:44Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4817",
    "body": "WARNING Server::timer_callback() (ERRNO 9007): No idle task worker is available\r\n```php\r\n<?php\r\n\r\n\r\ndefined('ENV_PATH') or define('ENV_PATH', __DIR__ . '/env');\r\n\r\ndefined('RUNTIME_PATH') or define('RUNTIME_PATH', __DIR__ . '/temp');\r\n\r\n$daemon = false; // 是否守护进程\r\n$action = '';\r\n$pidFile = __DIR__ . '/manager_master';\r\n\r\nforeach ($argv as $index => $item) {\r\n    if (!$action && in_array($item, ['start', 'stop', 'restart', 'reload'])) {\r\n        $action = $item;\r\n    }\r\n\r\n    if (!$daemon && $item === '-d') {\r\n        $daemon = true;\r\n    }\r\n\r\n}\r\n\r\n$pid = file_exists($pidFile) ? file_get_contents($pidFile) : 0;\r\nif ($action == 'stop' || $action == 'restart') {\r\n\r\n    if (!$pid) {\r\n        echo \"管理服务已经停止\\n\";\r\n    }\r\n    if ($pid && \\Swoole\\Process::kill($pid, 0)) {\r\n        \\Swoole\\Process::kill($pid, SIGTERM);\r\n    }\r\n    echo \"管理服务已经停止\\n\";\r\n    if ($action == 'stop') {\r\n        return;\r\n    }\r\n\r\n    while (\\Swoole\\Process::kill($pid, 0)) {\r\n\r\n    }\r\n}\r\n\r\n//创建WebSocket Server对象，监听0.0.0.0:9502端口\r\n$ws = new \\Swoole\\WebSocket\\Server('0.0.0.0', 5688);\r\n$ws->set(\r\n    [\r\n        'worker_num' => 1,\r\n//        'enable_coroutine' => false,\r\n        'task_worker_num' => 3,\r\n        'daemonize' => $daemon,\r\n    ]\r\n);\r\n\r\n\r\n$table = new Swoole\\Table(2048);\r\n$table->column('sass_app_id', Swoole\\Table::TYPE_INT);\r\n$table->column('time', Swoole\\Table::TYPE_STRING, 64);\r\n$table->create();\r\n$ws->table = $table;\r\n\r\n$ws->on('WorkerStart', function (\\Swoole\\Server $server, int $workerId) {\r\n\r\n\r\n    if ($server->taskworker) {\r\n        return;\r\n    }\r\n\r\n    if(!file_exists(RUNTIME_PATH)) {\r\n        mkdir(RUNTIME_PATH, 0777, true);\r\n    }\r\n\r\n    if(!file_exists(ENV_PATH)) {\r\n        mkdir(ENV_PATH, 0777, true);\r\n    }\r\n\r\n    \\Swoole\\Coroutine::create(\r\n        function () use ($server) {\r\n            while (true) {\r\n                echo sprintf(\"%s: 检测服务\\n\", date('Y-m-d H:i:s'));\r\n                if (!file_exists(ENV_PATH)) {\r\n                    return;\r\n                }\r\n\r\n                $getFiles = getDirFiles(ENV_PATH);\r\n\r\n                if (empty($getFiles)) {\r\n                    return;\r\n                }\r\n\r\n                $apps = [];\r\n                foreach ($getFiles as $file) {\r\n                    if (!is_file($file) || $file == '.' || $file == '..' || strpos($file, '/.env') === false) {\r\n                        continue;\r\n                    }\r\n\r\n                    $app = parse_ini_file($file, true);\r\n\r\n                    if(!isset($app['env_dir']) || !isset($app['ws_port'])) {\r\n                        continue;\r\n                    }\r\n\r\n                    if (isset($app['company_suffix']) && !isset($apps[$app['company_suffix']])) {\r\n                        $app['sass_app_id'] = $app['env_dir'];\r\n                        $apps[$app['company_suffix']] = $app;\r\n                    }\r\n                }\r\n\r\n                if (empty($apps)) {\r\n                    return;\r\n                }\r\n\r\n                foreach($apps as $app) {\r\n                    $server->task(json_encode(['type' => 'check', 'data' => $app], JSON_UNESCAPED_UNICODE));\r\n                     \\Swoole\\Coroutine::sleep(1);\r\n                }\r\n               \r\n            }\r\n\r\n        }\r\n    );\r\n});\r\n\r\n\r\n$ws->on('Start', function (\\Swoole\\Server $server) use ($pidFile) {\r\n    file_put_contents($pidFile, $server->master_pid);\r\n});\r\n\r\n//处理异步任务(此回调函数在task进程中执行)\r\n$ws->on('Task', function ($serv, $task_id, $reactor_id, $data) {\r\n    echo \"New AsyncTask[id={$task_id}]\".PHP_EOL;\r\n    //返回任务执行的结果\r\n\r\n\r\n    $msg = json_decode($data, true);\r\n\r\n    if (empty($msg['type'])) {\r\n        $serv->finish(\"{$task_id} -> OK\");\r\n        return;\r\n    }\r\n\r\n    $app = $msg['data'];\r\n\r\n    if (!$serv->table->exist($app['sass_app_id'])) {\r\n        $serv->table->set($app['sass_app_id'], ['sass_app_id' => $app['sass_app_id'], 'time' => 0]);\r\n    }\r\n\r\n    if (time() - $serv->table->get($app['sass_app_id'], 'time') < 5) {\r\n        $serv->finish(\"{$app['sass_app_id']} -> OK\");\r\n        return;\r\n    }\r\n\r\n    $serv->table->set($app['sass_app_id'], ['sass_app_id' => $app['sass_app_id'], 'time' => time()]);\r\n    // 检查服务是否正在运行\r\n    $shell = \"netstat -anp | grep \".$app['ws_port'].\" | grep LISTEN | grep tcp | wc -l\";\r\n    $result = shell_exec($shell);\r\n\r\n    if ($result == 1) { // 服务未启动\r\n        echo sprintf(\"检测时间: %s, %s: 服务正常运行\\n\", date('Y-m-d H:i:s', time()), $app['aliOss_system_name']);\r\n        $serv->finish(\"{$app['sass_app_id']} -> OK\");\r\n        return;\r\n    }\r\n\r\n    $command = sprintf(\"php start_swoole.php restart -d --appId=%s\", $app['sass_app_id']);\r\n    exec($command);\r\n    var_dump($command);\r\n    echo sprintf(\"检测时间: %s, %s: 服务已启动\\n\", date('Y-m-d H:i:s', time()), $app['aliOss_system_name']);\r\n    $serv->finish(\"{$app['sass_app_id']} -> OK\");\r\n});\r\n\r\n//处理异步任务的结果(此回调函数在worker进程中执行)\r\n$ws->on('Finish', function ($serv, $task_id, $data) {\r\n    echo \"AsyncTask[{$task_id}] Finish: {$data}\".PHP_EOL;\r\n});\r\n\r\n//监听WebSocket连接打开事件\r\n$ws->on('Open', function ($ws, $request) {\r\n    $ws->push($request->fd, \"hello, welcome\\n\");\r\n});\r\n\r\n//监听WebSocket消息事件\r\n$ws->on('Message', function ($ws, $frame) {\r\n    echo \"Message: {$frame->data}\\n\";\r\n    $ws->push($frame->fd, \"server: {$frame->data}\");\r\n});\r\n\r\n//监听WebSocket连接关闭事件\r\n$ws->on('Close', function ($ws, $fd) {\r\n    echo \"client-{$fd} is closed\\n\";\r\n});\r\n\r\n\r\nfunction getDirFiles($dir, $level=0) {\r\n    //首先先读取文件夹\r\n    try {\r\n        $temp = scandir($dir);\r\n    } catch (\\Exception $exception) {\r\n        return [];\r\n    }\r\n    $level++;\r\n    $files = [];\r\n    //遍历文件夹\r\n    foreach($temp as $v){\r\n        $files[] = $a = $dir.'/'.$v;\r\n        if(is_dir($a)){//如果是文件夹则执行\r\n            if($v=='.' || $v=='..'){//判断是否为系统隐藏的文件.和..  如果是则跳过\r\n                continue;\r\n            }\r\n            $files = array_merge($files, getDirFiles($a, $level)); //因为是文件夹所以再次调用 selectdir，把这个文件夹下的文件遍历出来\r\n        }\r\n    }\r\n    return $files;\r\n}\r\n\r\necho \"服务已启动\\n\";\r\n$ws->start();\r\n\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4817/comments",
    "author": "hanwei88",
    "comments": [
      {
        "user": "Yurunsoft",
        "created_at": "2022-08-28T05:40:48Z",
        "body": "字面意思，你投递的 task 多了，执行不过来。\r\n\r\n发代码请用成对的3个```括起来。"
      },
      {
        "user": "matyhtf",
        "created_at": "2022-08-31T07:43:44Z",
        "body": "只是提示你空闲进程不足，建议调大 task_worker_num 数量"
      }
    ]
  },
  {
    "number": 4813,
    "title": "5.0版本短名映射存在异常",
    "created_at": "2022-08-17T12:17:49Z",
    "closed_at": "2022-08-17T12:41:03Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4813",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nArgument #1 ($req) must be of type swoole_http_request, Swoole\\Http\\Request given\r\n\r\n```\r\n$server->listen('Request', function (\\Swoole\\Http\\Request $request, \\Swoole\\Http\\Response $response) {\r\n$req = new Request($request);\r\n}\r\n```\r\n\r\n` public function __construct(private swoole_http_request $req)`\r\n\r\n同样的代码，这个问题在4.8版本上就不存在.\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4813/comments",
    "author": "geyouwen",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2022-08-17T12:29:33Z",
        "body": "请执行`php --ri swoole`查看swoole.use_shortname是否关闭了"
      },
      {
        "user": "matyhtf",
        "created_at": "2022-08-17T12:41:03Z",
        "body": "请认真阅读 ChangeLog，5.0 版本已移除 PSR-0 下划线分割的类名，请检查代码，全部改为命名空间风格。"
      }
    ]
  },
  {
    "number": 4804,
    "title": " websocket server not working on ubuntu",
    "created_at": "2022-08-12T10:56:13Z",
    "closed_at": "2022-08-25T14:30:21Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4804",
    "body": "### 1. What did you do? If possible, provide a simple script for reproducing the error.\r\n   \r\n    I write a websocket server with swoole to monitor the CPU load from web. It works on centos but not on ubuntu.\r\n    script is like below:\r\n\r\n\r\n```\r\n    $ws=new Swoole\\WebSocket\\Server('0.0.0.0',9501);\r\n \tif($par=getopt('',['worker-num:'])){\r\n\t\t$worker_num=$par['worker-num'];\t\r\n\t\t$ws->set(array('worker_num'=>$worker_num));\r\n\t}   \r\n    $ws->on('Open',function($ws,$request){    ...       }); \r\n    $ws->on('message',function($ws,$frame){   ...    });\r\n    $ws->on('Close',function($ws,$fd){    ...    });\r\n    $ws->start();\r\n```\r\n\r\n\r\n### 2. What did you expect to see?\r\n   when start websocket connection, from websocket service monitoring window on server side, see below info:\r\n\r\n```\r\n    Start cpu monitor\r\n    execute : php /home/gui/cli/cmds/gui/websocket/_ws_server.php\r\n    websocket server is started\r\n    client-1 is connected:\r\n    new message received:fd=1,msg=start_cpu_monitor\r\n    receive message start_cpu_monitor from cpu-3\r\n```\r\n       \r\nAbove is the output on centos\r\n\r\n\r\n### 3. What did you see instead?\r\n    \r\n    same script works on centos but not on ubuntu. \r\n    on ubuntu:\r\n\r\n```\r\n    Start cpu monitor\r\n    execute : php /home/gui/cli/cmds/gui/websocket/_ws_server.php --worker-num=16\r\n    websocket server is started\r\n```\r\n\r\n    \r\n    **Below is trouble shooting details:**\r\n\r\n    on centos, \r\n\r\n```\r\n    [root@bbu45 bin]# netstat -apn |grep 9501\r\n    tcp        0      0 0.0.0.0:9501            0.0.0.0:*               LISTEN      238100/php\r\n    tcp        0      0 10.240.224.45:9501      10.238.224.145:50995    ESTABLISHED 238100/php\r\n```\r\n\r\n    on ubuntu:\r\n\r\n```\r\n    root@bbu05:/home# netstat -apn |grep 9501\r\n    tcp        0      0 0.0.0.0:9501       0.0.0.0:*               LISTEN      47577/php\r\n    root@bbu05:/home#\r\n```\r\n\r\n    \r\n    **check firewall, is disabled:**\r\n\r\n```\r\n     root@bbu05:/home# ufw status\r\n     Status: inactive\r\n```\r\n\r\n    \r\n    **Another weird thing is,** \r\n    on centos, by default, swoole start one worker process for each CPU plus the master process. \r\n    but on ubuntu, by default, only see master process. I have to use $ws->set(array('worker_num'=>$worker_num)); \r\n    to force to run multiple worker process.\r\n    \r\n\r\n   One difference between centos and ubuntu is, on centosl PHP ver is 7.4, on ubuntu, php version is 8.1\r\n\r\n### 4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n    root@bbu05:/home# php --ri swoole\r\n\r\n    swoole\r\n\r\n    Swoole => enabled\r\n    Author => Swoole Team <team@swoole.com>\r\n    Version => 5.0.0\r\n    Built => Aug 12 2022 17:21:11\r\n    coroutine => enabled with boost asm context\r\n    epoll => enabled\r\n    eventfd => enabled\r\n    signalfd => enabled\r\n    cpu_affinity => enabled\r\n    spinlock => enabled\r\n    rwlock => enabled\r\n    http2 => enabled\r\n    json => enabled\r\n    pcre => enabled\r\n    zlib => 1.2.12\r\n    mutex_timedlock => enabled\r\n    pthread_barrier => enabled\r\n    futex => enabled\r\n    async_redis => enabled\r\n\r\n    Directive => Local Value => Master Value\r\n    swoole.enable_coroutine => On => On\r\n    swoole.enable_library => On => On\r\n    swoole.enable_preemptive_scheduler => Off => Off\r\n    swoole.display_errors => On => On\r\n    swoole.use_shortname => On => On\r\n    swoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n    **root@bbu05:/home# uname -a**\r\n    `Linux bbu05 5.15.0-1009-realtime #9-Ubuntu SMP PREEMPT_RT Thu Apr 21 20:33:36 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux`\r\n    \r\n   **root@bbu05:/home# cat /etc/lsb-release**\r\n```\r\n    DISTRIB_ID=Ubuntu\r\n    DISTRIB_RELEASE=22.04\r\n    DISTRIB_CODENAME=jammy\r\n    DISTRIB_DESCRIPTION=\"Ubuntu 22.04 LTS\"\r\n```\r\n    **root@bbu05:/home# php -v**\r\n  ```\r\n  PHP 8.1.2 (cli) (built: Jul 21 2022 12:10:37) (NTS)\r\n    Copyright (c) The PHP Group\r\n    Zend Engine v4.1.2, Copyright (c) Zend Technologies\r\n        with Zend OPcache v8.1.2, Copyright (c), by Zend Technologies\r\n```\r\n    **root@bbu05:/home# gcc -v**\r\n```\r\n    Using built-in specs.\r\n    COLLECT_GCC=gcc\r\n    COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/11/lto-wrapper\r\n    OFFLOAD_TARGET_NAMES=nvptx-none:amdgcn-amdhsa\r\n    OFFLOAD_TARGET_DEFAULT=1\r\n    Target: x86_64-linux-gnu\r\n    Configured with: ../src/configure -v --with-pkgversion='Ubuntu 11.2.0-19ubuntu1' --with-bugurl=file:///usr/share/doc/gcc-11/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++,m2 --prefix=/usr --with-gcc-major-version-only --program-suffix=-11 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-plugin --enable-default-pie --with-system-zlib --enable-libphobos-checking=release --with-target-system-zlib=auto --enable-objc-gc=auto --enable-multiarch --disable-werror --enable-cet --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none=/build/gcc-11-gBFGDP/gcc-11-11.2.0/debian/tmp-nvptx/usr,amdgcn-amdhsa=/build/gcc-11-gBFGDP/gcc-11-11.2.0/debian/tmp-gcn/usr --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu --with-build-config=bootstrap-lto-lean --enable-link-serialization=2\r\n    Thread model: posix\r\n    Supported LTO compression algorithms: zlib zstd\r\n    gcc version 11.2.0 (Ubuntu 11.2.0-19ubuntu1)\r\n\r\n```\r\n    **root@bbu05:/home# php -m**\r\n\r\n```\r\n    [PHP Modules]\r\n    calendar\r\n    Core\r\n    ctype\r\n    date\r\n    dom\r\n    exif\r\n    FFI\r\n    fileinfo\r\n    filter\r\n    ftp\r\n    gettext\r\n    hash\r\n    iconv\r\n    json\r\n    libxml\r\n    openssl\r\n    pcntl\r\n    pcre\r\n    PDO\r\n    Phar\r\n    posix\r\n    readline\r\n    Reflection\r\n    session\r\n    shmop\r\n    SimpleXML\r\n    sockets\r\n    sodium\r\n    SPL\r\n    standard\r\n    swoole\r\n    sysvmsg\r\n    sysvsem\r\n    sysvshm\r\n    tokenizer\r\n    xml\r\n    xmlreader\r\n    xmlwriter\r\n    xsl\r\n    Zend OPcache\r\n    zlib\r\n\r\n[Zend Modules]\r\nZend OPcache\r\n```\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4804/comments",
    "author": "dcl1970",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2022-08-12T11:13:14Z",
        "body": "From swoole 5.0.0, the default mode of server is SWOOLE_BASE."
      },
      {
        "user": "matyhtf",
        "created_at": "2022-08-25T14:30:21Z",
        "body": "You should set the third parameter of the server constructor to SWOOLE_PROCESS\r\n\r\n```php\r\n$ws=new Swoole\\WebSocket\\Server('0.0.0.0',9501, SWOOLE_PROCESS);\r\n```"
      }
    ]
  },
  {
    "number": 4784,
    "title": "swoole-cli什么时候支持mac版",
    "created_at": "2022-08-02T08:07:58Z",
    "closed_at": "2022-08-31T09:09:06Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4784",
    "body": "swoole-cli什么时候支持mac版",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4784/comments",
    "author": "Yii18",
    "comments": [
      {
        "user": "reegle",
        "created_at": "2022-08-17T02:05:49Z",
        "body": "我也很期待"
      },
      {
        "user": "matyhtf",
        "created_at": "2022-08-31T09:09:06Z",
        "body": "已支持了，但暂时还没上传二进制包，会在 5.0.1 版本增加。"
      }
    ]
  },
  {
    "number": 4762,
    "title": "信号不支持协程",
    "created_at": "2022-07-14T16:14:50Z",
    "closed_at": "2022-07-15T08:52:38Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4762",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\nSwoole\\Process::signal(SIGCHLD, function ($sig) {\r\n    while ($ret = Swoole\\Process::wait(false)) {\r\n        $user=Db:name('user')->find(1);\r\n    }\r\n});\r\n\r\n\r\n2. What did you expect to see?\r\n  \r\n正确查询\r\n\r\n3. What did you see instead?\r\n\r\nHP Fatal error: Uncaught Swoole\\Error: API must be called in the coroutine in\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nbash-5.1# php --ri swoole\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.6.7\r\nBuilt => Jul 13 2022 12:05:21\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.1q  5 Jul 2022\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\npcre => enabled\r\nzlib => 1.2.12\r\nbrotli => E16777225/D16777225\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4762/comments",
    "author": "can-as",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2022-07-14T16:23:07Z",
        "body": "```php\r\nuse function Swoole\\Coroutine\\run;\r\n\r\nrun(function() {\r\n    Swoole\\Process::signal(SIGCHLD, function ($sig) {\r\n        while ($ret = Swoole\\Process::wait(false)) {\r\n            $user=Db:name('user')->find(1);\r\n         }\r\n    });\r\n});\r\n```\r\n试试这样"
      },
      {
        "user": "matyhtf",
        "created_at": "2022-07-15T08:52:38Z",
        "body": "可以使用`Swoole\\Coroutine\\System::waitSingal()`"
      }
    ]
  },
  {
    "number": 4703,
    "title": "Uncaught RedisException: read error on connection to redis.acme.local:6379",
    "created_at": "2022-04-24T08:42:10Z",
    "closed_at": "2022-04-26T07:17:40Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4703",
    "body": "how can i fix this error please?\r\n\r\n\r\nswoole 4.8.8\r\n\r\ncoroutine enabled for sure.\r\n\r\nI closed all redis connections at the end of a coroutine.\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4703/comments",
    "author": "videni",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2022-04-26T07:17:40Z",
        "body": "You should catch this exception and reconnect redis"
      }
    ]
  },
  {
    "number": 4691,
    "title": "协程容器是多核cpu利用的吗",
    "created_at": "2022-04-17T10:19:41Z",
    "closed_at": "2022-04-17T10:43:25Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4691",
    "body": "协程容器是多核cpu利用的吗\r\n最佳实践是啥？",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4691/comments",
    "author": "can-as",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2022-04-17T10:43:25Z",
        "body": "无法利用多核，需要开启多个工作进程"
      }
    ]
  },
  {
    "number": 4690,
    "title": "swoole-cli window版本下路径问题",
    "created_at": "2022-04-16T10:50:16Z",
    "closed_at": "2022-04-16T12:06:27Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4690",
    "body": "环境\r\n```\r\nSwoole 4.8.8 (cli) (built: Mar 16 2022 20:02:46) (NTS)\r\n```\r\n\r\n代码如下\r\n```\r\nvar_dump(__DIR__);\r\nexit;\r\n```\r\n\r\n执行结果如下\r\n```\r\nPS C:\\Users\\chengyao\\Desktop\\max-http-project> swoole-cli .\\bin\\max.php\r\nstring(51) \"/cygdrive/c/Users/chengyao/Desktop/max-http-project\"\r\nPS C:\\Users\\chengyao\\Desktop\\max-http-project> php .\\bin\\max.php\r\nstring(46) \"C:\\Users\\chengyao\\Desktop\\max-http-project\\bin\"\r\nPS C:\\Users\\chengyao\\Desktop\\max-http-project>\r\n```\r\n\r\n使用php和swoole-cli获取到的目录不一样",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4690/comments",
    "author": "bbuugg",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2022-04-16T12:06:27Z",
        "body": "swoole-cli 使用的是 cygwin 环境，所以是 unix 风格路径。`C:` 会被自动转换为 `/cygdrive/c`"
      }
    ]
  },
  {
    "number": 4660,
    "title": "是否可以把 swoole_substr_ 加上 igbinary 和 msgpack 版的",
    "created_at": "2022-03-24T06:29:24Z",
    "closed_at": "2022-03-24T09:09:55Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4660",
    "body": "\r\n至少加上 igbinary 的吧，好不好",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4660/comments",
    "author": "AlvisZhang",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2022-03-24T09:09:55Z",
        "body": "@AlvisZhang 可以提给 igbinary 和 msgpack 扩展开发者去实现，或者自行修改扩展代码实现，实际上 swoole 提供的 swoole_sbustr unserialize 和 json_decode 实现上也很简单，只是调用了 php 提供的 C API 而已。"
      },
      {
        "user": "AlvisZhang",
        "created_at": "2022-03-25T05:40:43Z",
        "body": "这不是自己懒么，而且希望在加载 swoole 扩展时就可用，不用自己再单独搞个扩展。\r\n\r\n那就是只能照着你的方法去实现，到时再提个 pull request 来争取合到 swoole 里了吧"
      }
    ]
  },
  {
    "number": 4642,
    "title": "swoole-cli 如何修改配置文件 比如关闭swoole.use_shortname",
    "created_at": "2022-03-06T15:22:03Z",
    "closed_at": "2022-03-07T00:07:47Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4642",
    "body": "swoole-cli 如何修改配置文件 比如关闭swoole.use_shortname\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4642/comments",
    "author": "lotofbadcode",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2022-03-06T15:25:02Z",
        "body": "可以\r\nswoole-cli -dswoole.use_shortname=Off"
      },
      {
        "user": "leoSunning001",
        "created_at": "2023-02-22T05:59:26Z",
        "body": "swoole-cli -dswoole.use_shortname=Off 设置无效怎么办 , 直接在cmd 修改无效"
      },
      {
        "user": "leoSunning001",
        "created_at": "2023-02-22T06:04:02Z",
        "body": "swoole-cli -dswoole.use_shortname=Off 设置无效怎么办\r\n\r\n> swoole-cli -dswoole.use_shortname=Off 设置无效怎么办 , 直接在cmd 修改无效\r\n\r\n"
      }
    ]
  },
  {
    "number": 4632,
    "title": "When static_handler_locations is set, websocket doesn't receive the \"Open\" event",
    "created_at": "2022-02-27T17:03:03Z",
    "closed_at": "2022-03-02T10:08:12Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4632",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nI'm setting swoole with the below code\r\n   $server->set([\r\n        'daemonize'=>false,\r\n        'user'=>'pi',\r\n        'chroot'=> tapRoot,\r\n        'pid_file'=> pidFile,\r\n        'open_websocket_protocol' => true,\r\n        'websocket_compression' => true,\r\n        'open_websocket_close_frame' => false,\r\n        'open_websocket_ping_frame' => false, // added from v4.5.4\r\n        'open_websocket_pong_frame' => false, // added from v4.5.4\r\n        'document_root' => htmlFolder,\r\n        'enable_static_handler' => true,\r\n        'http_autoindex' => true,\r\n        'http_index_files' => ['index.html'],\r\n        'static_handler_locations' => ['/', '/js', '/css', '/etc'],\r\n        'log_level' => 0,\r\n        'log_file' => logFile,\r\n    ]);\r\n\r\n2. What did you expect to see?\r\n\r\nThe http server should run accessing to files from /, /js, /css, /etc.\r\nThe websocket shall run not affected by above settings.\r\n\r\n3. What did you see instead?\r\n\r\nWhen I set static_handler_locations the websocket doesn't receive Open events.\r\nI shall disable the static_handler_locations and move all the static files in the same folder (i.e. \"/\").\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nI'm using 4.8.5 with php8.1.3\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\nLinux raspberrypi 5.10.63-v7l+ #1496 SMP Wed Dec 1 15:58:56 GMT 2021 armv7l GNU/Linux\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4632/comments",
    "author": "dariofinardi",
    "comments": [
      {
        "user": "dariofinardi",
        "created_at": "2022-02-28T11:06:32Z",
        "body": "Doing more investigation, it seems that the issue is because of below lines:\r\n        'http_autoindex' => true,\r\n        'http_index_files' => ['index.html'],\r\n\r\n"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2022-02-28T13:12:20Z",
        "body": "I will reproduce the error as soon as possible.\r\nThanks!"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2022-03-01T07:46:48Z",
        "body": "Please remove `/` from `static_handler_locations` setting.\r\nNow all requests are treated as static file.\r\nWebsocket protocol is base on http protocol."
      }
    ]
  },
  {
    "number": 4610,
    "title": "关于swoole-cli swoole的配置修改",
    "created_at": "2022-02-16T10:13:40Z",
    "closed_at": "2022-02-16T16:28:34Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4610",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n```\r\n使用 v4.8.6 swoole-cli 启动hyperf时\r\n ./swoole-cli bin/hyperf.php start\r\n```\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n**v4.8.6  swoole-cli怎么修改swoole的配置呀？\r\n例如 swoole.use_shortname 修改为 Off**\r\n\r\n3. What did you see instead?\r\n\r\n**需要关闭 swoole.use_shortname**\r\n`ERROR Swoole short function names must be disabled before the server starts, please set swoole.use_shortname='Off' in your php.ini.`\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n./swoole-cli --ri swoole\r\n\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.8.6\r\nBuilt => Jan 11 2022 11:48:24\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1m  14 Dec 2021\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\nc-ares => 1.18.1\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n```\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4610/comments",
    "author": "shimianxiang",
    "comments": [
      {
        "user": "leocavalcante",
        "created_at": "2022-02-16T12:23:47Z",
        "body": "`swoole-cli --ini` 的输出是什么?\r\n\r\n作为一种解决方法，您可以尝试 `swoole-cli -dswoole.use_shortname=Off bin/hyperf.php` "
      },
      {
        "user": "shimianxiang",
        "created_at": "2022-02-16T15:50:18Z",
        "body": "./swoole-cli --ini 的输出是\r\n```\r\nConfiguration File (php.ini) Path: /usr/local/lib\r\nLoaded Configuration File:         (none)\r\nScan for additional .ini files in: (none)\r\nAdditional .ini files parsed:      (none)\r\n\r\n```\r\n想要的答案就是这个 `swoole-cli -dswoole.use_shortname=Off bin/hyperf.php `感谢解答\r\n期待swoole5.0 swoole-cli  的正式发布\r\n\r\n"
      }
    ]
  },
  {
    "number": 4607,
    "title": "swoole.so.so: cannot open shared object file: No such file or directory",
    "created_at": "2022-02-14T16:02:39Z",
    "closed_at": "2022-02-18T04:06:44Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4607",
    "body": "Tell me. Installed phpize, gcc, db, php, php-dev, curl. \r\nThen I installed pecl install swoole. \r\nAdded a line to php.ini: extension=swoole.so . \r\nAn error pops up. \r\nAlso added in php.ini extension=/path/swoole.so and still an error\r\n```\r\n# php -m|grep swoole\r\nPHP Warning:  PHP Startup: Unable to load dynamic library 'swoole.so' (tried: /usr/lib/php/20170718/swoole.so \r\n(/usr/lib/php/20170718/swoole.so: undefined symbol: json_globals), /usr/lib/php/20170718/swoole.so.so\r\n (/usr/lib/php/20170718/swoole.so.so: cannot open shared object file: No such file or directory)) \r\nin Unknown on line 0\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4607/comments",
    "author": "veleg",
    "comments": [
      {
        "user": "leocavalcante",
        "created_at": "2022-02-14T17:58:30Z",
        "body": "Make sure that `extension=swoole.so` is **after** the JSON extension."
      },
      {
        "user": "veleg",
        "created_at": "2022-02-14T18:18:33Z",
        "body": "the json field in php.ini?\r\nIt should look like this:\r\n`[json]\r\n\r\nextension=swoole.so` ?"
      },
      {
        "user": "leocavalcante",
        "created_at": "2022-02-14T19:49:02Z",
        "body": "Try creating an `ext-swoole.ini` file at your `etc/php/8.0/conf.d` instead of editing the `php.ini`.\r\n\r\nWhat is your OS and how did you install PHP?\r\n\r\nFor example, in Ubuntu using `apt install php8.0`, you can create a `swoole.ini` file at `/etc/php/8.0/mods-available`  then use `phpenmod swoole`."
      }
    ]
  },
  {
    "number": 4600,
    "title": "The coroutine HTTP server does not handle POST requests correctly.",
    "created_at": "2022-02-09T05:16:16Z",
    "closed_at": "2022-02-09T12:08:03Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4600",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n``` php\r\nuse Swoole\\Coroutine\\Http\\Client;\r\nuse Swoole\\Coroutine\\Http\\Server;\r\nuse Swoole\\Http\\Request;\r\nuse Swoole\\Http\\Response;\r\nuse function Swoole\\Coroutine\\run;\r\n\r\nrun(function () {\r\n    go(function () {\r\n        $server = new Server('0.0.0.0', 1234, false);\r\n\r\n        $server->handle('/', function (Request $request, Response $response) {\r\n            var_dump($request->post); // The output is NULL\r\n            \r\n            $response->status(200);\r\n            $response->end($request->getData());\r\n        });\r\n    });\r\n\r\n    go(function () {\r\n        \\co::sleep(0.5);\r\n\r\n        $cli = new Client('127.0.0.1', 1234);\r\n        $cli->post('/', 'hello');\r\n        $cli->close();\r\n    });\r\n});\r\n\r\n\\Swoole\\Event::wait();\r\n```\r\n\r\n2. What did you expect to see?\r\n```php\r\n$request->post // The output is NULL\r\n```\r\n\r\n3. What did you see instead?\r\n```php\r\n$request->post // The output is hello\r\n```\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n``` shell\r\nphp --ri swoole\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.8.6\r\nBuilt => Jan 28 2022 22:03:07\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.1l  FIPS 24 Aug 2021\r\ndtls => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nc-ares => 1.17.2\r\nzlib => 1.2.11\r\nbrotli => E16777225/D16777225\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n``` shell\r\nphp -v\r\nPHP 8.1.2 (cli) (built: Jan 28 2022 22:02:23) (NTS)\r\nCopyright (c) The PHP Group\r\nZend Engine v4.1.2, Copyright (c) Zend Technologies\r\n```\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4600/comments",
    "author": "Alion548",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2022-02-09T12:08:03Z",
        "body": "@Alion548 The second parameter is a string, the format of the POST body is not `application/x-www-form-urlencoded`, you should use the `$request->getContent()` to get post body. "
      }
    ]
  },
  {
    "number": 4571,
    "title": "php8.10 swoole 4.8.5 JS上传文件到服务端偶尔会失败。nginx +swoole 前端js 后端swoole",
    "created_at": "2022-01-04T05:44:53Z",
    "closed_at": "2022-01-18T02:31:52Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4571",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4571/comments",
    "author": "tomzhaogy",
    "comments": [
      {
        "user": "tomzhaogy",
        "created_at": "2022-01-04T05:46:04Z",
        "body": "[root@35841e1e4240 /]# php --ri swoole\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.8.5\r\nBuilt => Jan  4 2022 09:31:44\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\npcre => enabled\r\nzlib => 1.2.7\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608"
      },
      {
        "user": "tomzhaogy",
        "created_at": "2022-01-04T05:46:41Z",
        "body": "[root@35841e1e4240 /]# php --version \r\nPHP 8.1.0 (cli) (built: Dec 29 2021 06:12:59) (NTS)\r\nCopyright (c) The PHP Group\r\nZend Engine v4.1.0, Copyright (c) Zend Technologies"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2022-01-04T05:53:24Z",
        "body": "请尝试将nginx的一些超时参数调整大一点"
      },
      {
        "user": "tomzhaogy",
        "created_at": "2022-01-04T06:02:14Z",
        "body": "一直pending中过了好久才返回504"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2022-01-04T14:42:50Z",
        "body": "504就是超时，可能是程序执行时间过久，nginx的超时时间太短"
      },
      {
        "user": "tomzhaogy",
        "created_at": "2022-01-05T01:37:57Z",
        "body": "偶尔出现这个问题，升级到4.8.5，PHP 8.1版本才出的这个问题。"
      },
      {
        "user": "matyhtf",
        "created_at": "2022-01-05T04:41:39Z",
        "body": "@tomzhaogy 查看一下 `dmesg -T` 的信息，是否有 crash，8.1 可能存在某些兼容性问题"
      },
      {
        "user": "tomzhaogy",
        "created_at": "2022-01-05T07:58:56Z",
        "body": "@matyhtf 步子迈大了又扯着蛋了，先退会php 7.4.27,谢谢哈。"
      },
      {
        "user": "tomzhaogy",
        "created_at": "2022-01-06T05:05:52Z",
        "body": "php 7.4.27 swoole 4.8.5 也不行 @matyhtf"
      },
      {
        "user": "tomzhaogy",
        "created_at": "2022-01-06T13:08:48Z",
        "body": "    public function voice_to_text_pc($request,$response){\r\n        $cur_day=date(\"Ymd\",time());\r\n        $this->create_record_path($cur_day);\r\n\r\n       \r\n        if (isset($request->get)) {\r\n            $request_data=$request->get;\r\n        } else  if (isset($request->post)) {\r\n            $request_data=$request->post;\r\n        } else {\r\n            return json_encode(array('result' => 1, 'msg' =>$this->get_err_msg(1)));\r\n        }\r\n\r\n        $session_id=$request_data[\"session_id\"];\r\n        $language=$this->get_language($session_id);\r\n        $queue_name=\"VOICE_TO_TEXT_QUEUE\";\r\n        if ($language!=\"PTH\") {\r\n            $queue_name=\"VOICE_TO_TEXT_{$language}_QUEUE\";\r\n        }\r\n        $this->info(__CLASS__,__FUNCTION__,$queue_name);\r\n\r\n        try {\r\n            $files=$request->files;\r\n            $files=$files['file'];\r\n            if (is_null($files)) {\r\n                return json_encode(array('code' => 1, 'msg' => $this->get_err_msg(1)));\r\n            }\r\n\r\n            if (!isset( $files[\"name\"]) || !isset( $files[\"tmp_name\"]))\r\n            {\r\n                return json_encode(array('code' => 1, 'msg' => $this->get_err_msg(1)));\r\n            }\r\n\r\n            $job_id=GUID::create();\r\n            $filename = basename($files['name']);\r\n            $tmpname = $files['tmp_name'];\r\n            $size=$files['size'];\r\n            if ($size==0) {\r\n                return json_encode(array('code' =>4, 'msg' => $this->get_err_msg(4)));\r\n            }\r\n            if (move_uploaded_file($tmpname,$this->file_path.\"wav/source/$cur_day/\".$job_id.\".wav\")) {                \r\n                $file_size=filesize($this->file_path.\"wav/source/$cur_day/\".$job_id.\".wav\");\r\n                if ($file_size!=$size) {\r\n                    echo \"job_id={$job_id}  wav size={$size} recv file size={$file_size}\\r\\n\";\r\n                    return json_encode(array('code' => 5, 'msg' => $this->get_err_msg(5)));\r\n                }\r\n                $start_time=$this->getMillisecond();        \r\n                $model=$this->get_model_default();\r\n                $model_id=\"\";\r\n                if (!is_null($model)) {\r\n                    $model_id=$model[\"model_id\"];\r\n                }\r\n                $message = array(\"job_id\"=>$job_id,\"model_id\"=>$model_id,\"format\"=>\"wav\",'file_name' =>$this->file_path.\"wav/source/$cur_day/\".$job_id.\".wav\",\r\n                    'file_name_wav' =>$this->file_path.\"wav/source/$cur_day/\".$job_id.\".wav\",'file_name_record' =>$this->file_path.\"record/$cur_day/\".$job_id.\".mp3\",\r\n                    \"file_link\"=>$this->ai_voice_web.\"/wav/source/$cur_day/\".$job_id.\".wav\",\"record_url\"=>$this->ai_voice_web.\"/record/$cur_day/\".$job_id.\".mp3\",\r\n                    \"finish\"=>3,\"create_time\"=>$start_time,\"file_size\"=>$size,\"recv_size\"=>$file_size);\r\n                $str_key=\"voice_to_text_\".$job_id;\r\n                //send kafka\r\n                $this->send_message($queue_name,$message);\r\n                $message[\"user_data\"]=json_encode($request_data);\r\n                $this->info(__CLASS__,__FUNCTION__,$message);\r\n                $this->set($str_key,json_encode($message));\r\n                return json_encode(array('code' => 0, 'msg' => \"OK\",'data' => array('job_id' =>$job_id)));\r\n            }\r\n        } catch (\\Exception $ex) {\r\n            echo __CLASS__.\"  \".__FUNCTION__.\"   \".__LINE__.\"\\r\\n\";\r\n            echo $ex->getMessage();\r\n        }\r\n\r\n        return json_encode(array('code' => 2, 'msg' => $this->get_err_msg(2)));\r\n    }\r\n"
      },
      {
        "user": "tomzhaogy",
        "created_at": "2022-01-06T13:10:16Z",
        "body": "代码如上。直接没进函数。偶然失败时候  js 端 一直penging 中\r\n"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2022-01-06T14:04:32Z",
        "body": "请问前端用的是vue吗，是的话检查一下看看是不是axios设置了超时时间。\r\n如果不是的话麻烦上传一下nginx的配置文件，注意隐藏ip之类的敏感信息。"
      },
      {
        "user": "tomzhaogy",
        "created_at": "2022-01-07T00:47:58Z",
        "body": "[root@3908955c0ea7 /]# php --version\r\nPHP 7.3.5 (cli) (built: Aug 19 2019 00:51:07) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.3.5, Copyright (c) 1998-2018 Zend Technologies\r\n\r\nswoole\r\n\r\nswoole support => enabled\r\nVersion => 1.9.0\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\nepoll => enabled\r\neventfd => enabled\r\ntimerfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nasync http/websocket client => enabled\r\nLinux Native AIO => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled"
      },
      {
        "user": "tomzhaogy",
        "created_at": "2022-01-07T00:48:19Z",
        "body": "上面这个环境试正常的。"
      },
      {
        "user": "matyhtf",
        "created_at": "2022-01-07T02:23:23Z",
        "body": "检查一下 swoole 的 log_file 中是否输出了错误信息，可能是 php 代码中存在 fatal error "
      }
    ]
  },
  {
    "number": 4561,
    "title": "How to check swoole is up and running ?",
    "created_at": "2021-12-26T17:47:53Z",
    "closed_at": "2021-12-27T06:13:55Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4561",
    "body": "Hey there, How can i determine the swoole http server is up and running ? I have two servers both of them have swoole extension but only one of them actually uses swoole, the `extension_loaded('swoole')` is useless in my case",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4561/comments",
    "author": "foremtehan",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2021-12-27T00:46:52Z",
        "body": "swoole_set_process_name() can rename process.\r\nYou can determine the swoole http server is up and running by their name."
      },
      {
        "user": "twose",
        "created_at": "2021-12-27T02:44:23Z",
        "body": "But why would you enable the Swoole extension on a server that does not use Swoole?"
      }
    ]
  },
  {
    "number": 4560,
    "title": "嵌套调用Event::dispatch会导致除最后一个dispatch外其他的dispatch调用不会返回",
    "created_at": "2021-12-25T07:03:08Z",
    "closed_at": "2021-12-25T14:06:36Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4560",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Event;\r\nuse Swoole\\Timer;\r\n\r\nTimer::tick(1000, function () {\r\n    echo \"tick\\n\";\r\n});\r\n\r\nfunction a()\r\n{\r\n    echo \"A\\n\";\r\n    Event::defer('b');\r\n    Event::dispatch();\r\n    echo \"!A\\n\";\r\n}\r\n\r\nfunction b()\r\n{\r\n    echo \"B\\n\";\r\n    Event::dispatch();\r\n    echo \"!B\\n\";\r\n}\r\n\r\na();\r\n\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n```\r\nA\r\nB\r\ntick\r\n!B\r\n!A\r\n*每秒钟输出 \"tick\"*\r\n```\r\n\r\n3. What did you see instead?\r\n\r\n```\r\nA\r\nB\r\ntick\r\n!B\r\n*每秒钟输出 \"tick\" 但永远不会有!A出现*\r\n```\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.8.4\r\nBuilt => Dec 24 2021 10:50:51\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n```\r\naodzip@ThinkPad-X1:~$ uname -a\r\nLinux ThinkPad-X1 5.4.0-91-generic #102~18.04.1-Ubuntu SMP Thu Nov 11 14:46:36 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\r\naodzip@ThinkPad-X1:~$ php -v\r\nPHP 7.4.26 (cli) (built: Nov 22 2021 09:47:55) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v3.4.0, Copyright (c) Zend Technologies\r\n    with Zend OPcache v7.4.26, Copyright (c), by Zend Technologies\r\naodzip@ThinkPad-X1:~$ gcc -v\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/7/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 7.5.0-3ubuntu1~18.04' --with-bugurl=file:///usr/share/doc/gcc-7/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-7 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 7.5.0 (Ubuntu 7.5.0-3ubuntu1~18.04)\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4560/comments",
    "author": "aodzip",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2021-12-25T13:57:37Z",
        "body": "还是那个问题，不能在Event::dispatch()未结束的时候又调用Event::dispatch()。\r\n这里是第二个Event::dispatch()结束的时候将下面的代码设置为false了。\r\n\r\n```c\r\nsw_reactor()->once = false\r\n```\r\n\r\n这样就导致第一次的Event::dispatch()由于第二次的Event::dispatch()的结束操作，由一次性的事件机制直接变成永久的事件机制。\r\n这样肯定就是只跑定时器呀\r\n你的代码其实就跟下面这个代码一样\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Event;\r\nuse Swoole\\Timer;\r\n\r\nTimer::tick(1000, function () {\r\n    echo \"tick\\n\";\r\n});\r\n\r\nfunction a()\r\n{\r\n    echo \"A\\n\";\r\n    Event::defer('b');\r\n    Event::wait(); // 这里变成永久的事件机制\r\n    echo \"!A\\n\";\r\n}\r\n\r\nfunction b()\r\n{\r\n    echo \"B\\n\";\r\n    echo \"!B\\n\";\r\n}\r\n\r\na();\r\n\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2021-12-25T14:06:36Z",
        "body": "对 `Event::dispatch()` 的使用不正确。这个函数是为了兼容`amphp`事件循环增加的，普通应用程序不应该使用它。\r\n\r\n`Event::dispatch()` 本质上与 `Event::wait()` 是一致的，只在 main 函数末尾调用\r\n\r\n```php\r\nwhile(true) {\r\n   Event::dispatch();\r\n}\r\n```\r\n"
      }
    ]
  },
  {
    "number": 4552,
    "title": "PHP 8.1.1 Swoole\\Event::rshutdown(): Event::wait() in shutdown function is deprecated in Unknown on line 0",
    "created_at": "2021-12-22T10:16:49Z",
    "closed_at": "2021-12-24T02:01:04Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4552",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nPHP Deprecated:  Swoole\\Event::rshutdown(): Event::wait() in shutdown function is deprecated in Unknown on line 0\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nphp --ri swoole\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.8.4\r\nBuilt => Dec 20 2021 10:16:23\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.1k  FIPS 25 Mar 2021\r\ndtls => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4552/comments",
    "author": "ghost",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-12-24T02:01:03Z",
        "body": "You should use `Co\\run()` or `go() + Swoole\\Event::wait()`\r\n\r\nRight\r\n---\r\n```php\r\nCo\\run(function () {\r\n   sleep(1);\r\n});\r\n```\r\nor\r\n```php\r\ngo(function () {\r\n   sleep(1);\r\n});\r\nSwoole\\Event::wait();\r\n```\r\nWrong\r\n---\r\n```php\r\ngo(function () {\r\n   sleep(1);\r\n});\r\n```"
      }
    ]
  },
  {
    "number": 4533,
    "title": "WARNING Server::check_worker_exit_status(): worker(pid=32, id=2) abnormal exit, status=255, signal=0",
    "created_at": "2021-12-10T00:57:52Z",
    "closed_at": "2021-12-16T02:18:45Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4533",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.8.3\r\nBuilt => Dec  9 2021 01:09:41\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1d  10 Sep 2019\r\ndtls => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\nLinux 565ed2b9cec1 3.10.0-693.2.2.el7.x86_64 #1 SMP Tue Sep 12 22:26:13 UTC 2017 x86_64 GNU/Linux\r\nPHP 7.2.34 (cli) (built: Dec 11 2020 10:44:02) ( NTS )\r\n\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/8/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Debian 8.3.0-6' --with-bugurl=file:///usr/share/doc/gcc-8/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-8 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 8.3.0 (Debian 8.3.0-6) \r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4533/comments",
    "author": "zuobee",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2021-12-11T03:52:11Z",
        "body": "Please show me the code to reproducing the error.\r\nThanks."
      },
      {
        "user": "zuobee",
        "created_at": "2021-12-13T02:09:43Z",
        "body": "it happen in swoft framework, when use RPC services are integrated in Http Server startup\r\n\r\n```\r\n    'httpServer' => [\r\n        'class' => HttpServer::class,\r\n        'port' => env('HTTP_PORT', 18306),\r\n        'listener' => [\r\n            'rpc' => bean('rpcServer'),\r\n            // 'tcp' => bean('tcpServer'),\r\n        ],\r\n\r\n    /**\r\n     * Add listener serve to the main server\r\n     *\r\n     * @throws ServerException\r\n     */\r\n    protected function addListener(): void\r\n    {\r\n        foreach ($this->listener as $listener) {\r\n            if (!$listener instanceof ServerInterface) {\r\n                continue;\r\n            }\r\n\r\n            $host = $listener->getHost();\r\n            $port = $listener->getPort();\r\n            $type = $listener->getType();\r\n\r\n            if (!$events = $listener->getOn()) {\r\n                throw new ServerException(\r\n                    'Not add any event handler for the listener server: ' . get_class($listener)\r\n                );\r\n            }\r\n\r\n            /* @var CoServer\\Port $server */\r\n            $server = $this->swooleServer->listen($host, $port, $type);\r\n            $server->set($listener->getSetting());\r\n\r\n            // Bind events to the sub-server\r\n            $this->addEvent($server, $events);\r\n\r\n            // Trigger event\r\n            Swoft::trigger(ServerEvent::AFTER_ADDED_LISTENER, $server, $this);\r\n        }\r\n    }\r\n```\r\n\r\nit happen maybe about 2 times one day\r\nerror logs\r\n```\r\nclient err\r\n2021-12-12 16:32:15 [error] [swoft] [swoft.process.user.consumer] [tid:1] [cid:4498] [traceid:] trace[StService.php:80] Swoft\\Rpc\\Client\\Exception\\RpcClientException\r\nrecv:Rpc call failed.code=110 message=Connection timed out interface=Zhoubin\\RpcLib\\UserInterface method=getUserInfo pool=user.pool version=1.0\r\n\r\nserver err\r\n[2021-12-12 16:32:12 $72.0]     WARNING Server::check_worker_exit_status(): worker(pid=122, id=3) abnormal exit, status=255, signal=0\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2021-12-16T02:18:45Z",
        "body": "This means a fatal php error has occurred, please check the php error_log"
      }
    ]
  },
  {
    "number": 4529,
    "title": "stream被远程连接关闭后 fread卡住?",
    "created_at": "2021-12-07T14:24:15Z",
    "closed_at": "2021-12-09T11:54:08Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4529",
    "body": "1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n最近在做一个转发的应用 stream连接被远程关闭后 fread 会继续卡住的问题 \r\n\r\n代码如下\r\n\r\n```php\r\n<?php\r\n\r\nuse  Swoole\\Coroutine;\r\nuse function Swoole\\Coroutine\\run;\r\n\r\n\r\nrun(function () {\r\n    $errorCode = $errorMessage = null;\r\n    //监听tcp链接\r\n    $serverSocket = stream_socket_server('tcp://0.0.0.0:8000', $errorCode, $errorMessage);\r\n    if ($errorCode != 0) {\r\n        throw new RuntimeException($errorMessage, $errorCode);\r\n    }\r\n    $clientSocket = stream_socket_accept($serverSocket);\r\n    //转发数据\r\n    $forwardAddress = 'tcp://www.baidu.com:80';\r\n\r\n    $forwardSocket = stream_socket_client($forwardAddress);\r\n\r\n    Coroutine\\go(function () use ($clientSocket, $forwardSocket) {\r\n        $copied = stream_copy_to_stream($clientSocket, $forwardSocket);\r\n        echo \"client -> remote copied[$copied]\" . PHP_EOL;\r\n        var_dump(['复制结束', feof($clientSocket), feof($forwardSocket), date(DATE_W3C)]);\r\n\r\n        $data = fread($clientSocket, 1024);\r\n        var_dump($data);\r\n    });\r\n\r\n    Coroutine\\go(function () use ($forwardSocket, $clientSocket) {\r\n        $copied = io_copy($forwardSocket, $clientSocket);\r\n        echo \"remote -> client copied[$copied]\" . PHP_EOL;\r\n    });\r\n\r\n});\r\n\r\necho 'done!';\r\n\r\n/**\r\n * @param resource $from\r\n * @param resource $to\r\n */\r\nfunction io_copy($from, $to): int\r\n{\r\n    while (!feof($from)) {\r\n        var_dump('读取');\r\n        $data = fread($from, 8192);\r\n        if (!$data) {\r\n            break;\r\n        }\r\n        var_dump('write');\r\n        if (!fwrite($to, $data)) {\r\n            break;\r\n        }\r\n    }\r\n    return 1;\r\n}\r\n```\r\n先运行上面的代码  然后执行 `curl '127.0.0.1:8000' -v` 你会看到curl 成功的转发了本地的请求。但是总会有一个协程不会退出,经过多次测试发现固定第二个go语句中的代码卡主 一开始两个协程用的都是 `stream_copy_to_stream` 为了方便排查 自己手写了一个io_copy函数\r\n\r\n第一个协程退出后打印了下 stream 的 eof  状态 可以从输出中看到 `clientSocket` 已经eof了,并且做了尝试去 fread 会直接返回， 但是 io_copy 中的 fread函数还在执行\r\n\r\n输出日志如下我只截取了重要部分\r\n```\r\nstring(3) \"eof\"\r\narray(3) {\r\n  [0]=>\r\n  bool(false)\r\n  [1]=>\r\n  bool(false)\r\n  [2]=>\r\n  string(25) \"2021-12-07T13:52:47+00:00\"\r\n}\r\nstring(6) \"读取\"\r\nclient -> remote copied[78]\r\narray(4) {\r\n  [0]=>\r\n  string(12) \"复制结束\"\r\n  [1]=>\r\n  bool(true)\r\n  [2]=>\r\n  bool(false)\r\n  [3]=>\r\n  string(25) \"2021-12-07T13:52:47+00:00\"\r\n}\r\nstring(0) \"\"\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n```\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.9.0-dev\r\nBuilt => Dec  5 2021 12:32:00\r\ncoroutine => enabled with boost asm context\r\nkqueue => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 3.0.0 7 sep 2021\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\npcre => enabled\r\nc-ares => 1.17.2\r\nzlib => 1.2.11\r\nbrotli => E16777225/D16777225\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 262144 => 262144\r\n```\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n```\r\nPHP 8.1.0 (cli) (built: Nov 28 2021 02:36:02) (NTS)\r\nCopyright (c) The PHP Group\r\nZend Engine v4.1.0, Copyright (c) Zend Technologies\r\n    with Zend OPcache v8.1.0, Copyright (c), by Zend Technologies\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4529/comments",
    "author": "xywf221",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-12-09T11:54:08Z",
        "body": "@xywf221 第二个协程中 fread 的连接并没有关闭，所以会一直等待。你可以在第一个协程结束时添加 `fclose($forwardSocket)`关闭连接，或者在 curl 命令中添加 HTTP 头让服务器主动关闭连接。\r\n\r\n```shell\r\ncurl '127.0.0.1:8000' -H 'Connection: close'\r\n```"
      }
    ]
  },
  {
    "number": 4510,
    "title": "监听unix套节字，开始端口复用，只会有一个进程能获取到连接",
    "created_at": "2021-11-25T09:55:30Z",
    "closed_at": "2021-12-01T14:05:14Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4510",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\nSwoole\\Coroutine\\Server\r\n开启多个worker，监听unixSocket(unix:/run/swoole.socket)，第四个参数传true(复用）\r\nnginx进行转发请求\r\n只会有一个进程处理请求\r\n\r\n如果是监听的tcp:port无该问题（系统自动均衡）\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.8.2\r\nBuilt => Nov 25 2021 17:43:57\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1  11 Sep 2018\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\npcre => enabled\r\nc-ares => 1.14.0\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\nLinux 2f4d2160e228 5.10.47-linuxkit #1 SMP Sat Jul 3 21:51:47 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nPHP 7.4.26 (cli) (built: Nov 22 2021 09:47:55) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v3.4.0, Copyright (c) Zend Technologies\r\n    with Zend OPcache v7.4.26, Copyright (c), by Zend Technologies\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4510/comments",
    "author": "bobyang007",
    "comments": [
      {
        "user": "twose",
        "created_at": "2021-11-26T02:38:06Z",
        "body": "那就只能用process模式了，Linux支持的问题"
      }
    ]
  },
  {
    "number": 4505,
    "title": "Swoole with MSSQL ",
    "created_at": "2021-11-22T15:43:27Z",
    "closed_at": "2021-12-01T14:05:36Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4505",
    "body": "Hi, i want to use swoole for a new project. Is there a way to use swoole with MSSQL? I read in the docs that you have coroutines for MySql, Postgres, Redis. But I didn't find anything about MSSQL.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4505/comments",
    "author": "mantsap89",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-11-24T00:18:44Z",
        "body": "MSSQL does not support running with coroutine environment, if you use `Swoole\\Server`, you should use task worker to simulate non-blocking/coroutine MSSQL client"
      }
    ]
  },
  {
    "number": 4484,
    "title": "The workers do not work when multiple messages are sent by the client.",
    "created_at": "2021-11-11T10:16:43Z",
    "closed_at": "2021-11-15T06:08:16Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4484",
    "body": "Different latency with different approaches of connecting and sending a message by the client. And not all workers work when clients consistently send a message.\r\n\r\n### Code from the server side:\r\n```php\r\n<?php\r\n\r\n$server = new \\Swoole\\Server('/home/ubuntu/swoole/myserv.sock', 9504, SWOOLE_IPC_UNSOCK);\r\n\r\n$server->set([\r\n    'open_eof_split' => true,\r\n    'open_eof_check' => true,\r\n    'package_eof' => \"\\n\",\r\n    'worker_num' => 50,\r\n]);\r\n\r\n$server->on('start', function () {\r\n    echo 'Server has started' . PHP_EOL;\r\n});\r\n\r\n$server->on('connect', function (Swoole\\Server $server, int $fd) {\r\n    echo 'New connection established: #' . $fd . PHP_EOL;\r\n});\r\n\r\n$server->on('receive', function ($server, $fd, $fromId, $data) {\r\n\r\n    sleep(1);\r\n\r\n    $stats = $server->stats();\r\n\r\n    echo 'Client id: ' . $fd .\r\n        ' Worker id: ' . $server->getWorkerId() .\r\n        ' Connection num: ' . $stats['connection_num'] .\r\n        ' Work num: ' . $stats['worker_num'] .\r\n        ' Idle work num: ' . $stats['idle_worker_num'] . PHP_EOL;\r\n\r\n    $server->send($fd, json_encode('pong') . \"\\n\");\r\n\r\n});\r\n\r\n$server->on('close', function ($server, $fd) {\r\n    echo 'Connection closed: #' . $fd . PHP_EOL;\r\n});\r\n\r\n$server->start();\r\n```\r\n\r\n### There are two client codes. The first code:\r\n```php\r\n<?php\r\n\r\nrequire dirname(__DIR__, 2) . '/helpers/bootstrap.php';\r\n\r\n$clients = [];\r\n\r\n$num = 10;\r\n\r\n$start = hrtime(true);\r\n\r\nfor ($i = 0; $i < $num; $i++) {\r\n\r\n    $clients[$i] = new Swoole\\Client(SWOOLE_IPC_UNSOCK | SWOOLE_KEEP);\r\n\r\n    if (!$clients[$i]->connect(\"127.0.0.1\", 9504, 2)) {\r\n        die(\"[ERROR] Failed to start client\") . PHP_EOL;\r\n    }\r\n\r\n    $clients[$i]->set([\r\n        'open_eof_split' => true,\r\n        'open_eof_check' => true,\r\n        'package_eof' => \"\\n\",\r\n    ]);\r\n\r\n}\r\n\r\nfor ($i = 0; $i < $num; $i++) {\r\n\r\n    $clients[$i]->send(json_encode('ping') . \"\\n\");\r\n\r\n}\r\n\r\nfor ($i = 0; $i < $num; $i++) {\r\n\r\n    $start_one = hrtime(true);\r\n\r\n    $clients[$i]->recv();\r\n\r\n    echo \"Client $i Total time: \" . round((hrtime(true) - $start_one) / 1000) . PHP_EOL;\r\n\r\n}\r\n\r\necho 'Total time: ' . round((hrtime(true) - $start) / 1000) . PHP_EOL;\r\n```\r\n\r\n### The second code:\r\n```php\r\n<?php\r\n\r\nrequire dirname(__DIR__, 2) . '/helpers/bootstrap.php';\r\n\r\n$clients = [];\r\n\r\n$num = 10;\r\n\r\n$start = hrtime(true);\r\n\r\nfor ($i = 0; $i < $num; $i++) {\r\n\r\n    $clients[$i] = new Swoole\\Client(SWOOLE_IPC_UNSOCK | SWOOLE_KEEP);\r\n\r\n    if (!$clients[$i]->connect(\"127.0.0.1\", 9504, 2)) {\r\n        die(\"[ERROR] Failed to start client\") . PHP_EOL;\r\n    }\r\n\r\n    $clients[$i]->set([\r\n        'open_eof_split' => true,\r\n        'open_eof_check' => true,\r\n        'package_eof' => \"\\n\",\r\n    ]);\r\n\r\n    $clients[$i]->send(json_encode('ping') . \"\\n\");\r\n\r\n}\r\n\r\nfor ($i = 0; $i < $num; $i++) {\r\n\r\n    $start_one = hrtime(true);\r\n\r\n    $clients[$i]->recv();\r\n\r\n    echo \"Client $i Total time: \" . round((hrtime(true) - $start_one) / 1000) . PHP_EOL;\r\n\r\n}\r\n\r\necho 'Total time: ' . round((hrtime(true) - $start) / 1000) . PHP_EOL;\r\n```\r\n\r\n### My conclusions and questions are as follows:\r\nThe difference is that in the first one, we first connect with ten clients, and then send 10 messages,\r\nand in the second code, we connected and immediately sent a message.\r\n\r\nThe first code is executed in the following time: Total time: 8014267 (~8 seconds)\r\nThe second code is executed in the following time: Total time: 2003541 (~8 seconds)\r\n*The next client launches will not necessarily have exactly the same time\r\n\r\nFrom the server side: in the first code, the maximum works 1-2 workers, although we have specified in the settings 50 worker_num,\r\nand in the second code everything is fine and work as much worker_num as the messages came.\r\n\r\nQuestion: How do I connect to 10 clients first, then send a messages and work as many workers as I specified in the settings. Make the Total time in the first code run in the same fast time as in the second code?\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4484/comments",
    "author": "kleninmaxim",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-11-15T06:08:16Z",
        "body": "\r\n```php\r\n$server = new \\Swoole\\Server('/home/ubuntu/swoole/myserv.sock', 9504,  SWOOLE_PROCESS, SWOOLE_IPC_UNSOCK);\r\n```\r\n\r\nThe third parameter of  constructor is not a socket type \r\n\r\n"
      }
    ]
  },
  {
    "number": 4438,
    "title": "How to stop the process pool so that it waits for all the workers to finish?",
    "created_at": "2021-10-15T20:44:58Z",
    "closed_at": "2021-10-21T08:50:01Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4438",
    "body": "In the my crawlers program with worker pool on kill (SIGTERM) signal program stops  immediately and doesn't wait until workers stop.\r\n\r\nPlease help to fix that prototype code, so it will exit after all workers stop:\r\n\r\n```\r\n<?php\r\n\r\ndeclare(strict_types=1);\r\n\r\n$workerNum = 5;\r\n\r\n$pool = new Swoole\\Process\\Pool($workerNum);\r\n\r\n$pool->on(\"WorkerStart\", function ($pool, $workerId) {\r\n    $sleep = rand(3, 6);\r\n    echo \"Worker#$workerId: sleep for $sleep seconds\\n\";\r\n    sleep($sleep);\r\n});\r\n\r\n$pool->on(\"WorkerStop\", function ($pool, $workerId) {\r\n    echo \"Worker#$workerId is stopped\\n\";\r\n    sleep(1);\r\n});\r\n\r\n$pool->start();\r\n\r\n```\r\n\r\nEnv parameters:\r\n\r\n```\r\nphp --ri swoole\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.6.5\r\nBuilt => Apr 24 2021 09:19:13\r\ncoroutine => enabled with boost asm context\r\nkqueue => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.1k  25 Mar 2021\r\ndtls => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nbrotli => E16777225/D16777225\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 262144 => 262144\r\n```\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n```\r\n[1] 7055\r\n[2] 7056\r\nDarwin MacBook-X.local 20.6.0 Darwin Kernel Version 20.6.0: Mon Aug 30 06:12:20 PDT 2021; root:xnu-7195.141.6~3/RELEASE_ARM64_T8101 arm64\r\n[1]  - done       uname -a\r\nPHP 7.4.23 (cli) (built: Aug 27 2021 10:07:08) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v3.4.0, Copyright (c) Zend Technologies\r\n[2]  + done       php -v\r\nConfigured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/c++/4.2.1\r\nApple clang version 13.0.0 (clang-1300.0.29.3)\r\nTarget: arm64-apple-darwin20.6.0\r\nThread model: posix\r\nInstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin\r\n```\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4438/comments",
    "author": "alebedev80",
    "comments": [
      {
        "user": "deminy",
        "created_at": "2021-10-16T00:17:43Z",
        "body": "The `SIGTERM` signal is handled in the manager process only, but not handled in each worker processes. You will need to handle signal `SIGTERM` in worker processes.\r\n\r\nHere are two examples to handle signal `SIGTERM` in worker processes.\r\n\r\n## If the worker process runs in non-blocking mode:\r\n\r\n```php\r\n<?php\r\n\r\ndeclare(strict_types=1);\r\n\r\nuse Swoole\\Coroutine;\r\nuse Swoole\\Process;\r\nuse Swoole\\Process\\Pool;\r\n\r\necho \"Current process ID is: \", posix_getpid(), \"\\n\";\r\n\r\n$pool = new Pool(2);\r\n$pool->set(['enable_coroutine' => true]);\r\n\r\n$pool->on(\"WorkerStart\", function (Pool $pool, int $workerId) {\r\n    Process::signal(SIGTERM, function() use ($pool, $workerId) {\r\n        echo \"Will shutdown process #{$workerId}\\n\";\r\n        // More clean up code before exiting the process.\r\n    });\r\n\r\n    $sleep = rand(3, 6);\r\n    echo \"Worker #$workerId: sleep for {$sleep} seconds\\n\";\r\n    Coroutine::sleep($sleep);\r\n});\r\n\r\n$pool->on(\"WorkerStop\", function ($pool, $workerId) {\r\n    echo \"Worker#$workerId is stopped\\n\";\r\n    sleep(1);\r\n});\r\n\r\n$pool->start();\r\n```\r\n\r\n## If the worker process runs in blocking mode:\r\n\r\n```php\r\n$pool->on(\"WorkerStart\", function ($pool, $workerId) {\r\n    $running = true;\r\n    pcntl_signal(SIGTERM, function () use (&$running) {\r\n        $running = false;\r\n    });\r\n    echo \"Worker#{$workerId} is started\\n\";\r\n    $redis = new Redis();\r\n    $redis->pconnect('127.0.0.1', 6379);\r\n    $key = \"key1\";\r\n    while ($running) {\r\n         $msg = $redis->brpop($key);\r\n         pcntl_signal_dispatch();\r\n         if ( $msg == null) continue;\r\n         var_dump($msg);\r\n     }\r\n});\r\n```"
      },
      {
        "user": "alebedev80",
        "created_at": "2021-10-16T10:56:22Z",
        "body": "@matyhtf thank you very much!\r\n\r\ni've fixed my prototype's code relate to blocking mode example and it's working fine. It would be great to correct the documentation, I think this is a quite common problem.\r\n\r\n```\r\n<?php\r\n\r\ndeclare(strict_types=1);\r\n\r\nuse Swoole\\Coroutine as Co;\r\n\r\n$workerNum = 3;\r\n\r\necho \"Current process ID is: \", posix_getpid(), \"\\n\";\r\n\r\n$pool = new Swoole\\Process\\Pool($workerNum);\r\n$pool->set(['enable_coroutine' => true]);\r\n$pool->on(\"WorkerStart\", function ($pool, $workerId) {\r\n    $running = true;\r\n    pcntl_signal(SIGTERM, function () use (&$running, $workerId) {\r\n        $t = date('H:i:s');\r\n        echo \"$t - Worker#$workerId: got SIGTERM at $t\\n\";\r\n        $running = false;\r\n    });\r\n    while ($running) {\r\n        $sleep = rand(5, 10);\r\n        $s = date('H:i:s');\r\n        echo \"$s - Worker#$workerId: start $s and sleep for $sleep seconds\\n\";\r\n        Co::exec(\"/bin/sleep $sleep\");\r\n        $f = date('H:i:s');\r\n        echo \"$f - Worker#$workerId: stop after sleep for $sleep seconds $s - $f\\n\";\r\n        pcntl_signal_dispatch();\r\n    }\r\n});\r\n\r\n$pool->on(\"WorkerStop\", function ($pool, $workerId) {\r\n    $t = date('H:i:s');\r\n    echo \"$t - Worker#$workerId is stopped\\n\";\r\n    sleep(1);\r\n});\r\n\r\n$pool->start();\r\n```\r\n\r\n\r\n\r\n"
      }
    ]
  },
  {
    "number": 4427,
    "title": "Swoole output server. Messages stick together or are not transmitted at all if you make too many shipments from one client",
    "created_at": "2021-10-11T11:50:42Z",
    "closed_at": "2021-10-15T00:26:04Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4427",
    "body": "Hi!\r\nI want to send data from client to server\r\n\r\n```\r\n<?php\r\n\r\n$client = new Swoole\\Client(SWOOLE_IPC_UNSOCK | SWOOLE_KEEP);\r\n\r\nif (!$client->connect(SOCKET_CLIENT_IP, SOCKET_PORT_SERVER, 0.5)) {\r\n\r\n    sleep(5);\r\n\r\n    die(\"connect failed\") . PHP_EOL;\r\n}\r\n\r\nwhile (true) {\r\n\r\n    $client->send('PING');\r\n    $client->send('PING');\r\n    $client->send('PING');\r\n    $client->send('PING');\r\n    $client->send('PING');\r\n    \r\n    usleep(100);\r\n\r\n}\r\n```\r\n\r\nBut on server I recieve empty message or not receive else. Why?\r\nSo, I do several clients' connections, but how I can send message only in one connection?\r\n\r\n```\r\n$server->client1 = new Swoole\\Client(SWOOLE_IPC_UNSOCK | SWOOLE_KEEP);\r\n\r\nif (!$server->client1->connect(SOCKET_CLIENT_IP, SOCKET_PORT_ORDER_MANAGER, 0.5)) die(\"connect failed\") . PHP_EOL;\r\n\r\n$server->client2 = new Swoole\\Client(SWOOLE_IPC_UNSOCK | SWOOLE_KEEP);\r\n\r\nif (!$server->client2->connect(SOCKET_CLIENT_IP, SOCKET_PORT_ORDER_MANAGER, 0.5)) die(\"connect failed\") . PHP_EOL;\r\n\r\n$server->client3 = new Swoole\\Client(SWOOLE_IPC_UNSOCK | SWOOLE_KEEP);\r\n\r\nif (!$server->client3->connect(SOCKET_CLIENT_IP, SOCKET_PORT_ORDER_MANAGER, 0.5)) die(\"connect failed\") . PHP_EOL;\r\n\r\ngo(function () use ($server, $fd, $fromId, $data) {\r\n    $server->client1->send(json_encode($data));\r\n});\r\n\r\ngo(function () use ($server, $fd, $fromId, $data) {\r\n    $server->client1->send(json_encode($data));\r\n});\r\n\r\ngo(function () use ($server, $fd, $fromId, $data) {\r\n    $server->client1->send(json_encode($data));\r\n});\r\n```\r\n\r\nMy output is:\r\n\r\n1) Worker: 23, fd: 1, fromId: 23, msg: PINGPINGPING (FD: 1)\r\n2) Worker: 23, fd: 1, fromId: 23, msg: PINGPINGPINGPINGPINGPINGPINGPING (FD: 1)\r\n3) Worker: 23, fd: 1, fromId: 23, msg: PINGPINGPINGPINGPINGPING (FD: 1)\r\n4) Worker: 23, fd: 1, fromId: 23, msg: PINGPINGPING (FD: 1)\r\n5) Worker: 23, fd: 1, fromId: 23, msg: PINGPINGPINGPINGPINGPINGPINGPINGPINGPINGPINGPINGPINGPINGPINGPINGPINGPINGPINGPINGPINGPINGPINGPING (FD: 1)\r\n6) Worker: 23, fd: 1, fromId: 23, msg: PINGPINGPINGPINGPINGPINGPING (FD: 1)",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4427/comments",
    "author": "kleninmaxim",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-10-15T00:26:04Z",
        "body": "You should set the server and client protocol\r\n\r\n```php\r\n$server->set(['open_eof_split' => true, 'package_eof' => \"\\r\\n\"]);\r\n$client->set(['open_eof_split' => true, 'package_eof' => \"\\r\\n\"]);\r\n\r\n$client->send('PING'.\"\\r\\n\");\r\n$server->send('PING'.\"\\r\\n\");\r\n```"
      }
    ]
  },
  {
    "number": 4426,
    "title": "Understanding HTTP server with enable_coroutine",
    "created_at": "2021-10-10T12:52:37Z",
    "closed_at": "2021-10-11T02:52:37Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4426",
    "body": "Hi,\r\n\r\nI'm wondering, if there is a difference between\r\n\r\n```php\r\n$server = new Swoole\\Http\\Server('127.0.0.1', 8080);\r\n$server->set(['enable_coroutine' => true]);\r\n\r\n$http->on('request', function ($request, $response) {\r\n    $response->end('Hi there.');\r\n});\r\n\r\n$http->start();\r\n```\r\n\r\nand\r\n\r\n```php\r\n…\r\n$http->on('request', function ($request, $response) {\r\n    go(function() use ($request, $response) {\r\n        $response->end('Hi there.');\r\n    });\r\n});\r\n…\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4426/comments",
    "author": "intellent",
    "comments": [
      {
        "user": "sy-records",
        "created_at": "2021-10-11T01:12:25Z",
        "body": "`$server->set(['enable_coroutine' => true]);` The default is `true`, which will automatically create a coroutine' in the callback, without the need to manually call the `go` method"
      },
      {
        "user": "matyhtf",
        "created_at": "2021-10-11T02:52:37Z",
        "body": "@intellent The behavior of these two program is consistent"
      }
    ]
  },
  {
    "number": 4424,
    "title": "Question regarding file system security",
    "created_at": "2021-10-07T02:20:22Z",
    "closed_at": "2021-10-08T02:39:57Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4424",
    "body": "Hi, I was wondering if swoole prevents file system transversal in the Swoole\\Http\\Response->sendfile() and Swoole\\Coroutine\\FastCGI\\Client::call() methods. What are the security implications of these and similar methods in swoole?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4424/comments",
    "author": "ClosetGeek-Git",
    "comments": [
      {
        "user": "twose",
        "created_at": "2021-10-08T02:21:06Z",
        "body": "These APIs are just the non-blocking syscall wrappers.\r\nApplication security is guaranteed by the developer who wrote the service code.\r\nThe developer's code determines which requests are allowed by the service, and what Swoole does is just send data."
      },
      {
        "user": "ClosetGeek-Git",
        "created_at": "2021-10-08T03:12:27Z",
        "body": "Thank you. The documentation should make this clear."
      }
    ]
  },
  {
    "number": 4421,
    "title": "多协程共用连接问题",
    "created_at": "2021-10-01T15:38:26Z",
    "closed_at": "2021-10-08T02:39:16Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4421",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n创建一个websocket客户端，创建两个协程并使用该客户端发送信息\r\n```php\r\n$client = new \\Swoole\\Coroutine\\Http\\Client('127.0.0.1', 9501, false);\r\nCoroutine::create(function () use ($client ) {\r\n            while (true) {\r\n                    $client ->push('t1');\r\n                    sleep(1);\r\n                }\r\n        });\r\nCoroutine::create(function () use ($client ) {\r\n            while (true) {\r\n                    $client ->push('t2');\r\n                    sleep(1);\r\n                }\r\n        });\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n抛出绑定错误，协程不能共用连接\r\n\r\n3. What did you see instead?\r\n\r\n可以正常同时发送消息，没有报错，有点疑惑\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n```\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.6.7\r\nBuilt => Jul  1 2021 14:20:07\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.1d  10 Sep 2019\r\ndtls => enabled\r\nhttp2 => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n```\r\nLinux vtk-php74 4.19.84-microsoft-standard #1 SMP Wed Nov 13 11:44:37 UTC 2019 x86_64 GNU/Linux\r\n```\r\n```\r\nPHP 7.4.20 (cli) (built: Jun 28 2021 21:49:38) ( NTS )\r\n```\r\n```\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/8/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Debian 8.3.0-6' --with-bugurl=file:///usr/share/doc/gcc-8/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-8 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 8.3.0 (Debian 8.3.0-6)\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4421/comments",
    "author": "MrCJJW",
    "comments": [
      {
        "user": "twose",
        "created_at": "2021-10-02T07:06:22Z",
        "body": "Linux有发送缓冲区，发送数据量小的时候会立即完成，所以这里是串行的。"
      }
    ]
  },
  {
    "number": 4395,
    "title": "[Support] Swoole有对RocketMq的支持吗",
    "created_at": "2021-09-07T14:47:14Z",
    "closed_at": "2021-09-08T08:24:25Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4395",
    "body": "Swoole有对RocketMq的支持吗",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4395/comments",
    "author": "khiphop",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-09-08T08:24:25Z",
        "body": "可以使用 hook + phpamqplib "
      }
    ]
  },
  {
    "number": 4343,
    "title": "haproxy做tcp代理websocket服务,怎么拿到客户端真实IP",
    "created_at": "2021-07-28T10:29:28Z",
    "closed_at": "2021-07-30T06:48:20Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4343",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n使用websocket服务，前面使用了haproxy做tcp代理，这种要怎么在握手的时候获取客户端IP地址呢。\r\nhttp的可以，但tcp的始终不行，swoole里一直拿到的是haproxy 的地址\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4343/comments",
    "author": "DlenoDing",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-07-30T06:48:20Z",
        "body": "HaProxy TCP 代理无法得到真实 IP ，可以考虑使用 LVS 或者其他 SLB 软件，LVS/SLB 软件通过修改 IP 包头，将真实 IP 返回给了 `real server`"
      }
    ]
  },
  {
    "number": 4338,
    "title": "Swoole closes request silently when file larger than 2MB is uploaded",
    "created_at": "2021-07-26T00:54:18Z",
    "closed_at": "2021-07-26T01:24:57Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4338",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nUploading files larger than 2MB\r\n\r\n2. What did you expect to see?\r\n\r\nTo work just fine or throw an exception\r\n\r\n3. What did you see instead?\r\nA warning was logged to console\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nversion 4.6.7\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\nLinux amdell 5.8.0-63-generic #71~20.04.1-Ubuntu SMP Thu Jul 15 17:46:08 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nPHP 8.0.8 (cli) (built: Jul  1 2021 15:26:46) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v4.0.8, Copyright (c) Zend Technologies\r\n    with Zend OPcache v8.0.8, Copyright (c), by Zend Technologies\r\n\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/9/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none:hsa\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 9.3.0-17ubuntu1~20.04' --with-bugurl=file:///usr/share/doc/gcc-9/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++,gm2 --prefix=/usr --with-gcc-major-version-only --program-suffix=-9 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib=auto --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none=/build/gcc-9-HskZEa/gcc-9-9.3.0/debian/tmp-nvptx/usr,hsa --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04) \r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4338/comments",
    "author": "Ahmard",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2021-07-26T01:01:27Z",
        "body": "Hi, you can look at increasing package_max_length config."
      },
      {
        "user": "Ahmard",
        "created_at": "2021-07-26T01:09:49Z",
        "body": "I think Swoole should throw an exception or provide an API to let programmers handle the error instead of closing the connection automatically."
      },
      {
        "user": "Ahmard",
        "created_at": "2021-07-26T01:10:45Z",
        "body": "> Hi, you can look at increasing package_max_length config.\r\n\r\nI've seen it, but it's not what I'm looking for, check my latest comment."
      },
      {
        "user": "sy-records",
        "created_at": "2021-07-26T01:24:57Z",
        "body": "You need to set the `package_max_length` option.\r\n\r\n```php\r\n$http = new Swoole\\Http\\Server('0.0.0.0', 9501);\r\n\r\n$http->set(['package_max_length' => 65]);\r\n\r\n$http->on('Request', function ($request, $response) {\r\n    $response->header('Content-Type', 'text/html; charset=utf-8');\r\n    $response->end('<h1>Hello Swoole. #' . rand(1000, 9999) . '</h1>');\r\n});\r\n\r\n$http->start();\r\n```\r\n\r\nHere a WARNING error message will be thrown.\r\n\r\n```\r\n[2021-07-26 09:22:58 #52593.5]  WARNING Port_onRead_http() (ERRNO 7102): Request Entity Too Large: header-length (347) + content-length (536709) is greater than the package_max_length(65536) from session#1 on 0.0.0.0:9501\r\n```"
      }
    ]
  },
  {
    "number": 4326,
    "title": "[BUG?] Coroutine::cancel not cancelling coroutine.",
    "created_at": "2021-07-19T12:18:16Z",
    "closed_at": "2021-08-02T05:04:23Z",
    "labels": [
      "question",
      "waiting on review"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4326",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nWhile testing `Coroutine::cancel` I noticed that the call will only cancel one IO call within the cancelled coroutine.\r\nSo either the documentation lost something in translation, or it doesn't actually cancel the coroutine.\r\n\r\n```php\r\n<?php\r\nuse Swoole\\Coroutine;\r\n\r\nforeach (['php --ri swoole', 'uname -a', 'php -v', 'gcc -v'] as $cmd) {\r\n    echo \"\\n----- $cmd ----\\n\";\r\n    echo `$cmd`;\r\n    echo \"\\n------------\\n\";\r\n}\r\n\r\nCo\\run(function () {\r\n    echo \"\\n Hello - \" . time();\r\n    $c = Co\\go(function () {\r\n        Co\\defer(function () {\r\n            echo \"\\n Cancel - \" . time();\r\n        });\r\n        Co::sleep(2);\r\n        echo \"\\n Hello A - \" . time() . \" \" . (Coroutine::isCanceled() ? 'Y' : 'N');\r\n        Co::sleep(2);\r\n        echo \"\\n Hello B - \" . time() . \" \" . (Coroutine::isCanceled() ? 'Y' : 'N');\r\n    });\r\n    echo \"\\n Started: $c\";\r\n    if (Coroutine::cancel($c) === true) {\r\n        echo \"\\n Cancelled: $c\";\r\n    } else {\r\n        echo \"\\nswoole_last_error: \" . swoole_last_error();\r\n    }\r\n});\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\nExpected the coroutine #2 to be cancelled, and not be processed any more\r\n```\r\n Hello - 1626696957\r\n Started: 2\r\n Cancelled: 2\r\n Cancel - 1626696957 <-- should be the start time (+0-1sec on second change)\r\n```\r\n\r\n3. What did you see instead?\r\n\r\nThe first `sleep` was interrupted, the coroutine continued to run.\r\n```\r\n Hello - 1626696957\r\n Started: 2\r\n Hello A - 1626696957 Y\r\n Cancelled: 2\r\n Hello B - 1626696959 N  <--- at the very least, this should probably be Y for cid #2\r\n Cancel - 1626696959 <-- it's actually the start time +2sec, since the second `sleep` was not cancelled.\r\n```\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n```\r\n----- php --ri swoole ----\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.7.0\r\nBuilt => Jul 16 2021 10:49:14\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1d  10 Sep 2019\r\ndtls => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n```\r\n----- uname -a ----\r\nLinux ca60602a12a0 4.15.0-46-generic #49-Ubuntu SMP Wed Feb 6 09:33:07 UTC 2019 x86_64 GNU/Linux\r\n\r\n\r\n----- php -v ----\r\nPHP 8.0.0 (cli) (built: Dec  1 2020 03:14:26) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v4.0.0-dev, Copyright (c) Zend Technologies\r\n    with Zend OPcache v8.0.0, Copyright (c), by Zend Technologies\r\n\r\n\r\n----- gcc -v ----\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/8/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Debian 8.3.0-6' --with-bugurl=file:///usr/share/doc/gcc-8/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-8 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 8.3.0 (Debian 8.3.0-6) \r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4326/comments",
    "author": "ValiDrv",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2021-07-19T14:33:48Z",
        "body": "Hi. The canceled coroutine would continue to run and coroutine api that cause context switch would return false when canceling a coroutine successfully.\r\n\r\nit actually cancel the first coroutine api (Co::sleep(2)).\r\nCoroutine::cancel() cancel Co::sleep() api and resume the target coroutine to continue to run.\r\n\r\n\r\n```php\r\n    $c = Co\\go(function () {\r\n        Co\\defer(function () {\r\n            echo \"\\n Cancel - \" . time();\r\n        });\r\n        var_dump(Co::sleep(2)).PHP_EOL;\r\n        echo \"\\n Hello A - \" . time() . \" \" . (Coroutine::isCanceled() ? 'Y' : 'N');\r\n        var_dump(Co::sleep(2)).PHP_EOL;\r\n        echo \"\\n Hello B - \" . time() . \" \" . (Coroutine::isCanceled() ? 'Y' : 'N');\r\n    });\r\n```\r\n\r\nHello - 1626705129\r\n Started: 2\r\nbool(false)\r\n\r\n Hello A - 1626705129 Y\r\n Cancelled: 2\r\nbool(true)\r\n\r\n Hello B - 1626705131 N\r\n"
      },
      {
        "user": "ValiDrv",
        "created_at": "2021-07-23T14:48:23Z",
        "body": "Hi, if what @NathanFreeman answered is the correct answer, then I'm confused.\r\n\r\n`Coroutine::cancel($c)` should **a)** cancel a coroutine? or **b)** should cancel whatever IO block that coroutine is currently being suspended for, and resume said coroutine?\r\n\r\nIf **b)** is the correct answer, then the `::cancel` method name is very misleading _(in English, and most Latin based languages)_, since it actually means it should cancel and forget the coroutine with the `$c` id (and probably all it's shutdown function).\r\n\r\nIf this is the case, I suggest the method is renamed to `::cancelIo(...)`, '::cancelBlock(...)' or something along those lines.\r\n(That L and I in `cancelIo` camel case doesn't look to good tho...)"
      },
      {
        "user": "matyhtf",
        "created_at": "2021-08-02T05:04:23Z",
        "body": "The `Co::cancel()` method is to cancel an operation, not killing the coroutine. After cancellation, the coroutine will resume from the suspended state and continue to execute."
      },
      {
        "user": "matyhtf",
        "created_at": "2021-08-02T05:17:11Z",
        "body": "Thanks for your advice.Let's think about the naming here"
      },
      {
        "user": "ValiDrv",
        "created_at": "2021-08-02T10:57:12Z",
        "body": "Thanks, with that explanation or makes perfect sense. \r\n\r\nExcept for the misleading name... ( I suggest it's deprecated/renamed before to many people start to use it)"
      }
    ]
  },
  {
    "number": 4323,
    "title": "fopen create unwanted threads in child process added by *addProcess*",
    "created_at": "2021-07-18T03:39:10Z",
    "closed_at": "2021-07-30T10:10:35Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4323",
    "body": "\r\n**1. What did you do? If possible, provide a simple script for reproducing the error.**\r\n\r\ncat /proc/cpuinfo\r\nI have **8 Core** machine\r\n\r\n```php\r\n$server = new Swoole\\Http\\Server('127.0.0.1', 9501);\r\n\r\n$server->addProcess(new \\Swoole\\Process(function () {\r\n\r\n    \\Co\\run(function () {\r\n        $pid = getmypid();\r\n\r\n        echo \"Before fopen: PID $pid = \" . trim(`cat /proc/{$pid}/status | grep Threads`) . \"\\n\";\r\n\r\n        $fh = fopen('/tmp/test.txt', 'a');\r\n        fwrite($fh, \"Hello, World\\n\");\r\n        fclose($fh);\r\n\r\n        echo \"After fopen: PID $pid = \" . trim(`cat /proc/{$pid}/status | grep Threads`) . \"\\n\";\r\n\r\n        while (1) {\r\n        }\r\n    });\r\n\r\n}));\r\n\r\n$server->on('request', function ($serv, $fd, $from_id, $data) {\r\n});\r\n\r\n$server->start();\r\n```\r\n\r\n\r\n**2. What did you expect to see?**\r\n\r\n```\r\nBefore fopen: PID xxxx  = Threads:  1\r\nAfter  fopen: PID xxxx  = Threads:  1\r\n```\r\n\r\n**3. What did you see instead?**\r\n\r\n```\r\nBefore fopen: PID xxxx  = Threads:  1\r\nAfter  fopen: PID xxxx  = Threads:  9\r\n```\r\n\r\nI am seeing threads auto-increased to **9** after fopen() call without any control.\r\n\r\nThis is **not** causing any issue to application, but creating unwanted threads.\r\n\r\nThis issue can be fixed by setting  `Co::set(['hook_flags' => SWOOLE_HOOK_FILE]);`\r\n\r\n- is this expected behavior ? or is a bug ?\r\n- I don't see documentation mentioned that **mandatory** to add **SWOOLE_HOOK_FILE**\r\n- is SWOOLE_HOOK_FILE mandatory?\r\n\r\n\r\n**4. What version of Swoole are you using (show your `php --ri swoole`)?**\r\n```shell\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.6.7\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1f\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n**5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?**\r\n```\r\nUbuntu 9.3.0-17ubuntu1~20.04 x86_64\r\n\r\nPHP 8.0.7 (cli) (built: Jun 25 2021 08:49:44) ( ZTS )\r\nZend Engine v4.0.7, Copyright (c) Zend Technologies\r\n    with Zend OPcache v8.0.7, Copyright (c), by Zend Technologies\r\n\r\ngcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04)\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4323/comments",
    "author": "suvera",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-07-30T10:10:35Z",
        "body": "This is not a bug. When you use file-system functions, the ext-swoole will create a thread pool to change synchronous blocking io to an asynchronous non-blocking operation"
      }
    ]
  },
  {
    "number": 4319,
    "title": "http2 client does not return response with non-ssl/non http2 sites",
    "created_at": "2021-07-14T20:42:48Z",
    "closed_at": "2021-11-10T23:56:13Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4319",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nTrying to fetch a non ssl content via http2 client\r\n\r\n\r\n2. What did you expect to see?\r\nsite content as i receive http client\r\n\r\n\r\n3. What did you see instead?\r\nno response displayed despite the client->send succeeded.\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n4.6.7\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\nDebian 10 buster, \r\nPHP 8.0.8 (cli) (built: Jul  1 2021 16:14:13) ( NTS )\r\ngcc version 8.3.0\r\n\r\n\r\n-----------\r\nDespite the http/client get works fine, the same setting does not return result with http2\r\n\r\n```php\r\n\r\nCo\\run(function()\r\n{\r\n    // The domain we want to connect to\r\n    $domain = 'httpbin.org';\r\n    $client = new Swoole\\Coroutine\\Http\\Client($domain, 80, false);\r\n    $client->set(['timeout' => -1]);\r\n    $client->get('/ip');\r\n    var_dump($client->body);\r\n  \r\n    $client2 = new Swoole\\Coroutine\\Http2\\Client($domain, 80, false);\r\n    $client2->set([\r\n        'timeout' => -1,\r\n    ]);\r\n    $client2->connect();\r\n\r\n    // Create and build a request that will be sent...\r\n    $request = new Swoole\\Http2\\Request();\r\n    $request->method = 'GET';\r\n    $request->path = '/ip';\r\n\r\n    var_dump($client2->send($request));\r\n    var_dump($response = $client2->recv());\r\n});\r\n\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4319/comments",
    "author": "tolgaulas",
    "comments": [
      {
        "user": "tolgaulas",
        "created_at": "2021-07-14T20:56:37Z",
        "body": "I guess this can be intentional and there can be no reason to fall back to http/1.1 for swoole, though it should be nifty to have it."
      },
      {
        "user": "twose",
        "created_at": "2021-07-16T08:34:14Z",
        "body": "Although the standard itself does not require the use of encryption, all major browser implementations (i.e. Firefox, Chrome, Safari, Opera, IE, Edge) have decided that they will only support HTTP/2 over TLS. So the almost all HTTP2 servers require will require the client to enable SSL."
      }
    ]
  },
  {
    "number": 4313,
    "title": "Socket#X has already been bound to another coroutine#Y",
    "created_at": "2021-07-12T11:37:38Z",
    "closed_at": "2021-07-30T10:12:39Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4313",
    "body": "1. What did you do? If possible, provide a simple script for reproducing the error.\r\nI have simple API server that listens for requests and do stuff according to some variables. It uses MariaDB and ConnectionPool with some modifications to fight different issue where connection can go away if not used for longer period of time. \r\nTo completely honest I'm pretty sure I did something wrong...some error on my part. But I don't know what to look for.\r\nBelow is simplified code:\r\n```php\r\n\tuse Swoole\\HTTP\\Server;\r\n\tuse Swoole\\ConnectionPool;\r\n\tuse Swoole\\Runtime;\r\n\tSwoole\\Runtime::enableCoroutine(SWOOLE_HOOK_ALL);\r\n\r\n\tclass ConnectionPoolExt extends ConnectionPool {\r\n\t\tpublic function __construct(callable $constructor, int $size = self::DEFAULT_SIZE, ?string $proxy = null) {\r\n\t\t\t$this->maxretries = 10;\r\n\t\t\tparent::__construct($constructor, $size, $proxy);\r\n\t\t}\r\n\r\n\t\tpublic function get($retry = 0) {\r\n\t\t\tif($this->pool === null) {\r\n\t\t\t\tthrow new RuntimeException('Pool has been closed');\r\n\t\t\t}\r\n\t\t\tif($this->pool->isEmpty() && $this->num < $this->size) {\r\n\t\t\t\t$this->make();\r\n\t\t\t}\r\n\t\t\ttry {\r\n\t\t\t\t$out = $this->pool->pop();\r\n\t\t\t\tif(!$out || $out == null) {\r\n\t\t\t\t\t$this->make();\r\n\t\t\t\t\t$out = $this->pool->pop();\r\n\t\t\t\t\terror_log('['.__FILE__.':'.__LINE__.'] '.$out);\r\n\t\t\t\t}\r\n\t\t\t\t$r = $out->q('SELECT 1');\r\n\t\t\t\tif(!$r || $r->irow == 0) throw new Exception('SELECT 1 failed - No connection');\r\n\t\t\t} catch(Swoole\\Error | DBException | Exception $e) {\r\n\t\t\t\t$this->make();\r\n\t\t\t\t$out = $this->pool->pop();\r\n\t\t\t\ttry {\r\n\t\t\t\t\terror_log('['.__FILE__.':'.__LINE__.'] '.$out);\r\n\t\t\t\t} catch(Swoole\\Error | DBException | Exception $e) {\r\n\t\t\t\t\tif($retry < $this->maxretries) {\r\n\t\t\t\t\t\treturn $this->get(++$retry);\r\n\t\t\t\t\t}\r\n\t\t\t\t\terror_log('['.__FILE__.':'.__LINE__.'=>'.basename($e->getFile()).':'.$e->getLine().'] '.$e->getMessage());\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn $out;\r\n\t\t}\r\n\t}\r\n\r\n\t$dbpool = new ConnectionPoolExt(function() use ($config) {\r\n\t\treturn new DB($config); // This is wrapper around PDO, nothing too fancy there.\r\n\t}, 500);\r\n\r\n\t$srv = new Server('X.X.X.X', 9501);\r\n\t$srv->set([\r\n\t\t'log_level' => 0,\r\n\t\t'log_file' => '/var/log/swoole/swoole.log',\r\n\t\t'log_rotation' => SWOOLE_LOG_ROTATION_DAILY,\r\n\t\t'reload_async' => true,\r\n\t\t'http_compression_level' => 5,\r\n\t\t'http_gzip_level' => 5,\r\n\t\t'http_parse_post' => true,\r\n\t]);\r\n\r\n\t$srv->on('request', function($request, $response) use ($dbpool) {\r\n\t\t$db = $dbpool->get();\r\n\t\t// Do some important stuff that uses $db\r\n\t\tgo(function() use ($dbpool) {\r\n\t\t\t$db = $dbpool->get();\r\n\t\t\t// Do some less important stuff in \"background\"\r\n\t\t\t$dbpool->put($db);\r\n\t\t});\r\n\t\t$dbpool->put($db);\r\n\t});\r\n```\r\n\r\n2. What did you expect to see?\r\nNothing actually. ;) Everything should work fine.\r\n\r\n3. What did you see instead?\r\nSometimes I'm getting `Socket#X has already been bound to another coroutine#Y` from within `go()` function. And I have no idea why. I'm getting there fresh connection from the pool so this shouldn't happen...And I'm getting this error at `$dbpool->get()` and some DB query as well, which is especially weird because if I've got connection from the pool why it's bound somewhere else?\r\nAdditional weirdness: I've seen this happening within `go()` but not at the first DB query! So I could have something like this:\r\n```php\r\n\t\tgo(function() use ($dbpool) {\r\n\t\t\t$db = $dbpool->get();\r\n\t\t\t$db->query('SELECT 1 FROM whatever'); // This had to worked\r\n\t\t\t// Do some stuff\r\n\t\t\t$db->query('SELECT 2 FROM somethingelse'); // Because this one threw Swoole\\Error\r\n\t\t\t$dbpool->put($db);\r\n\t\t});\r\n```\r\nwhere the first query would work and the second wouldn't.\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n4.6.7\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\nphp: 8.0.5\r\ngcc version 11.1.1 20210430 (GCC)\r\nLinux 5.10.37-1",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4313/comments",
    "author": "Draghmar",
    "comments": [
      {
        "user": "twose",
        "created_at": "2021-07-13T01:48:55Z",
        "body": "I can not find any problem with the code you provided here for now... And it seems that you have already known about coroutine socket binding things, so maybe I can trust you that you would not make simple mistakes here.\r\nBefore you provide a simple script for reproducing the error, it may be difficult for me to continue to help you track the real problem..."
      },
      {
        "user": "Draghmar",
        "created_at": "2021-07-13T07:43:03Z",
        "body": "The code I'm using doesn't differ from this simplified sample. It's exactly like that...Maybe there's one additional thing that I'm doing but I'm not sure if it's related - see the sample below. \r\nAlso there's no specific way for reproducing error. It doesn't happen all the time but from time to time and I can't find a way to trigger it \"manually\". Sometimes it triggers directly from within `go()` but sometimes when doing `$dbpool->get()` and testing connection from within `ConnectionPoolExt` extended class.\r\nI think it's related to the fact I see it only on production server, where there is more traffic then on dev. That's why I'm trying to understand why it can happen, so maybe this way I could \"blindly\" prevent it.\r\n\r\n```php\r\n$srv->on('request', function($request, $response) use ($dbpool) {\r\n\t$db = $dbpool->get();\r\n\t$path = $request->server['request_uri'];\r\n\t$router = new Router($path); // It parser the requested path to trigger function\r\n\r\n\t// Do some important stuff that uses $db\r\n\r\n\t$router->add('/requested/path', function() use ($db, $dbpool) {\r\n\t\t//Do some more stuff with $db\r\n\t\tgo(function() use ($dbpool) {\r\n\t\t\t$db = $dbpool->get();\r\n\t\t\t$db->query('SELECT 1 FROM whatever'); // This had to worked\r\n\r\n\t\t\t// Do some stuff\r\n\t\t\t\r\n\t\t\t// Triggers different biding, where `$this` relates to `$router`\r\n\t\t\t// Maybe I should do this in nested coroutine?\r\n\t\t\t$this->trigger('/some/path/to/trigger');\r\n\r\n\t\t\t$db->query('SELECT 2 FROM somethingelse'); // Because this one threw Swoole\\Error\r\n\t\t\t$dbpool->put($db);\r\n\t\t});\r\n\t});\r\n\r\n\t$router->add('/some/path/to/trigger', function() use ($db, $dbpool) {\r\n\t\t//Do some more stuff with $db\r\n\t\tgo(function() use ($dbpool) {\r\n\t\t\t$db = $dbpool->get();\r\n\t\t\t$db->query('SELECT 1 FROM whatever'); // This had to worked\r\n\t\t\t// Do some stuff\r\n\t\t\t$db->query('SELECT 2 FROM somethingelse'); // Because this one threw Swoole\\Error\r\n\t\t\t$dbpool->put($db);\r\n\t\t});\r\n\t});\r\n\r\n\t$router->go(); // It triggers bound Closure\r\n\t$dbpool->put($db);\r\n});\r\n```\r\nWhat the `$router->add()` does is:\r\n```php\r\npublic function add($path, $fn, $bubble = null) {\r\n\t$this->events[$path] = [\r\n\t\t'call'=>Closure::bind($fn,$this),\r\n\t\t'bubble'=>$bubble ?? $this->bubble,\r\n\t];\r\n}\r\n```\r\nAnd then `$router->go()` (as well as `$router->trigger()`) simply invokes what's in the `call`.\r\n\r\nI tried yesterday to remove all the `go()` functions and all those stuff, that I wanted to do in \"background\", I did in a normal run. At the moment it looks like I didn't get more of those errors, which would suggests the error is related to getting DB connection in coroutine...\r\n\r\nBTW Don't trust me with knowing anything about socket binding. ;) I do know that there is something like that but I don't know the details so it's quite possible I did some basic mistake. One of the reasons I'm asking here is to get some tips on what could trigger this error to try to find out if I did that mistake. :P"
      },
      {
        "user": "twose",
        "created_at": "2021-07-13T07:57:42Z",
        "body": "However... socket binding checks never make mistakes. The only thing you should know is that if you are reading or writing on the socket, you can not use the socket in another coroutine anymore before the reading or writing was done...\r\nI still can't see the problem from the limited info you provided... Did you create a new coroutine in `$this->trigger()`, then it read or write on the socket when the socket is working on `$db->query('SELECT 2 FROM somethingelse');`?"
      }
    ]
  },
  {
    "number": 4264,
    "title": "swoole HTTP服务器控制http请求转发到哪个worker进程处理",
    "created_at": "2021-06-15T05:45:47Z",
    "closed_at": "2021-06-15T08:02:47Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4264",
    "body": "请教一下 swoole HTTP服务器能否控制将http请求转发到哪些worker下处理，或者不转发到某些worker下处理？",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4264/comments",
    "author": "dongzitai",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-06-15T08:02:47Z",
        "body": "可设置 dispatch_func 或者 dispatch_mode 控制任务投递逻辑"
      },
      {
        "user": "dongzitai",
        "created_at": "2021-06-15T08:21:02Z",
        "body": "> 可设置 dispatch_func 或者 dispatch_mode 控制任务投递逻辑\r\n\r\n感谢"
      }
    ]
  },
  {
    "number": 4235,
    "title": "如何主动关闭某个协程？  比如：一个协程内 websocket连接持续获取数据， 某个时刻连接断了, 需要退出当前协程， 重新开启一个协程获取数据。",
    "created_at": "2021-05-24T06:30:29Z",
    "closed_at": "2021-05-25T08:34:31Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4235",
    "body": "如何主动关闭某个协程？  比如：一个协程内 websocket连接持续获取数据， 某个时刻连接断了, 需要退出当前协程， 重新开启一个新协程获取数据。 如何退出老协程。\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4235/comments",
    "author": "xybingbing",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-05-25T08:34:31Z",
        "body": "不支持主动关闭协程，你可以设计一种机制，通知老的协程退出"
      }
    ]
  },
  {
    "number": 4224,
    "title": "When using http proxy provided by luminati.io, the response body is not in english language",
    "created_at": "2021-05-18T17:18:09Z",
    "closed_at": "2021-05-19T00:50:19Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4224",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\nusing Swoole\\Coroutine\\Http\\Client with proxy settings:\r\n[\r\n'http_proxy_host' => [luminati proxy host],\r\n'http_proxy_port' => [luminati proxy port],\r\n'http_proxy_user' => [luminati provided username],\r\n'http_proxy_password' => [luminati provided password]\r\n]\r\n\r\n\r\n2. What did you expect to see?\r\n[\"body\"]=>\r\n  string(134) \"{\"responseCode\":0,\"responseMessage\":\"Success\",\"success\":true}\"\r\n\r\n\r\n3. What did you see instead?\r\n[\"body\"]=>\r\n  string(131) \"�V*J-.��+Nu�OIU�2Ё\r\n                                 �'�Ŕ�K���%�b(˪��4UG)7�(;�$85'5�$3?�3E���������$Y�Z�dedld4673�54�Q�OI)v�/�M,i1�Gl�Q�\"\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.6.7-dev\r\nBuilt => May 13 2021 14:01:11\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.1d  10 Sep 2019\r\ndtls => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\nLinux  4.19.0 #1 SMP Tue Jun 9 12:58:54 MSK 2020 x86_64 GNU/Linux\r\nPHP 7.4.2 (cli) (built: Feb  1 2020 19:33:30) ( NTS )\r\ngcc version 8.3.0 (Debian 8.3.0-6)\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4224/comments",
    "author": "odrads",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-05-19T00:50:19Z",
        "body": "Missing zlib library, Try disable http compression, or install zlib-dev and recompile swoole.\r\n\r\n```php\r\n$client->setHeaders(['Accept-Encoding' => null, ]);\r\n```"
      }
    ]
  },
  {
    "number": 4216,
    "title": "swoole啥时候能出mongodb的异步客户端驱动？",
    "created_at": "2021-05-17T10:15:07Z",
    "closed_at": "2021-05-19T03:08:11Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4216",
    "body": "我现在想操作mongodb  发现文档没有\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4216/comments",
    "author": "ffbbj",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-05-19T03:08:11Z",
        "body": "可以使用 task 进程实现 mongodb 的同步转异步。"
      }
    ]
  },
  {
    "number": 4206,
    "title": "Installation Issue: recipe for target 'ext-src/swoole_curl.lo' failed",
    "created_at": "2021-05-12T22:10:36Z",
    "closed_at": "2021-05-13T01:56:53Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4206",
    "body": "1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nUsed command below:\r\npecl install -D 'enable-sockets=\"no\" enable-openssl=\"yes\" enable-http2=\"yes\" enable-mysqlnd=\"yes\" enable-swoole-json=\"no\" enable-swoole-curl=\"yes\"' swoole\r\n\r\n2. What did you expect to see?\r\n\r\nSuccesful installation.\r\n\r\n3. What did you see instead?\r\nThe installation ends up on: \r\n\r\nIn file included from /tmp/pear/temp/swoole/ext-src/swoole_curl.cc:17:0:\r\n/tmp/pear/temp/swoole/ext-src/php_swoole_curl.h:25:10: fatal error: curl/curl.h: No such file or directory\r\n #include <curl/curl.h>\r\n          ^~~~~~~~~~~~~\r\ncompilation terminated.\r\nMakefile:229: recipe for target 'ext-src/swoole_curl.lo' failed\r\nmake: *** [ext-src/swoole_curl.lo] Error 1\r\nERROR: `make' failed\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nswoole-4.6.6\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n-- Ubuntu 18.04\r\n-- PHP 8.0.5\r\n-- gcc version 7.5.0\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4206/comments",
    "author": "fakharak",
    "comments": [
      {
        "user": "fakharak",
        "created_at": "2021-05-12T22:54:21Z",
        "body": "This solved the issue: \r\nsudo apt-get install libcurl4-openssl-dev\r\n\r\nBut now when i type 'php -v' i get:\r\nPHP Warning:  PHP Startup: Unable to load dynamic library 'swoole.so' (tried: /usr/lib/php/20200930/swoole.so (/usr/lib/php/20200930/swoole.so: undefined symbol: curl_ce), /usr/lib/php/20200930/swoole.so.so (/usr/lib/php/20200930/swoole.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0"
      },
      {
        "user": "sy-records",
        "created_at": "2021-05-13T01:56:53Z",
        "body": "1. #include <curl/curl.h>\r\n\r\n```bash\r\nsudo apt-get install libcurl4-openssl-dev\r\n```\r\n\r\n2. You need to load the curl extension before the swoole extension"
      },
      {
        "user": "fakharak",
        "created_at": "2021-05-13T07:48:18Z",
        "body": "Thanks. You have identified the root cause correctly as i have tested by updating php.ini.\r\n\r\nBut i want to mention that i do not have anything like below after installation\r\n/etc/php/7.2/cli/conf.d/XY-swoole.ini\r\n\r\nTherefore, at the time of writing i tested by enabling curl in php.ini which worked (I think which is to test the solution only, but not a preferred approach)\r\n\r\n\r\nAfter resolving curl_ce, i got \"undefined symbol: socket_ce\" in error message, so i uncommented socket extensin in php.ini which worked but as socket is also loading from mod_available therefore, i get:\r\n\r\nPHP Warning:  Module \"curl\" is already loaded in Unknown on line 0\r\nPHP Warning:  Module \"sockets\" is already loaded in Unknown on line 0\r\n\r\nI am now working on \r\n\r\nA) Create XY-swoole.ini (like, 60-swoole.ini) inside /etc/php/8.0/cli/conf.d/\r\nB) execute:\r\n    ln -s  /etc/php/7.2/mods-available/swoole.ini /etc/php/7.2/cli/conf.d/60-swoole.ini \r\nC) Close / Comment /disable extensions \"socket\" and \"curl\" in /etc/php/8.0/cli/php.ini\r\n\r\nSwoole is great, i further appreciate if future release may automate that process.\r\n\r\nGreat thanks."
      },
      {
        "user": "fakharak",
        "created_at": "2021-05-13T10:54:43Z",
        "body": "In order to execute three steps mentioned below, using bash (cli) ... \r\nA) Create XY-swoole.ini (like, 60-swoole.ini) inside /etc/php/8.0/cli/conf.d/\r\nB) execute:\r\nln -s /etc/php/7.2/mods-available/swoole.ini /etc/php/7.2/cli/conf.d/60-swoole.ini\r\nC) Close / Comment /disable extensions \"socket\" and \"curl\" in /etc/php/8.0/cli/php.ini\r\n\r\nI performed actions below in bash:\r\n\r\nsudo chmod g+rw- /etc/php/8.0/cli/conf.d\r\nsudo chmod g+rw- conf.d /etc/php/8.0/mods-available\r\nsudo printf \"; configuration for swoole module\\n; priority=60\\nextension=swoole.so\" > /etc/php/8.0/mods-available/swoole.ini\r\nln -s  /etc/php/8.0/mods-available/swoole.ini /etc/php/8.0/cli/conf.d/60-swoole.ini\r\nsudo chmod g+r-w+x conf.d\r\ncd /etc/php/8.0\r\nsudo chmod g+r-w+x mods-available\r\n\r\n- Add Run-time Configurations in php.ini\r\nswoole.enable_preemptive_scheduler\r\n\r\nLet me know if there is a better way. (I missed out taking default permissions of \"mod-available\" folder) so i sppreciate if these are provided.\r\nThanks"
      }
    ]
  },
  {
    "number": 4195,
    "title": "Coroutine TCP clients do not support Unix addresses as targets.",
    "created_at": "2021-05-10T06:14:43Z",
    "closed_at": "2021-05-11T02:28:06Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4195",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\nServer:\r\n``` php\r\n<?php\r\n\r\nuse Swoole\\Process;\r\nuse Swoole\\Coroutine;\r\nuse Swoole\\Coroutine\\Server\\Connection;\r\n\r\n\r\nSwoole\\Coroutine\\run(function () {\r\n    $server = new Swoole\\Coroutine\\Server('unix:///tmp/rpc.socket');\r\n\r\n    $server->set([\r\n        'open_length_check'     => true,\r\n        'package_max_length'    => 64 * 1024 * 1024, // 16M\r\n        'package_length_type'   => 'N',\r\n        'package_length_offset' => 0,\r\n        'package_body_offset'   => 4,\r\n    ]);\r\n\r\n    // 收到15信号关闭服务\r\n    Process::signal(SIGTERM, function () use ($server) {\r\n        $server->shutdown();\r\n    });\r\n\r\n    // 接收到新的连接请求 并自动创建一个协程\r\n    $server->handle(function (Connection $conn) {\r\n        while (true) {\r\n            $data = $conn->recv();\r\n\r\n            var_dump(strlen($data));\r\n\r\n            if ($data === false || $data === '') {\r\n                $conn->close();\r\n                break;\r\n            }\r\n\r\n            // var_dump(substr($data, 4));\r\n            var_dump(unpack('N', substr($data, 0, 4))[1]);\r\n\r\n            $data = \"ok\";\r\n            $conn->send(pack('N', strlen($data)).$data);\r\n        }\r\n    });\r\n\r\n    // 开始监听端口\r\n    $server->start();\r\n});\r\n\r\n```\r\n\r\nclient:\r\n``` php\r\n<?php\r\n\r\nuse Swoole\\Coroutine\\Client;\r\nuse function Swoole\\Coroutine\\run;\r\n\r\nrun(function () {\r\n    $client = new Client(SWOOLE_SOCK_UNIX_STREAM);\r\n\r\n    $client->set([\r\n        'open_length_check'     => true,\r\n        'package_max_length'    => 64 * 1024 * 1024,\r\n        'package_length_type'   => 'N',\r\n        'package_length_offset' => 0,\r\n        'package_body_offset'   => 4,\r\n    ]);\r\n\r\n    if (! $client->connect('unix:///tmp/rpc.socket', 0, 1))\r\n    {\r\n        echo \"connect failed. Error: {$client->errCode}\\n\";\r\n        return;\r\n    }\r\n\r\n    $http = new Swoole\\Coroutine\\Http\\Client('www.qq.com', 443, true);\r\n    $http->setHeaders([\r\n        'Host' => 'www.qq.com',\r\n        'User-Agent' => 'Chrome/49.0.2587.3',\r\n        'Accept' => 'text/html,application/xhtml+xml,application/xml',\r\n        'Accept-Encoding' => 'gzip',\r\n    ]);\r\n\r\n    $http->get('/');\r\n\r\n    $data = str_repeat($http->body, 10);\r\n    var_dump(strlen($data));\r\n\r\n    if ($client->send(pack('N', strlen($data)).$data) === false) {\r\n        var_dump($client->errCode);\r\n    }\r\n\r\n    echo $client->recv();\r\n\r\n    $http->close();\r\n    $client->close();\r\n});\r\n\r\n```\r\n\r\n2. What did you expect to see?\r\n``` shell\r\nls -l /tmp/rpc.socket\r\nsrwxr-xr-x 1 root root 0  5月 10 14:06 /tmp/rpc.socket\r\n\r\nphp ./client.php\r\nconnect failed. Error: 2\r\n```\r\n\r\n3. What did you see instead?\r\n-\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n``` shell\r\nphp --ri swoole\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.6.6\r\nBuilt => May  8 2021 14:24:09\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.1k  FIPS 25 Mar 2021\r\ndtls => enabled\r\nhttp2 => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n```\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n``` shell\r\nPHP 8.0.6 (cli) (built: May  8 2021 14:21:27) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v4.0.6, Copyright (c) Zend Technologies\r\n    with Zend OPcache v8.0.6, Copyright (c), by Zend Technologies\r\n```\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4195/comments",
    "author": "Alion548",
    "comments": [
      {
        "user": "sy-records",
        "created_at": "2021-05-11T02:28:06Z",
        "body": "```diff\r\n-    if (! $client->connect('unix:///tmp/rpc.socket', 0, 1))\r\n+    if (! $client->connect('/tmp/rpc.socket', 0, 1))\r\n    {\r\n        echo \"connect failed. Error: {$client->errCode}\\n\";\r\n        return;\r\n    }\r\n```"
      }
    ]
  },
  {
    "number": 4173,
    "title": "Static compile with php一些参数问题",
    "created_at": "2021-04-24T18:44:20Z",
    "closed_at": "2021-04-27T08:21:31Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4173",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n在把swoole放入ext/和php一起编译的时候，发现参数列表的文档以及编译选项不够全。\r\n\r\n首先这样的情况无法控制比如 `--enable-http2` 这几个参数。目前最新的 git 版本我只找到了 `coverage, json, dev` 等这几个enable的选项，且官方文档并无具体说明。\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4173/comments",
    "author": "crazywhalecc",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-04-27T08:21:31Z",
        "body": "可以控制这些参数，使用方法与单独编译 swoole 的一致"
      }
    ]
  },
  {
    "number": 4161,
    "title": "M1  mach-o, but wrong architecture",
    "created_at": "2021-04-21T13:20:06Z",
    "closed_at": "2021-04-24T23:35:50Z",
    "labels": [
      "question",
      "macos",
      "installation"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4161",
    "body": "dreamer@192 20170718 % ll\r\ntotal 8808\r\n-rw-r--r--  1 root  admin  1800935  1 26 19:13 mongodb.so\r\n-rw-r--r--  1 root  admin  2705328  4 21 21:18 swoole.so\r\ndreamer@192 20170718 % php -v\r\nPHP Warning:  PHP Startup: Unable to load dynamic library 'swoole.so' (tried: /opt/homebrew/lib/php/pecl/20170718/swoole.so (dlopen(/opt/homebrew/lib/php/pecl/20170718/swoole.so, 9): no suitable image found.  Did find:\r\n\t/opt/homebrew/lib/php/pecl/20170718/swoole.so: mach-o, but wrong architecture\r\n\t/opt/homebrew/lib/php/pecl/20170718/swoole.so: mach-o, but wrong architecture), /opt/homebrew/lib/php/pecl/20170718/swoole.so.so (dlopen(/opt/homebrew/lib/php/pecl/20170718/swoole.so.so, 9): image not found)) in Unknown on line 0\r\n\r\nWarning: PHP Startup: Unable to load dynamic library 'swoole.so' (tried: /opt/homebrew/lib/php/pecl/20170718/swoole.so (dlopen(/opt/homebrew/lib/php/pecl/20170718/swoole.so, 9): no suitable image found.  Did find:\r\n\t/opt/homebrew/lib/php/pecl/20170718/swoole.so: mach-o, but wrong architecture\r\n\t/opt/homebrew/lib/php/pecl/20170718/swoole.so: mach-o, but wrong architecture), /opt/homebrew/lib/php/pecl/20170718/swoole.so.so (dlopen(/opt/homebrew/lib/php/pecl/20170718/swoole.so.so, 9): image not found)) in Unknown on line 0\r\nPHP 7.2.34 (cli) (built: Dec 15 2020 20:10:02) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.2.34, Copyright (c) 1999-2018, by Zend Technologies",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4161/comments",
    "author": "shuliangfu",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-04-24T23:35:50Z",
        "body": "Your php may be of x86 architecture, please compile swoole on x86 platform, then copy swoole.so to your machine"
      },
      {
        "user": "shuliangfu",
        "created_at": "2021-05-10T06:53:06Z",
        "body": "No, no, my computer is the latest Apple M1"
      },
      {
        "user": "siwazeng",
        "created_at": "2021-11-10T02:12:24Z",
        "body": "请问你解决了问题了吗？能请求一下解决方法吗"
      }
    ]
  },
  {
    "number": 4142,
    "title": "Installing PECL swoole package fails on WSL2",
    "created_at": "2021-04-08T21:36:41Z",
    "closed_at": "2021-04-09T02:17:40Z",
    "labels": [
      "question",
      "installation"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4142",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nTried to install the pecl package with the following command:\r\n```pecl install --configureoptions 'enable-sockets=\"no\" enable-openssl=\"yes\" enable-http2=\"yes\" enable-mysqlnd=\"yes\" enable-swoole-json=\"no\" enable-swoole-curl=\"yes\"' swoole```\r\n\r\n2. What did you expect to see?\r\nI was expecting the package to be installed without a problem.\r\n\r\n\r\n3. What did you see instead?\r\n```shell\r\n/bin/bash /tmp/pear/temp/pear-build-rootp7EvvJ/swoole-4.6.4/libtool --mode=compile g++ -I. -I/tmp/pear/temp/swoole -I/tmp/pear/temp/pear-build-rootp7EvvJ/swoole-4.6.4/include -I/tmp/pear/temp/pear-build-rootp7EvvJ/swoole-4.6.4/main -I/tmp/pear/temp/swoole -I/usr/include/php/20200930 -I/usr/include/php/20200930/main -I/usr/include/php/20200930/TSRM -I/usr/include/php/20200930/Zend -I/usr/include/php/20200930/ext -I/usr/include/php/20200930/ext/date/lib -I/tmp/pear/temp/swoole -I/tmp/pear/temp/swoole/include -I/tmp/pear/temp/swoole/ext-src -I/tmp/pear/temp/swoole/thirdparty/hiredis  -DHAVE_CONFIG_H  -g -O2 -Wall -Wno-unused-function -Wno-deprecated -Wno-deprecated-declarations -std=c++11    -c /tmp/pear/temp/swoole/ext-src/swoole_runtime.cc -o ext-src/swoole_runtime.lo\r\nlibtool: compile:  g++ -I. -I/tmp/pear/temp/swoole -I/tmp/pear/temp/pear-build-rootp7EvvJ/swoole-4.6.4/include -I/tmp/pear/temp/pear-build-rootp7EvvJ/swoole-4.6.4/main -I/tmp/pear/temp/swoole -I/usr/include/php/20200930 -I/usr/include/php/20200930/main -I/usr/include/php/20200930/TSRM -I/usr/include/php/20200930/Zend -I/usr/include/php/20200930/ext -I/usr/include/php/20200930/ext/date/lib -I/tmp/pear/temp/swoole -I/tmp/pear/temp/swoole/include -I/tmp/pear/temp/swoole/ext-src -I/tmp/pear/temp/swoole/thirdparty/hiredis -DHAVE_CONFIG_H -g -O2 -Wall -Wno-unused-function -Wno-deprecated -Wno-deprecated-declarations -std=c++11 -c /tmp/pear/temp/swoole/ext-src/swoole_runtime.cc  -fPIC -DPIC -o ext-src/.libs/swoole_runtime.o\r\nIn file included from /tmp/pear/temp/swoole/ext-src/swoole_runtime.cc:22:\r\n/tmp/pear/temp/swoole/thirdparty/php/curl/curl_interface.h:8:10: fatal error: curl/curl.h: No such file or directory\r\n    8 | #include <curl/curl.h>\r\n      |          ^~~~~~~~~~~~~\r\ncompilation terminated.\r\nmake: *** [Makefile:259: ext-src/swoole_runtime.lo] Error 1\r\nERROR: `make' failed\r\n```\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nLatest\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n```\r\nLinux MyPC 5.4.72-microsoft-standard-WSL2 #1 SMP Wed Oct 28 23:40:43 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n```\r\nPHP 8.0.3 (cli) (built: Mar  5 2021 07:54:13) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v4.0.3, Copyright (c) Zend Technologies\r\n    with Zend OPcache v8.0.3, Copyright (c), by Zend Technologies\r\n```\r\n\r\n```\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/9/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none:hsa\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 9.3.0-17ubuntu1~20.04' --with-bugurl=file:///usr/share/doc/gcc-9/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++,gm2 --prefix=/usr --with-gcc-major-version-only --program-suffix=-9 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib=auto --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none=/build/gcc-9-HskZEa/gcc-9-9.3.0/debian/tmp-nvptx/usr,hsa --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04)\r\n```\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4142/comments",
    "author": "K2ouMais",
    "comments": [
      {
        "user": "doubaokun",
        "created_at": "2021-04-08T23:03:06Z",
        "body": "`libcurl-dev` is required.\r\n\r\nDepends on your OS, please try: `apt-get install libcurl4-openssl-dev`"
      }
    ]
  },
  {
    "number": 4132,
    "title": "'php.h' file not found during swoole install",
    "created_at": "2021-04-06T17:01:02Z",
    "closed_at": "2021-04-08T00:06:22Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4132",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n`pecl install swoole`\r\n\r\n\r\n\r\n2. What did you expect to see?\r\nSuccessful installation\r\n\r\n\r\n3. What did you see instead?\r\n```\r\n-4.6.4/main -I/private/var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/T/pear/temp/swoole -I/Applications/XAMPP/xamppfiles/include/php -I/Applic\r\nations/XAMPP/xamppfiles/include/php/main -I/Applications/XAMPP/xamppfiles/include/php/TSRM -I/Applications/XAMPP/xamppfiles/include/php/Zend -\r\nI/Applications/XAMPP/xamppfiles/include/php/ext -I/Applications/XAMPP/xamppfiles/include/php/ext/date/lib -I/private/var/folders/zz/zyxvpxvq6c\r\n\r\nsfxvn_n0000000000000/T/pear/temp/swoole -I/private/var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/T/pear/temp/swoole/include -I/private/var/fol\r\nders/zz/zyxvpxvq6csfxvn_n0000\r\n000000000/T/pear/temp/swoole/ext-src -I/private/var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/T/pear/temp/swoole/thirdparty/hiredis  -DHAVE_CO\r\nNFIG_H  -g -O2 -Wall -Wno-unused-function -Wno-deprecated -Wno-deprecated-declarations -std=c++11    -c /private/var/folders/zz/zyxvpxvq6csfxv\r\nn_n0000000000000/T/pear/temp/swoole/ext-src/php_swoole.cc -o ext-src/php_swoole.lo\r\nmkdir ext-src/.libs\r\n g++ -I. -I/private/var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/T/pear/temp/swoole -I/private/var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/\r\nT/pear/temp/pear-build-rootny1vur/swoole-4.6.4/include -I/private/var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/T/pear/temp/pear-build-rootny1\r\nvur/swoole-4.6.4/main -I/private/var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/T/pear/temp/swoole -I/Applications/XAMPP/xamppfiles/include/php\r\n -I/Applications/XAMPP/xamppfiles/include/php/main -I/Applications/XAMPP/xamppfiles/include/php/TSRM -I/Applications/XAMPP/xamppfiles/include/\r\nphp/Zend -I/Applications/XAMPP/xamppfiles/include/php/ext -I/Applications/XAMPP/xamppfiles/include/php/ext/date/lib -I/private/var/folders/zz/\r\nzyxvpxvq6csfxvn_n0000000000000/T/pear/temp/swoole -I/private/var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/T/pear/temp/swoole/include -I/priva\r\nte/var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/T/pear/temp/swoole/ext-src -I/private/var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/T/pear/te\r\nmp/swoole/thirdparty/hiredis\r\n-DHAVE_CONFIG_H -g -O2 -Wall -Wno-unused-function -Wno-deprecated -Wno-deprecated-declarations -std=c++11 -c /private/var/folders/zz/zyxvpxvq6\r\ncsfxvn_n0000000000000/T/pear/temp/swoole/ext-src/php_swoole.cc  -fno-common -DPIC -o ext-src/.libs/php_swoole.o\r\nIn file included from /private/var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/T/pear/temp/swoole/ext-src/php_swoole.cc:16:\r\nIn file included from /private/var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/T/pear/temp/swoole/ext-src/php_swoole_cxx.h:19:\r\n/private/var/folders/zz/zyxvpxvq6csfxvn_n0000000000000/T/pear/temp/swoole/ext-src/php_swoole.h:25:10: fatal error: 'php.h' file not found\r\n#include \"php.h\"\r\n         ^~~~~~~\r\n1 error generated.\r\nmake: *** [ext-src/php_swoole.lo] Error 1\r\nERROR: `make' failed\r\n```\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nNULL\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n## uname -a:\r\nDarwin Palnums-iMac.local 19.6.0 Darwin Kernel Version 19.6.0: Tue Nov 10 00:10:30 PST 2020; root:xnu-6153.141.10~1/RELEASE_X86_64 x86_64\r\n\r\n## php -v:\r\nPHP 8.0.2 (cli) (built: Feb  5 2021 23:52:40) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v4.0.2, Copyright (c) Zend Technologies\r\n    with Zend OPcache v8.0.2, Copyright (c), by Zend Technologies\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4132/comments",
    "author": "myckhel",
    "comments": [
      {
        "user": "huanghantao",
        "created_at": "2021-04-07T01:33:39Z",
        "body": "@myckhel \r\n\r\nDo you have this file?\r\n\r\n```bash\r\n/Applications/XAMPP/xamppfiles/include/php/main/php.h\r\n```"
      },
      {
        "user": "myckhel",
        "created_at": "2021-04-07T08:46:45Z",
        "body": "> @myckhel\r\n> \r\n> Do you have this file?\r\n> \r\n> ```shell\r\n> /Applications/XAMPP/xamppfiles/include/php/main/php.h\r\n> ```\r\n\r\nOooops!\r\ni dont have `/Applications/XAMPP/xamppfiles/include/php/main/php.h`\r\n\r\ni am actually using xampp's php."
      },
      {
        "user": "twose",
        "created_at": "2021-04-07T10:39:10Z",
        "body": "Use brew to install PHP and build Swoole on it is better"
      },
      {
        "user": "myckhel",
        "created_at": "2021-04-07T10:49:03Z",
        "body": "okay thank you.\r\ni guess i would have to use `brew`\r\nthen after the installation,\r\ncopy the `swoole.so` into `/Applications/XAMPP/xamppfiles/lib/php/extensions/...` and manually enable the extension in xampp's php.ini file."
      }
    ]
  },
  {
    "number": 4102,
    "title": "\\Swoole\\Process->signal注册信号弃用错误",
    "created_at": "2021-03-16T08:28:18Z",
    "closed_at": "2021-03-16T09:18:34Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4102",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n```php\r\n\r\n    ini_set('display_errors', true);\r\n    error_reporting(E_ALL);\r\n\r\n$process = new \\Swoole\\Process(fn() => printf(\"OK\\n\"));\r\n$process->signal(\\SIGUSR2, fn() => printf(\"SIG\\n\"));\r\n$process->start();\r\nsleep(1);\r\nexit;\r\n```\r\n\r\n\r\n2. What did you expect to see?\r\n不报错\r\n\r\n\r\n3. What did you see instead?\r\nDeprecated: Swoole\\Event::rshutdown(): Event::wait() in shutdown function is deprecated in Unknown on line 0\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.6.3\r\nBuilt => Mar 13 2021 14:39:29\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1d  10 Sep 2019\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n```\r\nLinux cx.huati.weibo.com 3.10.0-693.2.2.el7.toa.2.x86_64 #1 SMP Fri Dec 8 15:42:08 CST 2017 x86_64 GNU/Linux\r\n\r\n\r\nPHP 8.0.3 (cli) (built: Mar 13 2021 02:32:59) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v4.0.3, Copyright (c) Zend Technologies\r\n\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/8/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Debian 8.3.0-6' --with-bugurl=file:///usr/share/doc/gcc-8/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-8 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 8.3.0 (Debian 8.3.0-6)\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4102/comments",
    "author": "flyhope",
    "comments": [
      {
        "user": "sy-records",
        "created_at": "2021-03-16T09:18:34Z",
        "body": "```php\r\n    ini_set('display_errors', true);\r\n    error_reporting(E_ALL);\r\n\r\n$process = new \\Swoole\\Process(fn() => printf(\"OK\\n\"));\r\n$process->signal(\\SIGUSR2, fn() => printf(\"SIG\\n\"));\r\n$process->start();\r\nsleep(1);\r\nSwoole\\Event::wait();\r\n```"
      }
    ]
  },
  {
    "number": 4098,
    "title": "协程http服务端shutdown后，端口仍处于监听状态",
    "created_at": "2021-03-14T04:16:36Z",
    "closed_at": "2021-03-14T10:40:32Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4098",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n```php\r\n<?php\r\n\r\n\r\nuse Swoole\\Coroutine\\Http\\Server;\r\nuse function Swoole\\Coroutine\\run;\r\n\r\nrun(function () {\r\n    $server = new Server('127.0.0.1', 9502, false);\r\n    $server->handle('/', function ($request, $response) {\r\n        $response->end(\"<h1>Index</h1>\");\r\n    });\r\n    $server->handle('/test', function ($request, $response) {\r\n        $response->end(\"<h1>Test</h1>\");\r\n    });\r\n    $server->handle('/stop', function ($request, $response) use ($server) {\r\n        $response->end(\"<h1>Stop</h1>\");\r\n        $server->shutdown();\r\n    });\r\n\r\n    \\Swoole\\Coroutine::create(function() use ($server){\r\n        sleep(1);\r\n        $server->shutdown();\r\n    });\r\n\r\n    $server->start();\r\n\r\n\r\n    sleep(100);\r\n});\r\n```\r\n\r\n```bash\r\nnetstat -nap |grep 9502|grep LISTEN\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\nshutdown()后，不再监听端口\r\n\r\n3. What did you see instead?\r\n\r\nnetstat看到端口还处于监听状态\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.6.3\r\nBuilt => Mar 13 2021 14:39:29\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1d  10 Sep 2019\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n```\r\nLinux cx.huati.weibo.com 3.10.0-693.2.2.el7.toa.2.x86_64 #1 SMP Fri Dec 8 15:42:08 CST 2017 x86_64 GNU/Linux\r\n```\r\n\r\n```\r\nPHP 8.0.3 (cli) (built: Mar 13 2021 02:32:59) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v4.0.3, Copyright (c) Zend Technologies\r\n```\r\n\r\n```\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/8/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Debian 8.3.0-6' --with-bugurl=file:///usr/share/doc/gcc-8/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-8 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 8.3.0 (Debian 8.3.0-6)\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4098/comments",
    "author": "flyhope",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-03-14T10:40:32Z",
        "body": "对象销毁时才会 close socket"
      },
      {
        "user": "flyhope",
        "created_at": "2021-03-15T02:37:48Z",
        "body": "> 对象销毁时才会 close socket\r\n\r\n```php\r\n<?php\r\n\r\n\r\nuse Swoole\\Coroutine\\Http\\Server;\r\nuse function Swoole\\Coroutine\\run;\r\n\r\nrun(function () {\r\n        $server = new Server('127.0.0.1', 9502, false);\r\n            $server->handle('/', function ($request, $response) {\r\n                        $response->end(\"<h1>Index</h1>\");\r\n                            });\r\n            $server->handle('/test', function ($request, $response) {\r\n                        $response->end(\"<h1>Test</h1>\");\r\n                            });\r\n            $server->handle('/stop', function ($request, $response) use ($server) {\r\n                        $response->end(\"<h1>Stop</h1>\");\r\n                                $server->shutdown();\r\n                            });\r\n\r\n            \\Swoole\\Coroutine::create(function() use ($server){\r\n                        sleep(1);\r\n                        $server->shutdown();\r\n                        $server = null;\r\n                        unset($server);\r\n                            });\r\n\r\n        $server->start();\r\n\r\n        $server = null;\r\n        unset($server);\r\n\r\n            sleep(100);\r\n});\r\n```\r\n\r\n对象销毁依然不行，参考代码如上"
      }
    ]
  },
  {
    "number": 4090,
    "title": "Swoole Atomic is returning NULL.",
    "created_at": "2021-03-11T06:30:02Z",
    "closed_at": "2021-03-11T12:07:51Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4090",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nI tried to use the swoole atomic as a shared var in the server and event handlers of the server, but when i tried to access the value saved on the atomic object it returns NULL.\r\n```php\r\n<?php\r\n\r\nnamespace Proxy\\Atomics;\r\n\r\nuse Swoole\\Atomic;\r\n\r\nclass BlockedSwitchAtomic\r\n{\r\n    protected $blockFlag;\r\n    \r\n    public function __construct()\r\n    {\r\n        $this->blockFlag = new Atomic(0);\r\n    }\r\n\r\n    public function isBlocked()\r\n    {\r\n        return $this->blockFlag->get();\r\n    }\r\n\r\n    public function lock()\r\n    {\r\n         $this->blockFlag->set(1);\r\n    }\r\n\r\n    public function unlock()\r\n    {\r\n        $this->blockFlag->set(0);\r\n    }\r\n}\r\n\r\n```\r\n```php\r\n<?php\r\n\r\nnamespace Proxy\\Atomics;\r\n\r\nuse Swoole\\Atomic;\r\n\r\nclass TimeStampAtomic\r\n{\r\n    protected $lastCommunicationFromSocket;\r\n    \r\n    public function __construct()\r\n    {\r\n        $this->lastCommunicationFromSocket = new Atomic(0);    \r\n    }\r\n\r\n    public function get()\r\n    {\r\n         $this->lastCommunicationFromSocket->get();\r\n    }\r\n\r\n    public function update()\r\n    {\r\n        $this->lastCommunicationFromSocket->set(time());\r\n    }\r\n}\r\n\r\n```php\r\n<?php\r\n\r\nnamespace Proxy\\Server;\r\n\r\nuse Proxy\\Events\\ConnectEvent;\r\nuse Proxy\\Events\\ReceiveEvent;\r\nuse Configuration\\ServerConfig;\r\nuse Proxy\\Atomics\\BlockedSwitchAtomic;\r\nuse Proxy\\Atomics\\TimeStampAtomic;\r\nuse Proxy\\Stan\\StanController;\r\nuse Swoole\\Server;\r\n\r\nclass TCPServer\r\n{\r\n    private $proxyServer;\r\n\r\n    public $blockSwitch;\r\n\r\n    public $stanController;\r\n\r\n    public $lastConnection;\r\n\r\n    public function __construct()\r\n    {\r\n            $this->serverConf = new ServerConfig();\r\n            $this->proxyServer = new Server(\r\n                $this->serverConf->getServerHost(),\r\n                $this->serverConf->getServerPort(),\r\n                SWOOLE_PROCESS,SWOOLE_SOCK_TCP);\r\n            $this->proxyServer->set($this->serverConf->getServerSettings());\r\n            $this->stanController = new StanController();\r\n            $this->blockSwitch = new BlockedSwitchAtomic();\r\n            //añadimos el atomic para la ultima conexion.\r\n            $this->lastConnection = new TimeStampAtomic();\r\n            $this->setEvents();\r\n            $this->proxyServer->start();\r\n    }\r\n    public function getServer()\r\n    {\r\n        return $this->proxyServer;\r\n    }\r\n\r\n    private function setEvents()\r\n    {\r\n        ConnectEvent::set($this);\r\n        ReceiveEvent::set($this);\r\n    }\r\n}\r\n```\r\n```php\r\n\r\n<?php\r\n\r\nnamespace Proxy\\Events;\r\n\r\nuse Proxy\\Events\\Base\\BaseEvent;\r\nuse Proxy\\Server\\TCPServer;\r\n\r\nclass ConnectEvent implements BaseEvent\r\n{\r\n    public static function set(TCPServer $proxyServer)\r\n    {\r\n        $proxyServer->getServer()->on('connect', function($server, $client) use ($proxyServer){\r\n            $oData = [\r\n                'status' => 'success',\r\n                //this is where I get a null value instead of the timestamp\r\n                'last_communication' => $proxyServer->lastConnection->get(),\r\n            ];        \r\n            $server->send($client,\r\n               json_encode($oData)\r\n            );\r\n            \r\n        });\r\n    }\r\n\r\n}\r\n\r\n```\r\n2. What did you expect to see?\r\njson response with the timestamp set.\r\n\r\n\r\n3. What did you see instead?\r\nnc localhost 8300\r\n{\"status\":\"success\",\"last_communication\":null}\r\n\r\nand some other classes that are using a Atomic Object has the same problem.\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.6.3\r\nBuilt => Mar  3 2021 00:29:31\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.1f  31 Mar 2020\r\ndtls => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\nuname -a\r\nLinux mario-hitss 5.4.0-66-generic #74-Ubuntu SMP Wed Jan 27 22:54:38 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nphp -v\r\nPHP 7.4.3 (cli) (built: Oct  6 2020 15:47:56) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v3.4.0, Copyright (c) Zend Technologies\r\n    with Zend OPcache v7.4.3, Copyright (c), by Zend Technologies\r\n\r\ngcc -v\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/9/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none:hsa\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 9.3.0-17ubuntu1~20.04' --with-bugurl=file:///usr/share/doc/gcc-9/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++,gm2 --prefix=/usr --with-gcc-major-version-only --program-suffix=-9 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib=auto --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none=/build/gcc-9-HskZEa/gcc-9-9.3.0/debian/tmp-nvptx/usr,hsa --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04)\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4090/comments",
    "author": "sauriio",
    "comments": [
      {
        "user": "sy-records",
        "created_at": "2021-03-11T07:23:30Z",
        "body": "I don't understand your code where it calls update?"
      },
      {
        "user": "sauriio",
        "created_at": "2021-03-11T07:30:47Z",
        "body": "could be called on the ConnectEventClass on line 19, the result from two different connections is the same, NULL.\r\n\r\nnc localhost 8300\r\n{\"status\":\"success\",\"last_communication\":null}\r\n\r\non the second call is the same."
      },
      {
        "user": "sy-records",
        "created_at": "2021-03-11T07:32:07Z",
        "body": "Please change your code.\r\n\r\n```diff\r\nclass TimeStampAtomic\r\n{\r\n    protected $lastCommunicationFromSocket;\r\n\r\n    public function __construct()\r\n    {\r\n        $this->lastCommunicationFromSocket = new Atomic(0);\r\n    }\r\n\r\n    public function get()\r\n    {\r\n-         $this->lastCommunicationFromSocket->get();\r\n+        $data = $this->lastCommunicationFromSocket->get();\r\n+        if ($data === 0) {\r\n+            return $this->update();\r\n+       }\r\n\r\n+        return $data;\r\n    }\r\n\r\n    public function update()\r\n    {\r\n+        $date = time();\r\n-        $this->lastCommunicationFromSocket->set(time());\r\n+       $this->lastCommunicationFromSocket->set($date);\r\n\r\n+        return $date;\r\n    }\r\n}\r\n```"
      },
      {
        "user": "sauriio",
        "created_at": "2021-03-11T07:38:54Z",
        "body": "the addition only returns the date generated by the update function, I need to trigger it with a signal, and then it will be mostly read by the ConnectEvent (the workers too)."
      },
      {
        "user": "sauriio",
        "created_at": "2021-03-11T07:42:27Z",
        "body": "in a practical case, i will only save the first connection timestamp, and the subsequents will take the timestamp on the Atomic object to return it to the client."
      },
      {
        "user": "sy-records",
        "created_at": "2021-03-11T08:19:40Z",
        "body": "You need to ensure that the value is set...\r\n\r\n```php\r\n    public function get()\r\n    {\r\n        $data = $this->lastCommunicationFromSocket->get();\r\n        if ($data === 0) {\r\n            $this->update();\r\n            $data = $this->lastCommunicationFromSocket->get();\r\n        }\r\n\r\n        return $data;\r\n    }\r\n\r\n    public function update()\r\n    {\r\n        $this->lastCommunicationFromSocket->set(time());\r\n    }\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2021-03-11T12:07:50Z",
        "body": "```php\r\n\r\nclass TimeStampAtomic\r\n{\r\n    protected $lastCommunicationFromSocket;\r\n    \r\n    public function __construct()\r\n    {\r\n        $this->lastCommunicationFromSocket = new Atomic(0);    \r\n    }\r\n\r\n    public function get()\r\n    {\r\n         $this->lastCommunicationFromSocket->get(); \r\n         // ? You did not return any value here\r\n    }\r\n\r\n    public function update()\r\n    {\r\n        $this->lastCommunicationFromSocket->set(time());\r\n    }\r\n}\r\n```"
      }
    ]
  },
  {
    "number": 4068,
    "title": "WARNING\tssl_accept: bad SSL client[127.0.0.1:35418], reason=156, error_string=http request",
    "created_at": "2021-02-24T03:27:48Z",
    "closed_at": "2021-04-13T00:26:02Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4068",
    "body": "swoole 环境\r\n\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.6.2\r\nBuilt => Feb  2 2021 17:49:24\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.1c FIPS  28 May 2019\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\nlaravel 项目中，没用任何其他包，单纯使用 swoole，使用 ssl 证书，创建也是好的。当前端连接的时候，就出现 WARNING\tssl_accept: bad SSL client[127.0.0.1:35418], reason=156, error_string=http request 这个错误。有了解的朋友么。谢谢。\r\n\r\n```\r\n        $sets = [\r\n            'worker_num'=> config('swoole.config.worker_num'), // 进程数\r\n            'daemonize' => config('swoole.config.daemonize'), // 启用守护进程\r\n            'max_request'=> config('swoole.config.max_request'), // work 进程最大任务数\r\n            'dispatch_mode'=> config('swoole.config.dispatch_mode'), // 数据包分发策略，默认 2，固定模式\r\n            'pid_file' => $this->pid,\r\n            'log_file' => config('swoole.config.log_file')\r\n        ];\r\n\r\n        if (config('swoole.https')) {\r\n            $sets = array_merge($sets, [\r\n                'ssl_cert_file' => config('swoole.config.ssl_cert_file'),\r\n                'ssl_key_file' => config('swoole.config.ssl_key_file'),\r\n            ]);\r\n            $this->server = new swoole_websocket_server(config('swoole.host'), config('swoole.port'), SWOOLE_PROCESS, SWOOLE_SOCK_TCP | SWOOLE_SSL);\r\n        } else {\r\n            $this->server = new swoole_websocket_server(config('swoole.host'), config('swoole.port'));\r\n        }\r\n\r\n        $this->server->set($sets);\r\n```\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4068/comments",
    "author": "vini123",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-04-13T00:26:02Z",
        "body": "这个错误说明有明文 HTTP 请求发送到了 SSL 的 HTTPS 端口。"
      }
    ]
  },
  {
    "number": 4012,
    "title": "如何调试Socket has already been bound to another coroutine此类问题？",
    "created_at": "2021-01-20T13:29:41Z",
    "closed_at": "2021-01-21T03:26:57Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4012",
    "body": "```\r\nSocket#119 has already been bound to another coroutine#7, reading of the same socket in coroutine#10 at the same time is not allowed in ...\r\n```\r\n在WebSocket中遇到该问题，已使用连接池，但可能因为某部分代码出问题，导致连接没有被回收；\r\n在此请教一下，我应该如何调试此类问题？以便我可以找到出问题的代码",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4012/comments",
    "author": "HyperLife1119",
    "comments": [
      {
        "user": "sy-records",
        "created_at": "2021-01-20T23:31:32Z",
        "body": "异常有调用堆栈，分析上下文"
      },
      {
        "user": "HyperLife1119",
        "created_at": "2021-01-21T03:00:56Z",
        "body": "好的"
      }
    ]
  },
  {
    "number": 3992,
    "title": "fopen协程模式下内存增加异常",
    "created_at": "2021-01-09T06:51:59Z",
    "closed_at": "2021-01-12T00:36:37Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3992",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n```php\r\n\\Co::set(['hook_flags'=> SWOOLE_HOOK_ALL]);\r\n$server = new Swoole\\Http\\Server('127.0.0.1', 9501);\r\n$server->set(\r\n    [\r\n        'worker_num' => 1,\r\n        'daemonize' => false,\r\n        'dispatch_mode' => 1,\r\n        'log_file' => '/usr/local/swoole.log',\r\n        'enable_coroutine' => true\r\n    ]\r\n);\r\n\r\n$server->on('Start', function ($server) {\r\n    swoole_set_process_name('swoole master');\r\n});\r\n\r\n$server->on('ManagerStart', function ($server) {\r\n    swoole_set_process_name('swoole manager');\r\n});\r\n\r\n$server->on('WorkerStart', function ($server, $worker_id) {\r\n    swoole_set_process_name('swoole worker');\r\n});\r\n\r\n$server->on('Request', function ($request, $response) {\r\n    for ($i = 0; $i < 10000; $i++) {\r\n            go (function () use ($i) {\r\n                $f = fopen('/usr/local/open.log', 'a');\r\n                fwrite($f, $i . \"\\n\");\r\n                fflush($f);\r\n                fclose($f);\r\n            });\r\n        }\r\n    $response->end('123');\r\n});\r\n\r\n//启动服务器\r\n$server->start();\r\n```\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n原始内存\r\n```shell\r\n# ps aux|grep swoole\r\n4509 root      0:00 {php74} swoole master\r\n4510 root      0:00 {php74} swoole manager\r\n4512 root      0:00 {php74} swoole worker\r\n4514 root      0:00 grep swoole\r\n# cat /proc/4512/status |grep RSS\r\nVmRSS:\t   10000 kB\r\n```\r\n\r\n请求 curl 127.0.0.1:9501之后的内存\r\n```shell\r\n# curl 127.0.0.1:9501\r\n# cat /proc/4512/status |grep RSS\r\nVmRSS:\t   67572 kB\r\n```\r\n\r\n3. What did you see instead?\r\n\r\n修改hook_flags之后内存增长正常\r\n```shell\r\n\\Co::set(['hook_flags'=> SWOOLE_HOOK_ALL ^ SWOOLE_HOOK_FILE]);\r\n```\r\n\r\n原始内存\r\n```shell\r\n# cat /proc/4469/status |grep RSS\r\nVmRSS:\t   10064 kB\r\n```\r\n\r\n请求 curl 127.0.0.1:9501之后的内存\r\n```shell\r\n# curl 127.0.0.1:9501\r\n# cat /proc/4469/status |grep RSS\r\nVmRSS:\t   11264 kB\r\n```\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n我尝试了4.4.16和4.4.23都会出现该问题\r\n```shell\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.23\r\nBuilt => Jan  9 2021 03:09:06\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n```shell\r\nLinux 17427c2d4cb7 4.19.121-linuxkit #1 SMP Tue Dec 1 17:50:32 UTC 2020 x86_64 Linux\r\n```\r\n\r\n```shell\r\nPHP 7.4.0 (cli) (built: May 25 2020 09:01:06) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v3.4.0, Copyright (c) Zend Technologies\r\n```\r\n\r\n```shell\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-alpine-linux-musl/8.3.0/lto-wrapper\r\nTarget: x86_64-alpine-linux-musl\r\nConfigured with: /home/buildozer/aports/main/gcc/src/gcc-8.3.0/configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --build=x86_64-alpine-linux-musl --host=x86_64-alpine-linux-musl --target=x86_64-alpine-linux-musl --with-pkgversion='Alpine 8.3.0' --enable-checking=release --disable-fixed-point --disable-libstdcxx-pch --disable-multilib --disable-nls --disable-werror --disable-symvers --enable-__cxa_atexit --enable-default-pie --enable-default-ssp --enable-cloog-backend --enable-languages=c,c++,objc,fortran,ada --disable-libssp --disable-libmpx --disable-libmudflap --disable-libsanitizer --enable-shared --enable-threads --enable-tls --with-system-zlib --with-linker-hash-style=gnu\r\nThread model: posix\r\ngcc version 8.3.0 (Alpine 8.3.0) \r\n```\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3992/comments",
    "author": "longxinH",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2021-01-12T00:36:37Z",
        "body": "单次请求内存增加是正常的。底层要初始化很多结构，这些在请求结束后不会释放，这并非内存泄漏。\r\n\r\n你可以连续压测较长时间，观察内存是否稳定上涨。"
      },
      {
        "user": "longxinH",
        "created_at": "2021-01-13T03:27:28Z",
        "body": "```SWOOLE_HOOK_ALL ^ SWOOLE_HOOK_FILE``` 和 ```SWOOLE_HOOK_ALL```，为什么内存相差这么大"
      }
    ]
  },
  {
    "number": 3991,
    "title": "Swoole Install Fail, Module exist but don't work class",
    "created_at": "2021-01-08T17:12:27Z",
    "closed_at": "2021-01-12T00:42:26Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3991",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\nI am install swoole in diferents versions of Linux\r\n\r\n\r\n2. What did you expect to see?\r\n\r\nI want the module can run\r\n\r\n3. What did you see instead?\r\n\r\n\r\n[Fri Jan 08 16:37:35.288370 2021] [php7:error] [pid 2607] [client 23.227.192.85:55095] PHP Fatal error:  Uncaught Error: Class 'Swoole\\\\HTTP\\\\Server' not found in /var/www/html/1.php:2\\nStack trace:\\n#0 {main}\\n  thrown in /var/www/html/1.php on line 2\r\n[Fri Jan 08 16:59:57.746192 2021] [php7:error] [pid 2571] [client 23.227.192.85:55354] PHP Fatal error:  Uncaught Error: Class 'Swoole\\\\HTTP\\\\Server' not found in /var/www/html/1.php:2\\nStack trace:\\n#0 {main}\\n  thrown in /var/www/html/1.php on line 2\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nroot@swoole:/var/www/html# php --ri swoole\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.6.0\r\nBuilt => Jan  8 2021 16:29:30\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1d  10 Sep 2019\r\ndtls => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\nroot@swoole:/var/www/html# \r\n\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\nroot@swoole:/var/www/html# uname -a\r\nLinux swoole 4.19.0-10-cloud-amd64 #1 SMP Debian 4.19.132-1 (2020-07-24) x86_64 GNU/Linux\r\nroot@swoole:/var/www/html# php -v\r\nPHP 7.3.19-1~deb10u1 (cli) (built: Jul  5 2020 06:46:45) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.3.19, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.3.19-1~deb10u1, Copyright (c) 1999-2018, by Zend Technologies\r\nroot@swoole:/var/www/html# gcc -v\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/8/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Debian 8.3.0-6' --with-bugurl=file:///usr/share/doc/gcc-8/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-8 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 8.3.0 (Debian 8.3.0-6) \r\nroot@swoole:/var/www/html# \r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3991/comments",
    "author": "her0mx",
    "comments": [
      {
        "user": "luffluo",
        "created_at": "2021-01-09T01:57:58Z",
        "body": "Sorry, could you show the code in this file (/var/www/html/1.php)?"
      },
      {
        "user": "sy-records",
        "created_at": "2021-01-09T03:19:49Z",
        "body": "You may be using it in fpm mode, but Swoole needs to be run in CLI mode.\r\n\r\n```bash\r\nphp 1.php\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2021-01-12T00:42:26Z",
        "body": "Not the same version of php, or the php.ini settings of the application are different"
      }
    ]
  },
  {
    "number": 3940,
    "title": "Feature Request: Turn all PHP-FPM into SWOOLE in just one line of code only",
    "created_at": "2020-12-18T01:30:08Z",
    "closed_at": "2020-12-28T04:21:49Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3940",
    "body": "I would like to request a feature where a php-fpm file be run automatically as swoole.\r\n\r\n```use swoole```\r\n\r\nthen the file will automatically run in swoole server & co-routine method approach",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3940/comments",
    "author": "jobs-git",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-12-28T04:21:48Z",
        "body": "You can use some development frameworks and support both swoole and php-fpm runtime environments.\r\n\r\n"
      }
    ]
  },
  {
    "number": 3770,
    "title": "有swoole5的发布计划吗？",
    "created_at": "2020-10-24T15:33:27Z",
    "closed_at": "2020-10-25T03:38:35Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3770",
    "body": "如题",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3770/comments",
    "author": "fly2006zhao",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-10-25T03:38:35Z",
        "body": "暂时还没有 v5 的计划。"
      }
    ]
  },
  {
    "number": 3747,
    "title": "socket#48 output buffer overflow",
    "created_at": "2020-10-16T03:17:42Z",
    "closed_at": "2020-10-20T14:25:24Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3747",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3747/comments",
    "author": "qiaohengshan",
    "comments": [
      {
        "user": "doubaokun",
        "created_at": "2020-10-19T16:58:24Z",
        "body": "@joyqhs Can you send more details such as the sample code to reproduce the issue?"
      },
      {
        "user": "matyhtf",
        "created_at": "2020-10-20T14:25:24Z",
        "body": "Too much data is written to this connection, You can set send_yield to suspend the coroutine, or close the connection"
      }
    ]
  },
  {
    "number": 3732,
    "title": "Multiple insert queries, got error.",
    "created_at": "2020-10-10T10:12:16Z",
    "closed_at": "2020-10-12T10:47:09Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3732",
    "body": "When im trying isert a few rows i got error in second query:\r\n`SQLSTATE[HY000] [115] MySQL client is busy now on state#18, please use recv/fetchAll/nextResult to get all unread data and wait for response then try again`\r\n\r\n```php\r\n        $this->db = new \\Swoole\\Coroutine\\MySQL();\r\n        $this->db->connect([\r\n          'host' => '127.0.0.1',\r\n          'user' => '',\r\n          'password' => '',\r\n          'database' => '',\r\n        ]);\r\n        $this->db->setDefer();\r\n        $this->db->query(\"select * from `users`\");\r\n        dump($this->db);\r\n        $this->db->query(\"select * from `users`\");\r\n        dump($this->db);\r\n\r\n```\r\n\r\nWhy? How to resolve this problem?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3732/comments",
    "author": "Troodi",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-10-10T10:15:19Z",
        "body": "A mysql client can only execute 1 SQL query at the same time, you should create 2 mysql objects and execute 2 queries"
      },
      {
        "user": "Troodi",
        "created_at": "2020-10-10T14:50:31Z",
        "body": "Same error. Not same time.\r\n```\r\n$this->db->query(\"select * from `users`\");\r\ndump($this->db);\r\nsleep(1);\r\n$this->db->query(\"select * from `users`\");\r\ndump($this->db);\r\n```\r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2020-10-12T10:47:08Z",
        "body": "Remove setDefer, which means concurrent query"
      }
    ]
  },
  {
    "number": 3719,
    "title": "Broken pipe问题",
    "created_at": "2020-10-08T02:37:28Z",
    "closed_at": "2020-10-08T06:50:30Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3719",
    "body": "swoole4.4.14，当发生Broken pipe时，能否将该fd移出events？",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3719/comments",
    "author": "hejingsong",
    "comments": [
      {
        "user": "twose",
        "created_at": "2020-10-08T06:50:29Z",
        "body": "Broken pipe说明了你的代码有问题, 在触发Broken pipe之前已经有IO操作返回失败了, 你却仍在尝试操作, 没有判断返回值和处理错误, fd是会复用的, 这种对错误置之不理或是想规避的行为是不好的, 因为你的应用层可能有个fd关联的上下文, 你自己必须明确知道并处理这个错误。"
      }
    ]
  },
  {
    "number": 3688,
    "title": "How to make Swoole act both as Websocket Client and Server",
    "created_at": "2020-09-22T01:43:13Z",
    "closed_at": "2020-09-22T03:44:27Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3688",
    "body": "Hello. \r\n\r\nI intend to make a Swoole program to act both as a ws server and a ws client. This is required since there is a third server it has to interact wtih.\r\nThe flow is like this. (in parenthesis, the Swoole program)\r\n\r\nMy clients <-- ws conn-->( WS Server <-- internal messaging methods--> WS Client ) <-- ws conn--> 3rd Party WS Server\r\n\r\nIndependently both my WS Server (Swoole\\WebSocket\\Server) and my WS client (Swoole\\Coroutine\\HTTP\\Client) work perfectly.\r\n\r\nBut it seems coroutines cannot be used if a Swoole\\WebSocket\\Server exists. Since I tried the code bellow and only one starts according to which one is first.\r\n\r\n```\r\n// WS Server\r\n$server = new Server(\"ip\", port);\r\n$server->on(\"start\", cbFunc);\r\n$server->on('handshake', cbFunc);\r\n$server->on('message', cbFunc);\r\n$server->on('close', cbFunc);\r\n$server->start();\r\n\r\n// WS Client\r\nCo\\run(function() {\r\n\t$wsc = new Swoole\\Coroutine\\HTTP\\Client(\"extIP\", extPort);\r\n\t$ret = $wsc->upgrade(\"/\");\r\n\tif ( $ret ) {\r\n\t\toutput(\"WSC INITIALIZATION SUCCESS\");\r\n\t\twhile ( true ) {\r\n\t\t\tif ( ( $data = $wsc->recv() ) ) {\r\n\t\t\t\tcbFunc($data);\r\n\t\t\t}\r\n\t\t\tco::sleep(0.5);\r\n\t\t}\r\n\t}\r\n});\r\n\r\n```\r\n\r\nI also read about the Swoole\\Coroutine\\Server, but it seems i have to manually implement all the websocket operations and it is not clear if i can message other WS clients since I can't find any method to send messages to other connected clients.\r\n\r\nWhat is the correct approach?, Is it possible?\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3688/comments",
    "author": "gguerreromx",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-09-22T03:44:27Z",
        "body": "@gguerreromx \r\n\r\nexample\r\n-----\r\n```php\r\nCo\\run(function () {\r\n    $server = new Co\\Http\\Server(\"127.0.0.1\", 9501, false);\r\n    go(function () use ($server) {\r\n        $server->handle(\r\n            '/websocket',\r\n            function ($request, $ws) {\r\n                $ws->upgrade();\r\n                $ws->push(”hello“);\r\n                $ws->push(\"world\");\r\n            }\r\n        );\r\n        $server->handle(\r\n            '/shutdown',\r\n            function ($request, $response) use ($server) {\r\n                echo \"shutdown\\n\";\r\n                $response->status(200);\r\n                $server->shutdown();\r\n            }\r\n        );\r\n        $server->start();\r\n    });\r\n    \r\n    go(function () use ($server) {\r\n            go(function () {\r\n                $cli = new \\Swoole\\Coroutine\\Http\\Client('127.0.0.1',  9501);\r\n                $cli->set(['timeout' => 5]);\r\n                $ret = $cli->upgrade('/websocket');\r\n                $ret = $cli->recv();\r\n                $ret = $cli->recv();\r\n        }\r\n    \r\n        $server->shutdown();\r\n    });\r\n});  \r\n```"
      }
    ]
  },
  {
    "number": 3652,
    "title": "(CONSOLE)ErrorException: Object of class Swoole\\Curl\\Handler could not be converted to int",
    "created_at": "2020-09-13T00:56:15Z",
    "closed_at": "2020-09-13T10:50:23Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3652",
    "body": "(CONSOLE)ErrorException: Object of class Swoole\\Curl\\Handler could not be converted to int\r\nAt /data/web/new/vendor/ezimuel/ringphp/src/Client/CurlHandler.php line 109",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3652/comments",
    "author": "linjuchen",
    "comments": [
      {
        "user": "sy-records",
        "created_at": "2020-09-13T03:15:06Z",
        "body": "hook curl之后是一个对象，不支持强转为int类型。可以关闭hook，或者替换为其他的协程handler"
      }
    ]
  },
  {
    "number": 3581,
    "title": "open(/proc/self/fd/1) failed. Error: No such device or address",
    "created_at": "2020-08-17T13:47:25Z",
    "closed_at": "2020-08-25T04:58:32Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3581",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\nset log_file to `/proc/self/fd/1`\r\nhave  user and group `www-data` and main process running has `root`.\r\n\r\n2. What did you expect to see?\r\nproperly log into syslog\r\n\r\n\r\n3. What did you see instead?\r\n`Jul 21 19:40:20 ip-10-1-79-93 swoole.sh[227362]: open(/proc/self/fd/1) failed. Error: No such device or address[6]`\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.5.2\r\nBuilt => Jul 22 2020 22:26:45\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.display_errors => On => On\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\nswoole.use_shortname => On => On\r\n```\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n`Linux ip-10-5-69-152 5.4.0-1020-aws #20-Ubuntu SMP Fri Jul 10 05:52:40 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux`\r\n```\r\nPHP 7.4.3 (cli) (built: May 26 2020 12:24:22) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v3.4.0, Copyright (c) Zend Technologies\r\n    with Zend OPcache v7.4.3, Copyright (c), by Zend Technologies\r\n```\r\n```\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/9/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none:hsa\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 9.3.0-10ubuntu2' --with-bugurl=file:///usr/share/doc/gcc-9/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++,gm2 --prefix=/usr --with-gcc-major-version-only --program-suffix=-9 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib=auto --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none,hsa --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 9.3.0 (Ubuntu 9.3.0-10ubuntu2) \r\n\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3581/comments",
    "author": "Webonaute",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-08-22T05:34:07Z",
        "body": "If started as a daemon, the stdout will be closed at startup"
      }
    ]
  },
  {
    "number": 3564,
    "title": "WARNING swPipeUnsock_create(:83): socketpair() failed, Error: Too many open files[24]",
    "created_at": "2020-08-12T03:25:42Z",
    "closed_at": "2020-08-12T08:43:12Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3564",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nI'm downloading many small files from the Internet using file_get_contents, then writing using file_put_contents.  I have these inside a swoole process function.  At around the 500 file mark, I get this error:\r\n\r\n`WARNING swPipeUnsock_create(:83): socketpair() failed, Error: Too many open files[24]`\r\n\r\nExample script:\r\n\r\n```\r\n$data = array(<URLs of over 500 files>);\r\n\r\nforeach($data as $abc) {\r\n\r\n    $processes[ $abc ] = new \\Swoole\\Process(function () use ($abc) {\r\n\r\n        $bca = file_get_contents($abc);\r\n\r\n        file_put_contents(\"dir/path/to/new/file.abc\",$bca);\r\n\r\n    }\r\n\r\n    $processes[ $data ]->start();\r\n\r\n}\r\n```\r\n\r\nI even tried using the wait command after 100 processes at a time.  Do I need to allow more time for swoole to close the process?\r\n\r\n2. What did you expect to see?\r\n\r\nNo error\r\n\r\n\r\n3. What did you see instead?\r\n\r\n`WARNING swPipeUnsock_create(:83): socketpair() failed, Error: Too many open files[24]`\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nLatest\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\nDebian 10 Buster\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3564/comments",
    "author": "asheroto",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-08-12T08:43:12Z",
        "body": "@asheroto \r\n\r\nYou need to adjust the maximum number of handles, (`ulimit -n 100000`) or set the third parameter to `0` to close the process pipe. \r\n\r\n```php\r\nnew Swoole\\Process($fn, false, 0);\r\n```\r\n\r\n\r\n\r\n"
      },
      {
        "user": "asheroto",
        "created_at": "2020-08-13T02:08:58Z",
        "body": "Thanks.  Just curious, why would anyone want to leave the process pipe open?\r\n\r\nAlso, does closing the process pipe kill all of Swoole's process pipe or just for that file?  For example, if I have two PHP scripts running at the same time, both using the process pipe, will specifying 0 on the third parameter kill the pipe for both scripts?  Also, if I use a channel to communicate, do other scripts have access to that same channel, or is it only for the current instance of the php script.  So if I have test1.php and test2.php running, can they see each other's channels?\r\n\r\nThanks again, very much appreciated.  :)"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-08-13T06:19:50Z",
        "body": "@asheroto \r\n\r\n1. Pipes are used to communicate between processes. If processes need to communicate with each other, then you need to keep the pipes.\r\n2. Closing the pipes won't kill the process, just like opening a file and then closing the file. In fact, you can also use files for process communication.\r\n3. A Channel can be accessed between two processes, for example:\r\n\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Coroutine;\r\nuse Swoole\\Coroutine\\Channel;\r\nuse Swoole\\Process;\r\n\r\n$chan = new Channel();\r\n\r\n$process = new Process(function () use (&$chan) {\r\n    Coroutine::create(function () use (&$chan) {\r\n        var_dump('process: ' . getmypid());\r\n        $chan->push('data');\r\n    });\r\n});\r\n\r\nCoroutine::create(function () use (&$chan) {\r\n    var_dump('process: ' . getmypid());\r\n    $data = $chan->pop();\r\n    var_dump($data);\r\n});\r\n\r\n$process->start();\r\n$process->wait();\r\n```\r\n\r\nYou can see the following output on my machine:\r\n\r\n```bash\r\nstring(14) \"process: 94399\"\r\nstring(14) \"process: 94400\"\r\nstring(4) \"data\"\r\n```\r\n\r\nHowever, this approach relies on the operating system's write-time replication feature, where memory can be shared between multiple processes. However, there is no guarantee that all operating system versions will support this. It is recommended that a channel be used within a process's coroutine.\r\n"
      },
      {
        "user": "asheroto",
        "created_at": "2020-08-13T12:07:40Z",
        "body": "I see, okay, thank you for your help!"
      }
    ]
  },
  {
    "number": 3562,
    "title": "RedisServer:  TCP packet sticking in redis server with high concurrency",
    "created_at": "2020-08-09T18:21:24Z",
    "closed_at": "2020-09-13T10:54:22Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3562",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nTCP packet sticking occurs in the concurrent scenario of using `java lettuce redis client` or `redis-benchmark`\r\nserver : aliyunECS  4C8G\r\nQPS: 1000+ \r\n\r\n```php\r\nuse  Swoole\\Redis\\Server;\r\n$server = new Server('0.0.0.0', 9561);\r\n$server->on('AUTH', function($server, $fd, $_, $data){\r\n      if(count($data) != 1) {\r\n        return $server->send($fd, Server::format(Server::ERROR, \"ERR wrong number of arguments for 'AUTH' command\"));\r\n     } \r\n     return $server->send($fd, Server::format(Server::STATUS, \"OK\"));\r\n});\r\n$server->start();\r\n```\r\n\r\nuse redis-benchmark \r\n```bash\r\nredis-benchmark -n 1000  -c 100  -h 127.0.0.1  -p 9561 -a hky3360728767060:225867e0df292c7ab1fba880cc5cfb33 -k 0\r\n```\r\nlog record\r\n```\r\n[2020-08-07 16:44:13] redis-server.INFO: redis request body {\"command\":\"AUTH\",\"args\":[\"hky33607xxxxxxxxx:225867e0df292c7ab1fba8xxxxxx\",\"*21\r\n$4\r\nGET\r\n$16\r\nkey:__rand_int__\r\n$3\r\nxxx\r\n$1\",\"\r\nkey:__rand_int__\r\n$3\r\nxxx\r\n$16\r\nkey:__rand_int__\",\"xxx\",\"key.....\r\n```\r\n\r\n2. What did you expect to see?\r\n-\r\n\r\n3. What did you see instead?\r\n ``` ERR wrong number of arguments for 'XXX' command```\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n```\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.19\r\nBuilt => Jul 28 2020 07:49:43\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.0.2k-fips  26 Jan 2017\r\npcre => enabled\r\nzlib => 1.2.7\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n```\r\nPHP 7.2.14 (cli) (built: Jul 21 2020 19:13:06) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n```\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3562/comments",
    "author": "zqe",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-08-12T03:05:25Z",
        "body": "Your server did not reply any messages to the client"
      },
      {
        "user": "zqe",
        "created_at": "2020-08-12T08:19:09Z",
        "body": "Sorry, my example code is not very complete\r\n\r\nThe problem here is that the `auth` command parses more parameters in the request received by the log\r\n\r\nI have modified the comment, thanks"
      },
      {
        "user": "zqe",
        "created_at": "2020-08-12T08:38:19Z",
        "body": "Read the source code of lettuce\r\nIt was found to support full synchronous IO and asynchronous IO (NIO)\r\nSince the redis server service is not executed by a single thread, there may be a problem that after the same connection receives packets twice, the later sent packets respond first.\r\n\r\nNIO sends requests to the server many times in an asynchronous and non blocking way, and then receives the response from the server in sequence. When assigned to specific services, the benefit is that the same performance can be achieved with fewer connections. Therefore, NIO should be considered to support more"
      },
      {
        "user": "twose",
        "created_at": "2020-08-17T07:54:28Z",
        "body": "First, the Swoole Redis Server service is executed by a single thread, but the return order is not guaranteed.\r\nYou should arrange them in some ways by yourself (such as queue, channel...)"
      }
    ]
  },
  {
    "number": 3477,
    "title": "coroutine http client",
    "created_at": "2020-07-18T09:23:16Z",
    "closed_at": "2020-07-19T00:01:33Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3477",
    "body": "Im using coroutine http client, to use as websocket\r\nhow can i check, if the client is still connected?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3477/comments",
    "author": "Kapsonfire-DE",
    "comments": [
      {
        "user": "huanghantao",
        "created_at": "2020-07-18T13:00:53Z",
        "body": "@Kapsonfire-DE \r\n\r\nIf the connection is broken, the next client send will fail, which can be determined by the return value."
      },
      {
        "user": "Kapsonfire-DE",
        "created_at": "2020-07-18T14:53:43Z",
        "body": "Ok, but why there is no isConnected like \r\nSwoole\\Coroutine\\Client->isConnected\r\ndoc says it's there\r\n\r\n\r\n_____\r\nEDIT\r\ni checked recv/push and there is no info about the return type (if successful, timeout, broken connection)"
      },
      {
        "user": "Kapsonfire-DE",
        "created_at": "2020-07-18T18:12:20Z",
        "body": "I know use recv without timeout and check for false to detect broken connection, anything wrong with it?"
      },
      {
        "user": "matyhtf",
        "created_at": "2020-07-19T00:01:33Z",
        "body": "@Kapsonfire-DE Check whether the return value of `Client::Push()` and `Client::Recv()` methods is false, Use `Client::$errCode` to get the error code."
      }
    ]
  },
  {
    "number": 3453,
    "title": "WebSocket: How to send data to specific group connected/subscribed to specific topic",
    "created_at": "2020-07-06T20:58:33Z",
    "closed_at": "2020-07-10T12:07:31Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3453",
    "body": "I've checked the documentation but it is not stated their on how to send to specific group connected to specific topic. I'm using the code below to broadcast message but the problem is it sends to all clients connected.\r\n\r\n```\r\n$output = json_decode($frame->data, true);\r\n\r\nforeach ($server->connections as $fd) {\t\t\t\r\n    if ($server->exist($fd) && $server->isEstablished($fd)) {\r\n        $server->push($fd, json_encode($output), SWOOLE_WEBSOCKET_OPCODE_TEXT, SWOOLE_WEBSOCKET_FLAG_FIN | SWOOLE_WEBSOCKET_FLAG_COMPRESS);\r\n    } else { \r\n        $server->close($fd); \r\n    }\r\n}\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3453/comments",
    "author": "ljfreelancer88",
    "comments": [
      {
        "user": "jobs-git",
        "created_at": "2020-07-07T04:04:54Z",
        "body": "I dont have much idea about json, but judging from the description, these grouping could be easily done by a database.\r\n\r\nIn SQL, it is just as simple as: SELECT GROUP WHERE TOPIC = \"mytopic\"\r\n\r\nI think you have got to extract, who belongs to which so that you can send whatever you want for that group."
      },
      {
        "user": "huanghantao",
        "created_at": "2020-07-07T04:27:09Z",
        "body": "> I've checked the documentation but it is not stated their on how to send to specific group connected to specific topic. I'm using the code below to broadcast message but the problem is it sends to all clients connected.\r\n> \r\n> ```\r\n> $output = json_decode($frame->data, true);\r\n> \r\n> foreach ($server->connections as $fd) {\t\t\t\r\n>     if ($server->exist($fd) && $server->isEstablished($fd)) {\r\n>         $server->push($fd, json_encode($output), SWOOLE_WEBSOCKET_OPCODE_TEXT, SWOOLE_WEBSOCKET_FLAG_FIN | SWOOLE_WEBSOCKET_FLAG_COMPRESS);\r\n>     } else { \r\n>         $server->close($fd); \r\n>     }\r\n> }\r\n> ```\r\n\r\nYou need to group the connections yourself. For example:\r\n\r\n```php\r\n/**@var array */\r\n$subscribeFds['group1'] = [1, 2, 3];\r\n$subscribeFds['group2'] = [4, 5, 6];\r\n\r\nforeach ($subscribeFds['group1'] as $fd) {\t\t\t\r\n    if ($server->exist($fd) && $server->isEstablished($fd)) {\r\n        $server->push($fd, json_encode($output), SWOOLE_WEBSOCKET_OPCODE_TEXT, SWOOLE_WEBSOCKET_FLAG_FIN | SWOOLE_WEBSOCKET_FLAG_COMPRESS);\r\n    } else { \r\n        $server->close($fd); \r\n    }\r\n}\r\n\r\nforeach ($subscribeFds['group2'] as $fd) {\t\t\t\r\n    if ($server->exist($fd) && $server->isEstablished($fd)) {\r\n        $server->push($fd, json_encode($output), SWOOLE_WEBSOCKET_OPCODE_TEXT, SWOOLE_WEBSOCKET_FLAG_FIN | SWOOLE_WEBSOCKET_FLAG_COMPRESS);\r\n    } else { \r\n        $server->close($fd); \r\n    }\r\n}\r\n```"
      },
      {
        "user": "ljfreelancer88",
        "created_at": "2020-07-07T13:43:46Z",
        "body": "Based on your example, where are these `[1, 2, 3]` and `[4, 5, 6]` come from? Are these a user's primary key value from the database? Sorry for the noob question.\r\n\r\n```\r\n$subscribeFds['group1'] = [1, 2, 3];\r\n$subscribeFds['group2'] = [4, 5, 6];\r\n```"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-07-07T14:52:48Z",
        "body": "> Based on your example, where are these `[1, 2, 3]` and `[4, 5, 6]` come from? Are these a user's primary key value from the database? Sorry for the noob question.\r\n> \r\n> ```\r\n> $subscribeFds['group1'] = [1, 2, 3];\r\n> $subscribeFds['group2'] = [4, 5, 6];\r\n> ```\r\n\r\nYour websocket client 1,2,3 sent a subscribe request to topic1; websocket client 4, 5, 6 sent a subscribe request to topic1. For example:\r\n\r\n```php\r\npublic function onMessage(WebSocketServer $server, Frame $frame): void\r\n{\r\n    if (in_array($frame->data, ['topic1', 'topic2'])) {\r\n        $subscribeFds[$frame->data] = $frame->fd;\r\n    }\r\n}\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2020-07-10T12:07:31Z",
        "body": "You should store the fd group information in redis."
      }
    ]
  },
  {
    "number": 3425,
    "title": "[QUESTION] How can I detect if Swoole\\Coroutine\\Client got disconnected?",
    "created_at": "2020-06-27T04:21:31Z",
    "closed_at": "2020-06-28T04:03:50Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3425",
    "body": "How can I detect if **Swoole\\Coroutine\\Client** got **disconnected**?\r\nSo I can reconnect the client and be able to send commands to it.\r\n\r\n**1. What did you do? If possible, provide a simple script for reproducing the error.**\r\n\r\nPseudo code\r\n```\r\nClient is connected to IP and can send/receive commands.\r\nNetwork dies, cannot ping IP\r\nNetwork comes back up, can ping IP\r\nClient needs to send a command\r\n- The ->send works client side, but server does not get anything.\r\n- The ->recv is not called, since the server disconnected.\r\n```\r\n\r\nExample\r\n```\r\n$client = new Swoole\\Coroutine\\Client(SWOOLE_SOCK_TCP);\r\n$client->connect($host, $port, $timeout); # Connect OK\r\ngo(function () {  # Wait for data\r\n            while (true) {\r\n                $data = $this->recv();\r\n                if ($data === '' || $data === false) {\r\n                    break;\r\n                }\r\n            }\r\n        });\r\n# *** network gets disconnected ***\r\n# Send some data\r\nif ($client->isConnected()) {  # It's TRUE even after the network disconnected\r\n    $r = $client->send(...$data);   # Returns the number of bytes sent, and $client->errCode is 0\r\n}\r\n```\r\n\r\n**2. What did you expect to see?**\r\n\r\nI expect either:\r\n```\r\n- $client->isConnected() be FALSE\r\n- $client->send(...$data); return FALSE or 0\r\n- $client->errCode  Return some error if the connection was doped.\r\n```\r\n\r\n\r\n**3. What did you see instead?**\r\n```\r\n- $client->isConnected() = TRUE\r\n- $client->send(...$data); Returns bytes of $data\r\n- $client->errCode = 0\r\n```\r\n\r\n\r\n**4. What version of Swoole are you using (show your `php --ri swoole`)?**\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.5.2\r\nBuilt => May 29 2020 03:13:35\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1d  10 Sep 2019\r\nhttp2 => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n```\r\n\r\n\r\n**5. What is your machine environment used (including version of kernel & php & gcc) ?**\r\n\r\n`phpswoole/swoole:4.5.2-php7.4`\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3425/comments",
    "author": "ValiDrv",
    "comments": [
      {
        "user": "twose",
        "created_at": "2020-06-28T04:03:50Z",
        "body": "`isConnected` can only tell you if a connection has been established\r\n`Swoole\\Coroutine\\Socket->checkLiveness()` can detect the connection closed, but it doesn't always work\r\nMaybe learning Linux network programming will help you\r\n"
      },
      {
        "user": "ValiDrv",
        "created_at": "2020-06-28T13:40:55Z",
        "body": "Thank you.\r\nI thought the **Swoole\\Coroutine\\Client** had built in support for **open_tcp_keepalive**, **tcp_keepidle**, **tcp_keepcount**, **tcp_keepinterval**, assuming it connects to a server that supports it.\r\n\r\nIt could make a nice feature to have, with an additional **tcp_keepalive_function** which could be called for the health checks (assuming it's different than the standard keep-alive)"
      },
      {
        "user": "jobs-git",
        "created_at": "2020-06-28T15:30:43Z",
        "body": "Try to execute a very simple command to client, if it returns data then its up, if not, then its down."
      },
      {
        "user": "ValiDrv",
        "created_at": "2020-06-28T16:44:19Z",
        "body": "That does not work...\r\n\r\n**Swoole\\Coroutine\\Client->send('ping')** will return the bytes written to the socket, even if the socket is not connected.\r\n(if the buffer is full and it tries to flush it, then you get an error.)\r\n\r\n**Swoole\\Coroutine\\Client->recv(-1)** will wait forever in TCP mode. And if the server disconnected without sending the close packets, it will never know it's disconnected.\r\nIf you add a `timeout`, you never know what it should be for some requests. \r\nPicture a MySQL proxy, most queries take under X seconds, but you can have some that take a long time.\r\n\r\nSo usually, there is a tcp_keepalive which pings the server every X sec, and changes the connected flag on the socket if it does not get a reply in X pings.\r\n\r\nDevelopment would be easier if Swoole\\Coroutine\\Client would be a bit higher level and implement some of these things, and have the onClose/on[Etc.] events (swoole-ext-async does not work with swoole 4.5)"
      }
    ]
  },
  {
    "number": 3422,
    "title": "WARNING swSocket_write_blocking(:201) and WARNING swSignalfd_onSignal (ERRNO 707) errors on production only!",
    "created_at": "2020-06-25T15:38:14Z",
    "closed_at": "2020-06-26T06:17:54Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3422",
    "body": "Hello,\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nI use Swoole async TCP server to accept incoming tcp connections and Swoole coroutine TCP client to fetch remote resource and send it back to the client in a proxy manner.\r\nI can't provide the script as the error happens only on production environment under load. I'm still not sure what is the reason\r\n\r\n2. What did you expect to see?\r\n\r\nI don't expect any errors in Swoole log\r\n\r\n3. What did you see instead?\r\n\r\nA part of Swoole log from loaded production machine:\r\n\r\n```\r\n* [CLIENT PID 1613/ID 649] Header request packet received\r\n* [CLIENT PID 1613/ID 649] Connection...\r\n* [CLIENT PID 1613/ID 649] Connected\r\n* [CLIENT PID 1613/ID 649] Instant request header is handled. path /banners/35/c6/c5/4664.mp4\r\n* [CLIENT PID 1613/ID 649] Header response packet received\r\n* [CLIENT PID 1613/ID 649] Instant response header is handled. len: 0\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 16383\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 1, received: 16384\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 32767\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 49150\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 65533\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 3, received: 65536\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 81919\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 98302\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 2, received: 98304\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 114687\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 131070\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 147453\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 3, received: 147456\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 163839\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 180222\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 196605\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 212988\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 229371\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 245754\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 262137\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 278520\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 294903\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 311286\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 327669\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 344052\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 360435\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 376818\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 393201\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 409584\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16, received: 409600\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 425983\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 442366\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 458749\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 475132\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 491515\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 507898\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 524281\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 540664\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 557047\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 573430\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 589813\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 606196\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [CLIENT PID 1613/ID 649] Response packet. len: 16383, received: 622579\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSocket_write_blocking(:201): write 16383 bytes failed, Error: Broken pipe[32]\r\n* [SERVER PID 1613] Server is closing the connection with client 649\r\n* [CLIENT PID 1613/ID 649] Recv loop ended\r\n* [CLIENT PID 1613/ID 649] Closing the connection and clearing the operation timeout\r\n[2020-06-25 13:43:17 *1613.13]  WARNING swSignalfd_onSignal (ERRNO 707): Unable to find callback function for signal Broken pipe: 13\r\n```\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.16\r\nBuilt => Apr 20 2020 09:03:11\r\ncoroutine => enabled\r\ndebug => enabled\r\ntrace_log => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1d  10 Sep 2019\r\nhttp2 => enabled\r\npcre => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\n```\r\nDistributor ID: Ubuntu\r\nDescription:    Ubuntu 18.04.4 LTS\r\nRelease:        18.04\r\nCodename:       bionic\r\n```\r\n```\r\nKernel: Linux 4.15.0-88-generic x86_64\r\n```\r\n```\r\nPHP 7.1.33-12+ubuntu18.04.1+deb.sury.org+1 (cli) (built: Feb 23 2020 07:22:16) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.1.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.1.33-12+ubuntu18.04.1+deb.sury.org+1, Copyright (c) 1999-2018, by Zend Technologies\r\n```\r\n```\r\ngcc (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3422/comments",
    "author": "idealogica",
    "comments": [
      {
        "user": "idealogica",
        "created_at": "2020-06-25T15:42:46Z",
        "body": "Swoole server config:\r\n```\r\n        return [\r\n            'worker_num' => DEBUG ? 1 : 16,\r\n            'daemonize' => DEBUG ? 0 : 2,\r\n            'max_conn' => 5000,\r\n            'log_level' => DEBUG ? SWOOLE_LOG_DEBUG : SWOOLE_LOG_NOTICE, \r\n            'backlog' => 1024,\r\n            'max_request' => 5000,\r\n            'user' => 'www-data',\r\n            'group' => 'www-data',\r\n            'reload_async' => true,\r\n            'open_tcp_keepalive' => 1, // enable TCP Keep-Alive check\r\n            'tcp_keepidle' => 2, // check if there is no data for 2s.\r\n            'tcp_keepinterval' => 1, // check if there is data every 1s\r\n            'tcp_keepcount' => 5, //close the connection if there is no data for 5 cycles.\r\n            'open_tcp_nodelay' => true,\r\n            'enable_reuse_port' => true,\r\n            'socket_buffer_size' => 2048 * 1024 * 1024,\r\n            'socket_send_timeout' => 10,\r\n            'buffer_output_size' => 8 * 1024 * 1024, // default 2M\r\n        ];\r\n```\r\nSwoole coroutine client config\r\n```\r\n            $this->client->set([\r\n                'ssl_verify_peer' => false,\r\n                'ssl_allow_self_signed' => true,\r\n                'ssl_verify_peer_name' => false,\r\n                'ssl_host_name' => $this->requestUri->getHost(),\r\n                'verify_peer' => false,\r\n                'allow_self_signed' => true,\r\n                'verify_peer_name' => false,\r\n                'timeout' => 20,\r\n                'debug_mode'=> DEBUG,\r\n                'keep_alive' => false,\r\n                'socket_buffer_size' => 256 * 1024 * 1024,\r\n                'socket_send_timeout' => 10,\r\n            ]);\r\n```"
      },
      {
        "user": "idealogica",
        "created_at": "2020-06-25T15:54:31Z",
        "body": "I guess the error happens when I call `server::sendwait()` inside `go()` for each incoming packet:\r\n```\r\n                return $this->asyncExecute(function () use ($client, $data) {\r\n                    foreach (str_split($data, static::PACKET_SIZE) as $dataPacket) {\r\n                        $this->server->sendwait($client->getId(), $dataPacket);\r\n                    }\r\n                }, $callback, $client->getId());\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2020-06-26T06:17:54Z",
        "body": "You need to check the return value of the sendwait function. If false is returned, the connection may be closed"
      },
      {
        "user": "idealogica",
        "created_at": "2020-06-27T14:18:41Z",
        "body": "Thank you for the answer. Would you please explain in more details what is happening? I thought in case of broken connection server should fire onClose event automatically. But in this case it doesn't fire onClose, so sendwait() continues to send data with the warnings"
      },
      {
        "user": "idealogica",
        "created_at": "2020-06-27T14:19:55Z",
        "body": "@matyhtf thank you for the help, just one more question above ;)"
      }
    ]
  },
  {
    "number": 3420,
    "title": "HTTP2 onRequest detach issue",
    "created_at": "2020-06-25T09:44:09Z",
    "closed_at": "2020-06-26T06:37:37Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3420",
    "body": "Response detach from onRequest for HTTP2 is not working!\r\n\r\n```php\r\n<?php\r\n\r\n$server = new Swoole\\HTTP\\Server('127.0.0.1', 8080, SWOOLE_PROCESS, SWOOLE_SOCK_TCP | SWOOLE_SSL);\r\n\r\n$server->set([\r\n    'task_worker_num' => 1,\r\n    'worker_num' => 1,\r\n    \r\n    'ssl_cert_file' => 'cert.pem',\r\n    'ssl_key_file' => 'key.pem',\r\n    \r\n    'open_http2_protocol' => true,\r\n]);\r\n\r\n$server->on('request', function($req, $res) use($server) {\r\n    // direct handling works fine\r\n    //return $res->end(\"response from direct handling\");\r\n    \r\n    $res->detach();\r\n    $server->task((string) $res->fd);\r\n});\r\n\r\n$server->on('task', function($server, $taskId, $workerId, $fd) {\r\n    $res = Swoole\\Http\\Response::create($fd);\r\n    $res->end(\"TaskId: {$taskId}, WorkerId: {$workerId}, FD: {$fd}\");\r\n});\r\n\r\n$server->start();\r\n/* END OF FILE */\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3420/comments",
    "author": "phpmathan",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-06-26T06:37:37Z",
        "body": "http2 has contextual session data and cannot detach."
      }
    ]
  },
  {
    "number": 3403,
    "title": "Implementing latest protocol (hybi 10) in Websocket Server",
    "created_at": "2020-06-18T12:45:41Z",
    "closed_at": "2020-06-20T13:32:51Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3403",
    "body": "Hi, how can I implement the latest protocol(hybi 10) in Swoole websocket server? Is there a configuration that I can set to `true`?\r\n\r\nThank you in advance.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3403/comments",
    "author": "ljfreelancer88",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-06-20T13:32:51Z",
        "body": "This standard was created in 2011y and is not the latest. Swoole supports the latest websocket protocol.\r\n\r\nYou can use the latest version of chrome for testing"
      }
    ]
  },
  {
    "number": 3393,
    "title": "http get json's async loop",
    "created_at": "2020-06-15T01:18:25Z",
    "closed_at": "2020-06-15T04:26:15Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3393",
    "body": "Hello, I recently installed swoole. We need to make a lot of API requests without having to wait for response. We need to make around 80,000 different API requests total, 10 requests each second (because we have a limit), but without blocking I/O. There are very few examples, unfortunately, of how to process a huge amount of data from http get requests asynchronously. How Swoole can help us accomplish this task?\r\n\r\nBasic logic: send HTTP GET requests (10) each second -> while waiting for response, process responses that came earlier -> repeat",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3393/comments",
    "author": "karabest",
    "comments": [
      {
        "user": "huanghantao",
        "created_at": "2020-06-15T02:05:10Z",
        "body": "The Swoole HTTP Server will create a separate coroutine for each HTTP request to handle, which will not cause the IO to block."
      },
      {
        "user": "huanghantao",
        "created_at": "2020-06-15T03:07:39Z",
        "body": "Swoole version >= `v4.5.0`:\r\n\r\n```php\r\n$http = new Swoole\\Http\\Server(\"0.0.0.0\", 9501);\r\n\r\n$http->on('request', function ($request, $response) {\r\n    var_dump($request->getContent());\r\n});\r\n\r\n$http->start();\r\n```\r\n\r\nSwoole version < `v4.5.0`:\r\n\r\n```php\r\n$http = new Swoole\\Http\\Server(\"0.0.0.0\", 9501);\r\n\r\n$http->on('request', function ($request, $response) {\r\n    var_dump($request->rawContent());\r\n});\r\n\r\n$http->start();\r\n```"
      },
      {
        "user": "karabest",
        "created_at": "2020-06-15T03:14:11Z",
        "body": "thank you for the response\r\n\r\nwe used file_get_contents(\"api-url\") before, what is the equivalent in Swoole HTTP Server?"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-06-15T03:24:26Z",
        "body": "> thank you for the response\r\n> \r\n> we used file_get_contents(\"api-url\") before, what is the equivalent in Swoole HTTP Server?\r\n\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Coroutine;\r\n\r\nuse function Swoole\\Coroutine\\run;\r\n\r\nCoroutine::set(['hook_flags' => SWOOLE_HOOK_FILE]);\r\n\r\nrun(function () {\r\n    file_get_contents(\"api-url\");\r\n});\r\n```"
      },
      {
        "user": "karabest",
        "created_at": "2020-06-15T03:48:13Z",
        "body": "how do we integrate it with the Http Server? I don't get the overall logic\r\n"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-06-15T03:54:37Z",
        "body": "> how do we integrate it with the Http Server? I don't get the overall logic\r\n\r\n```php\r\nuse Swoole\\Coroutine;\r\n\r\nuse function Swoole\\Coroutine\\run;\r\n\r\nCoroutine::set(['hook_flags' => SWOOLE_HOOK_FILE]);\r\n\r\n$http = new Swoole\\Http\\Server(\"0.0.0.0\", 9501);\r\n\r\n$http->on('request', function ($request, $response) {\r\n    var_dump($request->rawContent());\r\n    file_get_contents(\"api-url\");\r\n});\r\n\r\n$http->start();\r\n```"
      },
      {
        "user": "karabest",
        "created_at": "2020-06-15T04:03:01Z",
        "body": "create Swoole Http Server -> configure on request event -> initiate request to Swoole Http Server -> Swoole Http Server performs  on request event and returns response\r\nIs this logic correct?"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-06-15T04:04:36Z",
        "body": "> create Swoole Http Server -> configure on request event -> initiate request to Swoole Http Server -> Swoole Http Server performs on request event and returns response\r\n> Is this logic correct?\r\n\r\nyes"
      },
      {
        "user": "karabest",
        "created_at": "2020-06-15T04:07:14Z",
        "body": "how do I trigger on request event?"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-06-15T04:14:38Z",
        "body": "> how do I trigger on request event?\r\n\r\nI don't see what you mean?"
      },
      {
        "user": "karabest",
        "created_at": "2020-06-15T04:17:33Z",
        "body": "create Swoole Http Server -> configure on request event -> THIS PART (initiate request to Swoole Http Server) -> Swoole Http Server performs on request event and returns response"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-06-15T04:19:16Z",
        "body": "> create Swoole Http Server -> configure on request event -> THIS PART (initiate request to Swoole Http Server) -> Swoole Http Server performs on request event and returns response\r\n\r\nAny HTTP client can trigger a request."
      },
      {
        "user": "karabest",
        "created_at": "2020-06-15T04:22:06Z",
        "body": "Swoole Coroutine HTTP Client will work?"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-06-15T04:23:32Z",
        "body": "> Swoole Coroutine HTTP Client will work?\r\n\r\nyes"
      },
      {
        "user": "karabest",
        "created_at": "2020-06-15T04:25:15Z",
        "body": "Thank you so much, I will try it out"
      }
    ]
  },
  {
    "number": 3380,
    "title": "http客户端 download 方法的一点建议",
    "created_at": "2020-06-11T09:42:13Z",
    "closed_at": "2020-06-11T13:08:47Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3380",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n```\r\ngo(function () {\r\n    $host = 'www.swoole.com';\r\n    $client = new \\Swoole\\Coroutine\\Http\\Client($host, 443, true);\r\n    $client->set(['timeout' => -1]);\r\n    $client->setHeaders([\r\n        'Host' => $host,\r\n        'User-Agent' => 'Chrome/49.0.2587.3',\r\n        'Accept' => '*',\r\n        'Accept-Encoding' => 'gzip'\r\n    ]);\r\n    $ret = $client->download('/aas', __DIR__ . '/logo.svg');\r\n    \r\n    print_r($ret); //这里会返回true;\r\n    if ($client->statusCode!=200) {\r\n\t\tshell_exec('rm -rf '.__DIR__ . '/logo.svg');\r\n\t\t$ret = false;\r\n    }  else {\r\n        $ret = true;\r\n    }\r\n\r\n    print_r($ret); //这里才是我想要的返回结果\r\n    return $ret;\r\n});\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n我在想，能不能 咱们在download的时候就判断下statusCode，如果statusCode状态异常就直接返回false\r\n\r\n3. What did you see instead?\r\n\r\n目前来说请求一个不存在的远程文件，这个方法也会返回成功，会保存一个无法识别的文件到本地，我只有在这个方法执行后再获取statusCode，如果statusCode不为200则删除文件，但是很麻烦。\r\n\r\n--------------------------------\r\n系统版本：centos8\r\nSwoole版本：4.4.16\r\nphp版本：7.4\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3380/comments",
    "author": "limFun",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-06-11T13:08:47Z",
        "body": "有些用户可能是希望保留非 200 结果页面的，底层删除并不合适。\r\n\r\ndownload 返回 true 只表示服务器返回了响应内容。而 statusCode 是更高层的逻辑状态。\r\n\r\n另外，我们做了一些改进，在 http 连接被拒绝时，不再生成空文件。"
      },
      {
        "user": "limFun",
        "created_at": "2020-06-12T01:23:56Z",
        "body": "> 有些用户可能是希望保留非 200 结果页面的，底层删除并不合适。\r\n> \r\n> download 返回 true 只表示服务器返回了响应内容。而 statusCode 是更高层的逻辑状态。\r\n> \r\n> 另外，我们做了一些改进，在 http 连接被拒绝时，不再生成空文件。\r\n\r\n对 就是不要生成空文件"
      }
    ]
  },
  {
    "number": 3379,
    "title": "swoole子进程0信号是什么场景下面产生的",
    "created_at": "2020-06-11T01:42:49Z",
    "closed_at": "2020-06-11T06:42:58Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3379",
    "body": "1、swoole版本信息\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.3.5\r\nBuilt => Mar 21 2020 23:30:42\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.0l  10 Sep 2019\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n2、问题描述\r\n主进程监控子进程信号，$result = swoole_process::wait(false)，有时候，子进程$result会接收到这样子的信号：{\"pid\":6,\"code\":0,\"signal\":0}，请问下，这个0信号是什么情况下面才会发送的，正常都是接收到15的信号。\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3379/comments",
    "author": "salterping",
    "comments": [
      {
        "user": "twose",
        "created_at": "2020-06-11T04:49:09Z",
        "body": "自己退出了 没有收到信号"
      }
    ]
  },
  {
    "number": 3358,
    "title": "documentation",
    "created_at": "2020-06-04T07:52:35Z",
    "closed_at": "2020-06-05T05:02:53Z",
    "labels": [
      "question",
      "document"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3358",
    "body": "Please make the documentation stronger.\r\nswoole is a great extension for php but it's documentation is very poor.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3358/comments",
    "author": "hosseinjarrahi",
    "comments": [
      {
        "user": "doubaokun",
        "created_at": "2020-06-04T09:25:35Z",
        "body": "@hosseinjarrahi any particular questions or correction of specific function of the document?\r\n\r\nCan you clarify more?"
      }
    ]
  },
  {
    "number": 3344,
    "title": "QUESTION: HTTP request buffer?",
    "created_at": "2020-05-23T14:02:59Z",
    "closed_at": "2020-05-26T06:46:02Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3344",
    "body": "Is there a way for Swoole to process incoming HTTP requests in a job queue fashion, where job bursts over the number of started workers would be buffered and still get processed instead of returning \"no workers available\" error?\r\n\r\nI have a system that starts bursts of jobs, then waits 10-60 sec for replies, and these bursts are sometimes bigger than the number of available workers.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3344/comments",
    "author": "ValiDrv",
    "comments": [
      {
        "user": "twose",
        "created_at": "2020-05-26T06:46:02Z",
        "body": "put the `Swoole\\Http\\Request/Response` objects to a queue"
      }
    ]
  },
  {
    "number": 3335,
    "title": " UDP Socket can not be auto released when Running DTLS protocol",
    "created_at": "2020-05-20T10:19:47Z",
    "closed_at": "2020-05-20T14:41:32Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3335",
    "body": "ENV：Centos7.4,  PHP7.3.16, Swoole4.5.0RC1\r\nQUESTION：Run DTLS Server， UDP Socket can not release?\r\n\r\n```\r\n[root@localhost dnsapi]# ss -s\r\nTotal: 2845 (kernel 3009)\r\nTCP:   21 (estab 6, closed 1, orphaned 0, synrecv 0, timewait 0/0), ports 0\r\n\r\nTransport Total     IP        IPv6\r\n*\t  3009      -         -        \r\nRAW\t  1         0         1        \r\nUDP\t  1095      1093      2        \r\nTCP\t  20        13        7        \r\nINET\t  1116      1106      10       \r\nFRAG\t  0         0         0        \r\n```\r\n\r\n\r\n```\r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47345                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47345                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47345                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47345                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47345                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47345                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47345                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47099                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47099                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47099                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47099                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47099                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47099                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47099                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47099                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47099                \r\nESTAB      0      0                                                                                                 127.0.0.1:pds                                                                                                             127.0.0.1:47099         \r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3335/comments",
    "author": "wk331100",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-05-20T14:41:32Z",
        "body": "Did your client and server close the connection?\r\n\r\nPlease set heartbeat detection options"
      }
    ]
  },
  {
    "number": 3333,
    "title": "Swoole\\Coroutine\\Http\\Server does not support $server->connections",
    "created_at": "2020-05-20T05:05:41Z",
    "closed_at": "2020-05-20T05:34:57Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3333",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nSwoole\\Coroutine\\Http\\Server does not support $server->connections\r\n\r\n\r\n2. What did you expect to see?\r\n\r\nHow can i send messages to other connections in Coroutine websocket server\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3333/comments",
    "author": "ghost",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-05-20T05:34:57Z",
        "body": "Save connection objects to php array"
      }
    ]
  },
  {
    "number": 3331,
    "title": "Swoole\\Coroutine\\Http\\Server does not support addListener",
    "created_at": "2020-05-20T00:26:03Z",
    "closed_at": "2020-05-20T00:44:42Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3331",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3331/comments",
    "author": "ghost",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-05-20T00:44:42Z",
        "body": "No need to use addListener method.  You should create multiple `You should create multiple objects` objects.\r\n\r\n```php\r\n<?php\r\nCo\\run(function () {\r\n    //server 1, port 9501\r\n    go(function () {\r\n        $server = new Co\\Http\\Server(\"127.0.0.1\", 9501, false);\r\n        $server->handle('/', function ($request, $response) {\r\n            $response->end(\"<h1>Index, 1</h1>\");\r\n        });\r\n        $server->handle('/test', function ($request, $response) {\r\n            $response->end(\"<h1>Test</h1>\");\r\n        });\r\n        $server->start();\r\n    });\r\n\r\n    //server 2, port 9502\r\n    go(function () {\r\n        $server = new Co\\Http\\Server(\"127.0.0.1\", 9502, false);\r\n        $server->handle('/', function ($request, $response) {\r\n            $response->end(\"<h1>Index, 2</h1>\");\r\n        });\r\n        $server->handle('/test', function ($request, $response) {\r\n            $response->end(\"<h1>Test</h1>\");\r\n        });\r\n        $server->start();\r\n    });\r\n});\r\n```"
      }
    ]
  },
  {
    "number": 3321,
    "title": "Co\\Socket:sendAll() get errCode 90 when data is near SO_SNDBUF",
    "created_at": "2020-05-14T11:06:16Z",
    "closed_at": "2020-05-15T12:47:47Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3321",
    "body": "Code\r\n\r\n```php\r\n$pool = new Swoole\\Process\\Pool(2, SWOOLE_IPC_UNIXSOCK, 0, true);                                                                             \r\n                                                                                                                                              \r\n$pool->on('workerStart', function (Swoole\\Process\\Pool $pool, int $workerId) {                                                                \r\n  if($workerId == 0){                                                                                                                         \r\n      $socket = $pool->getProcess(1)->exportSocket();                                                                                         \r\n                                                                                                                                              \r\n      echo strlen($socket->recv(500000)) . PHP_EOL;                                                                                                                                                                                                     \r\n  } else {                                                                                                                                    \r\n      $socket = $pool->getProcess()->exportSocket();                                                                                          \r\n                                                                                                                                              \r\n      /* $socket->send(\"hello proc0\\n\"); */                                                                                                   \r\n      $ret = $socket->sendAll(str_pad('', 425953, 'a'));                                                                                      \r\n      var_dump($ret, $socket->errCode, $socket->getOption(SOL_SOCKET, SO_SNDBUF), $socket->getOption(SOL_SOCKET, SO_TYPE));                                                                                                                                                                                                                                                                                  \r\n  }                                                                                                                                           \r\n});                                                                                                                                           \r\n                                                                                                                                             \r\n$pool->start();\r\n```\r\nI got:\r\n\r\nbool(false)\r\nint(90)\r\nint(425984)\r\nint(2)\r\n\r\nwhen I send/sendAll(str_pad('', 425953 - 1, 'a'));   it's ok\r\nthe data size is near SO_SNDBUF: 425984\r\nbut the DOC says sendAll will autoly send all the data without my own code\r\nso, how can I send bigger data when i use Process\\Pool",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3321/comments",
    "author": "HBSpy",
    "comments": [
      {
        "user": "twose",
        "created_at": "2020-05-15T10:03:54Z",
        "body": "it's DGRAM, not STREAM like TCP"
      },
      {
        "user": "HBSpy",
        "created_at": "2020-05-15T11:07:46Z",
        "body": "As the DOC says SOCK_DGRAM has 64k limit, but when I send/sendAll(str_pad('', 425953 - 1, 'a')); it's ok.\r\nSo, i should split the data and combine them by myself?"
      },
      {
        "user": "matyhtf",
        "created_at": "2020-05-15T12:47:47Z",
        "body": "@HBSpy This is a special feature of linux\r\n\r\nYou can send data in chunks, each sending 8K-16K data"
      }
    ]
  },
  {
    "number": 3293,
    "title": "Swoole TCP server, figuring out no. of workers for devices to meet scalability",
    "created_at": "2020-05-05T15:31:32Z",
    "closed_at": "2020-05-09T02:31:14Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3293",
    "body": "1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nI am using swoole TCP server for receving data packet over TCP by devices. \r\nEach Device sending data packet every 10 seconds.\r\nAfter making connection with server devices sends data packet in HEX.\r\nI parse this data packet and store it in MySQL DB using script written inside on receive callback.\r\nNow I have 1000 devices for which I am using 16 workers? Is this no. of worker is too small or too large?\r\nscript excecution time are as follows\r\n// avg execution time : 0.018135791 secs\r\n// max exceution time : 0.195485115 secs\r\n// min exceution time : 0.001955032 secs\r\n\r\nWhat can be optimum no of workers should I set so that I dont get any error and able to handle each data packet from devices?\r\nHow to find relationship between no. of workers, no of devices, data frequency and script exceution time?\r\n\r\nScript as below\r\n\r\n$serv = new swoole_server(\"0.0.0.0\", self::PORT_NO);\r\n$serv->set(array(\r\n\t'worker_num' => 16,\r\n\t'daemonize' => false,\r\n\t'heartbeat_check_interval' => 30,\r\n\t'heartbeat_idle_time' => 1800,\r\n\t'log_file' => $filepath\r\n));\r\n\r\n$serv->on('connect', function ($serv, $fd) {\r\n\t$tcp_client = $serv->connection_info($fd);\t\r\n});\r\n\r\n$serv->on('receive', function ($serv, $fd, $from_id, $data) {\t\r\n\t// Script processing received data packet\r\n\t// avg execution time : 0.019338155 secs\r\n\t// max exceution time : 0.161221981 secs\r\n\t// min exceution time : 0.161221981 secs\r\n});\r\n\r\n$serv->on('close', function ($serv, $fd) {   \r\n});\r\n\r\n$serv->on('shutdown', function () {\t\r\n});\r\n\r\n$serv->start();\t\t\r\n\r\n\r\n\r\n2. What did you expect to see?\r\n\r\nHow many maximum devices can be handle on given server? OR How do I scale TCP server to handle 50000 devices? \r\nHow Many Workers Do I need? \r\nIs there any other configuration I have to set?\r\nCan I use task worker? Then how mny worker or task worker needed? What is relation?\r\nalso how do I test 50000 devices?\r\nHow can I manage statistics of connections, errors? CPU, Memory load to understand any limit reached before getting any error?\r\nServer details mentioned in envionment below.\r\n\r\n3. What did you see instead?\r\n\r\nNot able to find how many no. of workers to set when devices grows.\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nswoole\r\n\r\nswoole support => enabled\r\nVersion => 1.9.21\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\nepoll => enabled\r\neventfd => enabled\r\ntimerfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nasync http/websocket client => enabled\r\nLinux Native AIO => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => Off => Off\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nLinux version 2.6.32-504.el6.x86_64 (mockbuild@c6b9.bsys.dev.centos.org) (gcc version 4.4.7 20120313 (Red Hat 4.4.7-11) (GCC) ) #1 SMP Wed Oct 15 04:27:16 UTC 2014\r\n\r\nPHP 5.6.31 (cli) (built: Sep 14 2017 18:31:45)\r\nCopyright (c) 1997-2016 The PHP Group\r\nZend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies\r\n    with Zend OPcache v7.0.6-dev, Copyright (c) 1999-2016, by Zend Technologies\r\n    with Xdebug v2.5.5, Copyright (c) 2002-2017, by Derick Rethans\r\n\r\nCPU info : \r\n\r\nArchitecture:          x86_64\r\nCPU op-mode(s):        32-bit, 64-bit\r\nByte Order:            Little Endian\r\nCPU(s):                32\r\nOn-line CPU(s) list:   0-31\r\nThread(s) per core:    2\r\nCore(s) per socket:    8\r\nSocket(s):             2\r\nNUMA node(s):          2\r\nVendor ID:             GenuineIntel\r\nCPU family:            6\r\nModel:                 62\r\nStepping:              4\r\nCPU MHz:               3300.183\r\nBogoMIPS:              6599.00\r\nVirtualization:        VT-x\r\nL1d cache:             32K\r\nL1i cache:             32K\r\nL2 cache:              256K\r\nL3 cache:              25600K\r\nNUMA node0 CPU(s):     0-7,16-23\r\nNUMA node1 CPU(s):     8-15,24-31\r\n\r\nMemory info (in GB) :\r\n\r\n             total       used       free     shared    buffers     cached\r\nMem:           125         68         57          0          0          4\r\n-/+ buffers/cache:         62         63\r\nSwap:            9          0          9\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3293/comments",
    "author": "keshav-boss",
    "comments": [
      {
        "user": "twose",
        "created_at": "2020-05-07T07:37:43Z",
        "body": "I'm sorry that I don't quite understand what you said\r\nmaybe you need to adjust the config and test it on your own mac, find out the best config for you"
      },
      {
        "user": "keshav-boss",
        "created_at": "2020-05-07T10:22:05Z",
        "body": "Thanks @twose for reply.\r\n\r\nCan you tell me how do I test whether configured no. of workers are enough?\r\nWhen to use task worker? and when not to use it?\r\n\r\n"
      },
      {
        "user": "twose",
        "created_at": "2020-05-08T03:22:30Z",
        "body": "if your code is sync blocked or there are not sync blocking code on your application so you should never use task-workers\r\nIf your code has both sync-blocking and async non-blocking things, put the async code on worker processes, use task-worker to handle the sync blocking things\r\n\r\n> how do I test whether configured no. of workers are enough\r\n\r\nit depends on you, you need to observe your CPU usage, memory, request time, etc.\r\n"
      }
    ]
  },
  {
    "number": 3283,
    "title": "Unable to process request",
    "created_at": "2020-04-29T09:33:21Z",
    "closed_at": "2020-04-30T07:36:18Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3283",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n`\r\n'enable_static_handler' => true,\r\n`\r\n\r\n2. What did you expect to see?\r\n\r\nProcess PHP requests while working with static files.\r\n\r\n3. What did you see instead?\r\n\r\n> HTTP 404 Not Found\r\n> Powered by Swoole\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n`\r\nswoole v4.5.0\r\n`\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\n`\r\ndocker pull hyperf/hyperf:7.2-alpine-v3.9-cli\r\n`\r\n\r\nSwoole v4.4 is normal.\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3283/comments",
    "author": "ghost",
    "comments": [
      {
        "user": "twose",
        "created_at": "2020-04-29T11:18:24Z",
        "body": "Please provide a simple script for reproducing the error"
      },
      {
        "user": "matyhtf",
        "created_at": "2020-04-30T07:36:18Z",
        "body": "```\r\n$server->set([\r\n    \"static_handler_locations\" => ['/static', '/app/images'],\r\n]);\r\n```\r\nPlease check if this configuration is correct"
      }
    ]
  },
  {
    "number": 3262,
    "title": "Dose  CURL_HOOK not support CURLOPT_FAILONERROR?",
    "created_at": "2020-04-21T09:13:31Z",
    "closed_at": "2020-04-24T01:50:20Z",
    "labels": [
      "question",
      "Implemented"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3262",
    "body": "PHP:7.2\r\nswoole:4.4.17\r\n\r\nwhen i used like this:\r\n```\r\n$ch = curl_init();\r\ncurl_setopt($ch, CURLOPT_URL, $url);\r\ncurl_setopt($ch, CURLOPT_FAILONERROR, false);\r\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\r\ncurl_setopt($ch, CURLOPT_SSL_VERIFYPEER, true);\r\n```\r\n\r\nPHP Fatal error: Uncaught Swoole\\Curl\\Exception: swoole_curl_setopt(): option[45] is not supported in @swoole-src/library/core/Curl/Handler.php:545\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3262/comments",
    "author": "nsnake",
    "comments": [
      {
        "user": "sy-records",
        "created_at": "2020-04-21T09:35:54Z",
        "body": "swoole v4.5 version will support.\r\n"
      }
    ]
  },
  {
    "number": 3235,
    "title": "count connections not equals foreach",
    "created_at": "2020-04-10T06:27:26Z",
    "closed_at": "2020-04-14T08:21:59Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3235",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nSWOOLE_BASE\r\n\r\n`count($server->ports[0]->connections)` not equals `foreach $server->ports[0]->connections`\r\n\r\n```php\r\n<?php\r\n$server = new Swoole\\WebSocket\\Server(\"0.0.0.0\", 9501, SWOOLE_BASE);\r\n$server->set([\r\n    'worker_num'    =>  2,\r\n]);\r\n\r\n$server->on('open', function (Swoole\\WebSocket\\Server $server, $request) {\r\n    echo \"server: handshake success with fd{$request->fd}\\n\";\r\n});\r\n\r\n$server->on('message', function (Swoole\\WebSocket\\Server $server, $frame) {\r\n    echo \"receive from {$frame->fd}:{$frame->data},opcode:{$frame->opcode},fin:{$frame->finish}\\n\";\r\n    $server->push($frame->fd, \"this is server\");\r\n\r\n    var_dump('workerId:' . $server->worker_id);\r\n    var_dump('port connections:' . count($server->ports[0]->connections));\r\n    foreach($server->ports[0]->connections as $fd)\r\n    {\r\n        var_dump($fd);\r\n    }\r\n});\r\n\r\n$server->on('close', function ($ser, $fd) {\r\n    echo \"client {$fd} closed\\n\";\r\n});\r\n\r\n$server->start();\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n```shell\r\nserver: handshake success with fd1\r\nreceive from 1:111,opcode:1,fin:1\r\nstring(10) \"workerId:1\"\r\nstring(18) \"port connections:1\"\r\nint(1)\r\nserver: handshake success with fd2\r\nreceive from 2:222,opcode:1,fin:1\r\nstring(10) \"workerId:0\"\r\nstring(18) \"port connections:1\"\r\nint(2)\r\n```\r\n\r\n3. What did you see instead?\r\n\r\n```shell\r\nserver: handshake success with fd1\r\nreceive from 1:111,opcode:1,fin:1\r\nstring(10) \"workerId:1\"\r\nstring(18) \"port connections:1\"\r\nint(1)\r\nserver: handshake success with fd2\r\nreceive from 2:222,opcode:1,fin:1\r\nstring(10) \"workerId:0\"\r\nstring(18) \"port connections:2\"\r\nint(2)\r\n```\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n4.4.17\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nphp 7.3\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3235/comments",
    "author": "Yurunsoft",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-04-14T08:21:59Z",
        "body": "Cannot traverse all connections with SWOOLE_BASE mode"
      }
    ]
  },
  {
    "number": 3202,
    "title": "协程channel push异常",
    "created_at": "2020-03-26T03:13:15Z",
    "closed_at": "2020-03-26T15:42:46Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3202",
    "body": "版本：mac os + php7.3 + swoole 4.4.x master \r\n```php\r\nuse Swoole\\Coroutine\\Scheduler;\r\nuse Swoole\\Coroutine\\Channel;\r\n$scheduler = new Scheduler();\r\n$scheduler->add(function() {\r\n    $chan = new Channel(1);\r\n    $chan->push(1,-1);\r\n    var_dump('push success');\r\n    $chan->push(1,-1);\r\n\r\n});\r\n$scheduler->start();\r\nvar_dump('Scheduler end');\r\n```\r\n预期结果：\r\n```\r\nstring(12) \"push success\"\r\n```\r\n实际结果：\r\n```\r\nstring(12) \"push success\"\r\nstring(13) \"Scheduler end\"\r\n```\r\n描述：理论上通道满了后，push超时-1的时候，协程应该一直挂起，直到channel被消费可以push\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3202/comments",
    "author": "kiss291323003",
    "comments": [
      {
        "user": "twose",
        "created_at": "2020-03-26T03:34:38Z",
        "body": "这是一个死锁程序 没有解锁的可能性 程序会结束并发出报警\r\n```php\r\nWARNING\t~Channel (ERRNO 10003): channel is destroyed, 1 producers will be discarded\r\n```"
      },
      {
        "user": "xiangdong2",
        "created_at": "2020-03-26T16:07:45Z",
        "body": "[root@swoole_server_10_10_0_45:/tmp]\r\n#cat scheduler.php \r\n<?php\r\nuse Swoole\\Coroutine\\Scheduler;\r\nuse Swoole\\Coroutine\\Channel;\r\n$scheduler = new Scheduler();\r\n$scheduler->add(function() {\r\n    $chan = new Channel(1);\r\n    $chan->push(1,-1);\r\n    var_dump('push success');\r\n    $chan->push(1,-1);\r\n\r\n});\r\n$scheduler->start();\r\nvar_dump('Scheduler end');\r\n\r\n[root@swoole_server_10_10_0_45:/tmp]\r\n#php scheduler.php\r\nstring(12) \"push success\"\r\nstring(13) \"Scheduler end\"\r\n\r\n能讲讲通道怎么满了么？普及下。"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-03-27T08:16:44Z",
        "body": "@xiangdong2 因为这里设置的`Channel`的大小是1，然后他`push`了一个数据进去，没有其他协程进行消费，`Channel`自然就是满的。"
      }
    ]
  },
  {
    "number": 3176,
    "title": "PHP Warning:  Swoole\\Server::task(): worker_id must be less than task_worker_num[4]",
    "created_at": "2020-03-14T05:14:30Z",
    "closed_at": "2020-03-14T15:11:41Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3176",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n```php\r\n<?php\r\nclass Ws\r\n{\r\n    public $host = '192.168.1.8';\r\n    public $port = 8081;\r\n\r\n    public $ws = null;\r\n    public function __construct()\r\n    {\r\n        $this->ws = new Swoole\\WebSocket\\Server($this->host, $this->port);\r\n\r\n        $this->ws->set([\r\n            'worker_num' => 1,\r\n            'task_worker_num' => 4\r\n        ]);\r\n\r\n        $this->ws->on('open', [$this, 'onOpen']);\r\n        $this->ws->on('message', [$this, 'onMessage']);\r\n        $this->ws->on('task', [$this, 'onTask']);\r\n        $this->ws->on('finish', [$this, 'onFinish']);\r\n        $this->ws->on('close', [$this, 'onClose']);\r\n\r\n        $this->ws->start();\r\n    }\r\n\r\n    public function onOpen($ws, $request)\r\n    {\r\n        var_dump($request->fd);\r\n    }\r\n\r\n    public function onMessage($ws, $frame)\r\n    {\r\n        echo \"client-message: {$frame->data}\\n\";\r\n        // todo 10s\r\n        $data = [\r\n            'task' => 1,\r\n            'fd' => $frame->fd\r\n        ];\r\n        $ws->task($data);\r\n        $ws->push($frame->fd, \"server-message: \" . date('Y-m-d h:i:s'));\r\n    }\r\n\r\n    public function onTask($serv, $taskid, $workerid, $data)\r\n    {\r\n        sleep(10);\r\n        return 'on task finish';\r\n    }\r\n\r\n    public function onFinish($serv, $taskid, $data)\r\n    {\r\n        echo \"taskid: {$taskid}\\n\";\r\n        echo \"finish-data-success: {$data}\";\r\n    } \r\n\r\n    public function onClose($ws, $fd)\r\n    {\r\n        echo \"client-id: {$fd}\\n\";\r\n    }\r\n}\r\n\r\n$obj = new Ws();\r\n```\r\n\r\n\r\n2. What did you expect to see?\r\nCall func onTask and onFinish when client send message to websocket server. Thus the server will output taskid and data.\r\n\r\n\r\n3. What did you see instead?\r\nPHP Warning:  Swoole\\Server::task(): worker_id must be less than task_worker_num[4]\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nVersion => 4.5.0-alpha\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\nLinux version 4.19.97-v7l+ \r\ngcc version 4.9.3\r\nPHP 7.4.3\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3176/comments",
    "author": "tianyu2014214",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-03-14T15:10:39Z",
        "body": "Could not reproduce your problem, please check the task method parameter is correct.\r\n\r\nPlease update to the latest version, use the `make clean` command to clear the cache, and recompile"
      },
      {
        "user": "zymeli",
        "created_at": "2020-10-02T12:55:21Z",
        "body": "### 你好，我也遇到此问题，我查看了源代码，应该是有BUG。\r\n--------------------\r\n```c\r\n\r\nstatic sw_inline int php_swoole_check_task_param(Server *serv, zend_long dst_worker_id) {\r\n    if (UNEXPECTED(serv->task_worker_num == 0)) {\r\n        php_swoole_fatal_error(E_WARNING, \"task method can't be executed without task worker\");\r\n        return SW_ERR;\r\n    }\r\n    if (UNEXPECTED(dst_worker_id >= serv->task_worker_num)) {\r\n        php_swoole_fatal_error(E_WARNING, \"worker_id must be less than task_worker_num[%u]\", serv->task_worker_num);\r\n        return SW_ERR;\r\n    }\r\n    if (UNEXPECTED(serv->is_task_worker())) {\r\n        php_swoole_fatal_error(E_WARNING, \"Server->task() cannot use in the task-worker\");\r\n        return SW_ERR;\r\n    }\r\n    return SW_OK;\r\n}\r\n```\r\n--------------------\r\nSwoole\\Server->task(mixed $data, int $dstWorkerId = -1, callable $finishCallback): int\r\n参数: int $dstWorkerId\r\n功能：可以指定要给投递给哪个 Task 进程，传入 ID 即可，范围参考 $worker_id\r\n--------------------\r\n$worker_id\r\n得到当前 Worker 进程的编号，包括 Task 进程。\r\n提示\r\n这个属性与 onWorkerStart 时的 $workerId 是相同的。\r\nWorker 进程编号范围是 [0, $serv->setting['worker_num']-1]\r\nTask 进程编号范围是 [$serv->setting['worker_num'], $serv->setting['worker_num'] + $serv->setting['task_worker_num']]\r\n--------------------\r\n以上，手册是正确的，但swoole_server.cc里，中间明显有BUG。\r\n--------------------\r\n我目前绕过这个bug的方法是：\r\n`\r\n$server->set([\r\n            'task_worker_num' => count($this->productIds) + 10, // 保证每个产品有一个task进程对应\r\n        ]);\r\n`\r\n--------------------\r\n以上，请查证，谢谢。"
      },
      {
        "user": "matyhtf",
        "created_at": "2021-02-04T08:38:57Z",
        "body": "@zymeli  文档中的表述可能存在一些错误，实际上这里的 `dst_worker_id` 是指 Task 进程的编号，是 `[0-task_worker_num -1]` 之间的一个数字"
      },
      {
        "user": "zymeli",
        "created_at": "2021-02-04T08:44:43Z",
        "body": "好的，谢谢你。\r\n\r\n\r\n\r\n---Original---\r\nFrom: \"韩天峰-Rango\"<notifications@github.com&gt;\r\nDate: Thu, Feb 4, 2021 16:39 PM\r\nTo: \"swoole/swoole-src\"<swoole-src@noreply.github.com&gt;;\r\nCc: \"zymeli\"<710055@qq.com&gt;;\"Mention\"<mention@noreply.github.com&gt;;\r\nSubject: Re: [swoole/swoole-src] PHP Warning:  Swoole\\Server::task(): worker_id must be less than task_worker_num[4] (#3176)\r\n\r\n\r\n\r\n\r\n \r\n@zymeli  文档中的表述可能存在一些错误，实际上这里的 dst_worker_id 是指 Task 进程的编号，是 [0-task_worker_num -1] 之间的一个数字\r\n \r\n—\r\nYou are receiving this because you were mentioned.\r\nReply to this email directly, view it on GitHub, or unsubscribe."
      }
    ]
  },
  {
    "number": 3174,
    "title": "tcp_server自定义进程如何关闭",
    "created_at": "2020-03-11T12:27:13Z",
    "closed_at": "2020-03-17T02:12:40Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3174",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n环境: \r\nphp7.1\r\nswoole4.3.6  tcp process模式\r\ncentos 7\r\n\r\n如题, 请问如何关闭processA进程, 而不被会manager重新拉起\r\n$serv = new \\Swoole\\Server($host, $port);\r\n$serv->addProcess($processA);\r\n$serv->start();\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3174/comments",
    "author": "lgxxaq",
    "comments": [
      {
        "user": "twose",
        "created_at": "2020-03-12T05:16:34Z",
        "body": "不要add不就不会拉起了"
      },
      {
        "user": "lgxxaq",
        "created_at": "2020-03-12T07:41:45Z",
        "body": "@twose 没看懂呢, processA这个进程是一定要有的, 但我想在某个时间点, 如接收到信号的方式关闭这个进程而不被manager重新拉起, 请问可以实现吗"
      },
      {
        "user": "lgxxaq",
        "created_at": "2020-03-12T10:23:38Z",
        "body": "我想单纯的发送信号即可, 不杀死进程\r\n```\r\nProcess::signal($signo, function () use ($process) {\r\n    // do something \r\n});\r\n```\r\n当$signo = 99信号好像捕捉不到, 但是已定义的如SIGINT, SIGTERM, SIGINFO又会杀死进程然后被manager拉起.\r\n\r\n但是有哪些信号可以让Process::signal接收到, 但是又不会杀死进程呢 ?"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-03-13T03:26:44Z",
        "body": "@lg430 意思应该是，你通过`add`的进程，就是会被`manager`进程管的。所以你创建用户进程不要用`add`的方式，而是自己`new Process`来创建进程。"
      },
      {
        "user": "lgxxaq",
        "created_at": "2020-03-13T06:05:16Z",
        "body": "@huanghantao 好的, 有没有好的方法实现shell与php进程通信呢, 我上面用的Process::signal貌似不合适, 如上面所说"
      },
      {
        "user": "matyhtf",
        "created_at": "2020-03-17T02:13:10Z",
        "body": "@lg430 可以在 wenda.swoole.com 中提问"
      }
    ]
  },
  {
    "number": 3169,
    "title": "Resource temporarily unavailable when I have thousands of concurrent requests for UDS services",
    "created_at": "2020-03-09T06:42:58Z",
    "closed_at": "2020-03-13T02:29:40Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3169",
    "body": "Full codes:\r\n```\r\nuse Swoole\\Process\\Pool;\r\nuse Swoole\\Server;\r\n\r\nini_set('memory_limit', '1536M');\r\n\r\nini_set('swoole.unixsock_buffer_size', '67108864‬');\r\n\r\nvar_dump(ini_get('memory_limit'), ini_get('swoole.unixsock_buffer_size'));\r\n\r\nfunction sockResource() {\r\n    return '/var/run/test.sock';\r\n}\r\n\r\n$process = new Swoole\\Process(function () {\r\n    $server = new Swoole\\Server(sockResource(), 0, SWOOLE_BASE, SWOOLE_UNIX_STREAM);\r\n    $server->on('receive', function (Server $server, $fd, int $fromId, string $requestData) {\r\n        $server->send($fd, mt_rand());\r\n    });\r\n    $server->start();\r\n});\r\n\r\n//$process->setTimeout(1);\r\n$process->start();\r\nusleep(200000);\r\n//sleep(2);\r\n\r\n//$pool = new \\Swoole\\Process\\Pool(4, SWOOLE_IPC_UNIXSOCK, 0, true);\r\n//$pool->on('workerStart', function (Pool $pool, int $workerId) {\r\n    $coroutineCount = 50000;\r\n\r\n    for ($i = 0; $i < $coroutineCount; $i++) {\r\n        go(function () {\r\n            $client = new \\Swoole\\Coroutine\\Client(SWOOLE_UNIX_STREAM);\r\n            if (!$client->connect(sockResource(), 0, 0)) {\r\n                var_dump($client->errMsg, Co::stats());\r\n            }\r\n            $client->send(mt_rand());\r\n            $msg = $client->recv();\r\n            if ($client->errCode > 0) {\r\n                var_dump($msg, $client->errMsg);\r\n            }\r\n        });\r\n    }\r\n//});\r\n//$pool->start();\r\n```\r\n\r\nThe previous codes was print this:\r\n```\r\nstring(32) \"Resource temporarily unavailable\"\r\narray(8) {\r\n  [\"event_num\"]=>\r\n  int(1923)\r\n  [\"signal_listener_num\"]=>\r\n  int(0)\r\n  [\"aio_task_num\"]=>\r\n  int(0)\r\n  [\"aio_worker_num\"]=>\r\n  int(0)\r\n  [\"c_stack_size\"]=>\r\n  int(2097152)\r\n  [\"coroutine_num\"]=>\r\n  int(1924)\r\n  [\"coroutine_peak_num\"]=>\r\n  int(1924)\r\n  [\"coroutine_last_cid\"]=>\r\n  int(2042)\r\n}\r\nbool(false)\r\nstring(20) \"Client no connection\"\r\n```\r\n\r\nphp --ri swoole:\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.16\r\nBuilt => Mar  3 2020 17:01:09\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\nThe environment:\r\n```\r\nWindows 10\r\nDocker 2.0.0.3 Linux Container 2 Core 2G Memory\r\n```\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3169/comments",
    "author": "idrunk",
    "comments": [
      {
        "user": "twose",
        "created_at": "2020-03-09T07:02:14Z",
        "body": "correct code\r\n\r\n```php\r\n            if (!$msg) {\r\n                var_dump($msg, $client->errMsg);\r\n            }\r\n```"
      },
      {
        "user": "twose",
        "created_at": "2020-03-09T07:06:07Z",
        "body": "Your number of connections may exceed the maximum allowed by the Linux kernel\r\n"
      },
      {
        "user": "idrunk",
        "created_at": "2020-03-09T07:14:47Z",
        "body": "I changed the codes like the following, And it still throw the error, I was adjust the concurrent connections to 2000, Sometimes run well and sometimes throw exception.\r\n\r\n```\r\n    $coroutineCount = 2000;\r\n    $counter = 0;\r\n\r\n    for ($i = 0; $i < $coroutineCount; $i++) {\r\n        go(function () use (& $counter) {\r\n            $client = new \\Swoole\\Coroutine\\Client(SWOOLE_UNIX_STREAM);\r\n            if (! $client->connect(sockResource(), 0, 0.2)) {\r\n                var_dump($client->errMsg, Co::stats());\r\n            } else {\r\n                $client->send(mt_rand());\r\n                $msg = $client->recv();\r\n                if (! $msg) {\r\n                    var_dump($msg, $client->errMsg);\r\n                } else {\r\n                    $counter ++;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    go(function () use (& $counter) {\r\n        Co::sleep(3);\r\n        var_dump($counter);\r\n    });\r\n```"
      },
      {
        "user": "twose",
        "created_at": "2020-03-09T07:19:38Z",
        "body": "try to change the timeout to -1 and add some retry logic\r\n"
      },
      {
        "user": "idrunk",
        "created_at": "2020-03-09T07:56:47Z",
        "body": "I do your suggestion for the example codes, It can fix the problem 100%, But when i use it in my project, It still didn't work. I set the timeout to -1, but if some coroutine process cannot connection and the next all will not connect to. The top limit connection was 130. I'll compare the code first to see if there is any problem in other places. Thank you first."
      },
      {
        "user": "twose",
        "created_at": "2020-03-09T08:29:06Z",
        "body": "Is your project running on a different mac?\r\nIf so, you may need to look up Linux kernel params"
      },
      {
        "user": "idrunk",
        "created_at": "2020-03-09T09:12:57Z",
        "body": "@twose Thanks for your help. The script's runtime environment was the same, They are all under the same docker container. I was found the problem, It because the example's server was return direct, But in my project, The server was do the redis io control, It was time-consuming that can not return at once, Even retry request it still can not return at once. So the all next coroutine concurrent will time out. Now my work it's do something make the server service run faster, I think there are many ways to solve it. Thank you again!"
      },
      {
        "user": "idrunk",
        "created_at": "2020-03-12T04:41:28Z",
        "body": "Hi, I reopened this issue because I still not resolve it. I was adjust the server end code, made it faster, But the problem still on. Now I found the problem is can't have some slow io in the server, or the next connection should be throw the error. I changed my php environment from docker container apline to debian, The problem still on. And tried adjusted the kernel config, All not working.\r\n\r\nThis is my new code.\r\n```\r\nfunction sockResource() {\r\n    return '/var/run/test.sock';\r\n}\r\n\r\n$process = new Swoole\\Process(function () {\r\n    $server = new Swoole\\Server(sockResource(), 0, SWOOLE_BASE, SWOOLE_UNIX_STREAM);\r\n    $server->on('receive', function (Swoole\\Server $server, $fd, int $fromId, string $requestData) {\r\n        usleep(50000);\r\n        $server->send($fd, mt_rand());\r\n    });\r\n    $server->start();\r\n});\r\n\r\n$process->start();\r\nusleep(200000);\r\n\r\n$coroutineCount = 100;\r\n$counter = 0;\r\n$time = microtime(1);\r\n\r\nfor ($i = 0; $i < $coroutineCount; $i++) {\r\n    go(function () use (& $counter) {\r\n        $client = new Swoole\\Coroutine\\Client(SWOOLE_UNIX_STREAM);\r\n        if (! $client->connect(sockResource(), 0, 2)) {\r\n            var_dump($client->errMsg, memory_get_usage());\r\n        } else {\r\n            $client->send(mt_rand());\r\n            $msg = $client->recv();\r\n            if (! $msg) {\r\n                var_dump($msg, $client->errMsg);\r\n            } else {\r\n                $counter ++;\r\n            }\r\n            $client->close();\r\n        }\r\n    });\r\n}\r\n\r\ngo(function () use (& $counter, $time) {\r\n    while (Co::stats()['coroutine_num'] >= 2) {\r\n        Co::sleep(0.001);\r\n    }\r\n    var_dump($time, microtime(1), $counter);\r\n});\r\n```\r\n\r\nAnd this is the kernel of my config, 'cat /proc/sys/net/unix/max_dgram_qlen' was echo 1000\r\n```\r\n      kernel.msgmnb: 4203520\r\n      kernel.msgmni: 64\r\n      kernel.msgmax: 8192\r\n#      net.core.wmem_default: 8388608\r\n#      net.core.rmem_default: 8388608\r\n#      net.core.rmem_max: 16777216\r\n#      net.core.wmem_max: 16777216\r\n#      net.ipv4.tcp_mem:   379008       505344  758016\r\n#      net.ipv4.tcp_wmem: 4096        16384   4194304\r\n#      net.ipv4.tcp_rmem: 4096          87380   4194304\r\n      net.ipv4.tcp_syncookies: 1\r\n#      net.ipv4.tcp_max_syn_backlog: 81920\r\n      net.ipv4.tcp_synack_retries: 3\r\n      net.ipv4.tcp_syn_retries: 3\r\n      net.ipv4.tcp_fin_timeout: 30\r\n      net.ipv4.tcp_keepalive_time: 300\r\n#      net.ipv4.tcp_tw_reuse: 1\r\n#      net.ipv4.tcp_tw_recycle: 1\r\n      net.ipv4.ip_local_port_range: 20000 65000\r\n#      net.ipv4.tcp_max_tw_buckets: 200000\r\n#      net.ipv4.route.max_size: 5242880\r\n      net.unix.max_dgram_qlen: 1000\r\n```"
      },
      {
        "user": "idrunk",
        "created_at": "2020-03-12T04:42:53Z",
        "body": "The timeout set to '-1' seems not working, Is my sample code something wrong?"
      },
      {
        "user": "idrunk",
        "created_at": "2020-03-12T07:50:18Z",
        "body": "I found the 'net.core.somaxconn' kernel argument can help me make more concurrent connections, But it seems stuck at 512 valve. Maybe I should adjust the logic to control the concurrent connection's quantity."
      }
    ]
  },
  {
    "number": 3156,
    "title": "phpize 报错",
    "created_at": "2020-03-03T10:58:09Z",
    "closed_at": "2020-03-03T11:17:06Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3156",
    "body": "php版本 7.2.26\r\n操作系统centos7\r\nswoole 4.4.16\r\n\r\nPackage libtool-2.4.2-22.el7_3.x86_64 already installed and latest version\r\nPackage automake-1.13.4-3.el7.noarch already installed and latest version\r\nPackage autoconf-2.69-11.el7.noarch already installed and latest version\r\n\r\n需要的软件都装了，但是在执行phpize的时候会报措如下：\r\n\r\n[root@lnp swoole]# phpize\r\nConfiguring for:\r\nPHP Api Version:         20170718\r\nZend Module Api No:      20170718\r\nZend Extension Api No:   320170718\r\nunknown channel 9: _AC_PROG_LIBTOOL is expanded from...\r\naclocal.m4:3326: AC_PROG_LIBTOOL is expanded from...\r\nconfigure.ac:149: the top level])\r\nobsolete at /usr/share/autoconf/Autom4te/Channels.pm line 638.\r\n\tAutom4te::Channels::msg('9: _AC_PROG_LIBTOOL is expanded from...\\x{a}aclocal.m4:3326: AC_P...', 'configure.ac:149', 'warning: The macro `AC_LANG_RESTORE\\' is obsolete.\\x{a}You should...', 'partial', 1) called at /usr/bin/autom4te line 1026\r\n\r\n\r\n求问解决办法，谢谢",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3156/comments",
    "author": "ezqliin",
    "comments": [
      {
        "user": "huanghantao",
        "created_at": "2020-03-03T11:06:32Z",
        "body": "@ezqliin 这个问题我前几天遇到过，你是不是在虚拟机里面跑的`phpize`？"
      },
      {
        "user": "ezqliin",
        "created_at": "2020-03-03T11:08:18Z",
        "body": "@huanghantao 是的，mac下用vagrant里跑的centos。但是我上次也是同样的centos box，同样的方法就安装成功了。不小心把那个环境清理了，这次再装就一直报这个错误"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-03-03T11:10:38Z",
        "body": "@ezqliin 你下载的`swoole-src`存放的目录不对。我当时遇到这个问题是因为我把`swoole-src`下载在了本机挂载在虚拟机的一个目录里面。估计你也是把`swoole-src`下载在了错误的目录里。"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-03-03T11:11:21Z",
        "body": "@ezqliin 你把`swoole-src`移到虚拟机的`/tmp`目录下执行`phpize`试试。"
      },
      {
        "user": "ezqliin",
        "created_at": "2020-03-03T11:15:58Z",
        "body": "@huanghantao  卧槽 牛逼！我想起来了，我上次是在虚拟机里执行的git 然后拉取的目录是虚拟机里的目录，这次是在共享目录中操作的，现在可以了！感谢！！！"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-03-03T11:17:06Z",
        "body": "@ezqliin 不客气。这个问题确实挺坑的。"
      }
    ]
  },
  {
    "number": 3140,
    "title": "open_websocket_protocol参数的使用问题",
    "created_at": "2020-02-26T23:41:54Z",
    "closed_at": "2020-02-27T03:04:54Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3140",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n在tcp服务器中开启 open_websocket_protocol\r\n\r\n```php\r\n\r\n\r\n//创建Server对象，监听 127.0.0.1:9501端口\r\n$serv = new Swoole\\Server(\"0.0.0.0\", 9501,SWOOLE_PROCESS,SWOOLE_TCP); \r\n$serv->set([\r\n    'open_websocket_protocol'=>true\r\n]);\r\n\r\n//监听连接进入事件\r\n$serv->on('Connect', function ($serv, $fd) {  \r\n    echo \"Client: Connect.\\n\";\r\n});\r\n\r\n$serv->on('Message', function($ws, \\Swoole\\WebSocket\\Frame$frame){\r\n    echo \"onMessage: .{$frame->data}\\n\";\r\n});\r\n$serv->on('request', function(\\Swoole\\Http\\Request $request, Phalcon\\Http\\Response $response){\r\n    echo \"request: .{$request->getData()}\\n\";\r\n});\r\n\r\n//request\r\n//监听数据接收事件\r\n$serv->on('Receive', function (\\Swoole\\Server$serv, $fd, $from_id, $data) {\r\n   echo \"Receive \".$data.\"\\n\";\r\n   $serv->send($fd, \" Server: \".$data);\r\n    \r\n});\r\n\r\n//监听连接关闭事件\r\n$serv->on('Close', function ($serv, $fd) {\r\n    echo \"Client: Close.\\n\";\r\n});\r\n\r\n//启动服务器\r\n$serv->start(); \r\n\r\n\r\necho \"ok\";\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\nonMessage 和 onReceive 事件都能生效\r\n\r\n3. What did you see instead?\r\n\r\nonReceive 事件没有生效,在进行tcp链接和数据发送的时候我收到了Connect 和Close ,客户端的send 也成功了,客户端的recv报错了,报错信息如下\r\n```\r\n\r\nWarning: Swoole\\Client::recv(): recv() failed. Error: Resource temporarily unavailable [11] in /var/www/html/index.php on line 27\r\nrecv failed.\r\n```\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.14\r\nBuilt => Dec 31 2019 08:39:39\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nLinux d306a408331b 5.3.0-40-generic #32~18.04.1-Ubuntu SMP Mon Feb 3 14:05:59 UTC 2020 x86_64 GNU/Linux\r\n\r\n\r\nPHP 7.2.25 (cli) (built: Nov 22 2019 17:19:47) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3140/comments",
    "author": "dongasai",
    "comments": [
      {
        "user": "huanghantao",
        "created_at": "2020-02-27T02:33:05Z",
        "body": "@dongasai \r\n因为你的`Server`没有给`Client`返回数据，所以`Client`报错了。\r\n\r\n我这里有一份设置`open_websocket_protocol`协议的代码。\r\n\r\n`Server`代码：\r\n\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Http\\Server;\r\nuse Swoole\\WebSocket\\Frame;\r\n\r\n$serv = new Server('127.0.0.1', 9501);\r\n$serv->set([\r\n    // 'open_http_protocol' => true,\r\n    'open_websocket_protocol' => true\r\n]);\r\n$serv->on('message', function (Server $server, Frame $frame) {\r\n    $response = new Frame;\r\n    $response->data = 'hello swoole';\r\n    $server->send($frame->fd, (string)$response);\r\n});\r\n$serv->start();\r\n```\r\n\r\n`Client`代码：\r\n\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Coroutine;\r\nuse Swoole\\Coroutine\\Http\\Client;\r\n\r\nuse function Co\\run;\r\n\r\nrun(function () {\r\n    $cli = new Client(\"127.0.0.1\", 9501);\r\n    $ret = $cli->upgrade(\"/websocket\");\r\n\r\n    if (!$ret) {\r\n        echo \"ERROR\\n\";\r\n        return;\r\n    }\r\n\r\n    $cli->push(\"websocket handshake 1\\n\");\r\n    $data = $cli->recv();\r\n    var_dump($data);\r\n});\r\n```"
      },
      {
        "user": "dongasai",
        "created_at": "2020-02-27T02:41:50Z",
        "body": "@huanghantao  非常的抱歉,我没有正确的描述我的问题,下面重点陈述问题重点\r\nWhat did you expect to see?\r\nonMessage 和 onReceive 事件都能生效\r\n\r\nWhat did you see instead?\r\nonReceive 事件没有生效\r\n\r\n该问题的重点是:onReceive事件没有生效\r\n我是在tcp客户端遇到的错无,在ws客户端没有遇到错误\r\n"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-02-27T02:43:29Z",
        "body": "@dongasai 你的代码启动会报警告的，如果你非要这么跑，这里是可以跑通的`Server`代码：\r\n\r\n```php\r\n<?php\r\n\r\n//创建Server对象，监听 127.0.0.1:9501端口\r\n$serv = new Swoole\\Server(\"0.0.0.0\", 9501,SWOOLE_PROCESS,SWOOLE_TCP); \r\n$serv->set([\r\n    'open_websocket_protocol'=>true\r\n]);\r\n\r\n//监听连接进入事件\r\n$serv->on('Connect', function ($serv, $fd) {  \r\n    echo \"Client: Connect.\\n\";\r\n});\r\n\r\n$serv->on('Message', function($serv, \\Swoole\\WebSocket\\Frame $frame){\r\n    $response = new \\Swoole\\WebSocket\\Frame;\r\n    $response->data = 'server';\r\n    $serv->send($frame->fd, (string)$response);\r\n});\r\n$serv->on('request', function(\\Swoole\\Http\\Request $request, Swoole\\Http\\Response $response){\r\n    echo \"request: .{$request->getData()}\\n\";\r\n});\r\n\r\n//request\r\n//监听数据接收事件\r\n$serv->on('Receive', function (\\Swoole\\Server$serv, $fd, $from_id, $data) {\r\n   echo \"Receive \".$data.\"\\n\";\r\n   $serv->send($fd, \" Server: \".$data);\r\n});\r\n\r\n//监听连接关闭事件\r\n$serv->on('Close', function ($serv, $fd) {\r\n    echo \"Client: Close.\\n\";\r\n});\r\n\r\n//启动服务器\r\n$serv->start(); \r\n\r\n\r\necho \"ok\";\r\n```"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-02-27T02:49:29Z",
        "body": "@dongasai 我懂你的意思了，你需要多端口监听，稍等"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-02-27T03:01:25Z",
        "body": "@dongasai 这是符合你预期的代码，同时提供`TCP`、`HTTP`、`WebSocket`服务的服务器：\r\n\r\n```php\r\n<?php\r\n\r\n$serv = new Swoole\\Server(\"127.0.0.1\", 9501, SWOOLE_PROCESS, SWOOLE_TCP); \r\n\r\n//监听连接进入事件\r\n$serv->on('Connect', function ($serv, $fd) {  \r\n    echo \"Client: Connect.\\n\";\r\n});\r\n\r\n//监听数据接收事件\r\n$serv->on('Receive', function (\\Swoole\\Server $serv, $fd, $from_id, $data) {\r\n    echo \"Receive \".$data.\"\\n\";\r\n    $serv->send($fd, \" Server: \".$data);\r\n });\r\n\r\n //监听连接关闭事件\r\n$serv->on('Close', function ($serv, $fd) {\r\n    echo \"Client: Close.\\n\";\r\n});\r\n\r\n$port1 = $serv->listen(\"127.0.0.1\", 9502, SWOOLE_SOCK_TCP);\r\n$port1->set([\r\n    'open_http_protocol' => true,    // 设置这个端口关闭http协议功能\r\n    'open_eof_check' => true,\r\n    \"package_eof\"    => \"\\r\\n\\r\\n\",\r\n]);\r\n\r\n$port1->on('request', function(\\Swoole\\Http\\Request $request, Swoole\\Http\\Response $response){\r\n    echo \"request: .{$request->getData()}\\n\";\r\n});\r\n\r\n$port2 = $serv->listen(\"127.0.0.1\", 9503, SWOOLE_SOCK_TCP);\r\n$port2->set([\r\n    'open_websocket_protocol' => true,\r\n]);\r\n\r\n$port2->on('Message', function($serv, \\Swoole\\WebSocket\\Frame $frame){\r\n    $response = new \\Swoole\\WebSocket\\Frame;\r\n    $response->data = 'server';\r\n    $serv->send($frame->fd, (string)$response);\r\n});\r\n\r\n//启动服务器\r\n$serv->start();\r\n```"
      },
      {
        "user": "twose",
        "created_at": "2020-02-27T03:04:54Z",
        "body": "在本项目README最开头就有混合服务器的最佳示例内容, 请阅读\r\n\r\n此外websocket和tcp不可能使用同一个端口\r\n首先websocket包含了websocket和http, 都是基于TCP协议之上的协议, 同一个客户端发来的数据包, 服务器是无法分辨究竟是自定义TCP协议还是HTTP/Websocket的\r\n"
      }
    ]
  },
  {
    "number": 3126,
    "title": "coroutine::list  遍历当前进程中正在运行的协程总是多一个",
    "created_at": "2020-02-21T17:09:44Z",
    "closed_at": "2020-02-22T07:53:35Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3126",
    "body": "```php\r\n<?php\r\n\r\nuse  \\Swoole\\Coroutine;\r\nuse  \\Swoole\\Coroutine\\WaitGroup;\r\nuse  \\Swoole\\Coroutine\\Channel;\r\n\r\nCoroutine::create(function() {\r\n\t\r\n\t$wg=new  WaitGroup();\r\n\t\r\n\t$wg->add(1);\r\n\t//  第一次打印CoroutineList， 会输出主协程ID（=1）\r\n\tforeach(Coroutine::list()  as $key=>$Cid){\r\n\t\tvar_dump(\"进程中正在运行的协程ID:\".$Cid);\r\n\t}\r\n\t\r\n\tCoroutine::create(function()  use($wg) {\r\n\t\t$Cid=Coroutine::getCid();\r\n\t\tvar_dump(\"A.新启动协程ID\".$Cid);\r\n\t\tCoroutine::sleep(2);\r\n\t\t$wg->done();\r\n\t\t\r\n\t});\r\n\r\n\t$wg->wait();  //  等待A协程运行结束\r\n\t\r\n\t\tforeach(Coroutine::list()  as $key=>$Cid){\r\n\t\tvar_dump(\"进程中正在运行的协程ID: \".$Cid);   //  这里遍历的时候A协程（ID=2）为什么会被遍历出来？\r\n\t}\r\n\t\r\n\t$wg->add(1);\r\n\tCoroutine::create(function()  use($wg) {\r\n\t\t$Cid=Coroutine::getCid();\r\n\t\tvar_dump(\"B.新启动协程ID\".$Cid);\r\n\t\tCoroutine::sleep(2);\r\n\t\t$wg->done();\r\n\t\t\r\n\t});\t\r\n\t$wg->wait();  //  等待B协程运行结束\r\n\t\r\n\t\tforeach(Coroutine::list()  as $key=>$Cid){\r\n\t\tvar_dump(\"进程中正在运行的协程ID: \".$Cid); //  这里遍历的时候B协程（ID=3）为什么会被遍历出来？\r\n\t}\r\n\t\r\n});\r\n\r\n```\r\n运行以上代码，结果：\r\n```php\r\nstring(34) \"进程中正在运行的协程ID:1\"\r\nstring(20) \"A.新启动协程ID2\"\r\n\r\nstring(35) \"进程中正在运行的协程ID: 2\"   //  这里$wg->wait()  等待 A协程（ID=2）结束，才遍历状态，为什么A协程会出现在list列表？\r\n\r\nstring(35) \"进程中正在运行的协程ID: 1\"\r\nstring(20) \"B.新启动协程ID3\"\r\n\r\nstring(35) \"进程中正在运行的协程ID: 3\"  //  这里$wg->wait()  等待 B协程结束，才遍历状态，为什么B协程（ID=3）会出现在list列表？\r\nstring(35) \"进程中正在运行的协程ID: 1\"\r\n\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3126/comments",
    "author": "qifengzhang007",
    "comments": [
      {
        "user": "huanghantao",
        "created_at": "2020-02-22T03:58:09Z",
        "body": "@qifengzhang007 \r\n`$wg->done();`会发生一次协程的调度，你可以打印跟踪一下。我这里有一份符合你预期的代码：\r\n\r\n```php\r\n<?php\r\n\r\nuse  \\Swoole\\Coroutine;\r\nuse  \\Swoole\\Coroutine\\WaitGroup;\r\nuse  \\Swoole\\Coroutine\\Channel;\r\n\r\nuse function Co\\run;\r\n\r\nCoroutine::create(function() {\r\n    \r\n    $wg = new WaitGroup();\r\n\r\n    $wg->add(1);\r\n    //  第一次打印CoroutineList， 会输出主协程ID（=1）\r\n    foreach(Coroutine::list()  as $key=>$Cid){\r\n        var_dump(\"进程中正在运行的协程ID:\".$Cid);\r\n    }\r\n\r\n    Coroutine::create(function()  use($wg) {\r\n        $Cid=Coroutine::getCid();\r\n        var_dump(\"A.新启动协程ID\".$Cid);\r\n        Coroutine::sleep(2);\r\n        var_dump(\"1\");\r\n        $wg->done();\r\n        var_dump(\"2\");\r\n    });\r\n\r\n    var_dump(\"3\");\r\n    $wg->wait();  //  等待A协程运行结束\r\n    var_dump(\"4\");\r\n    Coroutine::sleep(0.1);\r\n\r\n    foreach(Coroutine::list()  as $key=>$Cid){\r\n        var_dump(\"进程中正在运行的协程ID: \".$Cid);   //  这里遍历的时候A协程（ID=2）为什么会被遍历出来？\r\n    }\r\n\r\n    $wg->add(1);\r\n    Coroutine::create(function()  use($wg) {\r\n        $Cid=Coroutine::getCid();\r\n        var_dump(\"B.新启动协程ID\".$Cid);\r\n        Coroutine::sleep(2);\r\n        $wg->done();\r\n    });\t\r\n    $wg->wait();  //  等待B协程运行结束\r\n\r\n    Coroutine::sleep(0.1);\r\n\r\n    foreach(Coroutine::list()  as $key=>$Cid){\r\n        var_dump(\"进程中正在运行的协程ID: \".$Cid); //  这里遍历的时候B协程（ID=3）为什么会被遍历出来？\r\n    }\r\n});\r\n```"
      },
      {
        "user": "twose",
        "created_at": "2020-02-22T04:43:55Z",
        "body": "你可以通过getBackTrace来看到B协程仍处于`$wg->done`那一行, 当你的主协程结束后才会重新返回到B协程并释放它\r\n"
      },
      {
        "user": "qifengzhang007",
        "created_at": "2020-02-22T07:53:35Z",
        "body": "@huanghantao @twose \r\n非常感谢两位，果然是大神。\r\n尤其是@huanghantao 使用代码示例的方式，通过本人运行对比结果，彻底理解了这个过程。"
      }
    ]
  },
  {
    "number": 3104,
    "title": "Closing websocket connection inside a process",
    "created_at": "2020-02-13T13:08:51Z",
    "closed_at": "2020-04-25T00:19:54Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3104",
    "body": "**1. What did you do? If possible, provide a simple script for reproducing the error.**\r\nI'm trying to handle the close connection of a websocket when the user closes the browser tab or refresh the page.\r\nFirst I tried to catch that client event with the 'close' event but is never fired when the browser tab or a page refresh is done. So currently I'm using the response of the push method (if its false I want to close the connection)\r\n\r\n```php\r\n$server->on('message', static function (swoole_websocket_server $server, $frame) use ($accounts) {\r\n    $requestData = JSON::decode($frame->data);\r\n    echo \"\\nGetting data...\\n\";\r\n\r\n    foreach ($accounts as $account) {\r\n        $process = new \\Swoole\\Process(function ($worker) use ($requestData, $account, $server, $frame) {\r\n            echo \"[child $worker->pid] started\\n\";\r\n            $worker->name('child process '. $worker->pid);\r\n            try {\r\n                $data = getData($requestData, $account);\r\n\r\n                $res = $server->push($frame->fd, JSON::encode($data));\r\n                var_dump($res);\r\n                if (!$res) {\r\n                    $server->close($frame->fd); // this wont close the websocket connection\r\n                }\r\n                $worker->exit(0);\r\n            } catch (Exception $e) {\r\n                echo \"\\nERROR from Account {$account}. {$e->getMessage()}\\n\";\r\n            }\r\n        });\r\n\r\n        $pid = $process->start();\r\n        $childProcesses[(string)$pid] = $process;\r\n    }\r\n\r\n    $workerNum = count($vendorAccounts);\r\n    for ($i = 0; $i < $workerNum; $i++) {\r\n        \\Swoole\\Process::wait(true);\r\n    }\r\n\r\n    $server->close($frame->fd);\r\n});\r\n\r\n$server->on('close', function($ser, $fd) {\r\n    echo \"\\nclient {$fd} CLOSED\\n\";\r\n});\r\n```\r\n\r\n\r\n**2. What did you expect to see?**\r\nI expect that the 'close' event being fired, so I can handle and kill all the child processes\r\n\r\n\r\n**3. What did you see instead?**\r\nclose event is never fired. It seems like I can't close the server connection inside a process.\r\n\r\n\r\n**4. What version of Swoole are you using (show your `php --ri swoole`)?**\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.15\r\nBuilt => Jan 22 2020 10:23:44\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n**5. What is your machine environment used (including version of kernel & php & gcc) ?**\r\nOS: Ubuntu 18.04.01\r\nKernel: 5.1.21-050121-generic\r\nPHP: 7.3.14-6+ubuntu18.04.1+deb.sury.org+1\r\nGCC: 7.4.0 (Ubuntu 7.4.0-1ubuntu1~18.04.1)\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3104/comments",
    "author": "akrz",
    "comments": [
      {
        "user": "twose",
        "created_at": "2020-02-14T09:40:06Z",
        "body": "onClose event is triggered based on the dispatch_mode, and your code is illegal\r\nyou can fork child process and let it send some messages to its parent but you can not share resources between them\r\n"
      }
    ]
  },
  {
    "number": 3096,
    "title": "websocket不能设置package_max_length吗？",
    "created_at": "2020-02-10T13:34:26Z",
    "closed_at": "2020-02-10T14:49:50Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3096",
    "body": "package_max_length虽然设了，并且设置了成功，但是设置open_length_check=true和open_eof_check=true，但是都不生效。是websocket不支持吗？还是我的配置有问题呢？\r\n设置如下：\r\n[\r\n        'open_http_protocol' => false,\r\n\t\t\"open_mqtt_protocol\"=> false,\r\n        'open_eof_check' => true,// 当发现内存占用已超过package_max_length时，将直接丢弃此数据，并关闭连接\r\n        'open_length_check' => true, //当发现包长度超过package_max_length，将直接丢弃此数据，并关闭连接，不会占用任何内存\r\n\t\t\"open_websocket_protocol\"=> true,\r\n\t\t\"worker_num\"=> 4, // 进程数\r\n        'task_worker_num' => 4,\r\n\t\t\"buffer_output_size\"=> 10240,\r\n\t\t\"max_connection\"=> 1024,\r\n        'daemonize' => false,\r\n        'backlog' => 128,\r\n        'user' => 'coding',\r\n\r\n        'package_eof' => \"\\r\\n\", //设置EOF\r\n        'package_max_length' => 5,// 设置最大数据包尺寸，单位为字节\r\n        //'heartbeat_idle_time' => 300,//表示连接最大允许空闲的时间\r\n        'heartbeat_check_interval' => 30000,//启用心跳检测，此选项表示每隔多久轮循一次，单位为秒，如果该连接在120秒内（heartbeat_idle_time未设置时默认为interval的两倍），没有向服务器发送任何数据，此连接将被强制关闭。\r\n        'package_length_type' => 'N',\r\n        'package_length_offset' => 8,\r\n        'package_body_offset' => 16,\r\n    ]\r\n\r\n\r\n{\r\n\t\"setting\": {\r\n\t\t\"open_http_protocol\": true,\r\n\t\t\"open_mqtt_protocol\": false,\r\n\t\t\"open_eof_check\": false,\r\n\t\t\"open_length_check\": false,\r\n\t\t\"open_websocket_protocol\": true,\r\n\t\t\"worker_num\": 4,\r\n\t\t\"task_worker_num\": 4,\r\n\t\t\"buffer_output_size\": 10240,\r\n\t\t\"max_connection\": 1024,\r\n\t\t\"daemonize\": false,\r\n\t\t\"backlog\": 128,\r\n\t\t\"user\": \"coding\",\r\n\t\t\"package_eof\": \"\\r\\n\",\r\n\t\t\"package_max_length\": 5,\r\n\t\t\"heartbeat_check_interval\": 30000,\r\n\t\t\"package_length_type\": \"N\",\r\n\t\t\"package_length_offset\": 8,\r\n\t\t\"package_body_offset\": 16\r\n\t},\r\n\t\"connections\": {},\r\n\t\"host\": \"0.0.0.0\",\r\n\t\"port\": 9502,\r\n\t\"type\": 1,\r\n\t\"mode\": 2,\r\n\t\"ports\": [{\r\n\t\t\"host\": \"0.0.0.0\",\r\n\t\t\"port\": 9502,\r\n\t\t\"type\": 1,\r\n\t\t\"sock\": 4,\r\n\t\t\"setting\": {\r\n\t\t\t\"open_http_protocol\": false,\r\n\t\t\t\"open_mqtt_protocol\": false,\r\n\t\t\t\"open_eof_check\": true,\r\n\t\t\t\"open_length_check\": true,\r\n\t\t\t\"open_websocket_protocol\": true,\r\n\t\t\t\"worker_num\": 4,\r\n\t\t\t\"task_worker_num\": 4,\r\n\t\t\t\"buffer_output_size\": 10240,\r\n\t\t\t\"max_connection\": 1024,\r\n\t\t\t\"daemonize\": false,\r\n\t\t\t\"backlog\": 128,\r\n\t\t\t\"user\": \"coding\",\r\n\t\t\t\"package_eof\": \"\\r\\n\",\r\n\t\t\t\"package_max_length\": 5,\r\n\t\t\t\"heartbeat_check_interval\": 30000,\r\n\t\t\t\"package_length_type\": \"N\",\r\n\t\t\t\"package_length_offset\": 8,\r\n\t\t\t\"package_body_offset\": 16\r\n\t\t},\r\n\t\t\"connections\": {}\r\n\t}],\r\n\t\"master_pid\": 14530,\r\n\t\"manager_pid\": 14531,\r\n\t\"worker_id\": 4,\r\n\t\"taskworker\": true,\r\n\t\"worker_pid\": 14534\r\n}",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3096/comments",
    "author": "juminut",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-02-10T14:49:50Z",
        "body": "package_max_length 最小值为 `64K`"
      },
      {
        "user": "juminut",
        "created_at": "2020-03-04T12:59:26Z",
        "body": "设置了package_max_length =65536后，open_length_check=true和open_eof_check=true，还是不生效。"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-03-04T13:06:13Z",
        "body": "@juminut 你是不是希望把`hello\\r\\n\\world\\r\\n`拆分为`hello`和`world`。如果是的话，可以试一试在配置中加入：\r\n\r\n```php\r\n$serv->set([\r\n    'open_eof_split' => true,\r\n]);\r\n```"
      },
      {
        "user": "juminut",
        "created_at": "2020-03-04T13:07:37Z",
        "body": "不，我是为了防止传大数据量的数据的攻击。所以限制下最大允许大小"
      },
      {
        "user": "juminut",
        "created_at": "2020-03-04T14:56:18Z",
        "body": "所以想设置open_length_check=true，来限制下"
      }
    ]
  },
  {
    "number": 3081,
    "title": "Is it possible to gzip file data when using Response->sendFile() ? ",
    "created_at": "2020-01-26T23:59:04Z",
    "closed_at": "2020-02-03T05:01:31Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3081",
    "body": "With `http_compression` enabled, I am successfully able to send responses with compressed JSON/HTML. \r\n\r\nHowever, if I use the sendFile() method to send a PDF, data appears to be sent to the client uncompressed.\r\n\r\n```php\r\n$filePath = '/path/to/file.pdf';\r\n$response->sendfile($filePath);\r\n```\r\nIs there a way in which I can send compressed file data? Do I just compress it myself before sending and add the appropriate header to the response?\r\n\r\nThanks very much!",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3081/comments",
    "author": "osrec",
    "comments": [
      {
        "user": "twose",
        "created_at": "2020-02-03T05:01:31Z",
        "body": "`sendfile` is a syscall, It can send files directly to save memory\r\nbut you can't sell the cow and drink the milk.\r\nif you want to compress the file, you must load the file to memory and then compress it, this way you can't get any from `sendfile`\r\n\r\n"
      }
    ]
  },
  {
    "number": 3052,
    "title": "Can we rely on websocket FD number not being repeated?",
    "created_at": "2020-01-07T17:26:22Z",
    "closed_at": "2020-01-13T11:28:32Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3052",
    "body": "This is a general question, not a bug, so I don't think the issue template applies.\r\n\r\nFor reference, I am using the latest version of swoole with PHP 7.4.0 on Alpine Linux (Docker).\r\n\r\nMy question: When running a websocket server, like so:\r\n\r\n```php\r\n$server = new Swoole\\WebSocket\\Server(\"0.0.0.0\", 9501);\r\n\r\n$server->on('message', function (Swoole\\WebSocket\\Server $server, $frame) \r\n{\r\n    echo \"receive from {$frame->fd}:{$frame->data},opcode:{$frame->opcode},fin:{$frame->finish}\\n\";\r\n    $server->push($frame->fd, \"this is server\");\r\n});\r\n```\r\nis it safe to assume that `$frame->fd` will be the same for messages for the same connection?\r\n\r\nAlso, if a particular `$frame->fd` is re-used, will this only be after an explicit `onClose` event?\r\n\r\nThe background for this question is that we want to allow users to log in via a websocket, and want to check whether it is sufficient to just authenticate users at the start and maintain a list of authenticated FDs on the backend, or whether we need to get the client to send us a session ID/token with every frame.\r\n\r\nThanks!",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3052/comments",
    "author": "osrec",
    "comments": [
      {
        "user": "twose",
        "created_at": "2020-01-09T03:09:31Z",
        "body": "> is it safe to assume that $frame->fd will be the same for messages for the same connection?\r\n\r\nyes, fd is almost never reused (unless it exceeds 16000k)\r\n"
      },
      {
        "user": "osrec",
        "created_at": "2020-01-10T00:24:00Z",
        "body": "Great, thank you! So basically only after FD > 16 million will it repeat?"
      },
      {
        "user": "matyhtf",
        "created_at": "2020-01-12T03:44:18Z",
        "body": "@osrec Yes,  it will skip the fd in use"
      },
      {
        "user": "osrec",
        "created_at": "2020-01-15T00:57:01Z",
        "body": "thanks for your help @matyhtf and @twose :)"
      }
    ]
  },
  {
    "number": 3048,
    "title": "socket超时问题",
    "created_at": "2019-12-31T08:50:24Z",
    "closed_at": "2019-12-31T09:57:59Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3048",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n```\r\nlinux  4.18.20\r\nswoole 4.3.6\r\nphp 7.1.2\r\n```\r\n\r\n我发现有一些通过Client创建的tcp连接, 线上超时很多, 而超时发生的时刻, tcp连接对方表示没有收到socket数据, 我怀疑是write_timeout这个参数没设置好, 导致未完成快速重传\r\n\r\n就是假如tcp包被ip层分为了几个分片, 其中一个分片在传输过程中丢失, 而此时write_timeout时间已过, 导致未完成重传, 对方就未收到完整的包\r\n\r\n还是说write_timeout只是将待发送数据放入到发送队列的超时时间, 底层tcp重传完全由linux内核负责?\r\n\r\n这种对方表示未收到数据, 而我这里send返回值等于发送数据字节数的情况下, 有什么办法排查呢? 线上持续开一个tcpdump抓包吗?\r\n\r\n```\r\n$sConn = new \\Swoole\\Coroutine\\Client(SWOOLE_SOCK_TCP);\r\n$sConn->set([\r\n    'connect_timeout'       => 0.1,\r\n    'write_timeout'         => 0.3,\r\n    'read_timeout'          => 0.7,\r\n    'open_length_check'     => true,\r\n    'package_length_type'   => 'V',\r\n    'package_length_offset' => 6,\r\n    'package_body_offset'   => 10,\r\n    'package_max_length'    => 1024 * 1024 * 4,\r\n    'socket_buffer_size'    => 1024 * 1024 * 8,\r\n    'open_tcp_nodelay'      => true,\r\n]);\r\n```\r\n\r\nrecv超时连接错误信息\r\n```\r\n{\r\n    \"conn\": {\r\n        \"errCode\": 110,\r\n        \"errMsg\": \"Connection timed out\",\r\n        \"sock\": 38,\r\n        \"type\": 1,\r\n        \"setting\": {\r\n            \"connect_timeout\": 0.1,\r\n            \"write_timeout\": 0.3,\r\n            \"read_timeout\": 0.7,\r\n            \"open_length_check\": true,\r\n            \"package_length_type\": \"V\",\r\n            \"package_length_offset\": 6,\r\n            \"package_body_offset\": 10,\r\n            \"package_max_length\": 4194304,\r\n            \"socket_buffer_size\": 8388608,\r\n            \"open_tcp_nodelay\": true\r\n        },\r\n        \"connected\": true\r\n    }\r\n}\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3048/comments",
    "author": "lgxxaq",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-12-31T09:19:04Z",
        "body": "write_timeout是指超过这个时间没有等待到socket可写事件(缓冲区持续未空), 不再继续尝试写入数据\r\n\r\n> 还是说write_timeout只是将待发送数据放入到发送队列的超时时间, 底层tcp重传完全由linux内核负责?\r\n\r\n所以是的, 只是写到写缓冲区的超时\r\n\r\n> 这种对方表示未收到数据, 而我这里send返回值等于发送数据字节数的情况下, 有什么办法排查呢? \r\n\r\n外网不稳定因素太多了, send返回值只表示成功写入缓冲区的长度, 不代表对端一定能收到, 除非对端收完后返回一个response, 这就是上层的协议问题了, 排查的话自然能自己抓包监控流量是最好的\r\n"
      },
      {
        "user": "twose",
        "created_at": "2019-12-31T09:20:37Z",
        "body": "如果你的带宽不够, write_timeout可以大一点, 太小了\r\nsocket_buffer_size有点太大了, 协程其实不需要那么大, 当然视你的具体情况而定"
      },
      {
        "user": "lgxxaq",
        "created_at": "2019-12-31T09:57:50Z",
        "body": "@twose 好的,我抓包排查下呢"
      },
      {
        "user": "giantwu",
        "created_at": "2021-01-26T03:26:59Z",
        "body": "@lg430  请问您的问题有结果了吗？我们线上的 Swoole\\Coroutine\\Http\\Client  也发现了类似的问题，内网调用。"
      }
    ]
  },
  {
    "number": 3047,
    "title": " \\Swoole\\Process\\Pool 与 \\Swoole\\Async\\Client 不能正常运行",
    "created_at": "2019-12-31T04:08:22Z",
    "closed_at": "2019-12-31T06:10:07Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3047",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n```php\r\n        $pool = new \\Swoole\\Process\\Pool($this->workerNum);\r\n        $pool->on(\"WorkerStart\", function (Pool $pool, $workerId) {\r\n            echo 'WorkerStart: '. $workerId.\"\\n\";\r\n\r\n            $socket = new \\Swoole\\Async\\Client(SWOOLE_SOCK_TCP);\r\n            $socket->on(\"connect\", function(swooleClient $cli) {\r\n                $this->output->writeln('connect start');\r\n            });\r\n            $socket->on(\"receive\", function(swooleClient $cli, $data){\r\n                echo 'receive'.\"\\n\";\r\n            });\r\n            $socket->on(\"error\", function(swooleClient $cli){\r\n                echo \"error\\n\";\r\n            });\r\n            $socket->on(\"close\", function(swooleClient $cli){\r\n                echo \"Connection close\\n\";\r\n            });\r\n            $socket->connect('106.11.210.209', 8003);\r\n        });\r\n\r\n        $pool->on(\"WorkerStop\", function ($pool, $workerId) {\r\n            echo 'WorkerStop '.$workerId.\"\\n\";\r\n        });\r\n\r\n        $pool->start();\r\n```\r\n\r\n\r\n2. What did you expect to see?\r\n我需望子进程中的 异步客户端能正常运行.\r\n\r\n我的原始需求是.建多信进程,每个程序都连接到服务上面,等待接收数据并处理\r\n(或是按我的需求给出解决方案 ^!^)\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.14\r\nBuilt => Dec 27 2019 10:20:15\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.0.2k-fips  26 Jan 2017\r\npcre => enabled\r\nzlib => 1.2.7\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n\r\n\r\nswoole_async\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.14\r\nBuilt => Dec 31 2019 11:07:29\r\ndebug => enabled\r\ntrace_log => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3047/comments",
    "author": "km3945",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-12-31T06:10:07Z",
        "body": "在 `onWorkerStart`回调函数 末尾添加 `Swoole\\Event::wait()`"
      }
    ]
  },
  {
    "number": 3042,
    "title": "协程server信号捕获的疑问",
    "created_at": "2019-12-27T06:27:54Z",
    "closed_at": "2019-12-27T06:37:38Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3042",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n我在使用协程版http server时需要捕获程序退出信号，比如SIGINT/SIGTERM，但根据文档并不能很好理解如何使用，以下是几个尝试的写法，有的能捕获，但不优雅，有的就报错或无法捕获\r\n\r\n① 使用Process::signal()，在scheduler->start()之前绑定函数，直接报错了: eventLoop has already been created，在start之后写又无法捕获信号\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Coroutine;\r\nuse Swoole\\Coroutine\\Http\\Server;\r\nuse Swoole\\Event;\r\nuse Swoole\\Process;\r\nuse Swoole\\Timer;\r\n\r\n\r\n$scheduler = new Coroutine\\Scheduler();\r\n\r\n$handler = function ($signal) {\r\n    echo 'Caught signal: ' . $signal . PHP_EOL;\r\n\r\n    Event::exit();\r\n};\r\n\r\nProcess::signal(SIGINT, $handler);\r\n\r\n$scheduler->add(function () {\r\n    echo 'Starting server ...' . PHP_EOL;\r\n\r\n    $server = new Server('127.0.0.1', 3003);\r\n    $server->start();\r\n});\r\n\r\n$scheduler->start();\r\n```\r\n② 使用pcntl_signal() + pcntl_async_signals(true)，无法捕获信号\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Coroutine;\r\nuse Swoole\\Coroutine\\Http\\Server;\r\nuse Swoole\\Event;\r\nuse Swoole\\Process;\r\nuse Swoole\\Timer;\r\n\r\n\r\n$scheduler = new Coroutine\\Scheduler();\r\n\r\n$handler = function ($signal) {\r\n    echo 'Caught signal: ' . $signal . PHP_EOL;\r\n\r\n    Event::exit();\r\n};\r\n\r\npcntl_async_signals(true);\r\npcntl_signal(SIGINT, $handler);\r\n\r\n$scheduler->add(function () {\r\n    echo 'Starting server ...' . PHP_EOL;\r\n\r\n    $server = new Server('127.0.0.1', 3003);\r\n    $server->start();\r\n});\r\n\r\n$scheduler->start();\r\n```\r\n③ 使用pcntl_signal() + pcntl_signal_dispatch() + Timer::tick() 能捕获信号，但不够优雅\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Coroutine;\r\nuse Swoole\\Coroutine\\Http\\Server;\r\nuse Swoole\\Event;\r\nuse Swoole\\Process;\r\nuse Swoole\\Timer;\r\n\r\n\r\n$scheduler = new Coroutine\\Scheduler();\r\n\r\n$handler = function ($signal) {\r\n    echo 'Caught signal: ' . $signal . PHP_EOL;\r\n\r\n    Event::exit();\r\n};\r\n\r\npcntl_signal(SIGINT, $handler);\r\n\r\n\r\n$scheduler->add(function () {\r\n    echo 'Starting server ...' . PHP_EOL;\r\n\r\n    Timer::tick(1000, function () {\r\n        pcntl_signal_dispatch();\r\n    });\r\n\r\n    $server = new Server('127.0.0.1', 3003);\r\n    $server->start();\r\n});\r\n\r\n$scheduler->start();\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n使用某个最佳实践的写法实现信号捕获和程序平滑退出\r\n\r\n3. What did you see instead?\r\n\r\n所以我想知道，怎样才是符合最佳实践的写法？我在文档中没看到相关介绍，谢谢\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nswoole: 4.4.14\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nphp: 7.4.1\r\ngcc: 7.3.0\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3042/comments",
    "author": "crystoy",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-12-27T06:37:37Z",
        "body": "```php\r\nuse Swoole\\Coroutine;\r\nuse Swoole\\Coroutine\\Http\\Server;\r\nuse Swoole\\Process;\r\n\r\nCoroutine\\run(function () {\r\n    echo 'Starting server ...' . PHP_EOL;\r\n    $server = new Server('127.0.0.1', 3003);\r\n    Process::signal(SIGINT, function (int $signal) use ($server) {\r\n        echo 'Caught signal: ' . $signal . PHP_EOL;\r\n        $server->shutdown();\r\n    });\r\n    $server->start();\r\n});\r\n\r\n```"
      },
      {
        "user": "crystoy",
        "created_at": "2019-12-27T07:08:11Z",
        "body": "建议在文档中增加范例（或是已经有了，我没找到？），以免像我这样的新手多走弯路和反复提问，感谢大佬"
      },
      {
        "user": "twose",
        "created_at": "2019-12-27T09:03:40Z",
        "body": "程序骨架里应该写了scheduler相当于main函数, 那么所有代码理应放在scheduler中"
      },
      {
        "user": "crystoy",
        "created_at": "2019-12-27T09:10:40Z",
        "body": "好的，之前理解不到位。貌似当时考虑的一个问题是进程池不能在协程中创建，所以把信号处理单独拿出来打算公用的...现在加了判断已经完美解决了，多谢"
      }
    ]
  },
  {
    "number": 3007,
    "title": "swoole 4.2.1 版本 Coroutine\\Redis bug",
    "created_at": "2019-12-06T04:50:02Z",
    "closed_at": "2019-12-06T05:03:48Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3007",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n在调用redis的任何方法时，故意让多个协程同时调用单个redis实例，目的是让其出现错误，比如会出现以下警告错误信息：\r\nerrorCode:2;\r\nerrorMsg:redis client is waiting for response.\r\n这个警告是准确的，问题在于，出现这个错误后，再次使用单个协程调用redis时，当redis执行成功后，redis实例的errorCode和errorMsg没有被重置，还是返回上次失败时的信息\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n在redis调用失败后，再次调用没有重置上次的错误信息\r\n\r\n3. What did you see instead?\r\n\r\n期望是在redis调用失败后，再次调用之前能重置上次的错误信息\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n版本 4.2.1\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nphp 7.1  \r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3007/comments",
    "author": "shh12580",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-12-06T05:03:48Z",
        "body": "错误信息是配合返回值查看的，返回值不为false时错误信息无效"
      }
    ]
  },
  {
    "number": 3006,
    "title": "swoole/library 使用 composer 引入, 提示常量未定义",
    "created_at": "2019-12-06T03:53:20Z",
    "closed_at": "2019-12-06T03:57:42Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3006",
    "body": "在尝试禁用自带的 `swoole/library` 改用 `composer require swoole/library`\r\n\r\n会提示以下错误:\r\n\r\n```\r\nPHP Warning:  Use of undefined constant SWOOLE_USE_SHORTNAME - assumed 'SWOOLE_USE_SHORTNAME' (this will throw an Error in a future version of PHP) in /xxx/vendor/swoole/library/src/functions.php on line 2\r\nPHP Warning:  Use of undefined constant SWOOLE_USE_SHORTNAME - assumed 'SWOOLE_USE_SHORTNAME' (this will throw an Error in a future version of PHP) in /xxx/vendor/swoole/library/src/alias.php on line 2\r\nPHP Warning:  Use of undefined constant SWOOLE_USE_SHORTNAME - assumed 'SWOOLE_USE_SHORTNAME' (this will throw an Error in a future version of PHP) in /xxx/vendor/swoole/library/src/alias_ns.php on line 16\r\n```\r\n\r\n目前解决方案, 自行在项目代码中添加:\r\n\r\n```php\r\ndefine('SWOOLE_USE_SHORTNAME', true);\r\n```\r\n\r\n### 期望解决方式\r\n\r\n#### 方案一:\r\n\r\n`SWOOLE_USE_SHORTNAME`  在 swoole 扩展中定义\r\n\r\n#### 方案二:\r\n\r\n判断添加 `defined` 条件\r\n\r\n- `swoole/library/src/functions.php`\r\n- `swoole/library/src/alias.php`\r\n- `swoole/library/src/alias_ns.php`\r\n\r\n```php\r\nif (defined('SWOOLE_USE_SHORTNAME') && SWOOLE_USE_SHORTNAME) {\r\n    //...\r\n}\r\n```\r\n\r\n### `php.ini` 配置\r\n\r\n```\r\nextension=swoole.so\r\n\r\n; Configuration\r\nswoole.enable_library = Off\r\nswoole.use_shortname = On\r\n```\r\n\r\n\r\n### `php -ri swoole`\r\n\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.12\r\nBuilt => Nov  4 2019 15:44:24\r\ncoroutine => enabled\r\ntrace_log => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.0.2k-fips  26 Jan 2017\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => 1.2.7\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => Off => Off\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3006/comments",
    "author": "Moln",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-12-06T03:57:42Z",
        "body": "最低需要Swoole-v4.4.13\r\n你手动定义作为兼容补丁也可以"
      }
    ]
  },
  {
    "number": 2976,
    "title": "tcp_server中添加自定义进程问题",
    "created_at": "2019-11-25T06:29:51Z",
    "closed_at": "2019-11-25T10:39:02Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2976",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n```\r\n$serv = new \\Swoole\\Server($host, $port);\r\n$serv->addProcess($processA);\r\n$serv->addProcess($processB);\r\n\r\npublic function onWorkerStart()\r\n{\r\n// ...\r\n\r\n$processA->setBlocking(false);\r\n$processB->setBlocking(false);\r\n}\r\n\r\npublic function onReceive()\r\n{\r\n// ...\r\n\r\n$processA->write($msg)\r\n$processB->write($msg)\r\n}\r\n```\r\n\r\n2. What did you expect to see?\r\n3. What did you see instead?\r\n我现在使用了两个额外的进程来分别处理写日志和上报数据, 每当我在onReceive完成处理后, 就分发数据给这两个进程, 问题是我在onReceive这里连续发送两次消息貌似有点不合理且费时, 能一次发送广播给这两个进程吗?\r\n\r\n另外我之前是通过在onReceive发送给$processA, 然后$processA再发送给$processB, 这样虽然只在onReceive发送一次, 但是$processB->setBlocking(false);这一行就失效了, 也就是在processA中发送给processB的管道始终是阻塞的, 请问有其他方法实现worker和process通信的方式吗或者我应该如何改呢\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nswoole => 4.3.6\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\nphp 7.1.2\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2976/comments",
    "author": "lgxxaq",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-11-25T07:23:03Z",
        "body": "为什么不用协程"
      },
      {
        "user": "lgxxaq",
        "created_at": "2019-11-25T08:18:48Z",
        "body": "文档如是说\r\n```\r\n添加一个用户自定义的工作进程。此函数通常用于创建一个特殊的工作进程，用于监控、上报或者其他特殊的任务。\r\n```\r\n\r\n而我确实是需要一个进程单独上报注册中心呢"
      },
      {
        "user": "twose",
        "created_at": "2019-11-25T08:20:33Z",
        "body": "不要死读书，协程是更好的选择，直接新开一个协程去上报就好了"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-11-25T10:39:23Z",
        "body": "1. 循环发送\r\n2. 已经是非阻塞的，不需要再次设置"
      }
    ]
  },
  {
    "number": 2969,
    "title": "Swoole\\Runtime::enableCoroutine() and cURL",
    "created_at": "2019-11-22T04:17:33Z",
    "closed_at": "2019-11-22T07:39:07Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2969",
    "body": "Hi Swoole Team\r\n\r\nDoes `Swoole\\Runtime::enableCoroutine()` make all socket communication async? For example, would it make cURL requests in PHP async?\r\n\r\nThanks!\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2969/comments",
    "author": "osrec",
    "comments": [
      {
        "user": "huangzhhui",
        "created_at": "2019-11-22T05:45:39Z",
        "body": "`\\Swoole\\Runtime::enableCoroutine(SWOOLE_HOOK_ALL | SWOOLE_HOOK_CURL)`"
      },
      {
        "user": "osrec",
        "created_at": "2019-11-23T07:12:06Z",
        "body": "Thank you!"
      }
    ]
  },
  {
    "number": 2965,
    "title": "异步tcp异常",
    "created_at": "2019-11-20T07:27:59Z",
    "closed_at": "2019-11-20T08:04:03Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2965",
    "body": "**异常：**\r\nPHP Fatal error:  Swoole\\Client::__construct(): please install the ext-async extension, using Swoole\\Async\\Client in /Users/xx/workerspace/cli/sw/async_client.php on line 9\r\n\r\nFatal error: Swoole\\Client::__construct(): please install the ext-async extension, using Swoole\\Async\\Client in /Users/xx/workerspace/cli/sw/async_client.php on line 9\r\n\r\n**运行环境**\r\n~/workerspace/cli/sw(master ✗) php --ri swoole\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.12\r\nBuilt => Nov 20 2019 14:19:55\r\ncoroutine => enabled\r\nkqueue => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.0.2t  10 Sep 2019\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nbrotli => 16777223/16777223\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.display_errors => On => On\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.unixsock_buffer_size => 262144 => 262144\r\nswoole.use_shortname => On => On\r\n\r\n~/workerspace/cli/sw(master ✗) php --ri swoole_async \r\n\r\nswoole_async\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.12\r\nBuilt => Nov 20 2019 13:14:08\r\ndebug => enabled\r\ntrace_log => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nPHP 7.3.11 (cli) (built: Oct 24 2019 11:29:00) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.3.11, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.3.11, Copyright (c) 1999-2018, by Zend Technologies\r\n\r\n系统是MAC\r\n\r\n大家知道是什么原因吗？\r\n安装了几次。报同样的错误？\r\n\r\n**安装过程**\r\nswoole-src\r\nphpize\r\n./configure --enable-openssl --enable-http2 --enable-mysqlnd --enable-sockets --enable-debug-log --with-php-config=/usr/local/Cellar/php/7.3.11/bin/php-config\r\nmake && make install\r\n\r\nasync-ext\r\nphpize\r\n./configure\r\nmake && make install \r\n\r\n**运行的代码是官方示例：**\r\n$client = new swoole_client(SWOOLE_SOCK_TCP, SWOOLE_SOCK_ASYNC);\r\n\r\n//注册连接成功回调\r\n$client->on(\"connect\", function($cli) {\r\n    $cli->send(\"hello world\\n\");\r\n});\r\n\r\n//注册数据接收回调\r\n$client->on(\"receive\", function($cli, $data){\r\n    echo \"Received: \".$data.\"\\n\";\r\n});\r\n\r\n//注册连接失败回调\r\n$client->on(\"error\", function($cli){\r\n    echo \"Connect failed\\n\";\r\n});\r\n\r\n//注册连接关闭回调\r\n$client->on(\"close\", function($cli){\r\n    echo \"Connection close\\n\";\r\n});\r\n\r\n//发起连接\r\n$client->connect('127.0.0.1', 9501, 0.5);",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2965/comments",
    "author": "qingdi",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-11-20T08:04:03Z",
        "body": "请安装 `ext-async`扩展,最新的版本中已经彻底移除了异步回调的 API,或者使用 协程 API"
      },
      {
        "user": "qingdi",
        "created_at": "2019-11-20T08:40:12Z",
        "body": "版本问题：统一使用了4.4.7。async，swoole都使用了4.4.7版本。解决了。多谢。多谢。"
      },
      {
        "user": "mitsh",
        "created_at": "2019-12-19T11:53:56Z",
        "body": "@matyhtf can you provide an example for coroutine tcp client like identical to Swoole\\Async\\Client?"
      }
    ]
  },
  {
    "number": 2959,
    "title": "How to execute swoole code in php-fpm?",
    "created_at": "2019-11-17T00:55:22Z",
    "closed_at": "2019-11-20T08:46:05Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2959",
    "body": "I have a php-fpm compatible php file that is too big to port to swoole code.\r\n\r\nSo these are the approaches I am attempting.\r\n\r\n1. Run the php-fpm compatible php file in swoole, but I dont know how to make swoole execute such code. This is my preferred method, but I just dont know how.\r\n\r\n2. I can port my swoole code in a php-fpm compatible php file but it is also to huge to port back to regular php file.\r\n\r\nSo this is my recent attempt run the php file from php-fpm and create a code that looks like this:\r\n\r\nindex.php\r\n```php\r\n<?php\r\nstart swoole\r\nmy swoole codes\r\nend swoole\r\n\r\n#include php-fpm-compatible.php\r\n\r\nstart swoole\r\nother swoole code\r\nend swoole\r\n\r\n?>\r\n```\r\n\r\nHow do I include a swoole code and run it from php-fpm? Solution to no. 1 would also be appreciated.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2959/comments",
    "author": "jobs-git",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-11-18T03:57:55Z",
        "body": "We have no plan to support FPM anymore\r\nOnly sync Client is available in FPM"
      },
      {
        "user": "jobs-git",
        "created_at": "2019-11-18T13:21:22Z",
        "body": "Yes, I understand the plan, I dont want it either, I am just stuck with the FPM old code. I dont know sync client, how does it work in FPM? Is it possible to run my swoole codes from php-fpm?"
      },
      {
        "user": "twose",
        "created_at": "2019-11-19T03:52:01Z",
        "body": "The conversion between the two modes takes time to refactor\r\nI think you could give up this idea\r\n"
      }
    ]
  },
  {
    "number": 2948,
    "title": "Request named parameters for prepared statements in Co\\Mysql",
    "created_at": "2019-11-09T19:29:54Z",
    "closed_at": "2019-11-11T06:10:03Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2948",
    "body": "**This is the current way to use:**\r\n\r\n`$stmt = $mysql->prepare('INSERT INTO users SET name = ?, password = ?');`\r\n`$stmt->execute([\r\n                $name,\r\n                hashPassword($password)\r\n            ]);`\r\n\r\n\r\n**This is what I want**\r\n`$stmt = $mysql->prepare('INSERT INTO users SET name = :name, password = :pass');`\r\n`$stmt->execute([\r\n               'name' => $name,\r\n                'pass' => hashPassword($password)\r\n            ]);`\r\n\r\nThis may be in this example not be very important, but it gets more important if you use a value multiple times in your statement like:\r\n`SELECT * FROM users WHERE name = :name OR oldname = :name`\r\n\r\nEven though, named statements make long queries easier to understand.\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2948/comments",
    "author": "Kapsonfire",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-11-11T06:10:02Z",
        "body": "This is the pdo client simulation implementation, mysql does not support. \r\n\r\nYou can use the PDO client with runtime hook."
      }
    ]
  },
  {
    "number": 2905,
    "title": "Socket::recvAll 获得的结果和预想的不太一样。",
    "created_at": "2019-10-23T05:56:36Z",
    "closed_at": "2019-10-23T08:26:58Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2905",
    "body": "```php\r\n<?php\r\n\r\nuse Swoole\\Process;\r\n\r\n$process = new Process(function (Process $process) {\r\n    $socket = $process->exportSocket();\r\n    $head = $socket->recvAll(4,1);\r\n    var_dump($head);\r\n    $len = unpack('Nlen', $head)['len'];\r\n    var_dump($len);\r\n    $data = $socket->recvAll($len,1);\r\n    var_dump($data);\r\n\r\n    $socket->send('xxxx');\r\n}, false, 2, true);\r\n\r\n$process->start();\r\n\r\nSwoole\\Coroutine\\Run(function () use ($process) {\r\n    $socket = $process->exportSocket();\r\n    $data = 'Hello World.';\r\n    $socket->sendAll(pack('N', strlen($data)) . $data);\r\n    $socket->sendAll(pack('N', strlen($data)) . $data);\r\n    var_dump('send');\r\n    $socket->recv();\r\n});\r\n```\r\n\r\n结果\r\n\r\n```\r\n$ php demo.php\r\nstring(4) \"send\"\r\nstring(4) \"\r\n           \"\r\nint(12)\r\nstring(12) \"\r\n            Hello Wo\"\r\n```\r\n\r\n预想结果应该是\r\n\r\n```\r\n$ php demo.php\r\nstring(4) \"send\"\r\nstring(4) \"\r\n           \"\r\nint(12)\r\nstring(12) \"Hello World.\"\r\n```\r\n\r\n麻烦帮忙看一下。。。",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2905/comments",
    "author": "limingxinleo",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-10-23T08:26:58Z",
        "body": "pipe type 设置为 2 (SOCK_DGRAM) 模式下, 不是流式传输的, 直接send和recv即可"
      },
      {
        "user": "limingxinleo",
        "created_at": "2019-10-23T08:36:34Z",
        "body": "怪不得，我怎么看代码，怎么觉得没问题。。。"
      }
    ]
  },
  {
    "number": 2889,
    "title": "sendto to reactor failed",
    "created_at": "2019-10-16T04:27:13Z",
    "closed_at": "2019-10-17T03:57:57Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2889",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n[2019-10-16 02:00:22 *590.6]    WARNING swFactoryProcess_finish(:472): sendto to reactor failed, Error: No buffer space available[105]\r\n\r\n网上并没有搜索到这个错误信息, 请问是哪里的问题呢 ?\r\n\r\n\r\n```\r\n        self::$serv = new \\Swoole\\Server(self::$sconfig['server']['host'], self::$sconfig['server']['port']);\r\n        self::$serv->set([\r\n            'daemonize'             => 1,\r\n            'reactor_num'           => 8,\r\n            'worker_num'            => 8,\r\n            'max_request'           => 0,\r\n            'dispatch_mode'         => 1,\r\n            'log_file'              => LOG_PATH . '/error.log',\r\n            'open_length_check'     => true,\r\n            'package_max_length'    => 1024 * 1024 * 2,\r\n            'package_length_offset' => 6,\r\n            'package_length_type'   => 'V',\r\n            'package_body_offset'   => 10,\r\n            'socket_buffer_size'    => 1024 * 1024 * 64,\r\n            'buffer_output_size'    => 1024 * 1024 * 10,\r\n            'open_tcp_nodelay'      => true,\r\n            'enable_reuse_port'     => true,\r\n            'open_cpu_affinity'     => true,\r\n        ]);\r\n```\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nswoole\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.3.6\r\nBuilt => Aug 26 2019 16:10:16\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.0.1e-fips 11 Feb 2013\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nlinux kernel: 4.18.7\r\nphp: 7.1.2\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2889/comments",
    "author": "lgxxaq",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-10-16T06:41:04Z",
        "body": "请看一下内核参数怎么设置的\r\n\r\n```\r\nnet.ipv4.tcp_mem  =   379008       505344  758016\r\nnet.ipv4.tcp_wmem = 4096        16384   4194304\r\nnet.ipv4.tcp_rmem = 4096          87380   4194304\r\nnet.core.wmem_default = 8388608\r\nnet.core.rmem_default = 8388608\r\nnet.core.rmem_max = 16777216\r\nnet.core.wmem_max = 16777216\r\n```\r\n\r\n系统内存是否不足"
      },
      {
        "user": "lgxxaq",
        "created_at": "2019-10-16T09:36:49Z",
        "body": "@matyhtf  这是昨晚2点的日志, 存在大量客户端主动断开了链接导致swoole服务端send失败, 持续了一分钟就正常了, 监控显示系统内存只占了3%, 所以应该不是内存不足.\r\n\r\n我这由于运维不让修改线上机器内核参数(Docker模板), 所以都是默认.\r\nnet.ipv4.tcp_mem = 1538709\t2051613\t3077418\r\nnet.ipv4.tcp_wmem = 4096\t65536\t16777216\r\nnet.ipv4.tcp_rmem = 4096\t87380\t16777216\r\n其他的查不到了\r\n\r\n只是想确认下什么情况下会出现这个问题, 是socket缓冲区满了吗, 只能通过修改内核参数处理吗"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-10-16T09:57:49Z",
        "body": "这是由于内核 大块连续内存不足引起的。在内核层面 socket 缓存区分配内存失败导致。"
      },
      {
        "user": "twose",
        "created_at": "2019-10-17T03:43:06Z",
        "body": "socket_buffer_size\r\nbuffer_output_size\r\n调的也忒大了\r\n"
      },
      {
        "user": "lgxxaq",
        "created_at": "2019-10-17T05:14:51Z",
        "body": "@twose 之前这两个参数都没设置(默认), 发现上面的错误日志后才加上的, 结果两种情况下都有上面这个错误"
      },
      {
        "user": "minguo",
        "created_at": "2019-12-02T10:24:16Z",
        "body": "我也遇到这个问题,版本也是4.3.6,然后过了一段时间发现用swoole client连接server,发现连接被拒绝了\r\n\r\n现在也找不到原因~~~~"
      }
    ]
  },
  {
    "number": 2884,
    "title": "互斥锁的使用限制问题",
    "created_at": "2019-10-14T04:14:27Z",
    "closed_at": "2019-10-15T02:24:56Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2884",
    "body": "我想使用跨进程的互斥锁, 目前php可以通过flock或借助redis实现, 但不是太想使用这两种方式,\r\n\r\nswoole提供了基于内存的lock, 但文档说明不能用于协程环境,\r\n\r\n请问后续swoole会支持无任何限制的lock吗, 或者有其他方式实现全局互斥锁吗?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2884/comments",
    "author": "lgxxaq",
    "comments": [
      {
        "user": "huanghantao",
        "created_at": "2019-10-14T08:15:34Z",
        "body": "@lg430 目前的锁如果开发者使用不当，会造成同一个进程与自己死锁。\r\n今年的PHP大会上，好像说是不打算实现协程之间的锁机制。推荐使用channel。"
      },
      {
        "user": "lgxxaq",
        "created_at": "2019-10-14T09:05:45Z",
        "body": "@huanghantao 是全局互斥锁, 跨进程跨协程, 这个使用场景太多了, 很需要 (开发者使用不当这个是开发者的问题)"
      },
      {
        "user": "Yurunsoft",
        "created_at": "2019-10-14T09:09:01Z",
        "body": "+1，强烈建议增加跨进程的，支持协程的锁"
      },
      {
        "user": "twose",
        "created_at": "2019-10-15T02:16:20Z",
        "body": "能用于协程环境, 死锁问题需要自己编程解决"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-10-15T02:24:56Z",
        "body": "channel + 进程间通信的方式实现起来有一些复杂，而且只能本应用内使用。\r\n\r\n建议使用 redis 或者 Swoole\\Server 实现分布式锁，客户端使用 Coroutine\\Client \r\n\r\nCSP 编程的核心理念就是用 消息通信代替 数据同步和锁的机制。"
      },
      {
        "user": "huanghantao",
        "created_at": "2019-10-15T02:28:05Z",
        "body": "> @huanghantao 是全局互斥锁, 跨进程跨协程, 这个使用场景太多了, 很需要 (开发者使用不当这个是开发者的问题)\r\n\r\n其实进程之间怎么用，不同进程中的协程里面就可以怎么用。在同一个进程里面的多个协程里面使用就需要注意了，因为同一个进程里面的协程切来切去就自己锁死自己了，毕竟这个锁的粒度不是协程级别的。"
      }
    ]
  },
  {
    "number": 2877,
    "title": "Unhandled HTTP request from a TCP Server",
    "created_at": "2019-10-09T12:28:27Z",
    "closed_at": "2019-10-09T12:33:06Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2877",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n```\r\n$serv = new Swoole\\Server('0.0.0.0', 9501, SWOOLE_BASE, SWOOLE_SOCK_TCP);\r\n$serv->set([\r\n  \"open_http_protocol\" => true,\r\n]);\r\n$serv->on('request', function (Request $request,  Response $response) {\r\n  $response->end('Hello Swoole. #'.rand(1000, 9999).');\r\n});\r\n$serv->start();\r\n```\r\n```\r\nPHP Warning:  Swoole\\Server::start(): use Swoole\\Server class and open http related protocols may lead to some errors (inconsistent class type) in test.php on line 9\r\n```\r\n2. What did you expect to see?\r\n\r\n    Http request should be denied by default.\r\n\r\n3. What did you see instead?\r\n\r\n    Http connection is established for a TCP server and I have to configure `open_http_protocol` in order to handle unexpected http request.\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n```\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.1\r\nBuilt => Jul 29 2019 03:59:14\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\n    `Linux 3.10.0-957.1.3.el7.x86_64`\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2877/comments",
    "author": "tsuijie",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-10-09T12:32:41Z",
        "body": "HTTP is based on TCP\r\nVerify that the package is your responsibility, not Swoole\r\nAny illegal package is possible, not just HTTP\r\n"
      }
    ]
  },
  {
    "number": 2864,
    "title": "关于废弃 swoole_event_wait() 的一点小疑问",
    "created_at": "2019-10-01T09:13:44Z",
    "closed_at": "2019-10-08T03:36:13Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2864",
    "body": "想知道swoole_event_wait() 为什么要废弃？是因为名字和协程不搭吗，一些老业务改协程的时候或者协程嵌套较多的场景下 swoole_event_wait() 方式明显比写Scheduler 或者 waitgroup 要方便的多。",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2864/comments",
    "author": "xchl",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-10-08T03:36:13Z",
        "body": "和名字没有关系\r\nevent_wait和waitgroup不是一个性质\r\n\r\nevent_wait是等待事件循环结束的\r\nwaitgroup是控制协程调度的\r\n\r\nevent_wait结束代表着整个事件循环结束 所有事件循环的设施都会**销毁**\r\nevent_wait后在此之前创建的连接等资源都会被释放\r\n\r\nscheduler是为了隔离多个事件循环, 保证程序能够干净地运行, 而不是混杂在一起\r\n\r\n良好设计的程序, 整个生命周期应该只有一次事件循环, 而不是多次, 其余的调度完全可以交由协程处理, 而不是暴露出事件循环的设施\r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-10-09T03:05:09Z",
        "body": "4.4 版本不会废弃 Event::wait"
      }
    ]
  },
  {
    "number": 2858,
    "title": "debug",
    "created_at": "2019-09-26T15:14:09Z",
    "closed_at": "2019-09-27T01:58:33Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2858",
    "body": "//监听连接进入事件\r\n$serv->on('Connect', function ($serv, $fd) {  \r\n    echo \"Client: Connect.\\n\";\r\n});\r\n//监听数据接收事件\r\n$serv->on('Receive', function ($serv, $fd, $from_id, $data) {\r\n    $serv->send($fd, \"Server: \".$data);\r\n});\r\n\r\n以上代码取自官网，我使用gdb，打断点输入  \"b  zim_swoole_server_send\" 和 \"b php_swoole_onConnect\"都没用，我该如何调试呢？（有有客户端建立连接并且发送数据）\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2858/comments",
    "author": "jackbot-zhang",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-09-27T01:58:33Z",
        "body": "需要设置为SWOOLE_BASE模式且worker_num调成1, 关闭task进程\r\n\r\n否则事件是在worker进程触发 而你gdb跟踪的是master进程, 你需要attach到想要跟踪的进程"
      }
    ]
  },
  {
    "number": 2854,
    "title": "Swoole\\Timer::tick 的执行次数round为何永远都是0？",
    "created_at": "2019-09-25T07:13:45Z",
    "closed_at": "2019-09-25T08:29:00Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2854",
    "body": "业务是根据执行次数自动终止timer，Swoole\\Timer::info（$timerid）所返回的round永远都是0？\r\n```\r\n\t$limit_times=5;$interval=3;\r\n\tSwoole\\Timer::tick($interval*1000,function($timerid)use($limit_times){\r\n\t\t$timer_info=Swoole\\Timer::info($timerid);\r\n\t\tvar_dump($timer_info);\r\n\t     $round=$timer_info['round'];\r\n\t\tif($limit_times>0&&$round>=$limit_times){\r\n\t\t\tSwoole\\Timer::clear($timerid);\r\n\t\t}else{\r\n\t\t\techo 'job done by timer'.PHP_EOL;\r\n\t\t}\r\n\t});\r\n```\r\nphp版本是 7.2 \r\n\r\n```\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.3\r\nBuilt => Aug 28 2019 17:51:00\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.0.2l  25 May 2017\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2854/comments",
    "author": "15521956291",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-09-25T08:29:00Z",
        "body": "这个round不是指tick执行了几轮, 而是定时器创建时全局事件循环是第几轮, 所以你的例子中恒为0\r\n"
      },
      {
        "user": "15521956291",
        "created_at": "2019-09-25T13:27:06Z",
        "body": "那有没有办法可以过去当前循环的次数？\r\narray(4) {\r\n  [\"exec_msec\"]=>\r\n  int(162)\r\n  [\"interval\"]=>\r\n  int(0)\r\n  [\"round\"]=>\r\n  int(0)\r\n  [\"removed\"]=>\r\n  bool(false)\r\n}\r\n这个返回的数组没有相关信息呢，想这个exec_msec代表什么，原本打算通过这个除以inrerval计算执行次数的，可是发现并不能用\r\n还有，这东西版本更新里面跟文档里居然都没有说明，写更新记录跟文档真的不够用心！\r\n"
      },
      {
        "user": "twose",
        "created_at": "2019-09-26T03:07:50Z",
        "body": "这个API只是暴露了底层的信息方便PHP层做调试器用的\r\n\r\n循环次数需要自己记录\r\n\r\n要么就使用README里写的方法\r\n\r\n```php\r\ngo(function(){\r\n$round = 0;\r\nwhile (true) {\r\n    $round++;\r\n    Co::sleep(0.001);\r\n}\r\n});\r\n```\r\n\r\n"
      },
      {
        "user": "15521956291",
        "created_at": "2019-09-26T03:37:46Z",
        "body": "好的谢谢"
      }
    ]
  },
  {
    "number": 2838,
    "title": "Misleading error message",
    "created_at": "2019-09-18T09:12:21Z",
    "closed_at": "2019-09-18T12:29:55Z",
    "labels": [
      "question",
      "proposal"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2838",
    "body": "Resuming a non-existant coroutine produces a misleading message:\r\n```\r\nWarning: Swoole\\Coroutine::resume(): you can not resume the coroutine which is in IO operation.\r\n```\r\nOne may think that it is waiting for IO operation. While the correct error message would be more like:\r\n```\r\nWarning: Swoole\\Coroutine::resume(): there is no coroutine with the provided coroutine ID\r\n```\r\nAnd to provide even more details based on the current coroutine ID counter we could have two messages - one for a coroutine which execution is over and one for a coroutine ID that is higher than the current value of the coroutine ID counter:\r\n```\r\nWarning: Swoole\\Coroutine::resume(): the execution of coroutine ID XXX is completed and can not be resumed\r\nWarning: Swoole\\Coroutine::resume(): there is no coroutine with ID XXX started\r\n```\r\nOf course, the original message should stay for the case of waiting for IO. Maybe improved with putting inside the actual coroutine ID like:\r\n```\r\nWarning: Swoole\\Coroutine::resume(): the coroutine ID XXX can not be resumed because is performing IO operations\r\n```\r\nexample code:\r\n```php\r\n<?php\r\n$cid = 55;\r\nco::resume($cid);\r\n```\r\n\r\nSwoole version 4.4.5\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2838/comments",
    "author": "kenashkov",
    "comments": [
      {
        "user": "doubaokun",
        "created_at": "2019-09-18T10:38:13Z",
        "body": "@kenashkov I can't reproduce the message you have seen, what I can see:\r\n\r\n```\r\nWarning: Swoole\\Coroutine::resume(): you can not resume the coroutine which is in IO operation or non-existent\r\n```"
      },
      {
        "user": "kenashkov",
        "created_at": "2019-09-18T10:51:19Z",
        "body": "I have multiple versions of swoole and I got this one on older, not 4.4.5. In 4.4.5 the message reads:\r\n```\r\nSwoole\\Coroutine::resume(): you can not resume the coroutine which is in IO operation or non-existent\r\n```\r\nWhich is correct.\r\nThough maybe the message can be changed to three different ones:\r\n- one for coroutine in IO\r\n- one for coroutine which execution is over\r\n- one for a coroutine ID that does not exist (higher than coroutine_last_cid).\r\n\r\nSorry again for the confusion. Please reclassify as proposal."
      },
      {
        "user": "twose",
        "created_at": "2019-09-18T11:28:28Z",
        "body": "This API is useless, It even needs a hash search, usually, we use `channel->pop` to suspend a coroutine, `channel->push` to resume a coroutine.\r\n\r\nAnd this API has no good real-world use and maybe deprecated in the future.\r\n"
      },
      {
        "user": "kenashkov",
        "created_at": "2019-09-18T12:29:55Z",
        "body": "Thue :) channels should be used. I was just testing the API. Im closing this."
      },
      {
        "user": "fakharksa",
        "created_at": "2025-02-02T13:42:08Z",
        "body": "@matyhtf @NathanFreeman @twose @kenashkov \n\n**Summary:**\n\nYou can use the \"if\" below before executing `co::resume()` to verify the condition if the coroutine is in \"yieldable\" mode\n\n```\n// Resume only if in 'yieldable' mode\nif (Swoole\\Coroutine::getBackTrace($cid1)[0]['function'] == 'yield') {\n    output(Swoole\\Coroutine::getBackTrace($cid1)[0]['function']);\n    co::resume($cid1);\n}\n```\n\n**Complete Example:**\n\nThe function below will toggle (switch) between two coroutines using `co::yield()` (i have broken the while loop after 10 iterations explicitly, else it can be toggled forever)\n\nNotice that i used `co::sleep()` in first \"nested\" co-routine.\n\nNote: The example below can be used:\nA) even without `co::yield()` and `co::resume()` at all, and just with only `$ch1->push()` and `$ch->pop()`, \nOR\nB) without `$ch1->push()` and `$ch->pop()`, and only with `co::yield()` and `co::resume()`\n\n```\ndeclare(strict_types=1);\n\nini_set('memory_limit', -1);\n\nuse Swoole\\Coroutine as co;\nuse Swoole\\Runtime;\nuse Swoole\\Coroutine\\Channel;\n\nSwoole\\Coroutine::enableScheduler();\n\n//This program will toggle coroutines\noutput('Starting Main PHP Process');\n\nco::set([\n        'max_concurrency' => 50,\n        'max_coroutine' => intval($_ENV['SW_MAX_COROUTINE'] ?? 3000),\n        // Can also be set using Swoole\\Runtime::enableCoroutine(true, SWOOLE_HOOK_ALL);\n        'hook_flags' => SWOOLE_HOOK_ALL,\n    ]);\n\n\n$i=1;\nco\\run(function () {\n    global $i;\n    // output() is just our custom helper function defined as the last code snippet below\n    output('Starting Main Coroutine Container / Context');\n\n\n    $ch1 = new Channel();\n    $cid1 = go(function() use ($ch1, $i) {\n        $ch1->push('A'.$i);\n        while (true) {\n            $i++;\n\n            // Commenting the check below will run the coroutines forever\n            if ($i>10) {\n                break;\n            }\n\n            if (!$ch1->isEmpty()) {\n                // The \"co::sleep\" below will result in error \"Cannot Resume Coroutine if in I/O mode or non-existent\", and ...\n                // will not resume from another coroutine as it is taken as in I/O mode\n                // if other coroutine does not check \"if (Swoole\\Coroutine::getBackTrace($cid1)[0]['function'] == 'yield')\"\n                co::sleep(1);\n                co::yield();\n                $ch1->push('A'.$i);\n            }\n        }\n    });\n\n    $cid2 = go(function() use ($ch1, $cid1) {\n        while (true) {\n            co::sleep(1);\n            if ($ch1->isEmpty()) {\n                if (co::exists($cid1)) {\n\n                    // Resume if in 'yieldable' mode\n                    if (Swoole\\Coroutine::getBackTrace($cid1)[0]['function'] == 'yield') {\n                        output(Swoole\\Coroutine::getBackTrace($cid1)[0]['function']);\n                        co::resume($cid1);\n                    }\n                } else {\n                    $ch1->close();\n                    break;\n                }\n            } else {\n                output($ch1->pop());\n            }\n        }\n    });\n\n//    $coros = Swoole\\Coroutine::listCoroutines();\n//    foreach($coros as $crid)\n//    {\n//        output($crid);\n//        output(Swoole\\Coroutine::getBackTrace($crid));\n//    }\n\n    output('Last line of Main Coroutine Container / Context, after which container waits for nested coroutines to complete');\n\n});\n\noutput('Ending Main PHP Process');\n```\n\nBelow defines  custom helper function output()\n```\n// Helper function output()\n\n    function output(mixed $data, mixed $server = null, bool $shouldExit = false, bool $shouldVarDump = false): void\n    {\n        // New line at start and begining of output to make it appear seperated from the rest\n        echo PHP_EOL;\n\n        // Also log the Time with data.\n        echo '[' . Carbon::now()->format('Y-m-d H:i:s') . '] --> ';\n\n        if ($shouldVarDump) {\n            var_dump($data);\n        } else {\n            // If the Data is an Exception (Instance of Throwable)\n            if ($data instanceof \\Throwable) {\n                echo 'Exception Occured: ' . PHP_EOL;\n                echo 'Message: ' . $data->getMessage() . PHP_EOL;\n                echo 'In File: ' . $data->getFile() . PHP_EOL;\n                echo 'On Line: ' . $data->getLine() . PHP_EOL;\n                echo 'Having Code: ' . $data->getCode() . PHP_EOL;\n                echo 'Stack Trace:' . PHP_EOL;\n                echo $data->getTraceAsString() . PHP_EOL;\n            }\n            // Print_r the Data for Arrays or Objects\n            else if (is_array($data) || is_object($data)) {\n                print_r($data);\n            }\n            // Simply echo the scalar values\n            else {\n                echo $data;\n            }\n        }\n\n        echo PHP_EOL;\n\n        // Shutdown and exit (Conditional)\n        if ($shouldExit) {\n            if (is_null($server)) {\n                // Case: For coroutine\\run (when swoole is not running a Server), but not tested\n                try {\n                    \\Swoole\\Coroutine::sleep(.001);\n                    exit(911);\n                } catch (\\Swoole\\ExitException $e) {\n                    // var_dump($e->getMessage());\n                    // var_dump($e->getStatus() === 1);\n                    // var_dump($e->getFlags() === SWOOLE_EXIT_IN_COROUTINE);\n\n                    // If its not coroutine then force shutdown\n                    forceShutdown();\n\n                    sleep(3);\n                    exit(1);\n                }\n            } else {\n                // Tested: When Swoole is running a server\n                $shutdownRes = $server->shutdown();\n                if (!$shutdownRes) {\n                    forceShutdown();\n                }\n\n                sleep(3);\n                exit(1);\n            }\n        }\n    }\n```\n\n**Conclusion:**\n\nI think `co::yield()` is useful and should not be deprecated, it may be utilised in different Design patterns like Toggling between Co-routines forever.\n\n**Request:**\n\nIt will be good if we have a (performant) built-in function which returns the (boolean) fact \"whether the coroutine is in \"yieldable\" mode or not\" (which replaces the less-performing condition below):\n\n`if (Swoole\\Coroutine::getBackTrace($cid1)[0]['function'] == 'yield')`\n\nOr may be you can update co::resume() such that it resumes the yielded coroutine only when it is yieldable (in \"yieldable\" moden: when it is released from I/O and / or co::sleep() ) \n\nWith thanks in advance."
      },
      {
        "user": "fakharksa",
        "created_at": "2025-02-03T10:27:35Z",
        "body": "Another variant of code above is \"Pop in first coroutine and Push in second coroutine\", below:\n\n```\ndeclare(strict_types=1);\n\nini_set('memory_limit', -1);\n\nuse Swoole\\Coroutine as co;\nuse Swoole\\Runtime;\nuse Swoole\\Coroutine\\Channel;\n\nSwoole\\Coroutine::enableScheduler();\n\n//This program will toggle coroutines\noutput('Starting Main PHP Process');\n\nco::set([\n        'max_concurrency' => 50,\n        'max_coroutine' => intval($_ENV['SW_MAX_COROUTINE'] ?? 3000),\n        // Can also be set using Swoole\\Runtime::enableCoroutine(true, SWOOLE_HOOK_ALL);\n        'hook_flags' => SWOOLE_HOOK_ALL,\n    ]);\n\n/*\n** The function below will toggle (switch) between two coroutines using co::yield()\n(i have broken the while loop after 10 iterations explicitly, else it can be toggled forever)\n\n** Notice that i have also used co::sleep() in first \"nested\" co-routine.\n\n** Note: To toggle (switch) between coroutines, the example below can be used:\n* A) even without co::yield() and co::resume() at all, and just with only $ch1->push() and $ch->pop(),\n* OR\n* B) without $ch1->push() and $ch->pop(), and only with co::yield() and co::resume()\n*/\n\n// This program will toggle coroutines\noutput('Starting Main PHP Process');\n\n$i=1;\nco\\run(function () {\n    global $i;\n    //Main Coroutine-1 / Coroutines Container / Main Context\n    output('Starting Main Coroutine Container / Context');\n\n    $ch1 = new Channel();\n    $cid1 = go(function() use ($ch1, $i) {\n        //$ch1->push('A'.$i);\n//        output($ch1->pop());\n        while (true) {\n\n            if (!$ch1->isEmpty()) {\n\n                // The \"co::sleep\" below will result in error \"Cannot Resume Coroutine if in I/O mode or non-existent\", and ...\n                // will not resume from another coroutine as it is taken as in I/O mode\n                // if other coroutine does not check \"if (Swoole\\Coroutine::getBackTrace($cid1)[0]['function'] == 'yield')\"\n                co::sleep(1);\n                if ($i++>5) {\n                    break;\n                }\n                output($ch1->pop());\n                co::yield();\n            }\n        }\n    });\n\n    $cid2 = go(function() use ($ch1, $cid1, $i) {\n        while (true) {\n            co::sleep(1);\n            if (!$ch1->isEmpty()) {\n                if (co::exists($cid1)) {\n                    if (Swoole\\Coroutine::getBackTrace($cid1)[0]['function'] == 'yield') { // Resume $cid1, only if that is in 'yieldable' mode\n                        output(Swoole\\Coroutine::getBackTrace($cid1)[0]['function']);\n                        co::resume($cid1);\n                    }\n                } else {\n                    $ch1->close();\n                    break;\n                }\n            } else {\n                // pop() only when Channel is not Empty (when channel has some elements in it)\n                $ch1->push('A'.$i);\n                $i++;\n                // Commenting the check below will run the coroutines forever\n            }\n        }\n    });\n\n//    $coros = Swoole\\Coroutine::listCoroutines();\n//    foreach($coros as $crid)\n//    {\n//        output($crid);\n//        output(Swoole\\Coroutine::getBackTrace($crid));\n//    }\n\n    output('Last line of Main Coroutine Container / Context, after which container waits for nested coroutines to complete');\n});\n\n// This line will execute only after MAin Coroutine Container has finished (after all coroutines finish)\noutput('Continer / Context Finished, So Ending Main PHP Process');\n```"
      }
    ]
  },
  {
    "number": 2830,
    "title": "SWOOLE_ERROR_SERVER_TOO_MANY_LISTEN_PORT 9005 的问题",
    "created_at": "2019-09-12T08:28:11Z",
    "closed_at": "2019-09-16T05:47:10Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2830",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n```\r\n$num = 30000;\r\n$ips = ['127.0.0.1', '127.0.0.2'];\r\n\r\nfor ($i = 0; $i < $num; $i++) {\r\n    // 先使用随机端口，获取要绑定的端口给后面的IP使用\r\n    $bind_port = 0;\r\n    foreach ($ips as $ip) {\r\n        $port = $serv->addlistener($ip, $bind_port, SWOOLE_SOCK_TCP);\r\n        $bind_port = $port->port;\r\n    }\r\n}\r\n```\r\n2. What did you expect to see?\r\n\r\n我想绑 30000个端口到两个ip上，结果报错\r\n\r\n3. What did you see instead?\r\n\r\nERROR\tswServer_add_port (ERRNO 9005): allows up to 60000 ports to listen\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n4.3.6\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2830/comments",
    "author": "wenjy",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-09-16T05:47:10Z",
        "body": "最大只允许60000个端口"
      }
    ]
  },
  {
    "number": 2828,
    "title": "WebRTC streaming with Swoole",
    "created_at": "2019-09-12T06:13:46Z",
    "closed_at": "2019-10-15T09:41:42Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2828",
    "body": "This is just a question, if it doesn't belongs here please let me know where should I add it.\r\nThank you!\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n4.4.5\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nLinux 79755ba2f089 4.9.0-9-amd64 #1 SMP Debian 4.9.168-1+deb9u5 (2019-08-11) x86_64 GNU/Linux\r\n\r\ngcc (Debian 8.3.0-6) 8.3.0\r\n\r\nPHP 7.2\r\n\r\n--- \r\n\r\n\r\nI'd like to know how could I achieve streaming through WebRTC with swoole since I haven't seen any examples for it.\r\n\r\nThanks!\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2828/comments",
    "author": "pthreat",
    "comments": [
      {
        "user": "seeme-o",
        "created_at": "2019-09-13T16:03:15Z",
        "body": "Hello, since nobody has answered this I will. Swoole currently has no support for WebRTC and I don't think it is likely that it will ever have full WebRTC support. While basic DataChannels can be created over SCTP and MediaChannels can be created over SRTP, \"full\" WebRTC also requires SDP, ICE, STUN, etc, and full WebRTC support also requires media access. And to provide a useful server side experience it will also require hooking into libraries to process media such as gstreamer and/or ffmpeg. Most of this falls outside of the main goals of Swoole from what I've seen, although it wouldn't surprise me if third parties start releasing extensions to provide limited support for at least some WebRTC features outside of signalling."
      },
      {
        "user": "seeme-o",
        "created_at": "2019-09-13T16:09:09Z",
        "body": "Also, existing WebRTC server projects such as Mediasoup and Janus provide ways to use with plaftorms such as Swoole via Unix Domain Sockets and other IPC based mechanisms."
      },
      {
        "user": "pthreat",
        "created_at": "2019-09-16T14:09:20Z",
        "body": "Alright, thanks for the response!"
      }
    ]
  },
  {
    "number": 2825,
    "title": "Do Swoole coroutines invoke a context switch",
    "created_at": "2019-09-11T03:38:14Z",
    "closed_at": "2019-09-17T06:08:18Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2825",
    "body": "From Swoole slack #general:\r\n> Taylor Sasser 7:05 AM\r\nI would call them fibers instead of coroutines, since they are doing a full context switch",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2825/comments",
    "author": "ClosetGeek-Git",
    "comments": [
      {
        "user": "doubaokun",
        "created_at": "2019-09-12T11:23:31Z",
        "body": "@ClosetMonkey Swoole switch the `context of coroutine` based on IO, coroutine yield/resume API, or the preemptive scheduler. But the context switch of Swoole coroutine is light weight and different from the context switch of OS threads."
      }
    ]
  },
  {
    "number": 2807,
    "title": "http context is unavailable",
    "created_at": "2019-09-03T14:28:34Z",
    "closed_at": "2019-09-03T15:04:23Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2807",
    "body": "```Warning: Swoole\\Http\\Response::header(): http context is unavailable (maybe it has been ended or detached)```\r\n\r\nwhat the meaning of this warning? i use swoole docker v4.4.5.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2807/comments",
    "author": "ohmydevops",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-09-03T15:04:14Z",
        "body": "you have called `$response->end()`, so you can't send any more information."
      },
      {
        "user": "ljfreelancer88",
        "created_at": "2020-06-15T16:50:00Z",
        "body": "Hi, what are the approaches on how to eliminate this `http` warning? (see example code)\r\n\r\n```\r\n$http->on('request', function (Request $request, Response $response) {    \r\n    $response->header('Content-Type', 'text/event-stream');\r\n    $response->header('Cache-Control', 'no-cache');\r\n    $response->header('Connection', 'keep-alive');\r\n    $response->header('X-Accel-Buffering', 'no');  \r\n    \r\n    go(function() use ($response, $request) {        \r\n        do {\r\n            $date = date('H:i:s');\r\n            \r\n            $echo = 'data: ' . json_encode(['data' => '$date]) . PHP_EOL;\r\n            $response->end($echo); // Warning: Swoole\\Http\\Response::header(): http context is unavailable (maybe it has been ended or detached)\r\n            \r\n            co::sleep(2);\r\n        } while(true);\r\n    });\r\n    \r\n});\r\n```\r\n\r\nThank you"
      },
      {
        "user": "arku31",
        "created_at": "2020-09-22T10:29:41Z",
        "body": "Maybe someone else will struggle with it as well :)\r\n\r\n$response->setHeader() and $response->header() acts different. I haven't seen a confirmation in docs but seems that first, one sends header immediately and another one store it first and send it with end().\r\n\r\nThat was quite unclear as in my case end() was called in the middleware and header was supposed to set before what led to the exact message "
      }
    ]
  },
  {
    "number": 2806,
    "title": "4.4版本后多进程结束异常",
    "created_at": "2019-09-03T12:36:15Z",
    "closed_at": "2019-09-07T11:37:53Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2806",
    "body": "在4.4版本之前，我使用SIGHUP信号，配合```Process::wait```重启子进程，可以正常运行\r\n``` php\r\n// 主进程监听SIGCHLD事件\r\nswoole_process::signal(SIGCHLD, function ($signo) {\r\n            while ($process = swoole_process::wait(false)) {\r\n                    if ($process['signal'] === SIGHUP) {\r\n                        // 重新启动子进程\r\n                    }\r\n            }\r\n        }\r\n});\r\n\r\n// 启动子进程\r\n$process = new swoole_process(function() {\r\n   // 子进程逻辑，其中使用pipe进行进程间通讯\r\n})；\r\n\r\n// 某些条件下，比如子进程超时\r\nswoole_process::kill($process->pid, SIGHUP);\r\n```\r\n但在4.4之后的版本，会出现异常：\r\n```\r\n主进程SIGCHLD事件，打印回收结束运行的子进程signal值：\r\n1 // 正常，SIGHUP\r\n0 // 异常 （子进程重启后立即结束，主进程收到SIGCHLD事件，signal值为0）\r\n0 // 异常 （反复重启进程）\r\n...\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2806/comments",
    "author": "Alion548",
    "comments": [
      {
        "user": "Alion548",
        "created_at": "2019-09-03T12:39:23Z",
        "body": "异常环境：Swoole 4.4.5、PHP 7.3.6、Fedora 30\r\n正常环境：Swoole 4.3.6、PHP 7.3.6、Fedora 30\r\n "
      },
      {
        "user": "twose",
        "created_at": "2019-09-03T12:52:22Z",
        "body": "4.4.x以后进程只进行信号监听而不做其他事 事件循环将会直接退出 是否是由这个引起?"
      },
      {
        "user": "Alion548",
        "created_at": "2019-09-03T12:57:43Z",
        "body": "> 4.4.x以后进程只进行信号监听而不做其他事 事件循环将会直接退出 是否是由这个引起?\r\n\r\n如果是这样的话，第一次子进程启动后就立即结束了"
      },
      {
        "user": "twose",
        "created_at": "2019-09-03T15:22:23Z",
        "body": "子进程有pipe监听的话不会退出, 父进程什么也不干会退出, 可以加个定时器"
      },
      {
        "user": "Alion548",
        "created_at": "2019-09-03T15:42:08Z",
        "body": "父进程有事情干不会退出。现在问题是：子进程收到父进程的SIGHUP信号时，会立即结束进程（这是正常的）。父进程通过监听SIGCHLD事件，重新启动子进程，但是子进程启动后立即结束了（父进程SIGCHLD事件收到一个signal值为0的子进程退出消息）"
      },
      {
        "user": "twose",
        "created_at": "2019-09-04T03:51:36Z",
        "body": "那需要你提供一个可以复现的简单例子"
      },
      {
        "user": "Alion548",
        "created_at": "2019-09-07T08:04:01Z",
        "body": "``` php\r\n<?php\r\n\r\n$process = null;\r\n$pid = 0;\r\n\r\n// 创建子进程\r\n$startProcess = static function () use (&$process, &$pid) {\r\n    $process = new swoole_process(static function (swoole_process $process) {\r\n        var_dump('启动子进程');\r\n\r\n        swoole_event_add($process->pipe, static function ($fp) use ($process) {\r\n            var_dump('子进程接收到消息: '.$process->read());\r\n        });\r\n\r\n        //sleep(30); // 模拟阻塞\r\n    }, false, 2);\r\n\r\n    swoole_event_add($process->pipe, static function ($fp) use (&$process) {\r\n        var_dump('父进程接收到消息: '.$process->read());\r\n    });\r\n\r\n    $pid = $process->start();\r\n};\r\n\r\n// 回收子进程\r\nswoole_process::signal(SIGCHLD, static function ($signo) use ($startProcess, &$pid) {\r\n    while ($process = swoole_process::wait(false)) {\r\n        var_dump($process);\r\n\r\n        if ($process['signal'] === SIGHUP) {\r\n            $startProcess(); // 重启子进程\r\n        }\r\n    }\r\n});\r\n\r\n$startProcess();\r\n\r\n// 模拟父进程 向 子进程 发送消息\r\nswoole_timer_tick(1000, static function ($timerID) use ($process) {\r\n    $process->write('AAAA');\r\n});\r\n\r\n// 模拟每隔5s 重启子进程\r\nswoole_timer_tick(5000, static function ($timerID) use (&$pid) {\r\n    swoole_process::kill($pid, SIGHUP);\r\n});\r\n\r\n```\r\n``` bash\r\n[root@1d7679c127c8 src]# php ./process.php\r\nstring(15) \"启动子进程\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\narray(3) {\r\n  [\"pid\"]=>\r\n  int(44)\r\n  [\"code\"]=>\r\n  int(0)\r\n  [\"signal\"]=>\r\n  int(1)\r\n}\r\nstring(15) \"启动子进程\"  // 这次启动后，立即就结束了，而且Signal值为0\r\narray(3) {\r\n  [\"pid\"]=>\r\n  int(45)\r\n  [\"code\"]=>\r\n  int(0)\r\n  [\"signal\"]=>\r\n  int(0)\r\n}\r\nPHP Warning:  Swoole\\Process::kill(): swKill(45, 1) failed, Error: No such process[3] in /root/yingyan/process.php on line 45\r\nPHP Warning:  Swoole\\Process::kill(): swKill(45, 1) failed, Error: No such process[3] in /root/yingyan/process.php on line 45\r\n```"
      },
      {
        "user": "Alion548",
        "created_at": "2019-09-07T08:17:46Z",
        "body": "补充4.3.6版本运行结果：\r\n``` bash\r\n[root@fc6ae27d02cf src]# php process.php\r\nstring(15) \"启动子进程\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\narray(3) {\r\n  [\"pid\"]=>\r\n  int(31)\r\n  [\"code\"]=>\r\n  int(0)\r\n  [\"signal\"]=>\r\n  int(1)\r\n}\r\nstring(15) \"启动子进程\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\narray(3) {\r\n  [\"pid\"]=>\r\n  int(32)\r\n  [\"code\"]=>\r\n  int(0)\r\n  [\"signal\"]=>\r\n  int(1)\r\n}\r\nstring(15) \"启动子进程\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\nstring(30) \"子进程接收到消息: AAAA\"\r\narray(3) {\r\n  [\"pid\"]=>\r\n  int(33)\r\n  [\"code\"]=>\r\n  int(0)\r\n  [\"signal\"]=>\r\n  int(1)\r\n}\r\nstring(15) \"启动子进程\"\r\n\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-09-07T09:48:33Z",
        "body": "请在 子进程和父进程代码末尾添加 `Swoole\\Event::wait()`"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-09-07T09:58:11Z",
        "body": "```php\r\n<?php\r\n\r\n$process = null;\r\n$pid = 0;\r\n\r\n// 创建子进程\r\n$startProcess = static function () use (&$pid) {\r\n    global $process;\r\n    $process = new swoole_process(static function (swoole_process $process) {\r\n        var_dump('启动子进程');\r\n\r\n        swoole_event_add($process->pipe, static function ($fp) use ($process) {\r\n            var_dump('子进程接收到消息: '.$process->read());\r\n        });\r\n\r\n        swoole_event_wait();\r\n    }, false, 2);\r\n\r\n    swoole_event_add($process->pipe, static function ($fp) use (&$process) {\r\n        var_dump('父进程接收到消息: '.$process->read());\r\n    });\r\n\r\n    $pid = $process->start();\r\n};\r\n\r\n// 回收子进程\r\nswoole_process::signal(SIGCHLD, static function ($signo) use ($startProcess, &$pid) {\r\n    while ($process = swoole_process::wait(false)) {\r\n        var_dump($process);\r\n\r\n        if ($process['signal'] === SIGHUP) {\r\n            $startProcess(); // 重启子进程\r\n        }\r\n    }\r\n});\r\n\r\n$startProcess();\r\n\r\n// 模拟父进程 向 子进程 发送消息\r\nswoole_timer_tick(1000, static function ($timerID) {\r\n    global $process;\r\n    $process->write('AAAA');\r\n});\r\n\r\n// 模拟每隔5s 重启子进程\r\nswoole_timer_tick(5000, static function ($timerID) use (&$pid) {\r\n    swoole_process::kill($pid, SIGHUP);\r\n});\r\n\r\nswoole_event_wait();\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-09-07T09:59:09Z",
        "body": "timer 里面的 process 绑定的是老的 process ，而 startProcess 创建了新的 process，改为使用 global 方式实现。"
      },
      {
        "user": "Alion548",
        "created_at": "2019-09-07T10:08:31Z",
        "body": "> timer 里面的 process 绑定的是老的 process ，而 startProcess 创建了新的 process，改为使用 global 方式实现。\r\n\r\n``` php\r\n$process = null;\r\n\r\nswoole_timer_tick(1000, function ($timerID) {\r\n    global $process;\r\n    $process->write('AAAA');\r\n});\r\n```\r\n\r\n``` php\r\n$process = null;\r\n\r\nswoole_timer_tick(1000, function ($timerID) use (&$process) {\r\n    $process->write('AAAA');\r\n});\r\n```\r\n\r\n第二种方式使用use关键字，不是传址形式么，和使用global关键字有什么区别？"
      }
    ]
  },
  {
    "number": 2804,
    "title": "客户端长连接问题",
    "created_at": "2019-09-03T10:00:19Z",
    "closed_at": "2019-09-03T12:32:39Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2804",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n客户端和swoole的tcpserver每次tcp交互都是短连接吗, 如果客户端开启长连接请求tcpserver, 后续的请求有效吗\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2804/comments",
    "author": "lgxxaq",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-09-03T12:32:39Z",
        "body": "这个问题太基础了 看看文档吧 或者学习一下相关知识"
      }
    ]
  },
  {
    "number": 2796,
    "title": "task异步任务和process多进程有啥区别呢？",
    "created_at": "2019-09-01T15:12:13Z",
    "closed_at": "2019-09-02T07:31:42Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2796",
    "body": "大神，你好！\r\n我刚接触swoole，在实践过程中感觉task异步任务和process进程功能差不多，还请大神指点一二，有啥区别？适用场景有哪些？",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2796/comments",
    "author": "xiexianbo123",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-09-02T07:31:42Z",
        "body": "封装层次不同。"
      }
    ]
  },
  {
    "number": 2792,
    "title": "关于onClose回调函数reactor_id的问题",
    "created_at": "2019-08-29T11:32:45Z",
    "closed_at": "2019-08-31T07:04:10Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2792",
    "body": "我测试发现在 open_tcp_keepalive 和 heartbeat_check_interval 这两种方式关闭连接的时候，server的onClose回调函数的$reactorId 是reactor线程的id，而通过server->close() 方式关闭连接的时候，server的onClose回调函数的$reactorId为-1\r\n\r\n按理说都是服务端关闭连接，应该都为-1吧\r\n\r\n这个是bug吗？",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2792/comments",
    "author": "gutao1994",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-08-30T02:54:33Z",
        "body": "看了下实现, 这里应该是心跳线程去通知连接所属的reactor去关闭这个连接, 应该是个feature..."
      },
      {
        "user": "gutao1994",
        "created_at": "2019-08-30T07:16:58Z",
        "body": "@twose 这么实现，感觉有点奇怪"
      },
      {
        "user": "gutao1994",
        "created_at": "2019-08-30T07:45:17Z",
        "body": "@twose \r\n文档里说的：swoole-1.9.7版本修改了$reactorId参数，当服务器主动关闭连接时，底层会设置此参数为-1，可以通过判断$reactorId < 0来分辨关闭是由服务器端还是客户端发起的。\r\n\r\n实际表现和文档不符啊。。。"
      },
      {
        "user": "twose",
        "created_at": "2019-08-30T09:18:44Z",
        "body": "这个文档我知道 但是实现就是这样的\r\n心跳检测线程是在master的, 而onClose事件是发生在worker的, 如果不是调close方法触发的onClose, 都是从外部来的(对于worker来说)\r\n文档的说法不严谨\r\n你可以说说你的需求是什么, 判断来源要做什么用, 我们再来讨论要不要单独为这个做优化\r\n"
      }
    ]
  },
  {
    "number": 2788,
    "title": "How to shutdown everything from within runninng server?",
    "created_at": "2019-08-28T09:43:20Z",
    "closed_at": "2019-09-17T06:14:05Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2788",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n```\r\n$http = new Server(\"127.0.0.1\", 9501);\r\n$http->on('request', function ($request, $response) {\r\n    // SHUTDOWN HERE as if pressed CTRL-C\r\n});\r\n$http->start();\r\n```\r\n\r\n\r\nBasically, I need to reload SSL certs. It appears this is not possible based on #2046\r\n\r\nSo, my solution is to shutdown as if I pressed CTRL-C every X days and it will auto-reload from cronjob with minimal downtime. It is okay if current connections get killed.\r\n\r\nThe problem is that I cannot find a way to do this. I have tried $server->shutdown(), $server->stop(), etc. None of these appear to work and some will leave ghost processes (like workers) still running even if main process is shutdown.\r\n\r\nIs there a mechanism to just shutdown everything (main process, workers, etc)?\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2788/comments",
    "author": "RWGuy",
    "comments": [
      {
        "user": "leocavalcante",
        "created_at": "2019-09-01T03:02:05Z",
        "body": "The `shutdown()` method should work:\r\n```php\r\n$server->on('request', function (Request $request, Response $response) use ($server) {\r\n    if ($request->server['request_uri'] === '/stop') {\r\n        $response->end();\r\n        return $server->shutdown();\r\n    }\r\n\r\n    $response->end();\r\n});\r\n```"
      },
      {
        "user": "twose",
        "created_at": "2019-09-17T06:13:38Z",
        "body": "```php\r\n$server->set([ 'pid_file' => __DIR__. '/server.pid']);\r\n```\r\nwrite a script: send SIGTERM to master (kill \\`cat server.pid\\`), then restart your application"
      }
    ]
  },
  {
    "number": 2785,
    "title": "hook+ProcessPool bug",
    "created_at": "2019-08-27T06:06:16Z",
    "closed_at": "2019-08-31T00:19:26Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2785",
    "body": "开启hook协程化后，在进程池进程中的协程里执行如 `file_get_contents`、`sleep` 被hook的函数时，就会崩\r\n\r\nSwoole 4.4.3、4.4.4\r\n\r\n复现代码：\r\n```php\r\n<?php\r\n$workerNum = 1;\r\n$pool = new Swoole\\Process\\Pool($workerNum);\r\n\r\n$pool->on(\"WorkerStart\", function ($pool, $workerId) {\r\n    var_dump(1);\r\n    \\Swoole\\Runtime::enableCoroutine(true); // hook 后，执行下面那句话就崩\r\n    go(function() use($pool, $workerId){\r\n        var_dump(2);\r\n        file_get_contents(__FILE__); // 执行这句话就崩\r\n        var_dump(3);\r\n        sleep(1000);\r\n    });\r\n});\r\n\r\n$pool->on(\"WorkerStop\", function ($pool, $workerId) {\r\n    echo \"Worker#{$workerId} is stopped\\n\";\r\n});\r\n\r\n$pool->start();\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2785/comments",
    "author": "Yurunsoft",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-08-27T06:28:41Z",
        "body": "请在`WorkerStart`末尾添加　swoole\\event::wait();"
      },
      {
        "user": "Yurunsoft",
        "created_at": "2019-08-27T06:30:20Z",
        "body": "好的，加了就可以了。以前我直接在协程里`\\Swoole\\Event::wait();`的，最近的更新后好像就不行了"
      },
      {
        "user": "twose",
        "created_at": "2019-08-27T07:41:48Z",
        "body": "构造方法没开启enable_coroutine, 事件被忽略了"
      }
    ]
  },
  {
    "number": 2761,
    "title": "Swoole\\Client close() 返回true 但是没有关闭连接",
    "created_at": "2019-08-16T09:25:38Z",
    "closed_at": "2019-08-25T00:35:57Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2761",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n```\r\n\r\n<?php\r\n\r\nuse Swoole\\Client;\r\n\r\n$client = new Client(SWOOLE_SOCK_TCP, SWOOLE_SOCK_ASYNC);\r\n\r\n        $client->on('connect', function (Client $cli) {\r\n\r\n            $cli->send('aaaa');\r\n        }); \r\n\r\n        $client->on('receive',function (Client $cli, $data) {\r\n\r\n            var_dump($data);\r\n            $cli->close();\r\n        }); \r\n\r\n        $client->on('error', function (Client $cli) {\r\n            echo 'fail Connection error' . PHP_EOL;\r\n        }); \r\n\r\n        $client->on('close', function (Client $cli) {\r\n\r\n        }); \r\n\r\n        $client->connect('127.0.0.1', 9501);\r\n\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n 调用 $cli->close(); 客户端并没有关闭\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n4.4.3\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2761/comments",
    "author": "wenjy",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-08-16T10:13:26Z",
        "body": "请使用 strace 和 tcpdump 跟踪"
      },
      {
        "user": "wenjy",
        "created_at": "2019-08-19T02:50:48Z",
        "body": "strace\r\n\r\n```\r\n31389 epoll_wait(20,  <unfinished ...>\r\n31388 epoll_wait(19,  <unfinished ...>\r\n31386 restart_syscall(<... resuming interrupted futex ...> <unfinished ...>\r\n31385 futex(0x33122ac, FUTEX_WAIT_PRIVATE, 1, NULL <unfinished ...>\r\n31384 futex(0x3311a1c, FUTEX_WAIT_PRIVATE, 1, NULL <unfinished ...>\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:03 #31383.2]\\tT\"..., 88) = 88\r\n31383 epoll_wait(17, [], 4096, 502)     = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:03 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:03 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... restart_syscall resumed> )   = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1939, {938174, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 1000) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:04 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:04 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1941, {938175, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 998) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:05 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:05 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1943, {938176, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 999) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:06 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:06 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1945, {938177, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 998) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:07 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:07 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1947, {938178, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [{EPOLLIN, {u32=4, u64=4294967300}}], 4096, 999) = 1\r\n31383 accept4(4, {sa_family=AF_INET, sin_port=htons(24750), sin_addr=inet_addr(\"127.0.0.1\")}, [16], SOCK_CLOEXEC|SOCK_NONBLOCK) = 21\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:08 #31383.2]\\tT\"..., 130) = 130\r\n31383 setsockopt(21, SOL_TCP, TCP_NODELAY, [1], 4) = 0\r\n31383 epoll_ctl(20, EPOLL_CTL_ADD, 21, {EPOLLOUT, {u32=21, u64=21}} <unfinished ...>\r\n31389 <... epoll_wait resumed> [{EPOLLOUT, {u32=21, u64=21}}], 4096, -1) = 1\r\n31383 <... epoll_ctl resumed> )         = 0\r\n31389 futex(0x7f94b37e5ec0, FUTEX_WAIT_PRIVATE, 2, NULL <unfinished ...>\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 futex(0x7f94b37e5ec0, FUTEX_WAKE_PRIVATE, 1 <unfinished ...>\r\n31389 <... futex resumed> )             = 0\r\n31383 <... futex resumed> )             = 1\r\n31389 stat(\"/etc/localtime\",  <unfinished ...>\r\n31383 write(1, \"[2019-08-19 10:43:08 #31383.2]\\tT\"..., 107 <unfinished ...>\r\n31389 <... stat resumed> {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 <... write resumed> )             = 107\r\n31389 futex(0x7f94b37e5ec0, FUTEX_WAKE_PRIVATE, 1 <unfinished ...>\r\n31383 accept4(4,  <unfinished ...>\r\n31389 <... futex resumed> )             = 0\r\n31383 <... accept4 resumed> 0x7fffb4e3ea50, 0x7fffb4e3eac0, SOCK_CLOEXEC|SOCK_NONBLOCK) = -1 EAGAIN (Resource temporarily unavailable)\r\n31389 write(1, \"[2019-08-19 10:43:08 #31383.1]\\tT\"..., 165 <unfinished ...>\r\n31383 stat(\"/etc/localtime\",  <unfinished ...>\r\n31389 <... write resumed> )             = 165\r\n31383 <... stat resumed> {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31389 write(12, \"\\4\\0\\0\\0\\0\\0\\0\\0\\1\\0\\5\\0\\4\\0\\0\\0\", 16 <unfinished ...>\r\n31383 write(1, \"[2019-08-19 10:43:08 #31383.2]\\tT\"..., 88 <unfinished ...>\r\n31389 <... write resumed> )             = 16\r\n31383 <... write resumed> )             = 88\r\n31389 epoll_ctl(20, EPOLL_CTL_MOD, 21, {EPOLLIN, {u32=21, u64=21}} <unfinished ...>\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31389 <... epoll_ctl resumed> )         = 0\r\n31389 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31389 write(1, \"[2019-08-19 10:43:08 #31383.1]\\tT\"..., 106) = 106\r\n31389 epoll_wait(20, [{EPOLLIN, {u32=21, u64=21}}], 4096, -1) = 1\r\n31389 recvfrom(21, \"aaaa\", 65536, 0, NULL, NULL) = 4\r\n31389 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31389 write(1, \"[2019-08-19 10:43:08 #31383.1]\\tT\"..., 90) = 90\r\n31389 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31389 write(1, \"[2019-08-19 10:43:08 #31383.1]\\tT\"..., 104) = 104\r\n31389 write(12, \"\\4\\0\\0\\0\\4\\0\\0\\0\\1\\0\\0\\0\\4\\0\\0\\0aaaa\", 20) = 20\r\n31389 epoll_wait(20, [{EPOLLIN, {u32=12, u64=21474836492}}], 4096, -1) = 1\r\n31389 read(12, \"\\4\\0\\0\\0\\f\\0\\0\\0\\1\\0\\0\\0\\1\\0\\0\\0Server: aaaa\", 425952) = 28\r\n31389 sendto(21, \"Server: aaaa\", 12, 0, NULL, 0) = 12\r\n31389 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31389 write(1, \"[2019-08-19 10:43:08 #31383.1]\\tT\"..., 88) = 88\r\n31389 read(12, 0x7f949dc81010, 425952)  = -1 EAGAIN (Resource temporarily unavailable)\r\n31389 epoll_wait(20,  <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 317) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:08 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:08 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1949, {938179, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 1000) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:09 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:09 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1951, {938180, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 999) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:10 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:10 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1953, {938181, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 999) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:11 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:11 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1955, {938182, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 998) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:12 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:12 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1957, {938183, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 999) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:13 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:13 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1959, {938184, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 998) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:14 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:14 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1961, {938185, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 998) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:15 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:15 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1963, {938186, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 999) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:16 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:16 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1965, {938187, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 998) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:17 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:17 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1967, {938188, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 999) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:18 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:18 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n31386 futex(0x7f94a8aa6ce4, FUTEX_WAIT_BITSET_PRIVATE, 1969, {938189, 938847896}, ffffffff <unfinished ...>\r\n31383 <... epoll_wait resumed> [], 4096, 998) = 0\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:19 #31383.2]\\tT\"..., 88) = 88\r\n31383 stat(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=388, ...}) = 0\r\n31383 write(1, \"[2019-08-19 10:43:19 #31383.2]\\tT\"..., 100) = 100\r\n31383 epoll_wait(17,  <unfinished ...>\r\n31386 <... futex resumed> )             = -1 ETIMEDOUT (Connection timed out)\r\n31386 futex(0x7f94a8aa6d20, FUTEX_WAKE_PRIVATE, 1) = 0\r\n\r\n```\r\n\r\ntcpdump\r\n\r\n```\r\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\r\nlistening on any, link-type LINUX_SLL (Linux cooked), capture size 262144 bytes\r\n10:43:08.362381 IP 127.0.0.1.24750 > 127.0.0.1.9501: Flags [S], seq 2121846785, win 43690, options [mss 65495,sackOK,TS val 937878599 ecr 0,nop,wscale 7], length 0\r\n\t0x0000:  4500 003c 3446 4000 4006 0874 7f00 0001  E..<4F@.@..t....\r\n\t0x0010:  7f00 0001 60ae 251d 7e78 d001 0000 0000  ....`.%.~x......\r\n\t0x0020:  a002 aaaa fe30 0000 0204 ffd7 0402 080a  .....0..........\r\n\t0x0030:  37e6 e447 0000 0000 0103 0307 0000 0000  7..G............\r\n\t0x0040:  0000 0000 0000 0000 0000 0000            ............\r\n10:43:08.362398 IP 127.0.0.1.9501 > 127.0.0.1.24750: Flags [S.], seq 3359562143, ack 2121846786, win 43690, options [mss 65495,sackOK,TS val 937878599 ecr 937878599,nop,wscale 7], length 0\r\n\t0x0000:  4500 003c 0000 4000 4006 3cba 7f00 0001  E..<..@.@.<.....\r\n\t0x0010:  7f00 0001 251d 60ae c83e d99f 7e78 d002  ....%.`..>..~x..\r\n\t0x0020:  a012 aaaa fe30 0000 0204 ffd7 0402 080a  .....0..........\r\n\t0x0030:  37e6 e447 37e6 e447 0103 0307 0000 0000  7..G7..G........\r\n\t0x0040:  0000 0000 0000 0000 0000 0000            ............\r\n10:43:08.362407 IP 127.0.0.1.24750 > 127.0.0.1.9501: Flags [.], ack 1, win 342, options [nop,nop,TS val 937878599 ecr 937878599], length 0\r\n\t0x0000:  4500 0034 3447 4000 4006 087b 7f00 0001  E..44G@.@..{....\r\n\t0x0010:  7f00 0001 60ae 251d 7e78 d002 c83e d9a0  ....`.%.~x...>..\r\n\t0x0020:  8010 0156 fe28 0000 0101 080a 37e6 e447  ...V.(......7..G\r\n\t0x0030:  37e6 e447 0000 0000 0000 0000 0000 0000  7..G............\r\n\t0x0040:  0000 0000                                ....\r\n10:43:08.362605 IP 127.0.0.1.24750 > 127.0.0.1.9501: Flags [P.], seq 1:5, ack 1, win 342, options [nop,nop,TS val 937878599 ecr 937878599], length 4\r\n\t0x0000:  4500 0038 3448 4000 4006 0876 7f00 0001  E..84H@.@..v....\r\n\t0x0010:  7f00 0001 60ae 251d 7e78 d002 c83e d9a0  ....`.%.~x...>..\r\n\t0x0020:  8018 0156 fe2c 0000 0101 080a 37e6 e447  ...V.,......7..G\r\n\t0x0030:  37e6 e447 6161 6161 0000 0000 0000 0000  7..Gaaaa........\r\n\t0x0040:  0000 0000 0000 0000                      ........\r\n10:43:08.362618 IP 127.0.0.1.9501 > 127.0.0.1.24750: Flags [.], ack 5, win 342, options [nop,nop,TS val 937878599 ecr 937878599], length 0\r\n\t0x0000:  4500 0034 3de7 4000 4006 feda 7f00 0001  E..4=.@.@.......\r\n\t0x0010:  7f00 0001 251d 60ae c83e d9a0 7e78 d006  ....%.`..>..~x..\r\n\t0x0020:  8010 0156 fe28 0000 0101 080a 37e6 e447  ...V.(......7..G\r\n\t0x0030:  37e6 e447 0000 0000 0000 0000 0000 0000  7..G............\r\n\t0x0040:  0000 0000                                ....\r\n10:43:08.364912 IP 127.0.0.1.9501 > 127.0.0.1.24750: Flags [P.], seq 1:13, ack 5, win 342, options [nop,nop,TS val 937878601 ecr 937878599], length 12\r\n\t0x0000:  4500 0040 3de8 4000 4006 fecd 7f00 0001  E..@=.@.@.......\r\n\t0x0010:  7f00 0001 251d 60ae c83e d9a0 7e78 d006  ....%.`..>..~x..\r\n\t0x0020:  8018 0156 fe34 0000 0101 080a 37e6 e449  ...V.4......7..I\r\n\t0x0030:  37e6 e447 5365 7276 6572 3a20 6161 6161  7..GServer:.aaaa\r\n\t0x0040:  0000 0000 0000 0000 0000 0000 0000 0000  ................\r\n10:43:08.364921 IP 127.0.0.1.24750 > 127.0.0.1.9501: Flags [.], ack 13, win 342, options [nop,nop,TS val 937878602 ecr 937878601], length 0\r\n\t0x0000:  4500 0034 3449 4000 4006 0879 7f00 0001  E..44I@.@..y....\r\n\t0x0010:  7f00 0001 60ae 251d 7e78 d006 c83e d9ac  ....`.%.~x...>..\r\n\t0x0020:  8010 0156 fe28 0000 0101 080a 37e6 e44a  ...V.(......7..J\r\n\t0x0030:  37e6 e449 0000 0000 0000 0000 0000 0000  7..I............\r\n\t0x0040:  0000 0000                                ....\r\n\r\n```"
      },
      {
        "user": "wenjy",
        "created_at": "2019-08-19T02:59:37Z",
        "body": "ctrl + c 客户端\r\n\r\ntcpdump\r\n\r\n```\r\n10:57:15.740784 IP 127.0.0.1.24750 > 127.0.0.1.9501: Flags [F.], seq 5, ack 13, win 342, options [nop,nop,TS val 938725977 ecr 937878601], length 0\r\n\t0x0000:  4500 0034 344a 4000 4006 0878 7f00 0001  E..44J@.@..x....\r\n\t0x0010:  7f00 0001 60ae 251d 7e78 d006 c83e d9ac  ....`.%.~x...>..\r\n\t0x0020:  8011 0156 fe28 0000 0101 080a 37f3 d259  ...V.(......7..Y\r\n\t0x0030:  37e6 e449 0000 0000 0103 0307 0000 0000  7..I............\r\n\t0x0040:  0000 0000                                ....\r\n10:57:15.742568 IP 127.0.0.1.9501 > 127.0.0.1.24750: Flags [F.], seq 13, ack 6, win 342, options [nop,nop,TS val 938725979 ecr 938725977], length 0\r\n\t0x0000:  4500 0034 3de9 4000 4006 fed8 7f00 0001  E..4=.@.@.......\r\n\t0x0010:  7f00 0001 251d 60ae c83e d9ac 7e78 d007  ....%.`..>..~x..\r\n\t0x0020:  8011 0156 fe28 0000 0101 080a 37f3 d25b  ...V.(......7..[\r\n\t0x0030:  37f3 d259 37e6 e447 0103 0307 0000 0000  7..Y7..G........\r\n\t0x0040:  0000 0000                                ....\r\n10:57:15.742588 IP 127.0.0.1.24750 > 127.0.0.1.9501: Flags [.], ack 14, win 342, options [nop,nop,TS val 938725979 ecr 938725979], length 0\r\n\t0x0000:  4500 0034 344b 4000 4006 0877 7f00 0001  E..44K@.@..w....\r\n\t0x0010:  7f00 0001 60ae 251d 7e78 d007 c83e d9ad  ....`.%.~x...>..\r\n\t0x0020:  8010 0156 fe28 0000 0101 080a 37f3 d25b  ...V.(......7..[\r\n\t0x0030:  37f3 d25b 0000 0000 0000 0000 0000 0000  7..[............\r\n\t0x0040:  0000 0000\r\n```"
      },
      {
        "user": "wenjy",
        "created_at": "2019-08-19T03:16:38Z",
        "body": "客户端没有发起关闭请求"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-08-20T03:17:28Z",
        "body": "在你的 strace 信息中完全没看到相关信息，请检查代码是否正确，本地单元测试无法重现你的问题"
      },
      {
        "user": "wenjy",
        "created_at": "2019-08-20T07:54:17Z",
        "body": "好的，我用的4.3.6 和 4.4.3 这两个版本做的测试，服务端的代码和客户端的代码是一样的 4.3.6可以正常关闭，4.4.3版本不行，我暂时没发现问题在哪"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-08-21T09:03:36Z",
        "body": "@wenjy 可以给我一个可以稳定重现的 demo "
      },
      {
        "user": "wenjy",
        "created_at": "2019-08-21T11:06:27Z",
        "body": "@matyhtf \r\n服务端：\r\n\r\n```php\r\n<?php\r\n\r\n$config = [\r\n    'reactor_num'              => 2,     // 线程数. 一般设置为CPU核数的1-4倍\r\n    'worker_num'               => 2,    // 工作进程数量. 设置为CPU的1-4倍最合理\r\n    // 防止 PHP 内存溢出, 一个工作进程处理 X 次任务后自动重启 (注: 0,不自动重启)\r\n    'max_request'              => 1000,\r\n    // 此参数用来设置Server最大允许维持多少个TCP连接。超过此数量后，新进入的连接将被拒绝\r\n    'max_connection'                 => 10000,\r\n    'task_worker_num'          => 2,// task 进程数\r\n    'task_max_request'         => 1000,\r\n    // 防止 PHP 内存溢出\r\n    //'task_tmpdir'              => '/tmp',\r\n    //'message_queue_key'        => ftok(SYS_ROOT . 'queue.msg', 1),\r\n    'dispatch_mode'            => 2,\r\n    'daemonize'                => false,     // 设置守护进程模式\r\n    'backlog'                  => 128,\r\n    //'log_file'                 => '/data/logs/swoole.log',\r\n    //'heartbeat_check_interval' => 60,\r\n    // 心跳检测间隔时长(秒)\r\n    //'heartbeat_idle_time'      => 125,\r\n    // 连接最大允许空闲的时间\r\n    //'open_eof_check'           => 1,\r\n    //'open_eof_split'           => 1,\r\n    //'package_eof'              => \"\\r\\r\\n\",\r\n    //'open_cpu_affinity'        => 1,\r\n    'socket_buffer_size'       => 1024 * 1024 * 128,\r\n    'buffer_output_size'       => 1024 * 1024 * 2,\r\n    //'enable_delay_receive'     => true,\r\n    //'cpu_affinity_ignore' =>array(0,1)//如果你的网卡2个队列（或者没有多队列那么默认是cpu0来处理中断）,并且绑定了core 0和core 1,那么可以通过这个设置避免swoole的线程或者进程绑定到这2个core，防止cpu0，1被耗光而造成的丢包\r\n];\r\n\r\n// 基本模式\r\n//$mode = SWOOLE_BASE;\r\n// 多进程模式（默认）\r\n$mode = SWOOLE_PROCESS;\r\n\r\n//创建Server对象，监听 127.0.0.1:9501端口\r\n$serv = new \\Swoole\\Server('127.0.0.1', 9501, $mode, SWOOLE_SOCK_TCP);\r\n\r\n$serv->set($config);\r\n\r\n// 启动后在主进程（master）的主线程回调此函数\r\n$serv->on('start', function ($serv) {\r\n    // onStart回调中，仅允许echo、打印Log、修改进程名称\r\n    echo 'on start event' . PHP_EOL;\r\n});\r\n\r\n$serv->on('ManagerStart', function ($serv) {\r\n    echo 'on ManagerStart event' . PHP_EOL;\r\n});\r\n\r\n$serv->on('ManagerStop', function ($serv) {\r\n    echo 'on ManagerStop event' . PHP_EOL;\r\n});\r\n\r\n$serv->on('WorkerStart', function ($serv, $worker_id){\r\n    echo 'on WorkerStart event $worker_id->' .$worker_id. PHP_EOL;\r\n});\r\n\r\n$serv->on('WorkerStop', function ($serv, $worker_id){\r\n    echo 'on WorkerStop event $worker_id->' .$worker_id. PHP_EOL;\r\n});\r\n\r\n// 仅在开启reload_async特性后有效\r\n$serv->on('WorkerExit', function ($serv, $worker_id){\r\n    echo 'on WorkerExit event $worker_id->' .$worker_id. PHP_EOL;\r\n});\r\n\r\n$serv->on('shutdown', function ($serv) {\r\n    echo 'on shutdown event' . PHP_EOL;\r\n});\r\n\r\n//监听连接进入事件\r\n$serv->on('connect', function ($serv, $fd, int $reactorId) {\r\necho 'on connect $reactorId->'. $reactorId . PHP_EOL;\r\n});\r\n\r\n//监听数据接收事件\r\n$serv->on('receive', function ($serv, $fd, $reactorId, $data) {\r\n    echo 'on receive $reactorId->'. $reactorId . PHP_EOL;\r\n\r\n    //投递异步任务\r\n    //$task_id = $serv->task($data);\r\n    //echo \"Dispath AsyncTask: id=$task_id\\n\";\r\n\r\n    $serv->send($fd, \"Server: \".$data);\r\n});\r\n\r\n// 接收到UDP数据包时回调此函数，发生在worker进程中\r\n$serv->on('Packet', function ($server, string $data, array $client_info) {\r\n    echo 'on Packet' . PHP_EOL;\r\n});\r\n\r\n$serv->on('PipeMessage', function ($server, int $src_worker_id, mixed $message) {\r\n    echo 'on PipeMessage $src_worker_id->'.$src_worker_id . PHP_EOL;\r\n});\r\n\r\n$serv->on('WorkerError', function ($serv, int $worker_id, int $worker_pid, int $exit_code, int $signal) {\r\n    echo 'on WorkerError' . PHP_EOL;\r\n});\r\n\r\n//监听连接关闭事件\r\n$serv->on('Close', function ($serv, $fd, $reactorId) {\r\necho \"Client: Close.\\n\";\r\n});\r\n\r\n$serv->on('task', function ($serv, int $task_id, int $src_worker_id, mixed $data) {\r\n    echo 'on task event' . PHP_EOL;\r\n    echo \"New AsyncTask[id=$task_id]\".PHP_EOL;\r\n    //返回任务执行的结果\r\n    $serv->finish(\"$data -> OK\");\r\n});\r\n\r\n$serv->on('finish', function ($serv, int $task_id, string $data) {\r\n    echo 'on finish event' . PHP_EOL;\r\n    echo \"AsyncTask[$task_id] Finish: $data\".PHP_EOL;\r\n});\r\n\r\n//启动服务器\r\n$serv->start();\r\n```\r\n\r\n客户端：\r\n\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Client;\r\n\r\n$client = new Client(SWOOLE_SOCK_TCP, SWOOLE_SOCK_ASYNC);\r\n\r\n        $client->on('connect', function (Client $cli) {\r\n\r\n            $cli->send('aaaa');\r\n        });\r\n\r\n        $client->on('receive',function (Client $cli, $data) {\r\n\r\n            var_dump($data);\r\n            var_dump($cli->close());\r\n        });\r\n\r\n        $client->on('error', function (Client $cli) {\r\n            echo 'fail Connection error' . PHP_EOL;\r\n        });\r\n\r\n        $client->on('close', function (Client $cli) {\r\n\r\n        });\r\n\r\n        $client->connect('127.0.0.1', 9501);\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-08-25T00:35:57Z",
        "body": "请在 client 程序末尾添加 `Swoole\\Event::wait()` ，否则 close 发生在 shutdown 阶段，可能导致内存异常，底层做了保护，在这个阶段不执行 close\r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-08-25T00:37:27Z",
        "body": "另外，不建议使用 异步回调客户端，请使用协程 API，此模块已废弃，在新版本中即将移除。"
      }
    ]
  },
  {
    "number": 2759,
    "title": "How can I see coroutine http2_client GOAWAY payload data ?",
    "created_at": "2019-08-15T11:34:17Z",
    "closed_at": "2019-11-28T02:13:35Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2759",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nWe use http2_client to send push notification to apple devices. Apple closes the connection in the middle of the sending/receiving process. Apple document says that : APNs may also terminate a connection by sending a GOAWAY frame. The payload of the GOAWAY frame includes JSON data with a reason key. \r\n\r\nHow can we see GOAWAY frame payload data ? Because it's happening so much and we can not see the root cause to fix the problem. \r\n\r\n2. What did you expect to see?\r\n\r\nI need to see GOAWAY frame payload data to fix the connection problem.\r\n\r\n3. What did you see instead?\r\n\r\nI can not see GOAWAY payload data.\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.3\r\nBuilt => Aug  3 2019 08:09:04\r\ncoroutine => enabled\r\ntrace_log => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.0.2k-fips  26 Jan 2017\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nphp 7.3.8,  aws linux\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2759/comments",
    "author": "ozgurhangisi",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-08-16T04:17:53Z",
        "body": "after the connection closed, you can read the following properties to get the information of goaway frame:\r\n```php\r\n$client->errCode\r\n$client->errMsg\r\n$client->serverLastStreamId\r\n```\r\n"
      },
      {
        "user": "ozgurhangisi",
        "created_at": "2019-08-26T11:18:10Z",
        "body": "@twose Thanks for the response. I updated to swoole 4.4.4 and now there is another problem.\r\n\r\nI see lots of errCode=3 and errMsg=Window size overflow for stream: 0. errors. Almost every request that I send to apple notification system has problem. Connection is closing  and I see Window size overflow for stream: 0. message on error log ($client->errMsg value) \r\n\r\nSo I'm not sure but I suspect that this error can be related with swoole http2 client? \r\n"
      },
      {
        "user": "twose",
        "created_at": "2019-08-27T07:11:56Z",
        "body": "@ozgurhangisi\r\nCan you give me the code?\r\nThe problem may be related to the HTTP2 flow control window size, Apple may have special restrictions"
      },
      {
        "user": "ozgurhangisi",
        "created_at": "2019-08-27T13:17:21Z",
        "body": "@twoose I'm quite busy this week but next week I'll try to reproduce the error with my apple certificate and send you to the summarized code via email.\r\n\r\nThanks,\r\nOzgur."
      },
      {
        "user": "twose",
        "created_at": "2019-08-29T04:08:35Z",
        "body": "@ozgurhangisi Thanks for your feedback"
      }
    ]
  },
  {
    "number": 2755,
    "title": "swoole_table  Killed",
    "created_at": "2019-08-14T02:40:59Z",
    "closed_at": "2019-08-14T06:37:48Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2755",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n```shell\r\nphp test.php\r\n```\r\n-------------- test.php --------------\r\n```php\r\n$swoole_table = new swoole_table(5242880);\r\n$swoole_table->column('providers', swoole_table::TYPE_STRING, 1024);\r\n$swoole_table->create();\r\n$str = str_pad('a', 2024, \"a\", STR_PAD_LEFT);\r\n$stat = $swoole_table->set(\"abcd\", ['providers' => $str]);\r\nvar_dump($stat);\r\n```\r\n\r\n\r\n2. What did you expect to see?\r\n期望执行成功，如果出现错误给出错误或警告信息\r\n\r\n\r\n3. What did you see instead?\r\nKilled\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n```ini\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.3\r\nBuilt => Aug 10 2019 16:09:22\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n```\r\nCentos:\r\nLinux c4e00a058941 4.9.93-linuxkit-aufs #1 SMP Wed Jun 6 16:55:56 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nGCC:\r\ngcc (GCC) 4.8.5 20150623 (Red Hat 4.8.5-28)\r\nCopyright (C) 2015 Free Software Foundation, Inc.\r\nThis is free software; see the source for copying conditions.  There is NO\r\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE\r\n\r\nPHP:\r\n\r\nPHP Version => 7.2.21\r\n\r\nSystem => Linux c4e00a058941 4.9.93-linuxkit-aufs #1 SMP Wed Jun 6 16:55:56 UTC 2018 x86_64\r\nBuild Date => Aug 10 2019 15:48:45\r\nConfigure Command =>  './configure'  '--prefix=/usr/local/php' '--with-fpm-user=devops' '--with-fpm-group=devops' '--enable-fpm' '--enable-ctype' '--enable-ftp' '--enable-session' '--with-c\r\nurl' '--with-gettext' '--enable-intl' '--with-mcrypt' '--enable-bcmath' '--enable-pdo' '--enable-mysqlnd' '--with-pdo-mysql' '--enable-json' '--enable-zip' '--with-zlib' '--with-png-dir' '-\r\n-with-freetype-dir' '--with-jpeg-dir' '--with-gd' '--with-iconv' '--with-jpeg-dir=/usr/lib64/' '--enable-hash' '--enable-fileinfo' '--with-openssl' '--enable-xml' '--enable-libxml' '--with-\r\npear' '--enable-filter' '--enable-mbstring' '--with-sqlite3' '--enable-debug' '--enable-phpdbg-debug' '--enable-zend-test'\r\nServer API => Command Line Interface\r\nVirtual Directory Support => disabled\r\nConfiguration File (php.ini) Path => /usr/local/php/lib\r\nLoaded Configuration File => /usr/local/php/lib/php.ini\r\nScan this dir for additional .ini files => (none)\r\nAdditional .ini files parsed => (none)\r\nPHP API => 20170718\r\nPHP Extension => 20170718\r\nZend Extension => 320170718\r\nZend Extension Build => API320170718,NTS,debug\r\nPHP Extension Build => API20170718,NTS,debug\r\nDebug Build => yes\r\nThread Safety => disabled\r\nZend Signal Handling => enabled\r\nZend Memory Manager => enabled\r\nZend Multibyte Support => provided by mbstring\r\nIPv6 Support => enabled\r\nDTrace Support => disabled\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2755/comments",
    "author": "crazyxman",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-08-14T06:37:48Z",
        "body": "Table申请的内存太大了，你的程序被操作系统KILL掉了，要设置小一点。"
      }
    ]
  },
  {
    "number": 2742,
    "title": "[疑问]block or unblock?",
    "created_at": "2019-08-06T21:21:10Z",
    "closed_at": "2019-08-07T10:25:47Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2742",
    "body": "```$serv = new Swoole\\Http\\Server(\"127.0.0.1\", 9502);\r\n\r\n$serv->on('Request', function($request, $response) {\r\n    //等待10 seconds后向浏览器发送响应\r\n    Swoole\\Coroutine::sleep(10);\r\n    $response->end(\"<h1>Hello Swoole!</h1>\");\r\n});\r\n\r\n$serv->start();\r\n```\r\n\r\n我在浏览器开了4个tab.（4个worker) 理想状态下4个tab应该同时响应。但是事实上确实每隔10秒响应一个。是不是哪里有问题？",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2742/comments",
    "author": "jp928",
    "comments": [
      {
        "user": "jp928",
        "created_at": "2019-08-07T02:18:38Z",
        "body": "Just rewrite in english in case someone can explain.\r\nI made a snippet as below to test concurrency.\r\n```\r\n$serv->on('Request', function($request, $response) {\r\n    //waiting for 10 seconds\r\n    Swoole\\Coroutine::sleep(10);\r\n    $response->end(\"<h1>Hello Swoole!</h1>\");\r\n});\r\n\r\n$serv->start();\r\n```\r\n\r\nThen I opened 4 tabs in browser to test. My expectations is after 10 seconds, all tabs should be able to get response. However, they are blocked. After every 10 seconds I will get a tab works."
      },
      {
        "user": "Yurunsoft",
        "created_at": "2019-08-07T05:13:43Z",
        "body": "用 ab 测试一下，浏览器有时候有并发限制"
      },
      {
        "user": "sy-records",
        "created_at": "2019-08-07T05:19:37Z",
        "body": "用的chrome浏览器吗？chrome会对完全一样的url做并发请求限制。可以在请求时加上一个随机数，例如127.0.0.1:9501/?t=1,127.0.0.1:9501/?t=2,127.0.0.1:9501/?t=3 @jp928 "
      },
      {
        "user": "jp928",
        "created_at": "2019-08-07T09:31:16Z",
        "body": "@sy-records 谢谢回复。\r\n我查了一下 chrome 并发数量是6。 为什么我4个tab 就不行了？"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-08-07T10:25:47Z",
        "body": "使用 curl 或者 ab 测试，请勿使用 chrome "
      }
    ]
  },
  {
    "number": 2738,
    "title": "In SWOOLE_KEEP mode, asynchronous security restart invalid",
    "created_at": "2019-08-05T08:56:55Z",
    "closed_at": "2019-08-06T11:43:32Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2738",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nServer: max_request=10\r\nClient: $swooleClient = new swoole_client(SWOOLE_SOCK_TCP|SWOOLE_KEEP)\r\n\r\n客户端请求时添加 SWOOLE_KEEP 配置，服务端在请求达到max_request时会异步重启进程，此时客户端recv()会得到false，服务端的旧Worker没完成所有事件就自行退出了。\r\n\r\n2. What did you expect to see?\r\n\r\n客户端请求时添加 SWOOLE_KEEP 配置，在 max_request触发时也可以实现异步安全重启。\r\n\r\n3. What did you see instead?\r\n\r\n服务端max_request触发时客户端recv()得到了false\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.0-alpha\r\nBuilt => May 13 2019 15:06:20\r\ncoroutine => enabled\r\nkqueue => enabled\r\nrwlock => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nbrotli => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 262144 => 262144\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nmac与linux问题都存在\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2738/comments",
    "author": "laynefyc",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-08-05T10:57:49Z",
        "body": "这版本号太迷了, 不补充信息此issue直接忽略了"
      },
      {
        "user": "laynefyc",
        "created_at": "2019-08-05T11:10:58Z",
        "body": "应该不是特定版本的关系，我尝试过 4.4.0-alpha，1.9.23， 4.3.5  都有该问题。"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-08-06T11:43:32Z",
        "body": "你需要設置 length 或 eof 协议处理，这样 worker 进程在 onReceive 收到的就是完整的包。max_request 就可以正确处理。另外，如果你用了 SWOOLE_KEEP ，那需要验证 request id"
      },
      {
        "user": "laynefyc",
        "created_at": "2019-08-07T02:13:34Z",
        "body": "> 你需要設置 length 或 eof 协议处理，这样 worker 进程在 onReceive 收到的就是完整的包。max_request 就可以正确处理。另外，如果你用了 SWOOLE_KEEP ，那需要验证 request id\r\n\r\n感谢解答。我需要使用SWOOLE_KEEP，但是不知道验证 request id是在哪里做？异步安全重启时 onReceive 已经不能触发，只看到触发了onWorkerStop。"
      }
    ]
  },
  {
    "number": 2724,
    "title": "协程http客户端升级成websocket的时候recv()遇到的问题",
    "created_at": "2019-07-30T10:24:11Z",
    "closed_at": "2019-07-31T11:11:10Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2724",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n        $client = new \\Swoole\\Coroutine\\Http\\Client($url['host'], 443, true);\r\n        $client->setHeaders($headers);\r\n//        $client->set([['timeout' => 300]]);\r\n//            $client->set(['keep_alive' => true]);\r\n        $client->set([\r\n            'keep_alive' => true,\r\n//                'open_length_check'     => 1,\r\n//                'package_length_type'   => 'N',\r\n//                'package_length_offset' => 10000,       //第N个字节是包长度的值\r\n//                'package_body_offset'   => 100,       //第几个字节开始计算长度\r\n//                'package_max_length' => 200000000,  //协议最大长度\r\n//                'open_length_check'     => true,\r\n//                'package_length_type'   => 'N',\r\n//                'package_length_offset' => 0,       //第N个字节是包长度的值\r\n//                'package_body_offset'   => 4000,       //第几个字节开始计算长度\r\n//                'package_max_length'    => 200000000,  //协议最大长度\r\n            'open_eof_check' => true,\r\n            'package_eof' => \"\\r\\n\\r\\n\",\r\n//                'package_max_length' => 1024 * 1024 * 2,\r\n        ]);\r\n        go(function () use ($client, $url) {\r\n            echo $client->upgrade($url['path']) . PHP_EOL;\r\n            while (true) {\r\n                $msg = $client->recv();\r\n                echo $msg . PHP_EOL;\r\n            }\r\n        });\r\n2. What did you expect to see?\r\n把协程http客户端升级成websocket客户端接受消息推送。\r\n\r\n\r\n3. What did you see instead?\r\n在接受小的数据的数据的时候是正常的，而在接受大的数据的时候会被切断如下\r\n\r\n~{\"type\":\"face\",\"id\":\"6512d470-643e-488c-81be-f2787b90acc0\",\"areas\":[{\"id\":\"3a23b802-6428-4b82-82ba-c89f2df2ded9\",\"name\":\"地产\",\"status\":\"stay\",\"times\":1,\"count\":2,\"startTime\":\"2019-07-30T18:10:27.824+08:00\"},{\"id\":\"f82e4de7-28b7-4551-b3dd-56538b0fc33d\",\"name\":\"南\",\"status\":\"stay\",\"times\":1,\"count\":2,\"startTime\":\"2019-07-30T18:10:27.824+08:00\"},{\"id\":\"8b05e436-7d12-44fe-8b84-d12f812320b7\",\"name\":\"1层\",\"status\":\"stay\",\"times\":1,\"count\":2,\"startTime\":\"2019-07-30T18:10:27.824+08:00\"},{\"id\":\"2e44eca3-b5be-466d-afd2-cbf1915a0f77\",\"name\":\"沙盘2\",\"status\":\"stay\",\"times\":1,\"count\":2,\"startTime\":\"2019-07-30T18:10:27.824+08:00\"}],\"capture\":{\"id\":\"271b443e-3d9f-4c64-7602-709c8477baad\",\"image\":\"http:\",\"time\":\"2019-07-30T18:10:48.583+08:00\",\"location\":{\"id\":\"ba40baa3-54e9-4a98-9c2f-1a06845c6e25\",\"name\":\"2\"},\"attribute\":{\"age\":45,\"gender\":\"male\",\"glass\":\"noGlass\",\"hat\":\"noHat\"},\"quality\":{\"qualified\":true,\"score\":0.9\r\n�9076666}},\"meta\":{\"time\":\"2019-07-30T18:10:49.929+08:00\"}}\r\n�;{\"type\":\"keepalive\",\"meta\":{\"time\":\"2019-07-30T10:11:10Z\"}}\r\n�;{\"type\":\"keepalive\",\"meta\":{\"time\":\"2019-07-30T10:11:30Z\"}}\r\n�\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.3.6\r\nBuilt => Jul 22 2019 18:01:27\r\ncoroutine => enabled\r\nkqueue => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.0.2s  28 May 2019\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nbrotli => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 262144 => 262144\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\nphp7.3\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2724/comments",
    "author": "shumuyoucun",
    "comments": [
      {
        "user": "shumuyoucun",
        "created_at": "2019-07-31T07:08:36Z",
        "body": "// 'open_length_check' => 1,\r\n// 'package_length_type' => 'N',\r\n// 'package_length_offset' => 10000, //第N个字节是包长度的值\r\n// 'package_body_offset' => 100, //第几个字节开始计算长度\r\n// 'package_max_length' => 200000000, //协议最大长度\r\n// 'open_length_check' => true,\r\n// 'package_length_type' => 'N',\r\n// 'package_length_offset' => 0, //第N个字节是包长度的值\r\n// 'package_body_offset' => 4000, //第几个字节开始计算长度\r\n// 'package_max_length' => 200000000, //协议最大长度\r\n'open_eof_check' => true,\r\n'package_eof' => \"\\r\\n\\r\\n\",\r\n// 'package_max_length' => 1024 * 1024 * 2,\r\n\r\n设置包大小的方式 都用了 。没有起到作用"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-07-31T11:11:04Z",
        "body": "finish = 0 的帧，需要进行合并，可以参考相关文档。 "
      }
    ]
  },
  {
    "number": 2723,
    "title": "4.4.2 Coroutine\\Http\\Server->set 不工作",
    "created_at": "2019-07-29T11:23:08Z",
    "closed_at": "2019-07-29T11:49:14Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2723",
    "body": "代码如下：\r\n\r\n```php\r\nCo\\run(function (){\r\n    $server = new Co\\Http\\Server(\"127.0.0.1\", 9502, false);\r\n    $server->set([\r\n        'worker_num' => 4,\r\n    ]);\r\n    $server->handle('/', function ($request, $response) {\r\n        $response->end(\"<h1>Index</h1>\");\r\n    });\r\n    $server->handle('/test', function ($request, $response) {\r\n        $response->end(\"<h1>Test</h1>\");\r\n    });\r\n    $server->handle('/stop', function ($request, $response) use ($server) {\r\n        $response->end(\"<h1>Stop</h1>\");\r\n        $server->shutdown();\r\n    });\r\n    $server->start();\r\n});\r\n```\r\n\r\n但是只有一个worker进程。\r\n\r\nswoole版本号为：4.4.2",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2723/comments",
    "author": "minr",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-07-29T11:49:14Z",
        "body": "Co\\Http\\Server 就是单进程的，不支持设置 `worker_num`"
      }
    ]
  },
  {
    "number": 2720,
    "title": "enable_static_handler not support http_compression",
    "created_at": "2019-07-29T05:37:55Z",
    "closed_at": "2019-07-29T07:26:53Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2720",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n```php\r\n$http = new Server('0.0.0.0', 9998);\r\n$http->set([\r\n    'http_compression' => true,\r\n    'enable_static_handler' => true,\r\n    'document_root' => __DIR__ . '/../public/',\r\n    'static_handler_locations' => ['/static', '/upload', '/favicon.ico', '/robots.txt'],\r\n]);\r\n$http->on('Request', function (Request $request, Response $response): void {\r\n    $response->end(time());\r\n});\r\ndump($http->ports[0]);\r\n$http->start();\r\n```\r\n\r\n\r\n2. What did you expect to see?\r\nContent-Encoding: gzip\r\n\r\n\r\n3. What did you see instead?\r\n静态文件资源没有被压缩\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n```\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.2\r\nBuilt => Jul 26 2019 08:07:54\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1c  28 May 2019\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\nPHP 7.2.20-2+ubuntu18.04.1+deb.sury.org+1 (cli)\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2720/comments",
    "author": "NHZEX",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-07-29T07:19:22Z",
        "body": "鱼和熊掌不可兼得，如果想要压缩就得将文件内容先拷入内存后进行压缩再发送，如果想要0拷贝就必须直接使用sendfile发送，视情况选择，static_handler只支持直接发送文件"
      },
      {
        "user": "NHZEX",
        "created_at": "2019-07-29T07:26:53Z",
        "body": "好的，用另外得方案解决。\r\n谢谢~"
      }
    ]
  },
  {
    "number": 2714,
    "title": "关闭server时出现警告信息",
    "created_at": "2019-07-26T08:53:54Z",
    "closed_at": "2019-07-29T04:38:08Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2714",
    "body": "PHP 7.3.4\r\nSwoole 4.4.2\r\n\r\nkill -15 master_pid\r\n\r\nINFO\tServer is shutdown now\r\nWARNING\tswWorker_reactor_is_empty (ERRNO 9012): worker exit timeout, forced to terminate\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2714/comments",
    "author": "zuozhehao",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-07-26T09:27:15Z",
        "body": "Worker 进程内的 定时器 或者 event::add 句柄未清理导致。"
      },
      {
        "user": "NHZEX",
        "created_at": "2019-07-26T10:52:08Z",
        "body": "> Worker 进程内的 定时器 或者 event::add 句柄未清理导致。\r\n\r\n同遇到问题，但 WorkerStop 事件总是在超时后才会回调，但没有地方清理。\r\n\r\nswoole-4.4.2\r\nphp-7.2.20\r\n测试代码\r\n```php\r\n$http = new Server('0.0.0.0', 9998);\r\n$http->set(['daemonize' => false, 'dispatch_mode' => 2, 'worker_num' => 4, 'enable_coroutine' => true]);\r\n$http->on('Request', function (Request $request, Response $response): void {\r\n    $response->end(time());\r\n});\r\n$http->on('WorkerStart', function (Server $server): void {\r\n    Timer::tick(3000, function () {\r\n    });\r\n    echo \"WorkerStart#{$server->worker_pid}\\n\";\r\n});\r\n$http->on('WorkerStop', function (Server $server): void {\r\n    $data = date('Y-m-d H:i:s');\r\n    echo \"[{$data}]WorkerStop#{$server->worker_pid}\\n\";\r\n});\r\n$http->on('Shutdown', function () {\r\n    echo \"[]ServerShutdown\\n\";\r\n});\r\n$http->start();\r\n```\r\n输出信息\r\n```\r\nWorkerStart#7420\r\nWorkerStart#7422\r\nWorkerStart#7423\r\nWorkerStart#7421\r\n[2019-07-26 10:49:14 #7414.4]\tINFO\tServer is shutdown now\r\n[2019-07-26 10:49:44 *7420.0]\tWARNING\tswWorker_reactor_is_empty (ERRNO 9012): worker exit timeout, forced to terminate\r\n[2019-07-26 10:49:44]WorkerStop#7420\r\n[2019-07-26 10:49:44 *7422.2]\tWARNING\tswWorker_reactor_is_empty (ERRNO 9012): worker exit timeout, forced to terminate\r\n[2019-07-26 10:49:44 *7423.3]\tWARNING\tswWorker_reactor_is_empty (ERRNO 9012): worker exit timeout, forced to terminate\r\n[2019-07-26 10:49:44]WorkerStop#7422\r\n[2019-07-26 10:49:44]WorkerStop#7423\r\n[2019-07-26 10:49:44 *7421.1]\tWARNING\tswWorker_reactor_is_empty (ERRNO 9012): worker exit timeout, forced to terminate\r\n[2019-07-26 10:49:44]WorkerStop#7421\r\n[]ServerShutdown\r\n```"
      },
      {
        "user": "NHZEX",
        "created_at": "2019-07-27T05:55:23Z",
        "body": "问题解决，监听 WorkerExit 事件，完成清理即可正常退出。"
      }
    ]
  },
  {
    "number": 2713,
    "title": "kill master process sub process 也退出了",
    "created_at": "2019-07-26T07:15:23Z",
    "closed_at": "2019-07-31T04:44:55Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2713",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\nswoole  版本\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.3.5\r\nBuilt => Jul 19 2019 09:24:42\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.0j  20 Nov 2018\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\nprocess进程管理的时候，主进程kill后，子进程直接退出了，这个可以设置吗？主进程kill后，子进程事情处理完成后再退出？\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2713/comments",
    "author": "salterping",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-07-26T09:27:46Z",
        "body": "监听一下 SIGTERM 信号，自行退出。"
      },
      {
        "user": "salterping",
        "created_at": "2019-07-29T02:26:02Z",
        "body": "> 监听一下 SIGTERM 信号，自行退出。\r\n\r\n我这个是跑在容器里面的，然后swoole的启动是采用非守护进程的方式，容器重启的时候，会发送SIGTERM信号，可是无法捕获这个信号哈？这个要怎么处理\r\n`/**\r\n * 启动进程管理\r\n */\r\npublic function start()\r\n{\r\n    if (! $this->_configName) {\r\n        die(\"please set config name first\");\r\n    }\r\n    $this->processCheck();\r\n}\r\n\r\n/**\r\n * 进程检测\r\n */\r\npublic function processCheck()\r\n{\r\n\r\n    $this->initProcess();\r\n    while($ret = \\swoole_process::wait(false)) {\r\n        switch ($ret['signal']){\r\n            case SIGUSR1:\r\n                $this->restartWorker();\r\n                break;\r\n            case SIGTERM:\r\n                $this->gracefulExit();\r\n                break;\r\n            default:\r\n                $this->workerExit($ret);\r\n                break;\r\n        }\r\n    }\r\n    swoole_process::signal(SIGINT, function($signo) {\r\n        echo 'ProcessSignoSIGINT' . \"\\n\";\r\n    });\r\n    swoole_process::signal(SIGTERM, function($signo) {\r\n        echo 'ProcessSignoSIGTERM' . \"\\n\";\r\n    });\r\n    sleep(1);\r\n    $this->processCheck();\r\n}`"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-07-31T04:44:55Z",
        "body": "在 UserProcess 进程中使用 pcntl_signal 或 Process::signal 监听 SIGTERM 信号，实现退出逻辑。"
      }
    ]
  },
  {
    "number": 2712,
    "title": "global variables and threads",
    "created_at": "2019-07-25T14:29:34Z",
    "closed_at": "2019-08-27T10:43:10Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2712",
    "body": "Hi folks,\r\n\r\nI'm trying to understand thread and swoole\r\n\r\ni did this counter at global variable. It's the right way? should i consider other option (swoole table/atomic)? is \"thread safe\" do this, or a lock should be used when $counter++ ?\r\n\r\ncode:\r\n```php\r\n<?php\r\n@dl('swoole.so');\r\n\r\n$counter = 0;\r\n$http = new swoole_http_server('php', 8080);\r\n$http->set([\r\n    'worker_num' => 4,\r\n]);\r\n\r\n$http->on('request', function ($request, $response) use (&$counter) {\r\n#    echo \"counter:\";\r\n#    print_r($request);\r\n#    echo \"\\n\";\r\n    $response->header(\"Content-Type\", \"text/plain\");\r\n    $response->end($counter++);\r\n});\r\n$http->start();\r\n\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2712/comments",
    "author": "rspadim",
    "comments": [
      {
        "user": "huanghantao",
        "created_at": "2019-07-26T03:32:31Z",
        "body": "By the way, I use xdebug to print the reference count of $counter, there are some questions.\r\ncode show as below:\r\n```php\r\n<?php\r\n\r\n$counter = 0;\r\nxdebug_debug_zval('counter');\r\n$http = new swoole_http_server('php', 8080);\r\n$http->set([\r\n    'worker_num' => 4,\r\n    'enable_coroutine' => false,\r\n]);\r\n\r\n$http->on('request', function ($request, $response) use (&$counter) {\r\n    xdebug_debug_zval('counter');\r\n    $response->header(\"Content-Type\", \"text/plain\");\r\n    $response->end($counter++);\r\n});\r\nxdebug_debug_zval('counter');\r\n$http->start();\r\n```\r\nWhen I start the server, the output is as follows:\r\n```shell\r\n~/codeDir/phpCode/test/swoole # php issue_2712.php \r\ncounter: (refcount=0, is_ref=0)=0\r\ncounter: (refcount=2, is_ref=1)=0\r\n```\r\nWhen I use curl to request a server, the output is as follows:\r\n```shell\r\ncounter: (refcount=3, is_ref=1)=0\r\n```\r\nWhy is the reference count here changed to 3?"
      },
      {
        "user": "rspadim",
        "created_at": "2019-07-26T10:53:38Z",
        "body": "Probably chrome favico.ico 403 return that you didn’t checked at network traffic, chrome don’t have good habits :P\r\n\r\nThe ++ in php isn’t a atomic operator? I say, can i have a unref set when doimg this and a possible segment fault?"
      },
      {
        "user": "doubaokun",
        "created_at": "2019-07-28T18:25:30Z",
        "body": "@rspadim The global variable are isolated within each worker process, but should not be updated crossing workers. Please use external storage like `swoole_table` or Redis, MySQL."
      },
      {
        "user": "doubaokun",
        "created_at": "2019-07-28T18:27:00Z",
        "body": "@huanghantao xdebug is not supported by Swoole yet. Could you please open a new thread about xdebug? "
      },
      {
        "user": "huanghantao",
        "created_at": "2019-07-29T11:02:20Z",
        "body": "@doubaokun \r\nI have disable the coroutine."
      },
      {
        "user": "doubaokun",
        "created_at": "2019-08-27T10:43:10Z",
        "body": "I am closing this thread for now, feel free to open a new issues about the xdebug issue."
      }
    ]
  },
  {
    "number": 2701,
    "title": "swoole协程http客户端 把回调函数去掉了，onclose和onerror事件怎么监听？",
    "created_at": "2019-07-18T16:47:55Z",
    "closed_at": "2019-07-19T01:52:46Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2701",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n想监听http client 的onclose事件\r\n\r\n2. What did you expect to see?\r\n\r\n可以做到监听onclose事件\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2701/comments",
    "author": "longyue188",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-07-19T01:52:46Z",
        "body": "首先，HTTP客户端是自动重连的。\r\n其次，协程的编程模式和同步模式如出一辙，不要因为写多了异步就转换不了思维，比如：CURL怎么监听onClose和onError？同步编程里不需要这些东西，当请求出错了立即处理就好了。\r\n"
      }
    ]
  },
  {
    "number": 2679,
    "title": "MacOS MoJave10.14.5编译安装swoolev4.4.0失败",
    "created_at": "2019-07-12T07:03:49Z",
    "closed_at": "2019-07-12T13:48:20Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2679",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n```\r\n phpize-7.3.5 \r\n./configure  \r\nsudo make && make install\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n正常安装swoole\r\n\r\n3. What did you see instead?\r\n\r\n安装的扩展目录不是我预期的\r\n```\r\nInstalling shared extensions:     /usr/lib/php/extensions/no-debug-non-zts-20160303/\r\ncp: /usr/lib/php/extensions/no-debug-non-zts-20160303/#INST@26485#: Permission denied\r\nmake: *** [install-modules] Error 1\r\n```\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\ngit clone的最新版本v4.4.0\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nOS: MacOS Mojave10.14.5 ，已经关掉了rootless(csrutil disable)\r\nPHP:**包含默认的php7.1.23 还有我自己安装XAMPP包含的7.3.5**\r\n```\r\n$ gcc -v\r\nConfigured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/usr/include/c++/4.2.1\r\nApple LLVM version 10.0.1 (clang-1001.0.46.4)\r\nTarget: x86_64-apple-darwin18.6.0\r\nThread model: posix\r\nInstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin\r\n```\r\n\r\n\r\n\r\n-----------------------------安装过程（使用XAMPP的PHP7.3.5）--------------------------\r\n```\r\n$ phpize-7.3.5 .\r\nConfiguring for:\r\nPHP Api Version:         20180731\r\nZend Module Api No:      20180731\r\nZend Extension Api No:   320180731\r\n\r\n$ ./configure\r\nchecking for grep that handles long lines and -e... /usr/bin/grep\r\nchecking for egrep... /usr/bin/grep -E\r\nchecking for a sed that does not truncate output... /usr/bin/sed\r\nchecking for cc... cc\r\nchecking whether the C compiler works... yes\r\nchecking for C compiler default output file name... a.out\r\nchecking for suffix of executables... \r\nchecking whether we are cross compiling... no\r\nchecking for suffix of object files... o\r\nchecking whether we are using the GNU C compiler... yes\r\nchecking whether cc accepts -g... yes\r\nchecking for cc option to accept ISO C89... none needed\r\nchecking how to run the C preprocessor... cc -E\r\nchecking for icc... no\r\nchecking for suncc... no\r\nchecking whether cc understands -c and -o together... yes\r\nchecking for system library directory... lib\r\nchecking if compiler supports -R... no\r\nchecking if compiler supports -Wl,-rpath,... yes\r\nchecking build system type... x86_64-apple-darwin18.6.0\r\nchecking host system type... x86_64-apple-darwin18.6.0\r\nchecking target system type... x86_64-apple-darwin18.6.0\r\nchecking for PHP prefix... /usr\r\nchecking for PHP includes... -I/usr/include/php -I/usr/include/php/main -I/usr/include/php/TSRM -I/usr/include/php/Zend -I/usr/include/php/ext -I/usr/include/php/ext/date/lib\r\nchecking for PHP extension directory... /usr/lib/php/extensions/no-debug-non-zts-20160303\r\nchecking for PHP installed headers prefix... /usr/include/php\r\n....\r\n\r\n```\r\n\r\n这里发现默认用的是系统自带的PHP，以及默认的扩展目录\r\n```\r\nsudo make && make install \r\nBuild complete.\r\nDon't forget to run 'make test'.\r\n....\r\ndsymutil .libs/swoole.so || :\r\ncreating swoole.la\r\n(cd .libs && rm -f swoole.la && ln -s ../swoole.la swoole.la)\r\n/bin/sh /Users/spark/work/downloads/swoole-src/libtool --mode=install cp ./swoole.la /Users/spark/work/downloads/swoole-src/modules\r\ncp ./.libs/swoole.so /Users/spark/work/downloads/swoole-src/modules/swoole.so\r\ncp ./.libs/swoole.lai /Users/spark/work/downloads/swoole-src/modules/swoole.la\r\n----------------------------------------------------------------------\r\nLibraries have been installed in:\r\n   /Users/spark/work/downloads/swoole-src/modules\r\n\r\nIf you ever happen to want to link against installed libraries\r\nin a given directory, LIBDIR, you must either use libtool, and\r\nspecify the full pathname of the library, or use the `-LLIBDIR'\r\nflag during linking and do at least one of the following:\r\n   - add LIBDIR to the `DYLD_LIBRARY_PATH' environment variable\r\n     during execution\r\n\r\nSee any operating system documentation about shared libraries for\r\nmore information, such as the ld(1) and ld.so(8) manual pages.\r\n----------------------------------------------------------------------\r\n\r\n\r\nInstalling shared extensions:     /usr/lib/php/extensions/no-debug-non-zts-20160303/\r\ncp: /usr/lib/php/extensions/no-debug-non-zts-20160303/#INST@26485#: Permission denied\r\nmake: *** [install-modules] Error 1\r\n```\r\n\r\n\r\n请问如何指定我自己安装的PHP路径及扩展路径，指定后可否解决此问题？\r\n\r\n感谢，\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2679/comments",
    "author": "sparky1",
    "comments": [
      {
        "user": "phper08",
        "created_at": "2019-07-12T08:07:55Z",
        "body": "个人建议：\r\n1、phpize 用绝对路径；\r\n2、./configure 加上 --with-phpize= 加绝对路径\r\n3、make 和 make install 分开，先 make，然后 sudo make install"
      },
      {
        "user": "sparky1",
        "created_at": "2019-07-12T09:22:33Z",
        "body": "> 个人建议：\r\n> 1、phpize 用绝对路径；\r\n> 2、./configure 加上 --with-phpize= 加绝对路径\r\n> 3、make 和 make install 分开，先 make，然后 sudo make install\r\n\r\n我用了绝对路径，也加了参数，但还是找的系统默认的PHP\r\n`$ /Applications/XAMPP/bin/phpize-7.3.5 .\r\nConfiguring for:\r\nPHP Api Version:         20180731\r\nZend Module Api No:      20180731\r\nZend Extension Api No:   320180731\r\n(base) \r\n\r\n$ ./configure --with-phpize=/Applications/XAMPP/bin/phpize-7.3.5\r\nconfigure: WARNING: unrecognized options: --with-phpize\r\nchecking for grep that handles long lines and -e... /usr/bin/grep\r\nchecking for egrep... /usr/bin/grep -E\r\nchecking for a sed that does not truncate output... /usr/bin/sed\r\nchecking for cc... cc\r\nchecking whether the C compiler works... yes\r\nchecking for C compiler default output file name... a.out\r\nchecking for suffix of executables... \r\nchecking whether we are cross compiling... no\r\nchecking for suffix of object files... o\r\nchecking whether we are using the GNU C compiler... yes\r\nchecking whether cc accepts -g... yes\r\nchecking for cc option to accept ISO C89... none needed\r\nchecking how to run the C preprocessor... cc -E\r\nchecking for icc... no\r\nchecking for suncc... no\r\nchecking whether cc understands -c and -o together... yes\r\nchecking for system library directory... lib\r\nchecking if compiler supports -R... no\r\nchecking if compiler supports -Wl,-rpath,... yes\r\nchecking build system type... x86_64-apple-darwin18.6.0\r\nchecking host system type... x86_64-apple-darwin18.6.0\r\nchecking target system type... x86_64-apple-darwin18.6.0\r\nchecking for PHP prefix... /usr\r\nchecking for PHP includes... -I/usr/include/php -I/usr/include/php/main -I/usr/include/php/TSRM -I/usr/include/php/Zend -I/usr/include/php/ext -I/usr/include/php/ext/date/lib\r\nchecking for PHP extension directory... /usr/lib/php/extensions/no-debug-non-zts-20160303\r\nchecking for PHP installed headers prefix... /usr/include/php\r\n...\r\n`"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-07-12T13:48:20Z",
        "body": "php-config 使用绝对路径\r\n```shell\r\n\r\n./configure --with-php-config=/Applications/XAMPP/bin/php-config\r\n```"
      },
      {
        "user": "sparky1",
        "created_at": "2019-07-15T03:11:27Z",
        "body": "> php-config 使用绝对路径\r\n> \r\n> ```shell\r\n> ./configure --with-php-config=/Applications/XAMPP/bin/php-config\r\n> ```\r\n\r\n可以啦，多谢！"
      }
    ]
  },
  {
    "number": 2662,
    "title": "定时器里使用调度器",
    "created_at": "2019-07-03T14:05:02Z",
    "closed_at": "2019-07-04T01:51:54Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2662",
    "body": "正常\r\n```php\r\n<?php\r\n\r\nSwoole\\Timer::tick(1000, function() {\r\n\r\n\tSwoole\\Coroutine::create(function () {\r\n\r\n\t    \\Swoole\\Coroutine::sleep(1);\r\n\r\n\t    echo \"Done.\\n\";\r\n\t    \r\n\t});\r\n\r\n});\r\n```\r\n异常\r\n```php\r\n<?php\r\n\r\nSwoole\\Timer::tick(1000, function() {\r\n\r\n\t$scheduler = new \\Swoole\\Coroutine\\Scheduler;\r\n\r\n\t$scheduler->add(function () {\r\n\r\n\t    \\Swoole\\Coroutine::sleep(1);\r\n\r\n\t    echo \"Done.\\n\";\r\n\r\n\t});\r\n\r\n\t$scheduler->start();\r\n\r\n});\r\n\r\n```\r\n\r\n`Swoole\\Coroutine\\Scheduler::start(): eventLoop has already been created.`",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2662/comments",
    "author": "zuozhehao",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-07-04T01:51:50Z",
        "body": "`Swoole\\Coroutine\\Scheduler`是程序入口，启动器，你的用法是错误的。应该在 `Swoole\\Coroutine\\Scheduler` 启动后添加定时器。"
      },
      {
        "user": "zuozhehao",
        "created_at": "2019-07-04T03:16:31Z",
        "body": "@matyhtf \r\n\r\n那也就是Timer里不支持调度器吗？\r\n\r\n```php\r\n<?php\r\n\r\n$scheduler = new \\Swoole\\Coroutine\\Scheduler;\r\n\r\nSwoole\\Timer::tick(1000, function() use ($scheduler) {\r\n\r\n\t$scheduler->add(function () {\r\n\r\n\t    \\Swoole\\Coroutine::sleep(1);\r\n\r\n\t    echo \"Done.\\n\";\r\n\r\n\t});\r\n\r\n\t$scheduler->start();\r\n\r\n});\r\n```\r\n`PHP Fatal error:  Allowed memory size of 134217728 bytes exhausted (tried to allocate 8192 bytes) `"
      }
    ]
  },
  {
    "number": 2647,
    "title": "请问对mongodb的协程自动切换支持计划如何呢？",
    "created_at": "2019-06-24T14:21:44Z",
    "closed_at": "2019-06-25T06:07:41Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2647",
    "body": "看官方文档里面有一些介绍:\r\n```\r\n此特性为实验性质，可能存在未知问题，请勿使用于生产环境。实际项目中可使用 Task 进程的特性实现协程 MongoDB 组件。\r\n```\r\n不知道是否有计划将mongo的io操作时候的协程切换,加到runtime里面去呢?\r\n\r\n一直很喜欢swoole和mongo，mongo不能自动切换的话，总感觉少了点什么~\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2647/comments",
    "author": "hncg",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-06-25T06:07:41Z",
        "body": "使用 Task 进程同步阻塞模式实现。"
      }
    ]
  },
  {
    "number": 2627,
    "title": "用最新的4.3.4版本，没有注册onClose事件，出现大量的close_wait连接",
    "created_at": "2019-06-13T12:25:02Z",
    "closed_at": "2019-06-14T08:42:02Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2627",
    "body": "用最新的4.3.4版本，没有注册onClose事件，出现大量的close_wait连接\r\n\r\n持续运行一段时间之后，就会出现大量的close_wait的连接，然后就访问不了了",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2627/comments",
    "author": "kirachen1991",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-06-14T08:41:48Z",
        "body": "无法重现你的问题，暴露外网端口的服务器，请开启心跳检测设置。"
      }
    ]
  },
  {
    "number": 2617,
    "title": "Could not catch exception for coroutine MySQL",
    "created_at": "2019-06-09T20:19:43Z",
    "closed_at": "2019-06-10T10:29:01Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2617",
    "body": "I seem to not able to catch the exception. This was what I was expecting: try the code, if error occurs, catch the exceptions. I have the code below.\r\n```php\r\n            if ($pool->isEmpty()) {\r\n                    $mysql = new Swoole\\Coroutine\\MySQL;\r\n                    $sql_check = $mysql->connect([\r\n                        'host' => '127.0.0.1',\r\n                        'user' => 'user',\r\n                        'password' => 'pw',\r\n                        'database' => 'db'\r\n                    ]);\r\n\r\n                //check connection then reconnect using $sql_check == false\r\n            } else {\r\n                $mysql = $pool->dequeue();\r\n            }\r\n            try{\r\n                $stmt = $mysql->prepare('SELECT * FROM TABLE WHERE ID=1'); //php exists here before catch\r\n                $row = $stmt->execute();\r\n            }catch(Exception $e){\r\n                printf(\"Message\".$e->getMessage());\r\n                //try to reconnect maybe?\r\n            }\r\n```\r\n\r\nHowever, I seem not able to get the exception as php exits on `prepare statement` already.\r\n\r\nI use swoole 4.3.4 php 7.2 centos 7",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2617/comments",
    "author": "jobs-git",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-06-10T10:29:01Z",
        "body": "```php\r\nif ($mysql->connect(...) === false) {\r\n    var_dump($mysql->errCode, $mysql->errMsg);\r\n    return;\r\n}\r\n$stmt = $mysql->prepare('SELECT * FROM TABLE WHERE ID=1');\r\nif ($stmt === false) {\r\n    var_dump($mysql->errCode, $mysql->errMsg);\r\n    return;\r\n}\r\n$row = $stmt->execute();\r\nif ($row === false) {\r\n    var_dump($stmt->errCode, $stmt->errMsg);\r\n    return;\r\n}\r\n```\r\n"
      },
      {
        "user": "jobs-git",
        "created_at": "2019-06-11T22:42:05Z",
        "body": "Hi @twose  thank you for the feedback, however, I am looking for a try catch since its much faster. I will be integrating it with mysql transaction so creating `if statement` for each one of those will be too expensive."
      }
    ]
  },
  {
    "number": 2615,
    "title": "How to implement ini_set()",
    "created_at": "2019-06-08T00:36:44Z",
    "closed_at": "2019-06-08T17:59:54Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2615",
    "body": "I have got to set this\r\n     ini_set('session.cookie_httponly',1);\r\n\r\nbut I dont know if this is compatible with swoole registered cookie like\r\n     $res->cookie()\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2615/comments",
    "author": "jobs-git",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-06-08T04:37:46Z",
        "body": "This is a configuration item in FPM\r\n\r\nin Swoole:\r\n```php\r\nfunction Http\\Response->cookie(string $key, string $value = '', int $expire = 0 , string $path = '/', string $domain  = '', bool $secure = false , bool $httponly = false);\r\n```\r\n\r\nThere is no global configuration item\r\n"
      },
      {
        "user": "jobs-git",
        "created_at": "2019-06-08T17:59:54Z",
        "body": "this will do, thanks!"
      }
    ]
  },
  {
    "number": 2604,
    "title": "给 reactor 进程发送 kill 信号 reactor 进程自身不会退出",
    "created_at": "2019-05-30T00:26:36Z",
    "closed_at": "2019-06-15T03:39:48Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2604",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\nkill 掉 reactor 进程时，发现 manager + worker 进程全部正常退出了，但 reactor 进程自身未退出!\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.3.4\r\nBuilt => May 29 2019 01:23:47\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1b  26 Feb 2019\r\nhttp2 => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 33554432 => 33554432\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\nOS: Alpine 3.9.4 (Docker)\r\nKernel: 4.4.177-1.el7.elrepo.x86_64\r\nPHP: 7.3.5 & 7.3.6\r\nGCC: 8.3\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2604/comments",
    "author": "designinlife",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-05-30T03:28:53Z",
        "body": "代码, 操作步骤"
      },
      {
        "user": "designinlife",
        "created_at": "2019-05-30T10:05:57Z",
        "body": "> 代码, 操作步骤\r\n\r\n没具体测试代码，我们生产环境发现这个问题的！"
      },
      {
        "user": "designinlife",
        "created_at": "2019-05-31T03:49:57Z",
        "body": "补充一下：Swoole 4.2.13 没这个问题"
      },
      {
        "user": "designinlife",
        "created_at": "2019-06-05T00:25:41Z",
        "body": "与 #2406 一样的情况"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-06-14T10:50:40Z",
        "body": "无法重现你的问题。是否使用了 UserProcess"
      },
      {
        "user": "designinlife",
        "created_at": "2019-06-14T13:08:43Z",
        "body": "@matyhtf 是的，挂了UserProcess"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-06-15T03:39:48Z",
        "body": "你的 UserProcess 需要监听`SIGTERM`，在收到信号时应当退出。 "
      },
      {
        "user": "designinlife",
        "created_at": "2019-06-21T03:13:00Z",
        "body": "strace 跟踪了下关闭的过程，所有进程（包括用户进程）都退出了 除了 reactor 进程\r\n\r\nepoll_pwait(16, [], 4096, 999, NULL, 8) = 0\r\nclock_gettime(CLOCK_MONOTONIC, {3881210, 757813668}) = 0\r\nclock_gettime(CLOCK_REALTIME, {1561086554, 493162328}) = 0\r\nepoll_pwait(16, [{EPOLLIN, {u32=17, u64=47244640273}}], 4096, 999, NULL, 8) = 1\r\nread(17, \"\\17\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0`9\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\"..., 128) = 128\r\nclock_gettime(CLOCK_MONOTONIC, {3881211, 542330089}) = 0\r\nkill(14416, SIGTERM)                    = 0\r\nwait4(14416, [{WIFEXITED(s) && WEXITSTATUS(s) == 0}], 0, NULL) = 14416\r\nrt_sigaction(SIGRT_1, {0x7fe5a33f8a99, ~[], SA_RESTORER|SA_RESTART|SA_SIGINFO, 0x7fe5a33ed802}, NULL, 8) = 0\r\ntkill(14419, SIGRT_1)                   = 0\r\nfutex(0x7fe597e62bd8, FUTEX_WAKE_PRIVATE, 1) = 0\r\nmunmap(0x7fe597e4c000, 94208)           = 0\r\nwrite(12, \"\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0\\0\\0\", 16) = 16\r\nmunmap(0x7fe597f10000, 94208)           = 0\r\nwrite(14, \"\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0\\0\\0\", 16) = 16\r\nmunmap(0x7fe597ef9000, 94208)           = 0\r\nclose(4)                                = 0\r\nclose(11)                               = 0\r\nmunmap(0x7fe59872a000, 4198400)         = 0\r\nmunmap(0x7fe598329000, 4198400)         = 0\r\nclose(13)                               = 0\r\nclose(12)                               = 0\r\nclose(15)                               = 0\r\nclose(14)                               = 0\r\nclock_gettime(CLOCK_REALTIME, {1561086555, 285641998}) = 0\r\nclock_gettime(CLOCK_REALTIME, {1561086555, 285698990}) = 0\r\ngetpid()                                = 14415\r\nclock_gettime(CLOCK_REALTIME, {1561086555, 285803628}) = 0\r\nclock_gettime(CLOCK_REALTIME, {1561086555, 285881123}) = 0\r\nopen(\"/data/logs/sys.20190621.log\", O_WRONLY|O_CREAT|O_APPEND, 0666) = 4\r\nfstat(4, {st_mode=S_IFREG|0644, st_size=149769, ...}) = 0\r\nlseek(4, 0, SEEK_CUR)                   = 0\r\nlseek(4, 0, SEEK_CUR)                   = 0\r\nwrite(4, \"2019-06-21 03:09:15.285 [INFO][#\"..., 75) = 75\r\nclose(4)                                = 0\r\nclose(2)                                = 0\r\nclose(1)                                = 0\r\nclose(0)                                = 0\r\nfcntl(3, F_SETLK, {l_type=F_UNLCK, l_whence=SEEK_SET, l_start=0, l_len=0}) = 0\r\nmunmap(0x7fe599a00000, 2097152)         = 0\r\nmunmap(0x7fe59a11b000, 134217728)       = 0\r\nclose(3)                                = 0\r\nclose(16)                               = 0\r\nmunmap(0x7fe5a219c000, 2097248)         = 0\r\nfutex(0x7fe59a11a614, FUTEX_WAKE_PRIVATE, 1) = 0\r\nfutex(0x7ffdc4b01504, FUTEX_WAIT_PRIVATE, 2, NULL"
      },
      {
        "user": "designinlife",
        "created_at": "2019-06-21T07:14:40Z",
        "body": "找到问题根源了，gRPC扩展的问题导致的，我禁用掉 gRPC 就没问题了。\r\n很奇怪，我只是载入了 gRPC 扩展，业务代码中没任何地方使用它，却有这个影响！"
      },
      {
        "user": "twose",
        "created_at": "2019-06-21T10:12:45Z",
        "body": "是的，会和grpc冲突，以前遇到过，没找到原因，仅加载也会产生这个问题"
      },
      {
        "user": "pantaovay",
        "created_at": "2019-07-25T03:19:51Z",
        "body": "> 是的，会和grpc冲突，以前遇到过，没找到原因，仅加载也会产生这个问题\r\n\r\n禁用GRPC扩展，没有问题了\r\n\r\n目前有定位问题吗？"
      },
      {
        "user": "ninjacn",
        "created_at": "2019-10-15T06:31:27Z",
        "body": "swoole和grpc不能共存啊，这问题最好解决一下呢"
      }
    ]
  },
  {
    "number": 2590,
    "title": "http server 500",
    "created_at": "2019-05-21T01:41:59Z",
    "closed_at": "2019-05-21T10:13:38Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2590",
    "body": "CENTOS: 7.2\r\nPHP: 7.2.3\r\nSWOOLE: 4.3.3\r\nPROCESS: BASE（非协程）\r\n没找到原因，没法重现，不定时出现，重启后恢复。\r\n```\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 80)      = 0\r\n18404 epoll_wait(16, {}, 4096, 1000)    = 0\r\n18404 epoll_wait(16, {}, 4096, 1000)    = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 1000)    = 0\r\n18404 epoll_wait(16, {}, 4096, 998)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 epoll_wait(16, {}, 4096, 993)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=6, u64=4294967302}}}, 4096, 999) = 1\r\n18404 accept4(6, 0x7ffe1a9706e0, [112], SOCK_CLOEXEC|SOCK_NONBLOCK) = -1 EAGAIN (Resource temporarily unavailable)\r\n18404 epoll_wait(16, {}, 4096, 20)      = 0\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=6, u64=4294967302}}}, 4096, 1000) = 1\r\n18404 accept4(6, {sa_family=AF_INET, sin_port=htons(37992), sin_addr=inet_addr(\"41.24.12.225\")}, [16], SOCK_CLOEXEC|SOCK_NONBLOCK) = 7\r\n18404 setsockopt(7, SOL_TCP, TCP_NODELAY, [1], 4) = 0\r\n18404 epoll_ctl(16, EPOLL_CTL_ADD, 7, {EPOLLOUT, {u32=7, u64=7}}) = 0\r\n18404 accept4(6, 0x7ffe1a9706e0, [112], SOCK_CLOEXEC|SOCK_NONBLOCK) = -1 EAGAIN (Resource temporarily unavailable)\r\n18404 epoll_wait(16, {{EPOLLOUT, {u32=7, u64=7}}}, 4096, 892) = 1\r\n18404 epoll_ctl(16, EPOLL_CTL_MOD, 7, {EPOLLIN, {u32=7, u64=7}}) = 0\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=7, u64=7}}}, 4096, 892) = 1\r\n18404 recvfrom(7, \"GET /api/system/update HTTP/1.\"..., 65536, 0, NULL, NULL) = 204\r\n18404 sendto(7, \"HTTP/1.1 500 Internal Server Err\"..., 171, 0, NULL, 0) = 171\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=7, u64=7}}}, 4096, 892) = 1\r\n18404 recvfrom(7, \"\", 65536, 0, NULL, NULL) = 0\r\n18404 epoll_ctl(16, EPOLL_CTL_DEL, 7, NULL) = 0\r\n18404 close(7)                          = 0\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=6, u64=4294967302}}}, 4096, 853) = 1\r\n18404 accept4(6, 0x7ffe1a9706e0, [112], SOCK_CLOEXEC|SOCK_NONBLOCK) = -1 EAGAIN (Resource temporarily unavailable)\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=6, u64=4294967302}}}, 4096, 835) = 1\r\n18404 accept4(6, 0x7ffe1a9706e0, [112], SOCK_CLOEXEC|SOCK_NONBLOCK) = -1 EAGAIN (Resource temporarily unavailable)\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=6, u64=4294967302}}}, 4096, 481) = 1\r\n18404 accept4(6, 0x7ffe1a9706e0, [112], SOCK_CLOEXEC|SOCK_NONBLOCK) = -1 EAGAIN (Resource temporarily unavailable)\r\n18404 epoll_wait(16, {}, 4096, 251)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 1000)    = 0\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=6, u64=4294967302}}}, 4096, 1000) = 1\r\n18404 accept4(6, {sa_family=AF_INET, sin_port=htons(38006), sin_addr=inet_addr(\"41.24.12.225\")}, [16], SOCK_CLOEXEC|SOCK_NONBLOCK) = 7\r\n18404 setsockopt(7, SOL_TCP, TCP_NODELAY, [1], 4) = 0\r\n18404 epoll_ctl(16, EPOLL_CTL_ADD, 7, {EPOLLOUT, {u32=7, u64=7}}) = 0\r\n18404 accept4(6, 0x7ffe1a9706e0, [112], SOCK_CLOEXEC|SOCK_NONBLOCK) = -1 EAGAIN (Resource temporarily unavailable)\r\n18404 epoll_wait(16, {{EPOLLOUT, {u32=7, u64=7}}}, 4096, 560) = 1\r\n18404 epoll_ctl(16, EPOLL_CTL_MOD, 7, {EPOLLIN, {u32=7, u64=7}}) = 0\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=7, u64=7}}}, 4096, 560) = 1\r\n18404 recvfrom(7, \"GET /api/token HTTP/1.1\\r\\nX-Rea\"..., 65536, 0, NULL, NULL) = 127\r\n18404 sendto(7, \"HTTP/1.1 500 Internal Server Err\"..., 166, 0, NULL, 0) = 166\r\n18404 epoll_ctl(16, EPOLL_CTL_DEL, 7, NULL) = 0\r\n18404 close(7)                          = 0\r\n18404 epoll_wait(16, {}, 4096, 559)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 1000)    = 0\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=6, u64=4294967302}}}, 4096, 998) = 1\r\n18404 accept4(6, {sa_family=AF_INET, sin_port=htons(38018), sin_addr=inet_addr(\"41.24.12.225\")}, [16], SOCK_CLOEXEC|SOCK_NONBLOCK) = 7\r\n18404 setsockopt(7, SOL_TCP, TCP_NODELAY, [1], 4) = 0\r\n18404 epoll_ctl(16, EPOLL_CTL_ADD, 7, {EPOLLOUT, {u32=7, u64=7}}) = 0\r\n18404 accept4(6, 0x7ffe1a9706e0, [112], SOCK_CLOEXEC|SOCK_NONBLOCK) = -1 EAGAIN (Resource temporarily unavailable)\r\n18404 epoll_wait(16, {{EPOLLOUT, {u32=7, u64=7}}}, 4096, 894) = 1\r\n18404 epoll_ctl(16, EPOLL_CTL_MOD, 7, {EPOLLIN, {u32=7, u64=7}}) = 0\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=7, u64=7}}}, 4096, 893) = 1\r\n18404 recvfrom(7, \"GET /api/token HTTP/1.1\\r\\nX-Rea\"..., 65536, 0, NULL, NULL) = 128\r\n18404 sendto(7, \"HTTP/1.1 500 Internal Server Err\"..., 166, 0, NULL, 0) = 166\r\n18404 epoll_ctl(16, EPOLL_CTL_DEL, 7, NULL) = 0\r\n18404 close(7)                          = 0\r\n18404 epoll_wait(16, {}, 4096, 893)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 998)     = 0\r\n18404 epoll_wait(16, {}, 4096, 986)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 epoll_wait(16, {}, 4096, 998)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 998)     = 0\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 epoll_wait(16, {}, 4096, 998)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 1000)    = 0\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {}, 4096, 999)     = 0\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=6, u64=4294967302}}}, 4096, 971) = 1\r\n18404 accept4(6, {sa_family=AF_INET, sin_port=htons(38030), sin_addr=inet_addr(\"41.24.12.225\")}, [16], SOCK_CLOEXEC|SOCK_NONBLOCK) = 7\r\n18404 setsockopt(7, SOL_TCP, TCP_NODELAY, [1], 4) = 0\r\n18404 epoll_ctl(16, EPOLL_CTL_ADD, 7, {EPOLLOUT, {u32=7, u64=7}}) = 0\r\n18404 accept4(6, 0x7ffe1a9706e0, [112], SOCK_CLOEXEC|SOCK_NONBLOCK) = -1 EAGAIN (Resource temporarily unavailable)\r\n18404 epoll_wait(16, {{EPOLLOUT, {u32=7, u64=7}}}, 4096, 357) = 1\r\n18404 epoll_ctl(16, EPOLL_CTL_MOD, 7, {EPOLLIN, {u32=7, u64=7}}) = 0\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=7, u64=7}}}, 4096, 356) = 1\r\n18404 recvfrom(7, \"GET /api/token HTTP/1.1\\r\\nX-Rea\"..., 65536, 0, NULL, NULL) = 128\r\n18404 sendto(7, \"HTTP/1.1 500 Internal Server Err\"..., 166, 0, NULL, 0) = 166\r\n18404 epoll_ctl(16, EPOLL_CTL_DEL, 7, NULL) = 0\r\n18404 close(7)                          = 0\r\n18404 epoll_wait(16, {}, 4096, 356)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=6, u64=4294967302}}}, 4096, 1000) = 1\r\n18404 accept4(6, 0x7ffe1a9706e0, [112], SOCK_CLOEXEC|SOCK_NONBLOCK) = -1 EAGAIN (Resource temporarily unavailable)\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=6, u64=4294967302}}}, 4096, 306) = 1\r\n18404 accept4(6, 0x7ffe1a9706e0, [112], SOCK_CLOEXEC|SOCK_NONBLOCK) = -1 EAGAIN (Resource temporarily unavailable)\r\n18404 epoll_wait(16, {}, 4096, 174)     = 0\r\n18404 epoll_wait(16, {{EPOLLIN, {u32=6, u64=4294967302}}}, 4096, 1000) = 1\r\n18404 accept4(6, 0x7ffe1a9706e0, [112], SOCK_CLOEXEC|SOCK_NONBLOCK) = -1 EAGAIN (Resource temporarily unavailable)\r\n18404 epoll_wait(16, {}, 4096, 981)     = 0\r\n18404 madvise(0x1ac0000, 61440, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b3d000, 4096, MADV_DONTNEED) = 0\r\n18404 madvise(0x1b43000, 24576, MADV_DONTNEED) = 0\r\n\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2590/comments",
    "author": "apetab",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-05-21T06:10:09Z",
        "body": "跟踪日志里主动发送的500响应, 说明没有对response进行end操作, 导致底层自动响应了500"
      }
    ]
  },
  {
    "number": 2576,
    "title": "swoole_redis_server将来会去掉吗？",
    "created_at": "2019-05-13T01:06:00Z",
    "closed_at": "2019-05-13T04:36:04Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2576",
    "body": "听说将来可能会去掉，但感觉挺好用的，不同业务端PHP版本可以直接投递任务到swoole_redis_server里面，多进程异步处理，而不需要业务端（显示的）经过http或者TCP，而且业务端只要装个redis扩展就行，如果去掉了，有什么替代方案吗？",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2576/comments",
    "author": "longit123",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-05-13T04:36:04Z",
        "body": "不会去掉。至少 Swoole5 没有这个计划。"
      }
    ]
  },
  {
    "number": 2570,
    "title": "redis删除成功，结果还能get到",
    "created_at": "2019-05-10T09:55:53Z",
    "closed_at": "2019-05-13T06:23:11Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2570",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\nswooleServer.php\r\n```php\r\n<?php\r\nrequire_once 'redisPool.php';\r\nextension_loaded('swoole') ? '' : die (\"Please install swoole \");\r\nextension_loaded('redis') ? '' : die (\"Please install redis\");\r\n\r\nclass swooleServer\r\n{\r\n    private $server = '';\r\n    const LISTENHOST = '0.0.0.0';\r\n    const PORT = 9502;\r\n    private $config = [];\r\n    private $redisPool = '';\r\n    public function __construct($config = [])\r\n    {\r\n        $this->redisPool = new redisPool(true);\r\n        $this->server = new swoole_server(self::LISTENHOST, self::PORT, SWOOLE_PROCESS, SWOOLE_TCP);\r\n    }\r\n\r\n    public function onCallback()\r\n    {\r\n        $this->server->on('Receive', [$this, 'onReceive']);\r\n        $this->server->on('WorkerStart', [$this, 'onWorkerStart']);\r\n    }\r\n\r\n    public function onReceive(swoole_server $server, int $fd, int $reactor_id, string $data)\r\n    {\r\n        var_dump($fd);\r\n       $data = $this->upack($data);\r\n        $message = $data['message'];\r\n        $this->handel($message);\r\n        $this->send($fd, 2000, 'SUCCESS');\r\n    }\r\n\r\n    public function tokenBucketTick($tick_id, $key, $num, $value)\r\n    {\r\n        var_dump($key,$num,$value);\r\n        $redis = $this->redisPool->getRedis();\r\n        if ($redis !== false) {\r\n            $now = $redis->get($key);\r\n            if ($now < $value) {\r\n                $redis->incrBy($key, $num);\r\n            }\r\n            $this->redisPool->relasePool($redis);\r\n        }\r\n\r\n    }\r\n\r\n    public function handel($data)\r\n    {\r\n        $type = $data['type'];\r\n\r\n        if ($type == 'bucketToken') {\r\n\r\n            $value = $data['value'];                    //$value = [['key'=>$key,'num'=>$num,'type'=>1]]\r\n            if (!is_array($value)) return false;\r\n\r\n            foreach ($value as $row) {\r\n                $key = $row['key'];\r\n                $numValue = $row['num'];\r\n                if ($numValue > 1000) {\r\n                    $ms = 1;\r\n                    $num = intval($numValue / 1000);\r\n                } else {\r\n                    $ms = intval(1000 / $numValue);\r\n                    $num = 1;\r\n                }\r\n                //每 $ms毫秒 增加$num个token\r\n                var_dump('定时器执行次数');\r\n                $tick_id = swoole_timer_tick($ms,array($this,'tokenBucketTick'),...[$key, $num, $numValue]);\r\n                swoole_timer_after(1000 * 1, function () use ($tick_id, $key) {\r\n                    swoole_timer_clear($tick_id);\r\n                    $redis = $this->redisPool->getRedis();\r\n                    if ($redis) {\r\n                        $res= $redis->del($key);\r\n                        var_dump('删除结果:'.$res);\r\n                        var_dump('再次获取:'.$redis->get($key));\r\n\r\n                        $this->redisPool->relasePool($redis);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    public function upack($message)\r\n    {\r\n\r\n        $type = substr($message, 0, 2);\r\n        $length = substr($message, 2, 4);\r\n        $message = substr($message, 6);\r\n        $type = unpack('n', $type);\r\n        $length = unpack('N', $length);\r\n        return ['type' => $type[1], 'length' => $length[1], 'message' => json_decode($message, true)];\r\n    }\r\n\r\n    public function send($fd, $code, $message)\r\n    {\r\n        $data['code'] = $code;\r\n        $data['message'] = $message;\r\n        $this->server->send($fd, json_encode($data));\r\n    }\r\n\r\n    public function setConfig()\r\n    {\r\n        $this->config = [\r\n            'worker_num' => 4,\r\n            'dispatch_mode' => 1,\r\n            'open_length_check' => true,\r\n            'package_max_length' => 10 * 1024,\r\n            'package_length_type' => 'N',\r\n            'package_length_offset' => 2,\r\n            'package_body_offset' => 6,\r\n            'daemonize' => 0\r\n        ];\r\n    }\r\n\r\n    public function onWorkerStart(swoole_server $server, int $worker_id)\r\n    {\r\n\r\n    }\r\n\r\n    public function getRedis()\r\n    {\r\n        if (isset($this->server->redis)) {\r\n            if ($this->server->redis->ping() == 'pong') return $this->server->redis;\r\n        }\r\n        $this->server->redis = new \\Redis();\r\n        $this->server->redis->connect('127.0.0.1', 6379);\r\n        return $this->server->redis;\r\n    }\r\n\r\n\r\n    public function start()\r\n    {\r\n        $this->setConfig();\r\n        $this->server->set($this->config);\r\n        $this->onCallback();\r\n        $this->server->start();\r\n    }\r\n\r\n\r\n    public function pack($message)\r\n    {\r\n\r\n    }\r\n}\r\n\r\n$server = new swooleServer();\r\n$server->start();\r\n```\r\n-------------------------------------------\r\nredisPool.php\r\n```php\r\n<?php\r\n/**\r\n * Created by PhpStorm.\r\n * User: shenyang.qiu\r\n * Date: 2019/5/9\r\n * Time: 15:21\r\n */\r\nclass redisPool {\r\n    const host = '127.0.0.1';\r\n    const port = 6379;\r\n    public $maxnum = 100;\r\n    public $nownum = 0;\r\n    public $pool = [];\r\n    public $coroutine = false;\r\n    public function __construct($coroutine = false)\r\n    {\r\n        $this->pool = new SplQueue();\r\n        $this->coroutine = $coroutine;\r\n    }\r\n\r\n    public function getRedis()\r\n    {\r\n        if ($this->pool->count()) {\r\n            return $this->pool->pop();\r\n        } else {\r\n            try {\r\n\r\n                if ($this->nownum >$this->maxnum) {\r\n\r\n                    $timeout = 1000;\r\n                    while ($timeout) {\r\n\r\n                        if ($this->coroutine) {\r\n                            co::sleep(0.1);\r\n                            $timeout = $timeout -100;\r\n                        } else {\r\n                            usleep(100000);\r\n                            $timeout = $timeout-100;\r\n                        }\r\n\r\n                        if($this->pool->count()) {\r\n\r\n                            return $this->pool->pop();;\r\n                        }\r\n                    }\r\n                    return false;\r\n                } else {\r\n                    if ($this->coroutine) {\r\n                        $redis = new \\Swoole\\Coroutine\\Redis();\r\n                    } else {\r\n                        $redis = new \\Redis();\r\n                    }\r\n\r\n                    $this->nownum  ++;\r\n                    $redis->connect(self::host,self::port);\r\n\r\n                    return $redis;\r\n                }\r\n            } catch (RedisException $exception) {\r\n                return false;\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    public function relasePool($redis)\r\n    {\r\n        return $this->pool->push($redis);\r\n    }\r\n}\r\n```\r\n---------------------------------------------------\r\nclient.php\r\n```php\r\n<?php\r\n/**\r\n * Created by PhpStorm.\r\n * User: shenyang.qiu\r\n * Date: 2019/4/29\r\n * Time: 11:35\r\n */\r\nrequire_once 'redisPool.php';\r\n$redisPool = new redisPool();\r\n$atomic = new \\Swoole\\Atomic();\r\n$total = 3000;\r\n\r\nswoole_timer_tick(2000,function($tick_id) use($redisPool,$atomic, $total) {\r\n    swoole_timer_after(6000,function() use($tick_id) {\r\n        swoole_timer_clear($tick_id);\r\n    });\r\n    try {\r\n        for ($i = 0; $i < $total; $i++) {\r\n            $redis = $redisPool->getRedis();\r\n            $atomic->add();\r\n            if (!$redis) {\r\n                throw  new Exception(co::getuid() . '没有足够的redis对象');\r\n            }\r\n            $num = $redis->get('test');\r\n            if ($num === false) {\r\n\r\n                $res =$redis->set('test', 0);\r\n                var_dump($res);\r\n\r\n                $client = new \\Swoole\\Client(SWOOLE_SOCK_TCP);\r\n                $client->connect('127.0.0.1', 9502);\r\n                $data['type'] = 'bucketToken';\r\n                $data['value'] = [\r\n                    ['key' => 'test', 'num' => 1000]\r\n                ];\r\n                $message = json_encode($data);\r\n                $length = strlen($message);\r\n                $client->send(pack('nN', 1, $length) . $message);\r\n                $msg = $client->recv();\r\n                $client->close();\r\n\r\n            } else {\r\n                if ($num > 0) {\r\n\r\n                    $value = $redis->decr('test');\r\n\r\n                } else {\r\n                }\r\n            }\r\n            $redisPool->relasePool($redis);\r\n        }\r\n\r\n    } catch (Exception $e) {\r\n    }\r\n});\r\n```\r\n\r\n2. What did you expect to see?\r\nredis成功删除了结果，还能get到值\r\n\r\n\r\n3. What did you see instead?\r\n这是运行client后的结果(在swooleServer.php的清除定时器处):\r\nint(1)\r\nstring(21) \"定时器执行次数\"\r\nstring(14) \"删除结果:1\"\r\nstring(13) \"再次获取:\"\r\nint(2)\r\nstring(21) \"定时器执行次数\"\r\nstring(14) \"删除结果:1\"\r\nstring(14) \"再次获取:1\"\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2570/comments",
    "author": "qiushengyang",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-05-11T05:23:20Z",
        "body": "代码太多了, 是否没考虑到多进程的情况, 导致多个进程同时对一个键操作造成的\r\n另, 连接池实现不好, 可以看下README里的示例"
      },
      {
        "user": "qiushengyang",
        "created_at": "2019-05-13T01:58:51Z",
        "body": "> 代码太多了, 是否没考虑到多进程的情况, 导致多个进程同时对一个键操作造成的\r\n> 另, 连接池实现不好, 可以看下README里的示例\r\n\r\n谢谢，连接池我参考一下reame。但是这个问题不不知道怎么产生的。。。实际看了一下并没有多进程操作的可能，出现在这个问题没有一点头绪。。。操作redis的地方总共有两个地方。第一个就是client.php这块。client用的是普通的redis，是在主进程中阻塞循环3000次调用了swoole的client和redis，并没有用到协成。 server端只有协成redis的get 、incrBy、del操作 并没有操作设置成0的操作"
      },
      {
        "user": "qiushengyang",
        "created_at": "2019-05-13T05:02:36Z",
        "body": "> 代码太多了, 是否没考虑到多进程的情况, 导致多个进程同时对一个键操作造成的\r\n> 另, 连接池实现不好, 可以看下README里的示例\r\n\r\n产生的原因原来是 timer_tick_clear后不会立即中断当前tick"
      },
      {
        "user": "twose",
        "created_at": "2019-05-13T06:22:57Z",
        "body": "会在下一轮清除timer, 而不是立即中断\r\n立即中断需要clear后马上return"
      }
    ]
  },
  {
    "number": 2569,
    "title": "一个进程中创建多个协成请求redis，协成不能正常结束？",
    "created_at": "2019-05-10T03:35:49Z",
    "closed_at": "2019-05-11T05:24:02Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2569",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n### server.php\r\n```php\r\n<?php\r\nrequire_once 'redisPool.php';\r\nextension_loaded('swoole') ? '' : die (\"Please install swoole \");\r\nextension_loaded('redis') ? '' :die (\"Please install redis\");\r\nclass swooleServer{\r\n    private $server = '';\r\n    const LISTENHOST = '0.0.0.0';\r\n    const PORT = 9502;\r\n    private $config = [];\r\n    private $redisPool = '';\r\n\r\n    public function __construct($config = [])\r\n    {\r\n        $this->redisPool = new redisPool(true);\r\n        $this->server = new swoole_server(self::LISTENHOST, self::PORT, SWOOLE_PROCESS, SWOOLE_TCP);\r\n\r\n    }\r\n\r\n    public function onCallback()\r\n    {\r\n        $this->server->on('Receive', [$this, 'onReceive']);\r\n        $this->server->on('WorkerStart', [$this, 'onWorkerStart']);\r\n    }\r\n\r\n    public function onReceive(swoole_server $server, int $fd, int $reactor_id, string $data)\r\n    {\r\n        $data = $this->upack($data);\r\n        $message = $data['message'];\r\n        $this->handel($message);\r\n        $this->send($fd,2000, 'SUCCESS');\r\n    }\r\n\r\n    public function handel($data)\r\n    {\r\n        $type = $data['type'];\r\n        $key = $data['key'];\r\n        $value = intval($data['value']);\r\n\r\n        if ($value >1000) {\r\n            $ms = 1;\r\n            $num = intval($value/1000);\r\n        } else {\r\n            $ms = intval(1000/$value);\r\n            $num = 1;\r\n        }\r\n\r\n        if ($type == 'addSecondTick') {\r\n\r\n            swoole_timer_tick($ms,function($tick_id) use($key,$num,$value) {\r\n                swoole_timer_after(1000*60,function() use($tick_id,$key){\r\n                    swoole_timer_clear($tick_id);\r\n                    $redis = $this->redisPool->getRedis();\r\n                    $redis->del($key);\r\n                    $this->redisPool->relasePool($redis);\r\n                });\r\n\r\n                    $redis = $this->redisPool->getRedis();\r\n                    $now = $redis->get($key);\r\n                    if ($now < $value) {\r\n                        $redis->incrBy($key,$num);\r\n                    }\r\n                    $this->redisPool->relasePool($redis);\r\n\r\n\r\n\r\n            });\r\n\r\n        }\r\n        return;\r\n    }\r\n    public function upack($message)\r\n    {\r\n\r\n        $type = substr($message, 0,2);\r\n        $length = substr($message,2,4);\r\n        $message = substr($message,6);\r\n        $type = unpack('n', $type);\r\n        $length = unpack('N', $length);\r\n        return ['type'=>$type[1],'length'=>$length[1],'message'=>json_decode($message, true)];\r\n    }\r\n\r\n    public function send($fd, $code, $message)\r\n    {\r\n        $data['code'] = $code;\r\n        $data['message'] = $message;\r\n        $this->server->send($fd, json_encode($data));\r\n    }\r\n\r\n    public function setConfig()\r\n    {\r\n        $this->config  = [\r\n            'worker_num' =>2,\r\n            'dispatch_mode'=>2,\r\n            'open_length_check' => true,\r\n            'package_max_length' => 10*1024,\r\n            'package_length_type' => 'N',\r\n            'package_length_offset' => 2,\r\n            'package_body_offset' => 6,\r\n            'daemonize' =>0\r\n        ];\r\n    }\r\n\r\n    public function onWorkerStart(swoole_server $server, int $worker_id)\r\n    {\r\n\r\n    }\r\n\r\n    public function getRedis()\r\n    {\r\n        if (isset($this->server->redis)) {\r\n            if ($this->server->redis->ping() == 'pong') return $this->server->redis;\r\n        }\r\n        $this->server->redis = new \\Redis();\r\n        $this->server->redis->connect('127.0.0.1', 6379);\r\n        return $this->server->redis;\r\n    }\r\n\r\n\r\n\r\n    public function start()\r\n    {\r\n        $this->setConfig();\r\n        $this->server->set($this->config);\r\n        $this->onCallback();\r\n        $this->server->start();\r\n    }\r\n\r\n\r\n    public function pack($message)\r\n    {\r\n\r\n    }\r\n}\r\n$server = new swooleServer();\r\n$server->start();\r\n```\r\n\r\n### redisPool.php\r\n```php\r\n<?php\r\n/**\r\n * Created by PhpStorm.\r\n * User: shenyang.qiu\r\n * Date: 2019/5/9\r\n * Time: 15:21\r\n */\r\nclass redisPool {\r\n    const host = '127.0.0.1';\r\n    const port = 6379;\r\n    public $maxnum = 100;\r\n    public $nownum = 0;\r\n    public $pool = [];\r\n    public $coroutine = false;\r\n    public function __construct($coroutine = false)\r\n    {\r\n        $this->pool = new SplQueue();\r\n        $this->coroutine = $coroutine;\r\n    }\r\n\r\n    public function getRedis()\r\n    {\r\n        if ($this->pool->count()) {\r\n            return $this->pool->pop();\r\n        } else {\r\n            try {\r\n                if ($this->nownum >$this->maxnum) {\r\n                    $timeout = 1;\r\n                    while ($timeout) {\r\n                        co::sleep(0.05);\r\n                        $timeout = $timeout -0.05;\r\n                        if($this->pool->count()) {\r\n                            return $this->pool->pop();;\r\n                        }\r\n                    }\r\n                    return false;\r\n                } else {\r\n                    if ($this->coroutine) {\r\n                        $redis = new \\Swoole\\Coroutine\\Redis();\r\n                    } else {\r\n                        $redis = new \\Redis();\r\n                    }\r\n\r\n                    $this->nownum  ++;\r\n                    $redis->connect(self::host,self::port);\r\n\r\n                    return $redis;\r\n                }\r\n            } catch (RedisException $exception) {\r\n                return false;\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    public function relasePool($redis)\r\n    {\r\n        return $this->pool->push($redis);\r\n    }\r\n}\r\n```\r\n\r\n### client.php\r\n```php\r\n<?php\r\n/**\r\n * Created by PhpStorm.\r\n * User: shenyang.qiu\r\n * Date: 2019/4/29\r\n * Time: 11:35\r\n */\r\nrequire_once 'redisPool.php';\r\n$redisPool = new redisPool();\r\n$atomic = new \\Swoole\\Atomic();\r\nfor ($i = 0; $i < 200; $i++) {\r\n    go(function() use($redisPool,$atomic) {\r\n\r\n            $redis = $redisPool->getRedis();\r\n            $num = $redis->get('test');\r\n            var_dump($num);\r\n            if ($num === null || $num === false) {\r\n                $redis->set('test',0);\r\n                $client = new \\Swoole\\Client(SWOOLE_SOCK_TCP);\r\n                $client->connect('127.0.0.1', 9502);\r\n                $data['type'] = 'addSecondTick';\r\n                $data['key'] = 'test';\r\n                $data['value'] = 100;\r\n                $message = json_encode($data);\r\n                $length = strlen($message);\r\n                $client->send(pack('nN', 1, $length) . $message);\r\n                $msg = $client->recv();\r\n                $client->close();\r\n\r\n            } else {\r\n                if ($num > 0) {\r\n\r\n                    $redis->decr('test');\r\n\r\n                } else {\r\n\r\n                }\r\n            }\r\n\r\n    });\r\n}\r\nvar_dump('总共调用了:');\r\nvar_dump($atomic->get());\r\n```\r\n\r\n\r\n\r\n2. What did you expect to see?\r\n当运行完client.php的时候应该能正常退出\r\n\r\n\r\n3. What did you see instead?\r\n运行完不能正常退出，不知道卡在哪里了。 当把clitent.php中的改成循环100次就能正常退出，这是为什么？\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.3.1\r\nBuilt => Mar 15 2019 13:09:57\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n使用的是win10子系统\r\n\r\nPHP 7.1.29-1+ubuntu18.04.1+deb.sury.org+1 (cli) (built: May  3 2019 09:51:29) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.1.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.1.29-1+ubuntu18.04.1+deb.sury.org+1, Copyright (c) 1999-2018, by Zend Technologies\r\n\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/7/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 7.3.0-27ubuntu1~18.04' --with-bugurl=file:///usr/share/doc/gcc-7/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-7 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 7.3.0 (Ubuntu 7.3.0-27ubuntu1~18.04)\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2569/comments",
    "author": "qiushengyang",
    "comments": [
      {
        "user": "huanghantao",
        "created_at": "2019-05-10T04:57:16Z",
        "body": "@qiushengyang 你代码的逻辑问题，问题出在了`getRedis`这个函数的\r\n```php\r\nwhile ($timeout) {\r\n                        co::sleep(0.05);\r\n                        $timeout = $timeout -0.05;\r\n                        if($this->pool->count()) {\r\n                            return $this->pool->pop();;\r\n                        }\r\n                    }\r\n```\r\n陷入了死循环。"
      },
      {
        "user": "qiushengyang",
        "created_at": "2019-05-10T05:03:47Z",
        "body": "后来我也发现了这个问题，第一个就是这个$timeout出现精度问题不能退出循环，还有一个就是前端没有回收redis对象  谢谢指出\r\n\r\n> @qiushengyang 你代码的逻辑问题，问题出在了`getRedis`这个函数的\r\n> \r\n> ```\r\n> while ($timeout) {\r\n>                         co::sleep(0.05);\r\n>                         $timeout = $timeout -0.05;\r\n>                         if($this->pool->count()) {\r\n>                             return $this->pool->pop();;\r\n>                         }\r\n>                     }\r\n> ```\r\n> \r\n> 陷入了死循环。\r\n\r\n后来我也发现了这个问题，第一个就是这个$timeout出现精度问题不能退出循环，还有一个就是前端没有回收redis对象  谢谢指出\r\n"
      },
      {
        "user": "huanghantao",
        "created_at": "2019-05-10T05:05:29Z",
        "body": "不客气"
      },
      {
        "user": "qiushengyang",
        "created_at": "2019-05-10T05:07:05Z",
        "body": "> 不客气\r\n\r\n请教一下我这个限速令牌桶这个server这么写合适么"
      },
      {
        "user": "twose",
        "created_at": "2019-05-11T05:24:01Z",
        "body": "`while ($timeout > 0)`, 太基础了"
      }
    ]
  },
  {
    "number": 2562,
    "title": "使用stream_select函数阻塞等待时，swoole进程不能stop",
    "created_at": "2019-05-07T11:48:03Z",
    "closed_at": "2019-05-09T09:07:51Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2562",
    "body": "环境信息：\r\nCentOS 6.5\r\nPHP版本=> 7.1.1 \r\nSwoole版本=>  4.3.2\r\ngcc版本4.8.5（GCC）\r\n\r\n问题描述：\r\n使用stream_select函数阻塞等待时，swoole进程不能stop\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2562/comments",
    "author": "dean-lhb",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-05-07T23:22:26Z",
        "body": "阻塞了就无法操作, 除非关闭signalfd, 用信号打断"
      },
      {
        "user": "dean-lhb",
        "created_at": "2019-05-08T09:02:04Z",
        "body": "> 阻塞了就无法操作, 除非关闭signalfd, 用信号打断\r\n\r\n感谢回复，我是发送SIGTERM信号去停止进程的，在4.3.2版本不能停止，但在4.3.0版本是可以停止的"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-05-09T09:07:51Z",
        "body": "task 进程启用了协程，就会开启异步信号，无法终止"
      },
      {
        "user": "dean-lhb",
        "created_at": "2019-05-09T10:00:35Z",
        "body": "> task 进程启用了协程，就会开启异步信号，无法终止\r\n\r\n感谢大神回复，我这个不是task进程是worker进程，很想解决这个问题，因为我集成了Rabbitmq的PhpAmqpLib客户端，如果不能解决那每次stop就要等待超时了，我试了一下reload没有这种问题"
      }
    ]
  },
  {
    "number": 2550,
    "title": "Unable to load dynamic library 'swoole.so'",
    "created_at": "2019-05-02T17:11:22Z",
    "closed_at": "2019-05-24T05:42:21Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2550",
    "body": "**About PHP**\r\nPHP 7.2.16-1+ubuntu16.04.1+deb.sury.org+1 (cli) (built: Mar  7 2019 20:23:06) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.2.16-1+ubuntu16.04.1+deb.sury.org+1, Copyright (c) 1999-2018, by Zend Technologies\r\n\r\n\r\n**OS**: Mint linux\r\n\r\n**ERROR:** \r\nPHP Warning:  PHP Startup: Unable to load dynamic library 'swoole.so' (tried: /usr/lib/php/20170718/swoole.so (/usr/lib/php/20170718/swoole.so: cannot open shared object file: No such file or directory), /usr/lib/php/20170718/swoole.so.so (/usr/lib/php/20170718/swoole.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2550/comments",
    "author": "chhaunkar96",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-05-05T11:33:28Z",
        "body": "You need to compile and install first."
      },
      {
        "user": "chhaunkar96",
        "created_at": "2019-05-05T12:21:38Z",
        "body": "I have installed with pecl.\r\n`pecl install swoole`\r\n\r\nI really need to compile. "
      },
      {
        "user": "matyhtf",
        "created_at": "2019-05-05T12:35:14Z",
        "body": "Which php-config is used?\r\n\r\n```php\r\nwhich php\r\nwhich php-config\r\nphp-config\r\n```\r\n\r\nDoes your system have multiple php?"
      },
      {
        "user": "chhaunkar96",
        "created_at": "2019-05-05T12:43:45Z",
        "body": "**which php**\r\n`/usr/bin/php`\r\n**which php-config**\r\n`/usr/bin/php-config`\r\n**php-config**\r\n\r\n```\r\nUsage: /usr/bin/php-config [OPTION]\r\nOptions:\r\n  --prefix            [/usr]\r\n  --includes          [-I/usr/include/php/20151012 -I/usr/include/php/20151012/main -I/usr/include/php/20151012/TSRM -I/usr/include/php/20151012/Zend -I/usr/include/php/20151012/ext -I/usr/include/php/20151012/ext/date/lib ]\r\n  --ldflags           [-L/usr/lib/php/20151012  -L/usr/lib/x86_64-linux-gnu]\r\n  --libs              [-lcrypt   -lresolv -lcrypt -lz -lpcre -lrt -lm -ldl -lnsl  -lxml2 -lssl -lcrypto -lcrypt -lcrypt ]\r\n  --extension-dir     [/usr/lib/php/20151012]\r\n  --include-dir       [/usr/include/php/20151012]\r\n  --man-dir           [/usr/share/man]\r\n  --php-binary        [/usr/bin/php7.0]\r\n  --php-sapis         [apache2handler cgi cli fpm phpdbg ]\r\n  --phpapi            [20151012]\r\n  --configure-options [--includedir=/usr/include --mandir=/usr/share/man --infodir=/usr/share/info --disable-silent-rules --libdir=/usr/lib/x86_64-linux-gnu --libexecdir=/usr/lib/x86_64-linux-gnu --disable-maintainer-mode --disable-dependency-tracking --prefix=/usr --enable-cli --disable-cgi --disable-phpdbg --with-config-file-path=/etc/php/7.0/cli --with-config-file-scan-dir=/etc/php/7.0/cli/conf.d --build=x86_64-linux-gnu --host=x86_64-linux-gnu --config-cache --cache-file=/build/php7.0-Ts_EGl/php7.0-7.0.33/config.cache --libdir=${prefix}/lib/php --libexecdir=${prefix}/lib/php --datadir=${prefix}/share/php/7.0 --program-suffix=7.0 --sysconfdir=/etc --localstatedir=/var --mandir=/usr/share/man --disable-all --disable-debug --disable-rpath --disable-static --with-pic --with-layout=GNU --without-pear --enable-filter --with-openssl=yes --with-pcre-regex=/usr --enable-hash --with-mhash=/usr --enable-libxml --enable-session --with-system-tzdata --with-zlib=/usr --with-zlib-dir=/usr --enable-dtrace --enable-pcntl --with-libedit=shared,/usr build_alias=x86_64-linux-gnu host_alias=x86_64-linux-gnu CFLAGS=-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -O2 -Wall -pedantic -fsigned-char -fno-strict-aliasing -g]\r\n  --version           [7.0.33-5+ubuntu16.04.1+deb.sury.org+1]\r\n  --vernum            [70033]\r\n```\r\n\r\n**Does your system have multiple php?**\r\nyes\r\n`7.0  7.1  7.2  7.3`\r\n**Current version:** \r\n`PHP 7.2.16-1+ubuntu16.04.1+deb.sury.org+1 (cli) (built: Mar  7 2019 20:23:06) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.2.16-1+ubuntu16.04.1+deb.sury.org+1, Copyright (c) 1999-2018, by Zend Technologies\r\n"
      },
      {
        "user": "chenyongze",
        "created_at": "2019-05-06T02:25:07Z",
        "body": "/var/www/html # php -m|grep swoole\r\nPHP Warning:  PHP Startup: Unable to load dynamic library 'swoole.so' (tried: /usr/local/lib/php/extensions/no-debug-non-zts-20180731/swoole.so (Error loading shared library libstdc++.so.6: No such file or directory (needed by /usr/local/lib/php/extensions/no-debug-non-zts-20180731/swoole.so)), /usr/local/lib/php/extensions/no-debug-non-zts-20180731/swoole.so.so (Error loading shared library /usr/local/lib/php/extensions/no-debug-non-zts-20180731/swoole.so.so: No such file or directory)) in Unknown on line 0"
      },
      {
        "user": "chenyongze",
        "created_at": "2019-05-06T02:29:07Z",
        "body": "/usr/local/lib/php/extensions/no-debug-non-zts-20180731/swoole.so.so"
      },
      {
        "user": "twose",
        "created_at": "2019-05-13T06:26:30Z",
        "body": "I noticed that you've changed your PHP version again\r\ntry it again:\r\n```\r\nwhich php\r\nphp -v\r\nwhich php-config\r\nphp-config\r\n```\r\n\r\nand it requires gcc > 4.8"
      },
      {
        "user": "BigFlu",
        "created_at": "2019-08-06T20:00:47Z",
        "body": "echo \"extension=swoole\">$YOURPATHTO/php.d/swoole.ini"
      },
      {
        "user": "advcha",
        "created_at": "2019-09-18T06:31:28Z",
        "body": "I got the same problem. here is my way to solve it. If you change your default php version, for example to php7.2, make sure you also install php7.2-dev package\r\n`sudo apt install php7.2-dev`\r\nrun `php-config` to make sure it point to php7.2 version not php7.0 \r\n\r\nbefore run `sudo pecl install swoole`, check the php extension-dir not have swoole.so file (for example your php7.2 extension-dir in /usr/lib/php/20170718). so if any swoole.so file in it, remove it manually). the rest installation steps should be straight forward and the error should be gone. "
      },
      {
        "user": "ibrahimkh94",
        "created_at": "2023-11-19T22:18:25Z",
        "body": "> echo \"extension=swoole\">$YOURPATHTO/php.d/swoole.ini\r\n\r\nCould you please sir @BigFlu show in details where to put this line "
      },
      {
        "user": "ibrahimkh94",
        "created_at": "2023-11-19T22:40:37Z",
        "body": "Hi @matyhtf , could you please help me sir, i have the same probelm and i have multiversion of php with the same OS\r\n\r\nPHP Warning:  PHP Startup: Unable to load dynamic library 'openswoole' (tried: /usr/lib/php/20210902/openswoole (/usr/lib/php/20210902/openswoole: cannot open shared object file: No such file or directory), /usr/lib/php/20210902/openswoole.so (/usr/lib/php/20210902/openswoole.so: undefined symbol: socket_ce)) in Unknown on line 0\r\n"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2023-11-20T01:46:02Z",
        "body": "@ibrahimkh94 you need to compile `php_socket` extension first;"
      }
    ]
  },
  {
    "number": 2539,
    "title": "如果在go函数中有new Server行为 会有core错误",
    "created_at": "2019-04-29T10:23:02Z",
    "closed_at": "2019-04-29T11:18:24Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2539",
    "body": "```\r\ngo(function(){\r\n    new \\Swoole\\Server(\"127.0.0.1\", \"9898\", SWOOLE_SOCK_TCP);\r\n    $m=new \\Swoole\\Coroutine\\MySQL;\r\n    $m->connect(['host' => '127.0.0.1',\r\n        'port' => 3306,\r\n        'user' => '',\r\n        'password' => '']);\r\n});\r\n```\r\nProgram received signal SIGABRT, Aborted.\r\n__GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\r\n51      ../sysdeps/unix/sysv/linux/raise.c: No such file or directory.\r\n(gdb) bt\r\n#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:51\r\n#1  0x00007ffffdb00801 in __GI_abort () at abort.c:79\r\n#2  0x00007ffffdaf039a in __assert_fail_base (fmt=0x7ffffdc777d8 \"%s%s%s:%u: %s%sAssertion `%s' failed.\\n%n\",\r\n    assertion=assertion@entry=0x7ffffa90e6b8 \"swoole_objects.array[handle] == NULL\",\r\n    file=file@entry=0x7ffffa90e650 \"/home/lonely/php/ext/swoole/swoole.cc\", line=line@entry=396,\r\n    function=function@entry=0x7ffffa90fa80 <swoole_set_object_by_handle::__PRETTY_FUNCTION__> \"void swoole_set_object_by_handle(uint32_t, void*)\") at assert.c:92\r\n#3  0x00007ffffdaf0412 in __GI___assert_fail (assertion=0x7ffffa90e6b8 \"swoole_objects.array[handle] == NULL\",\r\n    file=0x7ffffa90e650 \"/home/lonely/php/ext/swoole/swoole.cc\", line=396,\r\n    function=0x7ffffa90fa80 <swoole_set_object_by_handle::__PRETTY_FUNCTION__> \"void swoole_set_object_by_handle(uint32_t, void*)\") at assert.c:101\r\n#4  0x00007ffffa80315c in swoole_set_object_by_handle (handle=2, ptr=0x7ffffac86000)\r\n    at /home/lonely/php/ext/swoole/swoole.cc:396\r\n#5  0x00007ffffa861666 in swoole_mysql_coro_create_object (ce=0x966bc40)\r\n    at /home/lonely/php/ext/swoole/swoole_mysql_coro.cc:408\r\n#6  0x000000000872da93 in object_and_properties_init (arg=0x7ffffac82120, class_type=0x966bc40, properties=0x0)\r\n    at /mnt/c/Users/PC/Downloads/php-7.3.3/Zend/zend_API.c:1335\r\n#7  0x000000000872dad7 in object_init_ex (arg=0x7ffffac82120, class_type=0x966bc40)\r\n    at /mnt/c/Users/PC/Downloads/php-7.3.3/Zend/zend_API.c:1343\r\n#8  0x00000000087a0375 in ZEND_NEW_SPEC_CONST_UNUSED_HANDLER ()\r\n    at /mnt/c/Users/PC/Downloads/php-7.3.3/Zend/zend_vm_execute.h:8825\r\n#9  0x00000000087fd7e0 in execute_ex (ex=0x7ffffac820a0)\r\n    at /mnt/c/Users/PC/Downloads/php-7.3.3/Zend/zend_vm_execute.h:56303\r\n#10 0x00007ffffa82570e in swoole::PHPCoroutine::create_func (arg=0x7ffffffea6f0)\r\n    at /home/lonely/php/ext/swoole/swoole_coroutine.cc:369\r\n#11 0x00007ffffa792299 in swoole::Context::context_func (arg=0x9633b98)\r\n    at /home/lonely/php/ext/swoole/src/coroutine/context.cc:125\r\n#12 0x00007ffffa9028d1 in make_fcontext ()\r\n    at /home/lonely/php/ext/swoole/thirdparty/boost/asm/make_x86_64_sysv_elf_gas.S:64\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2539/comments",
    "author": "php-lsys",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-04-29T11:18:24Z",
        "body": "在v4.3.2以后, 类似操作会导致致命错误\r\n```log\r\n[2019-04-29 19:17:12 @34727.0]\tERROR\t(PHP Fatal Error: 507):\r\nSwoole\\Coroutine\\MySQL::connect: operation not support (reactor is not ready)\r\nStack trace:\r\n#0  Swoole\\Coroutine\\MySQL->connect() called at [/Users/twosee/Toast/swoole-src/Debug/#2539.php:10]\r\n```"
      },
      {
        "user": "php-lsys",
        "created_at": "2019-04-29T11:51:02Z",
        "body": "刚从master分支拉下来的 "
      },
      {
        "user": "twose",
        "created_at": "2019-04-30T07:31:38Z",
        "body": "@php-lsys 不好意思 我是mysql分支 mysql客户端重构为协程后 不会再有这个问题"
      },
      {
        "user": "php-lsys",
        "created_at": "2019-04-30T07:40:46Z",
        "body": "我觉得该在server的构造中判断下,如果是在协程环境下直接抛异常.不然有时候不小心NEW下.直接出core了.这真是很悲催的一件事."
      },
      {
        "user": "twose",
        "created_at": "2019-04-30T07:42:33Z",
        "body": "如我所说的 在MySQL分支已经修复了 是一个已知问题"
      }
    ]
  },
  {
    "number": 2534,
    "title": "Connection gets outdated data.",
    "created_at": "2019-04-27T14:27:23Z",
    "closed_at": "2019-04-28T15:25:30Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2534",
    "body": "Hi! I have an issue with Swoole WebSocket Server. I created an object to use Swoole Server. Here is the constructor: \r\n\r\n`public function __construct()\r\n    {\r\n        $this->serverWS = new Swoole\\WebSocket\\Server(\"192.168.56.2\", 9502);\r\n        \r\n        $this->serverWS->on('open', \r\n            function(Server $serverWS, Request $request) \r\n            {\r\n                $this->onConnection($request);\r\n            }\r\n        );\r\n\r\n        $this->serverWS->on('message', \r\n            function(Server $serverWS, Frame $frame)\r\n            {\r\n                $this->onMessage($frame);\r\n            }\r\n        );\r\n\r\n        $this->serverWS->on('close',\r\n            function(Server $serverWS, int $fd)\r\n            {\r\n                $this->onClose($fd);\r\n            }\r\n        );\r\n\r\n        $this->serverWS->on('workerStart',\r\n            function(Server $serverWS)\r\n            {\r\n                $this->onWorkerStart($this->serverWS);\r\n            }\r\n        );\r\n\r\n        $this->serverWS->start();\r\n    }`\r\n\r\nAlso, I have a desktop client written in Python (I start it with Linux terminal). Connection is established by the following example:\r\n\r\n`if __name__ == \"__main__\":\r\n    websocket.enableTrace(True)\r\n    ws = websocket.WebSocketApp(\"ws://192.168.56.2:9502\",\r\n                            on_message = on_message,\r\n                            on_error = on_error,\r\n                            on_close = on_close,\r\n                            header   = {\r\n                                'User-Agent: RaspberryPi/3B+' + ' ' + str(os.uname()), \r\n                                'Access-Token: ' + generate_token()\r\n                            }\r\n    )\r\n    ws.on_open = on_open\r\n    ws.run_forever()`\r\n\r\nWhat I do on server side is set current Python connection ID (I'm defining a Python client by the certain request header) to private property of my custom WebsocketServer object (this property is equal 0 by default). And by triggering onClose event I set this property to 0 again. If this property is not 0 and the same client tries to establish the connection, server closes it.\r\nI do this because i need to identify this client and have only one instance of it's connection.\r\n\r\nAnd the problem is that I can have two connections at the same time (two terminal windows with started clients). If there's three or more clients - all works fine: server closes connections.\r\n\r\nI tried to debug and what I noticed is when the first PythonClient connection triggers, WebsocketServer sets ID property from 0 to 1 (and I can easily read this property and it will surely be equal 1). Then I'm running the second PythonClient and what i got on server is 0 ID property again, which will be setted to 2...\r\nThe third connection (and following ones) get ID that is equal 1, untill I'm keeping first connection opened. (As it should be)\r\n\r\nThis is so strange. I have no any idea why this happens. Please, tell me what I'm doing wrong!\r\n\r\nMy Swoole version is:\r\n`php --ri swoole\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.3.1\r\nBuilt => Mar 22 2019 11:50:29\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.0g  2 Nov 2017\r\nhttp2 => enabled\r\npcre => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n`\r\n\r\nMy Linux kernel is:\r\n`Linux elephant 4.15.0-47-generic #50-Ubuntu SMP Wed Mar 13 10:44:52 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux`\r\n\r\nMy PHP version is:\r\n`PHP 7.2.17-0ubuntu0.18.04.1 (cli) (built: Apr 18 2019 14:12:38) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.2.17-0ubuntu0.18.04.1, Copyright (c) 1999-2018, by Zend Technologies`\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2534/comments",
    "author": "shumichenko",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-04-28T06:19:46Z",
        "body": "I can only tell you the following points due to my poor English language proficiency:\r\n1. The server is asynchronous, multiple requests may be processed at the same time\r\n2. Server use multi-process mode by default, you can try `new Swoole\\WebSocket\\Server(\"192.168.56.2\", 9502, SWOOLE_BASE);` to make it be a single process Server\r\n"
      },
      {
        "user": "shumichenko",
        "created_at": "2019-04-28T15:25:00Z",
        "body": "> I can only tell you the following points due to my poor English language proficiency:\r\n> \r\n> 1. The server is asynchronous, multiple requests may be processed at the same time\r\n> 2. Server use multi-process mode by default, you can try `new Swoole\\WebSocket\\Server(\"192.168.56.2\", 9502, SWOOLE_BASE);` to make it be a single process Server\r\n\r\nThanks, it's working now!"
      }
    ]
  },
  {
    "number": 2533,
    "title": "The worker process of Server opens the bug of the coroutine by default.",
    "created_at": "2019-04-27T08:40:27Z",
    "closed_at": "2019-04-28T11:53:18Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2533",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n```php\r\n$http = new Swoole\\Http\\Server(\"0.0.0.0\", 8888);\r\n$http->set([\r\n    'worker_num' => 1,\r\n    'max_request' => 1,\r\n]);\r\n$http->on('start', function(){\r\n    swoole_set_process_name('LOCAL::master');\r\n});\r\n$http->on('managerstart', function(){\r\n    swoole_set_process_name('LOCAL::manager');\r\n});\r\n$http->on('request', function ($request, $response)use($http) {\r\n    printf(\"REQUEST: pid[%d] cid[%d] cnum[%d] uri[%s]\\n\", getmypid(), Co::getcid(), sizeof(Co::list()), $request->server['request_uri']);\r\n    \r\n    // Waiting for using a coroutine will be suspended\r\n    Co::sleep(2);\r\n\r\n    // In the same situation, the method of connecting data using the coroutine given by the official website will also be suspended.\r\n    // $swoole_mysql = new Swoole\\Coroutine\\MySQL();\r\n    // $swoole_mysql->connect([\r\n    //     'host' => '127.0.0.1',\r\n    //     'port' => 3306,\r\n    //     'user' => 'user',\r\n    //     'password' => 'pass',\r\n    //     'database' => 'test',\r\n    // ]);\r\n    \r\n    $response->end(\"<h1>Hello Swoole. #\".rand(1000, 9999).\"</h1>\");\r\n});\r\n$http->on('workerstart', function($serv, $worker_id){\r\n    swoole_set_process_name('LOCAL::worker');\r\n    printf(\"WORKERSTART: pid[%d] cid[%d] cnum[%d]\\n\", getmypid(), Co::getcid(), sizeof(Co::list()));\r\n});\r\n$http->on('workerstop', function(swoole_server $server, int $worker_id){\r\n    printf(\"WORKERSTOP: pid[%d] cid[%d] cnum[%d]\\n\", getmypid(), Co::getcid(), sizeof(Co::list()));\r\n});\r\n$http->start();\r\n```\r\n2. What did you expect to see?\r\n    Fix this bug\r\n\r\n3. What did you see instead?\r\n    At the time the request reached the last time `max_request`, the request would be stuck because the `coroutine` might have been `destroyed`.\r\n    When I test it, not only `Co::sleep` will get stuck, but the `connection database` will also get stuck.\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n#### swoole\r\n\r\n    Swoole => enabled\r\n    Author => Swoole Team <team@swoole.com>\r\n    Version => 4.3.1\r\n    Built => Mar 13 2019 09:23:05\r\n    coroutine => enabled\r\n    trace_log => enabled\r\n    epoll => enabled\r\n    eventfd => enabled\r\n    signalfd => enabled\r\n    cpu_affinity => enabled\r\n    spinlock => enabled\r\n    rwlock => enabled\r\n    sockets => enabled\r\n    openssl => OpenSSL 1.0.2k-fips  26 Jan 2017\r\n    http2 => enabled\r\n    pcre => enabled\r\n    zlib => enabled\r\n    mutex_timedlock => enabled\r\n    pthread_barrier => enabled\r\n    futex => enabled\r\n    mysqlnd => enabled\r\n    async_redis => enabled\r\n\r\n    Directive => Local Value => Master Value\r\n    swoole.enable_coroutine => On => On\r\n    swoole.display_errors => On => On\r\n    swoole.use_shortname => On => On\r\n    swoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n#### OS\r\n    Linux localhost.localdomain 3.10.0-957.el7.x86_64 #1 SMP Thu Nov 8 23:39:32 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n#### PHP\r\n    PHP 7.2.17 (cli) (built: Apr  3 2019 10:02:16) ( NTS )\r\n    Copyright (c) 1997-2018 The PHP Group\r\n    Zend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n        with Zend OPcache v7.2.17, Copyright (c) 1999-2018, by Zend Technologies\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2533/comments",
    "author": "mingyuantech",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-04-28T08:12:04Z",
        "body": "You should add `reload_async` option, There will be a bug when use max_request with coroutines.\r\n```php\r\n$http->set([\r\n    'worker_num' => 1,\r\n    'max_request' => 1,\r\n    'reload_async' => true,\r\n]);\r\n```\r\n"
      }
    ]
  },
  {
    "number": 2532,
    "title": "Question about saving http2 client to file or redis for reuse",
    "created_at": "2019-04-26T18:16:24Z",
    "closed_at": "2019-04-28T06:24:17Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2532",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nI have a php-cli code that connects to http2 server and send some information. I run this code with shell_exec(\"php send_data_to_http2.php\") from my cron.php file;\r\n\r\nIs it possible to save http2 client for reuse ? Client connection takes a few seconds and I want to save & reuse the connection if it's possible.\r\n\r\nThis is my current code in send_data_to_http2.php\r\n\r\n```\r\ngo(function () use ($http2_info) {\r\n    $cli = new co\\Http2\\Client($http2_info['http2_url'], $http2_info['http2_port'], $http2_info['http2_ssl']);\r\n.....\r\n.....\r\n}\r\n```\r\n\r\nI want to do something like this \r\n\r\n```\r\ngo(function () use ($http2_info,$saved_connection_path) {\r\n    if (file_exists($saved_connection_path)) {\r\n       $cli = unserialize(file_get_contents($saved_connection_path));\r\n       if (!$cli->ping()) {\r\n          $cli->close();\r\n          $cli = new co\\Http2\\Client($http2_info['http2_url'], $http2_info['http2_port'], $http2_info['http2_ssl']);           \r\n      }\r\n    } else {\r\n     $cli = new co\\Http2\\Client($http2_info['http2_url'], $http2_info['http2_port'], $http2_info['http2_ssl']);\r\n     save_to_file($saved_connection_path,serialize($cli));\r\n    }\r\n.....\r\n.....\r\n}\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\nI want to save my http2 client connection to somewhere and reuse it. It's not a http server it's a php-cli code and I run it with shell_exec.\r\n\r\n3. What did you see instead?\r\n\r\n---\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nswoole v. 4.3.3\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nphp 7.2.17 swoole 4.3.3\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2532/comments",
    "author": "ozgurhangisi",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-04-28T06:24:17Z",
        "body": "It's a dream, what you really need is a connection proxy."
      },
      {
        "user": "ozgurhangisi",
        "created_at": "2019-04-29T09:01:07Z",
        "body": "@twose I knew that :) Thanks for your answer."
      }
    ]
  },
  {
    "number": 2515,
    "title": "协程里面mysql和lock 为何死锁了",
    "created_at": "2019-04-18T10:49:22Z",
    "closed_at": "2019-04-18T13:16:33Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2515",
    "body": "```\r\n$lock = new swoole_lock(SWOOLE_MUTEX);\r\n\r\nfunction get( $lock )\r\n{\r\n\t$lock->lock();\r\n\techo \"lock\\n\";\r\n\r\n\t$Mysql = new Swoole\\Coroutine\\MySQL();\r\n\t\r\n\t$flag = $Mysql->connect( [\r\n\t\t'host' => '127.0.0.1',\r\n\t\t'port' => 3306,\r\n\t\t'user' => 'root',\r\n\t\t'password' => '123',\r\n\t\t'database' => 'ty_blast',\r\n\t\t'charset' => 'utf8',\r\n\t] );\r\n\t\r\n\techo \"unlock\\n\";\r\n\r\n\t$lock->unlock();\r\n}\r\n\r\ngo(function() use ( $lock ){\r\n\r\n\tget($lock);\r\n});\r\n\r\n\r\ngo(function() use ( $lock ){\r\n\r\n\tget($lock);\r\n});\r\n\r\n```\r\n\r\nswoole 4.3.2",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2515/comments",
    "author": "ppyupp",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-04-18T11:13:54Z",
        "body": "swoole lock是同步阻塞的\r\n\r\n```php\r\n<?php\r\n\r\nclass lock\r\n{\r\n    private $chan;\r\n\r\n    public function __construct()\r\n    {\r\n        $this->chan = new Chan;\r\n    }\r\n\r\n    public function lock()\r\n    {\r\n        $this->chan->push(true);\r\n    }\r\n\r\n    public function unlock()\r\n    {\r\n        $this->chan->pop();\r\n    }\r\n}\r\n\r\nfunction get(lock $lock)\r\n{\r\n    echo \"lock\\n\";\r\n    $lock->lock();\r\n    Co::sleep(0.1);\r\n    echo \"unlock\\n\";\r\n    $lock->unlock();\r\n}\r\n\r\n$lock = new lock();\r\n\r\ngo(function () use ($lock) {\r\n    get($lock);\r\n});\r\ngo(function () use ($lock) {\r\n    get($lock);\r\n});\r\n```\r\n"
      }
    ]
  },
  {
    "number": 2496,
    "title": "利用swoole完成和couchbase交互",
    "created_at": "2019-04-09T03:07:43Z",
    "closed_at": "2019-04-10T00:28:38Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2496",
    "body": "Hi：\r\n    我希望可以使用 swoole来使用读取 couchbase的作用，请问可以直接使用 TCP Client来完成操作吗。 \r\n   另外这种性能上是否有使用过测试呢。",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2496/comments",
    "author": "leehomewl",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-04-10T00:28:37Z",
        "body": "可以使用 tcp client 实现 couchbase 协议的客户端"
      },
      {
        "user": "leehomewl",
        "created_at": "2019-04-10T01:34:23Z",
        "body": "好的，谢谢"
      }
    ]
  },
  {
    "number": 2493,
    "title": "swoole timer doesn't work",
    "created_at": "2019-04-06T22:27:29Z",
    "closed_at": "2019-04-07T04:31:45Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2493",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n```php\r\nuse Swoole\\Server;\r\nuse Swoole\\Timer;\r\n\r\n$server = new Server('0.0.0.0', 30002, SWOOLE_BASE, SWOOLE_SOCK_UDP);\r\n\r\n$server->on('Packet', function (Server $server, $data, $addr)\r\n{\r\n    var_export($data);\r\n});\r\n\r\n$server->tick(1000, function () {\r\n    echo 1;\r\n});\r\n\r\n$id = Timer::tick(1000, function () {\r\n    echo 2;\r\n});\r\n\r\n/*$server->on('Timer', function (Server $server, $data, $addr)\r\n{\r\n    echo 3;\r\n});*/\r\n\r\nswoole_timer_tick(1000, function() {\r\n    echo 4;\r\n});\r\n\r\n$server->on('Start', function (Server $server)\r\n{\r\n    $server->tick(1000, function() {\r\n        echo 5;\r\n    });\r\n});\r\n\r\n$server->on('start', function (Server $server)\r\n{\r\n    $server->tick(1000, function() {\r\n        echo 6;\r\n    });\r\n});\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n1,2,3,4,5 or 6 in console\r\n\r\n3. What did you see instead?\r\n\r\nOnly data from udp socket.\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n4.3.1\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\ncentos7, php 7.2\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2493/comments",
    "author": "morozovsk",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-04-07T04:31:45Z",
        "body": "This is as expected, and you need to put it in the WorkerStart callback because the server will reopen a new event loop.\r\n"
      }
    ]
  },
  {
    "number": 2490,
    "title": "swoole升级到最新版本加载出错",
    "created_at": "2019-04-05T04:09:06Z",
    "closed_at": "2019-04-06T01:16:16Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2490",
    "body": "环境信息：\r\nCentOS 6.5 (Final)\r\nPHP Version => 7.1.1\r\nSwoole Version => github最新\r\ngcc version 4.8.5 (GCC)\r\n\r\n问题描述：\r\n扩展文件夹swoole.so文件已经生成，加载的时候出现下面的错误。安装4.2.4版本一切正常\r\nphp --ri swoole\r\n\r\nPHP Warning:  PHP Startup: Unable to load dynamic library '/usr/local/php/lib/php/extensions/no-debug-zts-20160303/swoole.so' - /usr/local/php/lib/php/extensions/no-debug-zts-20160303/swoole.so: undefined symbol: _Z24to_zval_read_in6_pktinfoPKcP12_zval_structP12_res_context in Unknown on line 0\r\nExtension 'swoole' not present.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2490/comments",
    "author": "dean-lhb",
    "comments": [
      {
        "user": "yunnian",
        "created_at": "2019-04-05T17:08:32Z",
        "body": "看下编译的时候是不是用了其他版本，比如phpize"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-04-06T01:16:16Z",
        "body": "重新执行 phpize ，make clean "
      }
    ]
  },
  {
    "number": 2479,
    "title": "request 回调中异常退出时  4.2.10 版本会回调 register_shutdown_function 函数,  但4.2.11之后就不会回调 register_shutdown_function",
    "created_at": "2019-04-03T08:45:16Z",
    "closed_at": "2019-04-03T09:37:23Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2479",
    "body": "\r\nrequest 回调中异常退出时\r\n\r\n4.2.10 版本会回调 register_shutdown_function 函数,  但4.2.11之后就不会回调 register_shutdown_function\r\n\r\n测试程序:\r\n```php\r\n<?php\r\n$http = new swoole_http_server(\"0.0.0.0\", 9501, SWOOLE_BASE);\r\n\r\nregister_shutdown_function ( function  ()\r\n{\r\n    echo \"===================================\\n\";\r\n    echo \"== do register_shutdown_function ==\\n\";\r\n    echo \"===================================\\n\";\r\n});\r\n\r\n$http->on('request', function ($req, $resp) {\r\n\r\n    //让程序异常退出\r\n    $s= new \\XXX();\r\n\r\n});\r\n\r\n$http->start();\r\n\r\n```\r\n\r\nVersion => 4.2.10\r\n\r\n正常有回调到:  do register_shutdown_function \r\n\r\n它的输出:\r\n```\r\nPHP Fatal error:  Uncaught Error: Class 'XXX' not found in /home/jim/server.php:20\r\nStack trace:\r\n#0 {main}\r\n  thrown in /home/jim/server.php on line 20\r\n===================================\r\n== do register_shutdown_function == \r\n===================================\r\n[2019-04-03 16:34:05 *3827.0]   ERROR   zm_deactivate_swoole (ERROR 503): Fatal error: Uncaught Error: Cl\r\nass 'XXX' not found in /home/jim/server.php:20                                                          \r\nStack trace:\r\n#0 {main}\r\n  thrown in /home/jim/server.php on line 20.\r\n```\r\n\r\nVersion => 4.2.11\r\n\r\n没有 异常退出 没有回调到:  register_shutdown_function \r\n\r\n\r\n它的输出:\r\n```\r\nlocalhost:~$ php server.php \r\nPHP Fatal error:  Uncaught Error: Class 'XXX' not found in /home/jim/server.php:20\r\nStack trace:\r\n#0 {main}\r\n  thrown in /home/jim/server.php on line 20\r\n\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2479/comments",
    "author": "xcwen",
    "comments": [
      {
        "user": "xcwen",
        "created_at": "2019-04-03T08:57:55Z",
        "body": "\r\n\r\n环境\r\nlocalhost:~/vipthink_core(master)$ php -v\r\nPHP 7.2.4-1+b1 (cli) (built: May 12 2018 13:03:02) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.2.4-1+b1, Copyright (c) 1999-2018, by Zend Technologies\r\n\r\n"
      },
      {
        "user": "twose",
        "created_at": "2019-04-03T09:11:04Z",
        "body": "协程内出现未处理的异常会直接导致进程bailout, 无法继续回调shutdown函数\r\n原先swoole的虽然会回调, 但是可能会产生不可预期的错误\r\n\r\n后续版本可能会改成协程内有未捕获异常, 只会导致协程退出\r\n但致命错误仍会导致不可逆转的进程退出"
      },
      {
        "user": "xcwen",
        "created_at": "2019-04-03T09:29:06Z",
        "body": "那 .怎么截获 类似\"类不存在\"的错误.\r\n\r\n```php\r\n$http->on('request', function ($req, $resp) {\r\n\r\n    //让程序异常退出\r\n    try{\r\n        $s= new \\XXX();\r\n    }catch (\\Exception $e) {\r\n        echo \"111111111111111111\\n\";\r\n    }\r\n\r\n});\r\n```\r\n还是无法截获:<\r\n\r\n我想在这是, 返回错误给前端,而不是什么都没有返回.\r\n"
      },
      {
        "user": "twose",
        "created_at": "2019-04-03T09:37:20Z",
        "body": "你直接`class_exists`不就好了, 可以用catch (Error $e)"
      },
      {
        "user": "xcwen",
        "created_at": "2019-08-31T09:28:57Z",
        "body": "这样可以截获\r\n\r\n$http->on('request', function ($req, $resp) {\r\n\r\n    //让程序异常退出\r\n    try{\r\n        $s= new \\XXX();\r\n    }catch (\\Error $e) {  // not Exception \r\n        echo \"111111111111111111\\n\";\r\n    }\r\n\r\n});"
      }
    ]
  },
  {
    "number": 2463,
    "title": "Coroutines loosing parent's coroutine context",
    "created_at": "2019-03-27T18:04:59Z",
    "closed_at": "2019-03-28T06:39:15Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2463",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n```\r\n\\Swoole\\Runtime::enableCoroutine();\r\ngo(function() {\r\n   $uid = \\Co::getuid();\r\n   go(function () use ($uid) {\r\n      sleep(2);\r\n      var_dump(\\Co::getContext($uid));   //NULL\r\n   });\r\n});\r\n```\r\n\r\nI expected that child coroutine can access parent's context, but it returns `NULL`\r\n\r\nI'm using Swoole 4.3.1 on ubuntu 16.04 (docker image php:7.2-fpm)\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2463/comments",
    "author": "pervozdanniy",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-03-28T03:16:25Z",
        "body": "after you call `sleep` with `enableCoroutine`, coroutine#2 would yield to coroutine#1, and coroutine#1 closed, so it returns `NULL` (not exists)."
      }
    ]
  },
  {
    "number": 2454,
    "title": "swoole talbe 问题",
    "created_at": "2019-03-25T05:41:13Z",
    "closed_at": "2019-03-25T12:43:39Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2454",
    "body": "您好：\r\nswoole table  sting 类型的长度 是 动长 还是 定长啊， 比如说 我申请一个字段 长度 为1000 但是我只存里1个字符， 实际占用 是 1 还是 1000啊",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2454/comments",
    "author": "kokofirst",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-03-25T05:59:10Z",
        "body": "共享内存是提前分配的, 申请地越大占用越大, 但实际占用的物理内存是按需的, 你可以写个脚本自己观察"
      }
    ]
  },
  {
    "number": 2437,
    "title": "swoole4.2.13 channel问题",
    "created_at": "2019-03-18T03:02:01Z",
    "closed_at": "2019-03-18T03:25:25Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2437",
    "body": "channel提供的empty、full等操作不准确\r\nchannel中元素索引从0开始，但是empty会把0作为true，full会作为false\r\n但此时channel已经有了元素了",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2437/comments",
    "author": "maxinliang007",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-03-18T03:25:25Z",
        "body": "请仔细阅读文档中的说明。\r\nchannel 只能 pop push，没有 “索引”，不清楚你具体指的是什么？"
      },
      {
        "user": "maxinliang007",
        "created_at": "2019-03-18T03:34:47Z",
        "body": "> 请仔细阅读文档中的说明。\r\n> channel 只能 pop push，没有 “索引”，不清楚你具体指的是什么？\r\n\r\nchannel提供的empty、full等操作不准确，当我的channel有一个值时，调用empty得到的结果确是true"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-03-18T06:18:49Z",
        "body": "请写出对应的示例代码"
      }
    ]
  },
  {
    "number": 2435,
    "title": "Swoole\\Coroutine\\Client-errCode-errMsg错误码未更新",
    "created_at": "2019-03-17T09:37:09Z",
    "closed_at": "2019-03-17T09:38:52Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2435",
    "body": "调用send或recv时将返回对应的错误码：错误码未更新。\r\n流程说明：\r\nclient连接失败-重连成功-send成功-获取errCode、errMsg还是连接失败时候的错误码\r\n\r\n环境：\r\nPHP 7.2.13 (cli)\r\nSwoole-Version => 4.3.1",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2435/comments",
    "author": "loyating",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-03-17T09:38:52Z",
        "body": "只有出错时才会更新错误码, 操作成功时设置错误码没有意义"
      },
      {
        "user": "loyating",
        "created_at": "2019-03-17T09:43:45Z",
        "body": "send前将对端服务关闭，然后发送，结果是成功的，发送数据的尺寸与send返回尺寸一致，到下一次调用才会返回错误码\r\n实际上这次数据发送需要重发的，这里该如何判定？"
      },
      {
        "user": "twose",
        "created_at": "2019-03-17T09:47:15Z",
        "body": "TCP发送成功是将数据拷贝到了Linux的内核缓冲区, 并不代表对端一定收到了数据, 这个是无法保证的, 在漫长的网络链路中, 任何一步都有可能出现失败, 不然就不会有 `请求` + `响应` 的流程了, 除非对端返回了成功响应且你成功收到, 不然你永远无法判断对端确实收到了数据\r\n\r\n所以下一次调用发送时系统内核才通知你连接已断开并返回FALSE, 这是符合预期的"
      },
      {
        "user": "loyating",
        "created_at": "2019-03-17T09:49:33Z",
        "body": "好的，谢谢"
      }
    ]
  },
  {
    "number": 2429,
    "title": "内存泄漏如何定位",
    "created_at": "2019-03-13T07:47:23Z",
    "closed_at": "2019-03-22T09:40:38Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2429",
    "body": "能否考虑开发一个专门动态追踪PHP程序是否出现内存泄漏的工具呢？代码复杂了之后程序出现内存泄漏调试太难了\r\n有些隐藏比较深的bug非常难找到，如果有一款能调试PHP内存泄漏的工具就好了",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2429/comments",
    "author": "jqhph",
    "comments": [
      {
        "user": "sy-records",
        "created_at": "2019-03-13T08:17:41Z",
        "body": "正在开发一款检测常驻PHP进程内存泄漏的工具"
      },
      {
        "user": "jqhph",
        "created_at": "2019-03-13T08:28:09Z",
        "body": "> 正在开发一款检测常驻PHP进程内存泄漏的工具\r\n\r\n那就太好了，现在有计划什么时候发布上线吗"
      },
      {
        "user": "twose",
        "created_at": "2019-03-13T08:28:49Z",
        "body": "一般将资源绑定在协程上下文中, 避免使用全局变量, 严格把控全局变量和静态变量的使用, 就可以轻松规避内存泄漏问题, PHP作为一个有GC的语言, 开发的心智负担相对来说已经很低了, 特别复杂的项目, 对程序员的要求也不会太低\r\n至于工具, 目前还没有很好的工具能够实现你的需求"
      },
      {
        "user": "jqhph",
        "created_at": "2019-03-13T08:38:26Z",
        "body": "> 一般将资源绑定在协程上下文中, 避免使用全局变量, 严格把控全局变量和静态变量的使用, 就可以轻松规避内存泄漏问题, PHP作为一个有GC的语言, 开发的心智负担相对来说已经很低了, 特别复杂的项目, 对程序员的要求也不会太低\r\n> 至于工具, 目前还没有很好的工具能够实现你的需求\r\n\r\n已经在尽量避免使用全局变量和静态变量了，但是项目复杂加上使用了各种框架和插件之后，各种对象传递，比较难靠肉眼看出哪部分代码有问题。如果没有工具辅助排查这种问题，真的很难解决"
      },
      {
        "user": "maxinliang007",
        "created_at": "2019-03-18T03:30:37Z",
        "body": "> 一般将资源绑定在协程上下文中, 避免使用全局变量, 严格把控全局变量和静态变量的使用, 就可以轻松规避内存泄漏问题, PHP作为一个有GC的语言, 开发的心智负担相对来说已经很低了, 特别复杂的项目, 对程序员的要求也不会太低\r\n> 至于工具, 目前还没有很好的工具能够实现你的需求\r\n\r\n已经把变量尽量都定义在协程了，对于外部变量和对象使用也是通过use引入，然后使用完全部unset掉但程序运行半小时依然会报内存溢出，频繁重启"
      }
    ]
  },
  {
    "number": 2427,
    "title": "一个由max_request 导致的异常",
    "created_at": "2019-03-12T13:58:23Z",
    "closed_at": "2019-03-13T02:23:05Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2427",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\nA文件：\r\n```\r\n<?php\r\n$http = new Swoole\\Http\\Server(\"127.0.0.1\", 9501);\r\n$http->set([\r\n        \"worker_num\"=>1,\r\n        \"max_request\"=>10\r\n]);\r\n$http->on('request', function ($request, $response) {\r\n        $cli = new Swoole\\Coroutine\\Http\\Client('127.0.0.1', 9502);\r\n        $cli->setHeaders([\r\n                'Host' => \"localhost\",\r\n                \"User-Agent\" => 'Chrome/49.0.2587.3',\r\n                'Accept' => 'text/html,application/xhtml+xml,application/xml',\r\n                'Accept-Encoding' => 'gzip',\r\n        ]);\r\n        $cli->set([ 'timeout' => 1]);\r\n        $cli->get('/');\r\n        echo $cli->body;\r\n        $cli->close();\r\n        $response->end(\"<h1>9501 Hello Swoole. #\".rand(1000, 9999).\"</h1>\");\r\n});\r\n$http->start();\r\n```\r\n\r\nB文件:\r\n```\r\n<?php\r\n$http = new Swoole\\Http\\Server(\"127.0.0.1\", 9502);\r\n$http->set([\r\n        \"worker_num\"=>1,\r\n        \"max_request\"=>1000\r\n]);\r\n$http->on('request', function ($request, $response) {\r\n    $response->end(\"<h1>Hello Swoole. #\".rand(1000, 9999).\"</h1>\");\r\n});\r\n$http->start();\r\n```\r\n\r\n启动后，请求A服务，A服务逻辑会发送一个请求到B服务。\r\n测试时直接curl 请求A服务端口。\r\n\r\n2. What did you expect to see?\r\n服务设置max_request为10，正常情况下应该都是正常请求。A服务10次请求后自动退出worker并且用另外一个worker替代。\r\n\r\n\r\n3. What did you see instead?\r\n但curl第十次请求时卡住不返回。如果将A服务改成SWOOLE_BASE模式，会导致返回curl: (52) Empty reply from server\r\n第十一次请求正常。\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.3.0\r\nBuilt => Mar 12 2019 21:45:06\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.0.1j 15 Oct 2014\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\ngcc version 4.8.5 20150623 (Red Hat 4.8.5-4) (GCC) \r\nlinux版本：3.10.104\r\nphp :\r\n```\r\nPHP 7.2.1 (cli) (built: Jan 11 2018 19:22:45) ( NTS )\r\nCopyright (c) 1997-2017 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2017 Zend Technologies\r\n```\r\n\r\n编译时修改了：\r\n去掉 SW_HTTP_100_CONTINUE 注释",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2427/comments",
    "author": "hemin3260",
    "comments": [
      {
        "user": "hemin3260",
        "created_at": "2019-03-13T02:22:17Z",
        "body": " reload_async => true 可以避免"
      },
      {
        "user": "twose",
        "created_at": "2019-03-13T06:36:22Z",
        "body": "没开启异步安全重启特性 服务强制被关闭 导致请求无法处理"
      }
    ]
  },
  {
    "number": 2414,
    "title": "WARNING\tswSignalfd_onSignal (ERROR 707): Unable to find callback function for signal Broken pipe: 13.",
    "created_at": "2019-03-08T03:30:16Z",
    "closed_at": "2019-03-12T03:45:26Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2414",
    "body": "运行tcp服务之后，测试连接和发信息正常，然后tcp关闭客户端，服务继续运行，长时间没有请求，一个晚上没动（确切时间不清楚），第二条用客户端连接后首次发请求服务端提示WARNING\tswSignalfd_onSignal (ERROR 707): Unable to find callback function for signal Broken pipe: 13.但能正常接收消息，不知道什么情况，之后的请求就不出现了，fd是onreceive 的回调参数，swoole4.2.13+php7.3+centos6.1\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2414/comments",
    "author": "anychange",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-03-08T05:47:45Z",
        "body": "这仅是一个警告 说明你向已关闭的连接发送了数据 每次发送数据时需要判断返回值 如发送失败不应再继续发送"
      }
    ]
  },
  {
    "number": 2413,
    "title": "关于defer模式下协程http客户端设置超时的一点疑问",
    "created_at": "2019-03-08T02:22:53Z",
    "closed_at": "2019-03-12T04:48:19Z",
    "labels": [
      "question",
      "good question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2413",
    "body": "我起4个协程http客户端，设置超时为10s，发post请求(即Coroutine\\Http\\Client->post，并set([ 'timeout' => 10 ]))，结果过了40s才返回，是不是应该10s返回呢？\r\n\r\n下面是版本信息：\r\nCentOS Linux release 7.3.1611 (Core) \r\n\r\nPHP 7.2.15 (cli) (built: Mar  1 2019 11:41:54) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.2.15, Copyright (c) 1999-2018, by Zend Technologies\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.2.13\r\nBuilt => Mar  1 2019 11:43:30\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2413/comments",
    "author": "kant712",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-03-10T03:47:43Z",
        "body": "四个HTTP客户端串行了, 起四个协程并发执行才会是10s"
      },
      {
        "user": "shenzhe",
        "created_at": "2019-03-10T09:37:54Z",
        "body": "代码片段贴出来"
      },
      {
        "user": "kant712",
        "created_at": "2019-03-10T11:03:52Z",
        "body": "下述代码工作符合预期，总耗时3s：\r\n```\r\n<?php\r\n$http = new Swoole\\Http\\Server( \"127.0.0.1\" , 9501 );\r\n$http->on( \"request\" , function( $request , $response )\r\n{\r\n    $c1 = new Swoole\\Coroutine\\Http\\Client( '1.1.1.1' , 8081 );\r\n    $c1->set( [ 'timeout' => 5 ] );\r\n    $c1->setDefer();\r\n    $c1->post( '/sleep' , [\r\n        'time' => 3000 , //该服务过3s返回\r\n    ] );\r\n    $c2 = new Swoole\\Coroutine\\Http\\Client( '1.1.1.1' , 8081 );\r\n    $c2->set( [ 'timeout' => 5 ] );\r\n    $c2->setDefer();\r\n    $c2->post( '/sleep' , [\r\n        'time' => 3000 ,\r\n    ] );\r\n    $c1->recv();\r\n    $c2->recv();\r\n    $response->end( $c1->body . $c2->body );\r\n} );\r\n$http->start();\r\n```\r\n下述代码测试的是服务器端口不可达的情形，耗时10s：\r\n```\r\n<?php\r\n$http = new Swoole\\Http\\Server( \"127.0.0.1\" , 9501 );\r\n$http->on( \"request\" , function( $request , $response )\r\n{\r\n    $c1 = new Swoole\\Coroutine\\Http\\Client( '2.2.2.2' , 8081 ); //端口不可达\r\n    $c1->set( [ 'timeout' => 5 ] );\r\n    $c1->setDefer();\r\n    $c1->post( '/sleep' , [\r\n        'time' => 10000 ,\r\n    ] );\r\n    $c2 = new Swoole\\Coroutine\\Http\\Client( '2.2.2.2' , 8081 ); //端口不可达\r\n    $c2->set( [ 'timeout' => 5 ] );\r\n    $c2->setDefer();\r\n    $c2->post( '/sleep' , [\r\n        'time' => 10000 ,\r\n    ] );\r\n    $c1->recv();\r\n    $c2->recv();\r\n    $response->end( $c1->body . $c2->body );\r\n} );\r\n$http->start();\r\n```\r\n\r\n下述代码测试的是服务器端口可达，但是在指定超时时间内不返回的情形，耗时10s：\r\n```\r\n<?php\r\n$http = new Swoole\\Http\\Server( \"127.0.0.1\" , 9501 );\r\n$http->on( \"request\" , function( $request , $response )\r\n{\r\n    $c1 = new Swoole\\Coroutine\\Http\\Client( '1.1.1.1' , 8081 ); //端口可达\r\n    $c1->set( [ 'timeout' => 5 ] );\r\n    $c1->setDefer();\r\n    $c1->post( '/sleep' , [\r\n        'time' => 10000 ,\r\n    ] );\r\n    $c2 = new Swoole\\Coroutine\\Http\\Client( '1.1.1.1' , 8081 ); //端口可达\r\n    $c2->set( [ 'timeout' => 5 ] );\r\n    $c2->setDefer();\r\n    $c2->post( '/sleep' , [\r\n        'time' => 10000 ,\r\n    ] );\r\n    $c1->recv();\r\n    $c2->recv();\r\n    $response->end( $c1->body . $c2->body );\r\n} );\r\n$http->start();\r\n```"
      },
      {
        "user": "kant712",
        "created_at": "2019-03-12T01:10:52Z",
        "body": "> 四个HTTP客户端串行了, 起四个协程并发执行才会是10s\r\n\r\n代码已贴，麻烦帮忙看看，谢谢！"
      },
      {
        "user": "kant712",
        "created_at": "2019-03-12T01:11:02Z",
        "body": "> 代码片段贴出来\r\n\r\n代码已贴，麻烦帮忙看看，谢谢！"
      },
      {
        "user": "twose",
        "created_at": "2019-03-12T04:47:13Z",
        "body": "defer模式是支持并发收包(recv), 而你此处卡在了连接阶段, 并不能通过defer特性并发连接\r\ndefer模式并不是一个很好的特性, 只是一个有缺陷的历史产物, 你需要使用CSP的编程模式\r\n```php\r\ngo(function () {\r\n    $s = microtime(true);\r\n    $chan = new Co\\Channel;\r\n    for ($n = 2; $n--;) {\r\n        go(function () use ($chan) {\r\n            $cli = new Co\\Http\\Client('2.2.2.2', 8081); //端口不可达\r\n            $cli->set(['timeout' => 1]);\r\n            $cli->get('/');\r\n            $chan->push($cli);\r\n        });\r\n    }\r\n    for ($n = 2; $n--;) {\r\n        $result = $chan->pop();\r\n        var_dump($result->errMsg);\r\n    }\r\n    var_dump(microtime(true) - $s);\r\n});\r\n```"
      },
      {
        "user": "kant712",
        "created_at": "2019-03-12T05:07:05Z",
        "body": "> defer模式是支持并发收包(recv), 而你此处卡在了连接阶段, 并不能通过defer特性并发连接\r\n> defer模式并不是一个很好的特性, 只是一个有缺陷的历史产物, 你需要使用CSP的编程模式\r\n> \r\n> ```\r\n> go(function () {\r\n>     $s = microtime(true);\r\n>     $chan = new Co\\Channel;\r\n>     for ($n = 2; $n--;) {\r\n>         go(function () use ($chan) {\r\n>             $cli = new Co\\Http\\Client('2.2.2.2', 8081); //端口不可达\r\n>             $cli->set(['timeout' => 1]);\r\n>             $cli->get('/');\r\n>             $chan->push($cli);\r\n>         });\r\n>     }\r\n>     for ($n = 2; $n--;) {\r\n>         $result = $chan->pop();\r\n>         var_dump($result->errMsg);\r\n>     }\r\n>     var_dump(microtime(true) - $s);\r\n> });\r\n> ```\r\n\r\n学习了，我再试试，谢谢！"
      }
    ]
  },
  {
    "number": 2403,
    "title": "max_connection is exceed the maximum value[1024].",
    "created_at": "2019-03-05T11:04:23Z",
    "closed_at": "2019-03-06T03:22:51Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2403",
    "body": "server配置如下：\r\n$serv->set(array(\r\n        'heartbeat_idle_time' => 300, //aftere 300s close\r\n        'heartbeat_check_interval' => 10, //30s check client send or not\r\n        'max_conn' => 30000,\r\n        'open_length_check' => true,\r\n        'package_max_length' => 81920,\r\n        'package_length_type' => 'N',\r\n        'package_length_offset' => 8,\r\n        'package_body_offset' => 16,\r\n        // 'dispatch_mode' => 5\r\n        'task_worker_num' => 1000,\r\n));\r\nulimit -n\r\n262140\r\n\r\n\r\n使用 supervisor 起动就报如下错误，手动起server不报\r\n\r\n--servertcp start--\r\n[2019-03-05 10:42:27 @108945.0] WARNING swServer_start_check: serv->max_connection is exceed the maximum value[1024].\r\n[2019-03-05 10:42:27 @108945.0] WARNING swServer_start_check: serv->max_connection is too small.\r\n[2019-03-05 10:42:27 @108945.0] WARNING swPipeUnsock_create: socketpair() failed. Error: Too many open files [24]\r\n[2019-03-05 10:42:27 @108945.0] WARNING swServer_create_task_worker: [Master] create task_workers failed.\r\n[2019-03-05 10:42:27 @108945.0] WARNING swFactoryProcess_start: swFactoryProcess_manager_start failed.\r\nPHP Fatal error:  Swoole\\Server::start(): failed to start server. Error: swFactoryProcess_start: swFactoryProcess_manager_start failed. in /var/www/golf/swooleserver/servertcp.php on line 69\r\n[2019-03-05 10:42:27 @108945.0] ERROR   zm_deactivate_swoole (ERROR 503): Fatal error: Swoole\\Server::start(): failed to start server. Error: swFactoryProcess_start: swFactoryProcess_manager_start failed. in /var/www/golf/swooleserver/servertcp.php on line\r\n\r\n\r\n\r\n\r\nswoole version\r\nVersion => 4.1.1\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2403/comments",
    "author": "ebankie",
    "comments": [
      {
        "user": "jobs-git",
        "created_at": "2019-03-05T11:05:01Z",
        "body": "this must be your OS increase OS maximum connection"
      },
      {
        "user": "ebankie",
        "created_at": "2019-03-05T11:07:54Z",
        "body": "'task_worker_num' => 1000,  这条配置比较少的时候例如：20个500个，就可以正常起动，怀疑是supervsor 起动 引起的，，"
      },
      {
        "user": "twose",
        "created_at": "2019-03-06T03:22:51Z",
        "body": "这个取决于你的系统参数, worker_num不是越多越好的, worker数量一般最多设置为CPU核数的2倍, 否则适得其反"
      },
      {
        "user": "ebankie",
        "created_at": "2019-03-06T06:00:22Z",
        "body": "那可以理解为 work_num 和 task_worker_num 是一样的，但是 设置task_worker_num 一定的注册onTask、onFinish，我尝试配置少些看看，效果"
      }
    ]
  },
  {
    "number": 2396,
    "title": "跑定时器出现内存泄漏，如何定位是哪块代码有问题？",
    "created_at": "2019-03-04T02:16:43Z",
    "closed_at": "2019-03-07T10:06:35Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2396",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n>目前是使用swoft框架跑了个定时器，每隔几个小时就报内存超出，然后worker进程就重启，由于看不到代码追踪信息，无法定位到具体是哪里出现了问题，想问下有什么好的方法监控下进程\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n```\r\nFatal error: Allowed memory size of 134217728 bytes exhausted (tried to allocate 262144 bytes) in /var/www/swoft/vendor/swoft/db/src/Statement.php on line 465\r\n```\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n4.2.12\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\nphp 7.2\r\ngcc version 6.3.0\r\n使用docker容器\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2396/comments",
    "author": "jqhph",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-03-04T07:18:00Z",
        "body": "检查代码中使用全局变量和静态变量的地方"
      },
      {
        "user": "jqhph",
        "created_at": "2019-03-04T07:32:17Z",
        "body": "> 检查代码中使用全局变量和静态变量的地方\r\n\r\n反复检查过多次，没有发现有问题的地方。除了检查代码逻辑，还有没有其他可以监控或定位问题代码块的方式？"
      },
      {
        "user": "twose",
        "created_at": "2019-03-04T07:34:38Z",
        "body": "是否使用了`Timer::tick`方法并使用了传参的方法调用?"
      },
      {
        "user": "jqhph",
        "created_at": "2019-03-04T07:46:45Z",
        "body": "> 是否使用了`Timer::tick`方法并使用了传参的方法调用?\r\n只传了定时器间隔时间和匿名函数，添加方法如下：\r\n```php\r\n// 添加定时器\r\n$timerId = swoole_timer_tick($interval, $taskHandler);\r\n```"
      },
      {
        "user": "twose",
        "created_at": "2019-03-04T10:33:37Z",
        "body": "那应该和底层无关 需要自检 进程退出时有内存分配不足的位置 大概率会在频繁申请内存的地方 可以自己加大频率试试"
      }
    ]
  },
  {
    "number": 2389,
    "title": "各位大神帮忙看下这个是不是swoole的一个bug",
    "created_at": "2019-02-26T10:07:32Z",
    "closed_at": "2019-02-26T10:27:19Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2389",
    "body": "请问下我在swoole\\server中新增监听一个端口,启用了websocket协议解析.在onOpen的回调中拿到的server对象为什么是swoole\\server对象而不是websocket\\server对象,而在onMessage回调中拿到的却是websocket\\server对象,按理来说在onOpen回调中的server对象不应该是websocket\\server对象吗?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2389/comments",
    "author": "xyzj91",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-02-26T10:11:05Z",
        "body": "没办法升级Server对象, 只能先使用Websocket\\Server然后增加tcp的端口"
      },
      {
        "user": "xyzj91",
        "created_at": "2019-02-26T10:15:11Z",
        "body": "> 没办法升级Server对象, 只能先使用Websocket\\Server然后增加tcp的端口\r\n\r\n好吧,也只能先这样实现了"
      }
    ]
  },
  {
    "number": 2384,
    "title": "进入redis协程客户端之后协程id不一致",
    "created_at": "2019-02-25T06:49:56Z",
    "closed_at": "2019-02-26T01:43:11Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2384",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n监听onRequest方法，disPatch调用redis协程客户端执行了一次incr操作\r\n```php\r\n$register->set($register::onRequest,function (\\swoole_http_request $request,\\swoole_http_response $response)use($dispatcher){\r\n            $request_psr = new Request($request);\r\n            $response_psr = new Response($response);\r\n            try{\r\n                EasySwooleEvent::onRequest($request_psr,$response_psr);\r\n                        file_put_contents(\"/tmp/ee.log\", \"put1\\t\" . SERVER_NAME . \"\\t\" . Coroutine::getUid() . \"\\t\" . var_export($response_psr,true) . \"\\n\", FILE_APPEND);\r\n                    $dispatcher->dispatch($request_psr,$response_psr);\r\n            file_put_contents(\"/tmp/ee.log\", \"put2\\t\" . SERVER_NAME . \"\\t\" . Coroutine::getUid() . \"\\t\" . var_export($response_psr, true) . \"\\n\", FILE_APPEND);\r\n}\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n协程id一致\r\n\r\n3. What did you see instead?\r\n```php\r\nput1    Demo    52641   EasySwoole\\Core\\Http\\Response::__set_state(array(\r\n   'response' =>\r\n  Swoole\\Http\\Response::__set_state(array(\r\n     'fd' => 52640,\r\n     'header' => NULL,\r\n     'cookie' => NULL,\r\n     'trailer' => NULL,\r\n  )),\r\n   'sendFile' => NULL,\r\n   'isEndResponse' => 0,\r\n   'statusCode' => 200,\r\n   'reasonPhrase' => 'OK',\r\n   'cookies' =>\r\n  array (\r\n  ),\r\n   'protocolVersion' => '1.1',\r\n   'headers' =>\r\n  array (\r\n  ),\r\n   'body' => NULL,\r\n))\r\nput2    Demo    52632   EasySwoole\\Core\\Http\\Response::__set_state(array(\r\n   'response' =>\r\n  Swoole\\Http\\Response::__set_state(array(\r\n     'fd' => 52631,\r\n     'header' =>\r\n    array (\r\n      'Content-Type' => 'application/json;charset=utf-8',\r\n    ),\r\n     'cookie' => NULL,\r\n     'trailer' => NULL,\r\n  )),\r\n   'sendFile' => NULL,\r\n   'isEndResponse' => 2,\r\n   'statusCode' => 200,\r\n   'reasonPhrase' => 'OK',\r\n   'cookies' =>\r\n  array (\r\n  ),\r\n   'protocolVersion' => '1.1',\r\n   'headers' =>\r\n  array (\r\n    'Content-type' =>\r\n    array (\r\n      0 => 'application/json;charset=utf-8',\r\n    ),\r\n  ),\r\n   'body' => NULL,\r\n))\r\n```\r\n协程id和reponse fd不一致\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n4.2.10\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nkernel  Linux version 3.10.106\r\nphp 7.1\r\ngcc 4.8.5",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2384/comments",
    "author": "highwayliu",
    "comments": [
      {
        "user": "mabu233",
        "created_at": "2019-02-25T08:00:51Z",
        "body": "我记得你在es群说过这是压测时出现的，高并发的时候两个 file_put_contents之间可能会有另一个请求的file_put_contents插入，这不是很正常吗？"
      },
      {
        "user": "highwayliu",
        "created_at": "2019-02-25T08:05:52Z",
        "body": "> 我记得你在es群说过这是压测时出现的，高并发的时候两个 file_put_contents之间可能会有另一个请求的file_put_contents插入，这不是很正常吗？\r\n\r\n是多轮高并发之后停止策略，单独发一个curl，会出现这样的情况，这时候swoole的日志显示回包回不出去，连接已断开。\r\n[2019-02-25 15:18:54 *30295.0]\tNOTICE\tswFactoryProcess_finish (ERROR 1005): connection[fd=9172] does not exists.\r\n[2019-02-25 15:18:54 *30295.0]\tNOTICE\tswFactoryProcess_finish (ERROR 1005): connection[fd=9173] does not exists.\r\n[2019-02-25 15:18:54 *30295.0]\tNOTICE\tswFactoryProcess_finish (ERROR 1005): connection[fd=9174] does not exists.\r\n"
      },
      {
        "user": "highwayliu",
        "created_at": "2019-02-25T08:06:41Z",
        "body": "> 我记得你在es群说过这是压测时出现的，高并发的时候两个 file_put_contents之间可能会有另一个请求的file_put_contents插入，这不是很正常吗？\r\n\r\n升级为4.2.13 在同样的多轮压测策略之后，没发现这样的问题"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-02-26T01:43:11Z",
        "body": "说明这是不同的请求。所以协程ID不一样。"
      }
    ]
  },
  {
    "number": 2361,
    "title": "swoole serialize will be removed, you should be using the php serialize instead.",
    "created_at": "2019-02-05T13:04:06Z",
    "closed_at": "2019-02-05T14:52:55Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2361",
    "body": "请问这种错误如何解决？\r\n\r\nswoole serialize will be removed, you should be using the php serialize instead.\r\n\r\n启动时一直提示这个致命错误，用的SD框架。",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2361/comments",
    "author": "kingrainy",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-02-05T14:52:55Z",
        "body": "标题就是答案, 你可以 \r\n`ini_set('error_reporting', E_ALL ^ E_DEPRECATED);`"
      }
    ]
  },
  {
    "number": 2339,
    "title": "PHP Warning:  PHP Startup: Unable to load dynamic library '/usr/lib64/php/modules/swoole.so' - /usr/lib64/php/modules/swoole.so: undefined symbol: X509_check_host in Unknown on line 0",
    "created_at": "2019-01-23T15:06:30Z",
    "closed_at": "2019-01-31T02:14:32Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2339",
    "body": "centos6.5\r\nphp7.0\r\ngcc 4.4.7\r\nOpenSSL 1.0.2l  25 May 2017\r\n安装swoole 2.2.0  打开enable-openssl选项\r\nphp --ri swoole 如下报错\r\nPHP Warning:  PHP Startup: Unable to load dynamic library '/usr/lib64/php/modules/swoole.so' - /usr/lib64/php/modules/swoole.so: undefined symbol: X509_check_host in Unknown on line 0\r\nExtension 'swoole' not present.\r\n请问是什么原因",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2339/comments",
    "author": "shuigunixiang",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-01-27T11:49:02Z",
        "body": "```shell\r\nwhich php\r\nldd /usr/bin/php\r\n```\r\n\r\n请查看php链接的openssl库是什么版本？可能你编译使用的是新版本，但运行时使用的是旧版本。"
      }
    ]
  },
  {
    "number": 2337,
    "title": "4.2.12版本manager进程中使用task",
    "created_at": "2019-01-23T04:03:12Z",
    "closed_at": "2019-01-27T11:43:29Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2337",
    "body": "1. What did you do? If possible, provide a simple script for reproducing the error.\r\n根据官网文档描述4.2.12版本可以再manager中触发task，但在本地环境中测试，\r\n\r\n```\r\npublic function onManagerStart($server)\r\n    {\r\n        $server->task(\"cronJob\");\r\n    }\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\nmanager中可以触发task\r\n\r\n3. What did you see instead?\r\n`Fatal error: Uncaught ErrorException: Swoole\\Server::task(): task method can only be used in the worker process. `\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n4.2.12\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\nmac mojave\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2337/comments",
    "author": "sayid",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-01-27T11:43:29Z",
        "body": "4.2.12 不可用，在 4.2.13/4.3.0 中可用。"
      }
    ]
  },
  {
    "number": 2333,
    "title": "WARNING swManager_check_exit_status: worker#11 abnormal exit, status=255, signal=0",
    "created_at": "2019-01-21T08:57:16Z",
    "closed_at": "2019-01-21T09:06:23Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2333",
    "body": "目前用nginx做反代，偶尔会报504 ，nginx设置的超时时间为5S。目前 启动了8个worker，出现504时，看到的现象是：1）其中有两个worker 会退出，swoolelog里面记录：WARNING swManager_check_exit_status: worker#2 abnormal exit, status=255, signal=0\r\n2）strace -p  最后会的输出：write(1, \"127.0.0.19506order/online_pos_li\"…, 34) = -1 EIO (Input/output error)\r\nexit_group(-1)                          = ?\r\n+++ exited with 255 +++\r\n目前代码里面没有exit，或者die之类的语句。\r\nregister_shutdown_function 也没有任何异常信息。\r\nphp： 7.1.26    ，swoole：4.2.12  \r\n业务代码是使用GuzzleHttpClient调用了一个远程的http接口 。现在的问题是任何一个接口都可能出现这个问题。但是不能重现该问题。",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2333/comments",
    "author": "giantwu",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-01-21T09:06:23Z",
        "body": "请将Server程序设置为守护进程"
      },
      {
        "user": "giantwu",
        "created_at": "2019-01-21T09:12:28Z",
        "body": "> 请将Server程序设置为守护进程\r\n\r\n目前运行就是以demo形式运行的，配置项：daemonize=>1  "
      },
      {
        "user": "matyhtf",
        "created_at": "2019-01-21T09:15:07Z",
        "body": "请检查你的设置，或者使用 nohup ，write(1 表示写入标准输出（打印屏幕），这时 shell已退出，write(1 会立即返回 eio ，而 php 底层遇到 echo 失败会立即退出。"
      },
      {
        "user": "giantwu",
        "created_at": "2019-01-21T09:19:14Z",
        "body": "多谢韩大大，这个我检查下，确保是守护进程形式存在的。另外还有个您帮看下：WARNING swSignal_callback (ERROR 707): Unable to find callback function for signal Hangup: 1\r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-01-21T09:24:33Z",
        "body": "这个可能与上一个问题是相同的。未设置守护进程，shell 退出时会向 Server 发送 sighup 信号。\r\n"
      },
      {
        "user": "giantwu",
        "created_at": "2019-01-21T09:32:28Z",
        "body": "韩大大，确认是 守护进程，而且代码中没有任何输出语句。目前用的是easyswoole3  Server 启动时 跟踪了，确认是 daemonize=>1 "
      },
      {
        "user": "kiss291323003",
        "created_at": "2019-01-21T11:06:21Z",
        "body": "他确认了，是以php easyswoole start d这样的形式启动的。这样启动的形式确实是正确的守护。不过我目前这边没有碰见过相同的情况。建议升级下gcc和php，然后重新编译下swoole"
      },
      {
        "user": "giantwu",
        "created_at": "2019-01-22T02:21:38Z",
        "body": "> 他确认了，是以php easyswoole start d这样的形式启动的。这样启动的形式确实是正确的守护。不过我目前这边没有碰见过相同的情况。建议升级下gcc和php，然后重新编译下swoole\r\n\r\n多谢，费心了，我在试试看。"
      }
    ]
  },
  {
    "number": 2312,
    "title": "Coroutine Channel question",
    "created_at": "2019-01-14T05:07:54Z",
    "closed_at": "2019-01-14T05:16:26Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2312",
    "body": "```php\r\n// a.php\r\n$chan = new \\Swoole\\Coroutine\\Channel();\r\ngo(function () use ($chan) {\r\n    $chan->push(1);\r\n//    $chan->push(2);\r\n});\r\n// php a.php\r\n// 执行完退出\r\n\r\n// a.php\r\n$chan = new \\Swoole\\Coroutine\\Channel();\r\ngo(function () use ($chan) {\r\n    $chan->push(1);\r\n    $chan->push(2);\r\n});\r\n// php a.php\r\n// 为什么会阻塞\r\n\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2312/comments",
    "author": "lizhichao",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-01-14T05:09:43Z",
        "body": "因为通道容量只有1, 第二次push会挂起"
      },
      {
        "user": "lizhichao",
        "created_at": "2019-01-14T05:16:26Z",
        "body": "3q "
      }
    ]
  },
  {
    "number": 2304,
    "title": "同步模式下，等待某个协程结束再响应，怎么处理呢？chan只能在协程里用",
    "created_at": "2019-01-10T07:27:28Z",
    "closed_at": "2019-01-11T03:49:04Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2304",
    "body": "",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2304/comments",
    "author": "thinkcmf",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-01-10T08:01:40Z",
        "body": "把全局代码包到协程里使用"
      },
      {
        "user": "windrunner414",
        "created_at": "2019-01-10T10:14:18Z",
        "body": "在协程内响应"
      },
      {
        "user": "thinkcmf",
        "created_at": "2019-01-10T12:42:55Z",
        "body": "> 把全局代码包到协程里使用\r\n\r\n主要是不想大改原有项目的逻辑，又想使用协程"
      },
      {
        "user": "thinkcmf",
        "created_at": "2019-01-10T13:00:13Z",
        "body": "其实给当前 worker加个标记别接受新的请求就可以了"
      },
      {
        "user": "windrunner414",
        "created_at": "2019-01-10T15:29:44Z",
        "body": "```\r\nfunction onRequest($request, $response) {\r\n    go(function () use (&$request, &$response) {\r\n        // do something...\r\n        $response->end();\r\n    });\r\n}\r\n```\r\n这样试试呢？\r\n而且包在协程里也无需改逻辑呀"
      },
      {
        "user": "thinkcmf",
        "created_at": "2019-01-11T02:13:38Z",
        "body": "> ```\r\n> function onRequest($request, $response) {\r\n>     go(function () use (&$request, &$response) {\r\n>         // do something...\r\n>         $response->end();\r\n>     });\r\n> }\r\n> ```\r\n> 这样试试呢？\r\n> 而且包在协程里也无需改逻辑呀\r\n\r\n原有逻辑里有很多静态变量和静态属性，放协程里，如果协程里有阻塞代码，协程就会挂起，然后新请求时来，静态变量和静态属性就可能会被覆盖"
      },
      {
        "user": "twose",
        "created_at": "2019-01-11T02:19:10Z",
        "body": "你这种情况, 同步和异步一起使用, 没有意义, 会产生错误"
      },
      {
        "user": "thinkcmf",
        "created_at": "2019-01-11T02:25:45Z",
        "body": "> 你这种情况, 同步和异步一起使用, 没有意义, 会产生错误\r\n\r\n其实就是让 worker 只处理一个请求，这个请求处理完，再接着处理新的请求，这样就不用担心，静态变量被覆盖了。\r\n\r\n```\r\nfunction onRequest($request, $response) {\r\n     // 这里标记 worker 别接受新请求了\r\n\r\n    go(function () use (&$request, &$response) {\r\n        // do something...\r\n        // 这里可以开心地使用协程了\r\n        $response->end();\r\n        // 请求处理完,告诉worker可以接受新请求了\r\n    });\r\n\r\n}\r\n```\r\n这种方式可以让很多老程序使用上协程，感觉可以是半异步半同步了"
      },
      {
        "user": "twose",
        "created_at": "2019-01-11T02:28:26Z",
        "body": "那为什么要用协程?.."
      },
      {
        "user": "thinkcmf",
        "created_at": "2019-01-11T02:34:01Z",
        "body": "> 那为什么要用协程?..\r\n\r\n```\r\nfunction onRequest($request, $response)\r\n{\r\n    // 这里标记 worker 别接受新请求了\r\n    \r\n    go(function () use (&$request, &$response) {\r\n        // do something...\r\n        //并发请求 n\r\n        $n = 5;\r\n        for ($i = 0; $i < $n; $i++) {\r\n            $cli = new Swoole\\Coroutine\\Http\\Client('127.0.0.1', 80);\r\n            $cli->setHeaders([\r\n                'Host'            => \"local.ad.oa.com\",\r\n                \"User-Agent\"      => 'Chrome/49.0.2587.3',\r\n                'Accept'          => 'text/html,application/xhtml+xml,application/xml',\r\n                'Accept-Encoding' => 'gzip',\r\n            ]);\r\n            $cli->set(['timeout' => 2]);\r\n            $cli->setDefer();\r\n            $cli->get('/test.php');\r\n            $clients[] = $cli;\r\n        }\r\n\r\n        for ($i = 0; $i < $n; $i++) {\r\n            $r        = $clients [$i]->recv();\r\n            $result[] = $clients[$i]->body;\r\n        }\r\n        $response->end(json_encode($data));\r\n\r\n        // 请求处理完,告诉worker可以接受新请求了\r\n    });\r\n\r\n}\r\n```\r\n\r\n这样就可以使用协程并发处理此类问题，同时也不影响老代码"
      },
      {
        "user": "thinkcmf",
        "created_at": "2019-01-11T02:42:14Z",
        "body": "只要能标记 worker 是否接受新请求的开关，这种想法感觉还是有意义的，至少比全同步好点"
      },
      {
        "user": "twose",
        "created_at": "2019-01-11T02:44:28Z",
        "body": "开启协程, 做一个全局的channel, 然后向里面push([$request, $response]), 然后单独开一个协程, pop出来, 逐个处理."
      },
      {
        "user": "thinkcmf",
        "created_at": "2019-01-11T03:26:23Z",
        "body": "> 开启协程, 做一个全局的channel, 然后向里面push([$request, $response]), 然后单独开一个协程, pop出来, 逐个处理.\r\n\r\n感谢，完美解决了\r\n"
      }
    ]
  },
  {
    "number": 2255,
    "title": "swoole-4.2.10  build failed with http2",
    "created_at": "2018-12-28T06:03:39Z",
    "closed_at": "2018-12-28T10:50:15Z",
    "labels": [
      "question",
      "installation"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2255",
    "body": "I  build  php5.7.x and swoole  with devtoolset-2 and gcc-4.8.x ，\r\nbefore   swoole-4.2.10  ,  It works well . \r\nlastnight , it can't build successfully with  http2 \r\n\r\n/apps/libs/nghttp2 -> /apps/libs/nghttp2-1.34.0/\r\n\r\nthe configure : \r\n ./configure --enable-mysqlnd --enable-openssl --enable-http2 --enable-sockets --enable-swoole --with-php-config=/apps/svr/php/bin/php-config --with-nghttp2-dir=/apps/libs/nghttp2/ \r\nmake -j2\r\n...\r\nIn file included from /apps/src/swoole-src-4.2.10/swoole.c:16:0:\r\n/apps/src/swoole-src-4.2.10/php_swoole.h:136:2: error: #error \"Enable http2 support, require nghttp2 library.\"\r\n #error \"Enable http2 support, require nghttp2 library.\"\r\n  ^\r\nmake: *** [swoole.lo] Error 1\r\nmake: *** Waiting for unfinished jobs....\r\nIn file included from /apps/src/swoole-src-4.2.10/swoole_async.cc:17:0:\r\n/apps/src/swoole-src-4.2.10/php_swoole.h:136:2: error: #error \"Enable http2 support, require nghttp2 library.\"\r\n #error \"Enable http2 support, require nghttp2 library.\"\r\n  ^\r\nmake: *** [swoole_async.lo] Error 1\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2255/comments",
    "author": "omyhub",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-12-28T10:50:12Z",
        "body": "Need to install nghttp2\r\n\r\n```shell\r\nsudo apt install libnghttp2-dev\r\n```"
      }
    ]
  },
  {
    "number": 2241,
    "title": "swoole4.2.10创建进程问题",
    "created_at": "2018-12-25T05:48:07Z",
    "closed_at": "2018-12-25T08:18:45Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2241",
    "body": "你好\r\n我升级到4.2.10之后 创建进程时候 出现两个问题：\r\nFatal error: Swoole\\Process::start(): must be forked outside the coroutine.\r\n和\r\nFatal error: Swoole\\Process::__construct(): unable to create process with async-io threads.\r\n发现，4.2.10不能在协程和异步中创建进程了，这个以后还会改回来吗，影响太大了，如果不能在异步中创建进程，也就是说我想 兼顾子进程的回收与重建，还有 动态增加新的进程就不可能了，或是有别的方法可以处理这样的事情吗",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2241/comments",
    "author": "kokofirst",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-12-25T06:26:27Z",
        "body": "协程中只能使用`co::exec`来创建进程, 否则会出现问题"
      },
      {
        "user": "kokofirst",
        "created_at": "2018-12-25T07:36:51Z",
        "body": "可是 用 co::exec 创建的进程 和主进程 无法进行通信， 也无法使用 swoole_table 共享数据"
      },
      {
        "user": "kokofirst",
        "created_at": "2018-12-25T08:08:29Z",
        "body": "我之前写了一个进程管理器，通过进程管理器来调控子进程的数量，主要是不知道怎么改了，这个东西无法用现有的东西重写了.工作原理是，通过子进程的繁忙度，来和主进程通信，让主进程动态的增加或者减少子进程，现在 协程中不让创建子进程了，就无法同时创建子进程和 回收子进程了"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-12-25T08:18:06Z",
        "body": "这两个都是不安全的，因此底层禁止了这种行为。\r\n* AIO 线程，会带线程 fork\r\n* 协程，会复制协程栈，导致出现内存错误\r\n\r\n只有 `exec` 是安装的。新的子进程可以使用 `php child.php` 创建一个新的环境。父子进程可以使用 tcp 或 unix socket 进行通信。"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-12-25T08:18:45Z",
        "body": "或者，在你的进程管理器中不要使用任何 AIO 和 协程 相关 API"
      }
    ]
  },
  {
    "number": 2185,
    "title": "PHP Warning:  Swoole\\WebSocket\\Server::push(): the connected client of connection[49] is not a websocket client or closed.",
    "created_at": "2018-12-06T05:52:10Z",
    "closed_at": "2018-12-11T07:44:36Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2185",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n```\r\n   public function onRequest(\\swoole_http_request $request, \\swoole_http_response $response)\r\n    {\r\n        $data = [\r\n            'message' => $request->post['info']\r\n        ];\r\n        foreach ($this->webSocketServ->connections as $fd) {\r\n            try {\r\n                $this->webSocketServ->push($fd, json_encode($data));\r\n            } catch (Exception $e) {\r\n\r\n            }\r\n        }\r\n    }\r\n```\r\n\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n客户端关闭后应该就开始触发 close ，client  已经从 $server->connections  中移除才对 ，为什么会报这个错误 ？\r\n\r\n3. What did you see instead?\r\n\r\n`PHP Warning:  Swoole\\WebSocket\\Server::push(): the connected client of connection[49] is not a websocket client or closed.`\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n```\r\n[root@localhost 09]# php --ri swoole\r\n\r\nswoole\r\n\r\nswoole support => enabled\r\nVersion => 4.2.9\r\nAuthor => Swoole Group[email: team@swoole.com]\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.0.2k-fips  26 Jan 2017\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => On => On\r\nswoole.use_shortname => On => On\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\n```\r\n[root@localhost 09]# uname -a\r\nLinux localhost.localdomain 3.10.0-862.el7.x86_64 #1 SMP Fri Apr 20 16:44:24 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2185/comments",
    "author": "yunlongw",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-12-06T09:52:29Z",
        "body": "发送期间客户端可能会断开的, 而你遍历的PHP迭代器是不可能实时更新的, 在发送的时候底层会再次获取连接, 如果发现客户端断开了就会警告, 你可以加个@抑制警告, 这个在群发时没有影响, 可以安心@."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-12-11T07:44:36Z",
        "body": "使用`WebSocket\\Server->isEstablished`判断`fd`是否为可用的`websocket`连接"
      }
    ]
  },
  {
    "number": 2167,
    "title": "Swoole\\Serialize 没有支持 Serializable 接口",
    "created_at": "2018-11-30T02:35:33Z",
    "closed_at": "2018-11-30T08:29:07Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2167",
    "body": "使用`serialize`、`unserialize`：\r\n\r\n```php\r\n<?php\r\nclass obj implements Serializable\r\n{\r\n    public function serialize()\r\n    {\r\n        echo __METHOD__, PHP_EOL;\r\n        return '';\r\n    }\r\n    public function unserialize($data)\r\n    {\r\n        echo __METHOD__, PHP_EOL;\r\n    }\r\n}\r\n\r\n$obj = new obj;\r\n\r\n$ser = serialize($obj);\r\n$newobj = unserialize($ser);\r\n```\r\n\r\n正常输出：\r\n```php\r\nobj::serialize\r\nobj::unserialize\r\n```\r\n\r\n使用`Swoole\\Serialize`：\r\n\r\n```php\r\n<?php\r\nclass obj implements Serializable\r\n{\r\n    public function serialize()\r\n    {\r\n        echo __METHOD__, PHP_EOL;\r\n        return '';\r\n    }\r\n    public function unserialize($data)\r\n    {\r\n        echo __METHOD__, PHP_EOL;\r\n    }\r\n}\r\n\r\n$obj = new obj;\r\n\r\n$ser = Swoole\\Serialize::pack($obj);\r\n$newobj = Swoole\\Serialize::unpack($ser);\r\n```\r\n\r\n什么也没输出，应该是没有支持 Serializable 接口吧",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2167/comments",
    "author": "Yurunsoft",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-11-30T04:13:08Z",
        "body": "没有实现接口 但实现了魔术方法 该模块将废除"
      },
      {
        "user": "Yurunsoft",
        "created_at": "2018-11-30T06:29:16Z",
        "body": "为什么要废除，比php的速度快而且体积小啊"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-11-30T08:29:07Z",
        "body": "@Yurunsoft  PHP 内核频繁改动导致维护困难，没有过多精力去维护它。建议使用 msgpack 等扩展。"
      }
    ]
  },
  {
    "number": 2166,
    "title": "Connection could not be established to mysql despite connection pooling",
    "created_at": "2018-11-29T22:16:05Z",
    "closed_at": "2018-11-30T02:35:46Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2166",
    "body": "When you have a query that is a bit harder for mysql and a few thousands concurrent connected client. I get an error that connection could not be established, this is despite creating connection pool for mysql. Here is the error:\r\n\r\n`PHP Warning:  Swoole\\Coroutine\\MySQL::prepare(): The MySQL connection is not established`\r\n\r\nThen the swoole server dies out, I am expecting that It should not die out and the connection is always established\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n```php\r\n<?php\r\n\r\n$pool = new \\SplQueue;\r\n# 2: pool startup size\r\n\r\n$server = new swoole_http_server(\"/home/user/swoole.sock\", 0, SWOOLE_BASE, SWOOLE_UNIX_STREAM);\r\n\r\n$server->on('request', function (swoole_http_request $request, swoole_http_response $response) use ($pool) {\r\n\r\n    if ($pool->isEmpty()) {\r\n        $mysql = new Swoole\\Coroutine\\MySQL;\r\n        $mysql->connect([\r\n          'host' => '127.0.0.1',\r\n          'user' => 'user',\r\n          'password' => 'pwd',\r\n          'database' => 'test'\r\n        ]);\r\n    } else {\r\n        $mysql = $pool->pop();\r\n    }\r\n    $stmt = $mysql->prepare('SELECT * FROM `table` where `col1`=1 ORDER BY `ID` desc LIMIT 20' );\r\n    $result = $stmt->execute();\r\n    # 1: mysql benchmark\r\n\r\n    # 3: change to one requested query\r\n\r\n    $response->end('whatever'.print_r($result,true));\r\n\r\n    $pool->push($mysql);\r\n\r\n});\r\n\r\n$server->start();\r\n\r\n```\r\n\r\n\r\n2. What did you expect to see?\r\nConnection are always established and swoole server always survives\r\nNone dying server is very important for 24/7 applications\r\n\r\n\r\n3. What did you see instead?\r\nI get an error that connection could not be established, this is despite creating connection pool for mysql. Here is the error:\r\n\r\n`PHP Warning:  Swoole\\Coroutine\\MySQL::prepare(): The MySQL connection is not established`\r\n\r\nThe swoole server dies out\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n4.2.7\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2166/comments",
    "author": "jobs-git",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-11-30T02:35:36Z",
        "body": "You need to check error (code 2006 or 2013) after you query the database and try to reconnect and retry."
      },
      {
        "user": "jobs-git",
        "created_at": "2018-11-30T02:41:53Z",
        "body": "Hi, I could not query the error cause swoole server dies too, more over, if the query is very simple I can go upto 40k connections, if I have a bit difficult query, I get only upto 2000 connections/s but at 5k, I now get this error."
      }
    ]
  },
  {
    "number": 2162,
    "title": "[bug]在定时器中创建子程序会直接变成僵尸",
    "created_at": "2018-11-29T06:38:24Z",
    "closed_at": "2018-11-29T10:53:51Z",
    "labels": [
      "question",
      "coroutine",
      "good question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2162",
    "body": "timer 本身是个子进程，托管在manager下。\r\n看官方文档，好像说 start会清除父进程的 timer，但是我这个timer可以一直打印log，但是孙进程创建出来就是僵尸（它的父进程是这个timer进程，而timer进程没死）\r\n\r\n说明：创建孙进程时无报错，成功返回pid。孙进程里的 exec 不会有错，跟它没关，写什么都这样。\r\n\r\n```php\r\n<?php\r\n\r\nnamespace Pkg\\Swoola\\Components\\Swoole\\Process;\r\n\r\ntrait QueueWorkerTrait\r\n{\r\n    protected $queueWorkerPids = [];\r\n\r\n    public function addQueueWorker()\r\n    {\r\n        $self = $this;\r\n        $process = new \\Swoole\\Process(function(\\Swoole\\Process $worker) {\r\n            \\Pkg\\Swoola\\set_process_name('swoola - timer process ');\r\n            \\Swoole\\Process::signal(SIGCHLD, function($sig) {\r\n                // 必须为false，非阻塞模式\r\n                while($ret = \\Swoole\\Process::wait(false)) {\r\n                    echo \"PID={$ret['pid']}\\n\";\r\n                }\r\n            });\r\n\r\n            swoole_timer_tick(1000, function() {\r\n                if (!$this->queueWorkerPids) {\r\n                    $this->createQueueWorker();\r\n                } else {\r\n                    foreach ($this->queueWorkerPids as $idx => $pid) {\r\n                        $current_time = date('H:i:s');\r\n                        if (\\Swoole\\Process::kill($pid, 0)) {\r\n                            echo \"PID[{$pid}] is alived({$current_time}).\\n\";\r\n                        } else {\r\n                            echo \"PID[{$pid}] is died.\\n\";\r\n                            unset($this->queueWorkerPids[$idx]);\r\n                            $this->createQueueWorker($idx);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        });\r\n\r\n        $this->server->addProcess($process);\r\n        // $process->start();\r\n    }\r\n\r\n    protected function createQueueWorker($idx = null)\r\n    {\r\n        $num = is_null($idx) ? 2 : 1;\r\n\r\n        for ($i = 0; $i < $num; $i++) {\r\n            $process = new \\Swoole\\Process(function(\\Swoole\\Process $worker) use($i, $idx) {\r\n                $worker->exec(PHP_BINARY, [SWOOLA_APP_DIR.'/artisan', 'queue:work']);\r\n            });\r\n\r\n            $pid = $process->start();\r\n            if (is_null($idx)) {\r\n                $this->queueWorkerPids[$i] = $pid;\r\n            } else {\r\n                $this->queueWorkerPids[$idx] = $pid;\r\n            }\r\n\r\n            // if ($pid) {\r\n\r\n            // } else {\r\n            //     $errno = swoole_errno();\r\n            //     var_dump(swoole_strerror($errno));\r\n            // }\r\n        }\r\n    }\r\n}\r\n\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2162/comments",
    "author": "fanybook",
    "comments": [
      {
        "user": "fanybook",
        "created_at": "2018-11-29T06:55:05Z",
        "body": "```\r\n            // swoole_timer_tick(1000, function() {\r\n            while (true) {\r\n                if (!$this->queueWorkerPids) {\r\n                    $this->createQueueWorker();\r\n                } else {\r\n                    foreach ($this->queueWorkerPids as $idx => $pid) {\r\n                        $current_time = date('H:i:s');\r\n                        if (\\Swoole\\Process::kill($pid, 0)) {\r\n                            echo \"PID[{$pid}] is alived({$current_time}).\\n\";\r\n                        } else {\r\n                            echo \"PID[{$pid}] is died.\\n\";\r\n                            unset($this->queueWorkerPids[$idx]);\r\n                            $this->createQueueWorker($idx);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                sleep(1);\r\n            }\r\n            // });\r\n```\r\n改成死循环，创建的孙程序就没问题\r\n\r\n\r\n```\r\n            swoole_timer_tick(1000, function() {\r\n                echo '2333333';\r\n            });\r\n\r\n            // swoole_timer_tick(1000, function() {\r\n            while (true) {\r\n                if (!$this->queueWorkerPids) {\r\n                    $this->createQueueWorker();\r\n                } else {\r\n                    foreach ($this->queueWorkerPids as $idx => $pid) {\r\n                        $current_time = date('H:i:s');\r\n                        if (\\Swoole\\Process::kill($pid, 0)) {\r\n                            echo \"PID[{$pid}] is alived({$current_time}).\\n\";\r\n                        } else {\r\n                            echo \"PID[{$pid}] is died.\\n\";\r\n                            unset($this->queueWorkerPids[$idx]);\r\n                            $this->createQueueWorker($idx);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                sleep(1);\r\n            }\r\n            // });\r\n```\r\n在死循环外，加timer，创建出孙程序也变成僵尸"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-11-29T10:49:00Z",
        "body": "请使用协程模式\r\n\r\n```php\r\n<?php\r\ngo(function() {\r\n    while(1)\r\n    {\r\n        co::sleep(1);\r\n        var_dump(co::exec(\"ps aux\"));\r\n    }\r\n});\r\n\r\nswoole_event_wait();\r\n```\r\n"
      },
      {
        "user": "fanybook",
        "created_at": "2018-11-29T11:14:47Z",
        "body": "懂了  👍"
      }
    ]
  },
  {
    "number": 2144,
    "title": "register_shutdown_function() 触发时机疑问",
    "created_at": "2018-11-23T07:41:36Z",
    "closed_at": "2018-11-24T04:15:06Z",
    "labels": [
      "enhancement",
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2144",
    "body": "代码：\r\n\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Coroutine;\r\n\r\nfunction test()\r\n{\r\n    Coroutine::sleep(1);\r\n    var_dump('test gg');\r\n}\r\n\r\nregister_shutdown_function(function(){\r\n    var_dump('all gg');\r\n});\r\n\r\ngo('test');\r\n```\r\n\r\n输出：\r\n\r\n```php\r\nstring(6) \"all gg\"\r\nstring(7) \"test gg\"\r\n```\r\n\r\n我认为的正常的结果应该是协程里面的执行完，再触发`register_shutdown_function`吧？不知道是有意如此，还是bug",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2144/comments",
    "author": "Yurunsoft",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-11-24T04:15:06Z",
        "body": "如果你的脚本末尾没有` swoole_event_wait() `，底层会将` swoole_event_wait() `注册`register_shutdown_function`，执行顺序就会变成上面的。\r\n\r\n请在代码末尾加入 `swoole_event_wait();`"
      },
      {
        "user": "twose",
        "created_at": "2018-11-26T08:50:38Z",
        "body": "@Yurunsoft \r\n现在swoole_event_wait永远都是第一位, 结果符合预期"
      }
    ]
  },
  {
    "number": 2142,
    "title": "Is swoole 2.x version continuing? Is swoole 4.x Backward compatibable to swoole 2.x?",
    "created_at": "2018-11-23T05:28:42Z",
    "closed_at": "2018-11-24T04:17:17Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2142",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\nI want to use swoole in my business. We planned using TARS as service manager. But TARS only support swoole 1.x/2.x, NOT support 4.x.  Can I use swoole 4.x in TARS in future ?\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2142/comments",
    "author": "tomjamescn",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-11-23T06:15:04Z",
        "body": "TARS have already support swoole 4 now.\r\nswoole 4 just refactor the kernel without any PHP API changes."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-11-24T04:17:17Z",
        "body": "Version 2.0 is flawed, please use 4.0, 2.0 will not be maintained."
      }
    ]
  },
  {
    "number": 2128,
    "title": "Async Mysqli Prepare",
    "created_at": "2018-11-18T14:15:21Z",
    "closed_at": "2018-11-18T15:43:31Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2128",
    "body": "The documentation discusses async mysql request as\r\n```php\r\n<?php\r\n$db = new swoole_mysql;\r\n$server = array(\r\n    'host' => '192.168.56.102',\r\n    'port' => 3306,\r\n    'user' => 'test',\r\n    'password' => 'test',\r\n    'database' => 'test',\r\n    'charset' => 'utf8',\r\n    'timeout' => 2,\r\n);\r\n\r\n$db->connect($server, function ($db, $r) {\r\n    if ($r === false) {\r\n        var_dump($db->connect_errno, $db->connect_error);\r\n        die;\r\n    }\r\n    $sql = 'show tables';\r\n    $db->query($sql, function(swoole_mysql $db, $r) {\r\n        if ($r === false)\r\n        {\r\n            var_dump($db->error, $db->errno);\r\n        }\r\n        elseif ($r === true )\r\n        {\r\n            var_dump($db->affected_rows, $db->insert_id);\r\n        }\r\n        var_dump($r);\r\n        $db->close();\r\n    });\r\n});\r\n```\r\n\r\nHow to carry out the same async functionality for Mysql Prepared Statement?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2128/comments",
    "author": "jobs-git",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-11-18T14:58:24Z",
        "body": "no, the async mode may be removed in the next big version."
      },
      {
        "user": "jobs-git",
        "created_at": "2018-11-18T15:06:23Z",
        "body": "Why should the async mysql be removed?"
      },
      {
        "user": "ghost",
        "created_at": "2018-11-18T15:10:32Z",
        "body": "Because everything will be based on `coroutines` when that's completely done. No need for _async_ code anymore :wink: "
      },
      {
        "user": "jobs-git",
        "created_at": "2018-11-18T15:17:35Z",
        "body": "So will there be a co-routine that does mysqli prepared? How will swoole connector fit with mysql server or postgresql since these are async servers? Moreover communication via tcp seems to be very expensive in time.\r\n\r\nAnd oh, nice job in Swoole 4.2.7 beats Nginx static more than twice whilst doing dynamic php."
      },
      {
        "user": "ghost",
        "created_at": "2018-11-18T15:29:23Z",
        "body": "What do you mean with\r\n\r\n> since these are async servers?\r\n\r\nThey are using _threads_. Whatever they are doing while you are waiting for a query isn't relevant for your code because you are outsourcing this _blocking IO_ to a coroutine - and you can accelerate _thousands_ or _millions_ of them without blocking your backend."
      },
      {
        "user": "jobs-git",
        "created_at": "2018-11-18T15:33:33Z",
        "body": "its a typo, I mean synchronous servers or non async severs"
      },
      {
        "user": "ghost",
        "created_at": "2018-11-18T15:38:29Z",
        "body": "If you build a **high-concurrency** backend to serve millions of requests, the question is how to handle those big numbers. We are **not** talking about **C10K**, swoole is build to solve **C1000K** :wink: \r\n\r\nHmm, mysqli is long ago for me... You can look at examples and documentation for a deeper dive :blush: "
      },
      {
        "user": "jobs-git",
        "created_at": "2018-11-18T15:43:31Z",
        "body": "That is true, based from the test I have made, Swoole was able to handle C1000k without timeout or read errors, that is impressive! I will be testing the sql requests soon and see what appears on my benchmark. This issue can be closed for now since it appears that the project is going in another direction. Thanks!"
      },
      {
        "user": "ghost",
        "created_at": "2018-11-18T15:50:42Z",
        "body": "Maybe, your keyword is _Connection Pool_ :wink: "
      },
      {
        "user": "jobs-git",
        "created_at": "2018-11-18T16:03:46Z",
        "body": "I will surely remember that keyword, i have read somewhere that swoole requests sql queries too fast that some connections get dropped.\r\n\r\nBy the way, my requests to join the swoole slack group is not yet being accepted."
      },
      {
        "user": "twose",
        "created_at": "2018-11-19T02:36:30Z",
        "body": "@jobs-git \r\ncan you read the readme? runtime hook may help you."
      },
      {
        "user": "ghost",
        "created_at": "2018-11-19T18:58:06Z",
        "body": "> By the way, my requests to join the swoole slack group is not yet being accepted.\r\n\r\n@doubaokun ping @jobs-git for slack"
      }
    ]
  },
  {
    "number": 2115,
    "title": "Travis 上无法安装 swoole",
    "created_at": "2018-11-12T21:04:53Z",
    "closed_at": "2018-11-13T01:05:01Z",
    "labels": [
      "question",
      "installation"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2115",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n`.travis.yml` 如下:\r\n\r\n```yml\r\nlanguage: php\r\n\r\nphp:\r\n  - 7.1\r\n\r\naddons:\r\n  hosts:\r\n    - redis\r\n\r\ncache:\r\n  directories:\r\n    - $HOME/.composer/cache\r\n\r\nservices:\r\n  - redis-server\r\n\r\nbefore_script:\r\n  - echo \"extension = redis.so\" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini\r\n  - printf 'yes\\nno\\nyes\\nno\\nno\\nno\\nno\\n' | pecl install swoole\r\n  - SYMFONY_ENV=test composer install --prefer-dist\r\n  - \"./travis.sh\"\r\n\r\nscript:\r\n  - \"./test.sh\"\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n安装正常并开始测试。\r\n\r\n3. What did you see instead?\r\n\r\n每次运行到 `pecl install swoole` 时候都出错，错误信息如下：\r\n\r\n```\r\n/bin/bash /tmp/pear/install/pear-build-travist0se2t/swoole-4.2.7/libtool --mode=compile cc  -I. -I/tmp/pear/install/swoole -DPHP_ATOM_INC -I/tmp/pear/install/pear-build-travist0se2t/swoole-4.2.7/include -I/tmp/pear/install/pear-build-travist0se2t/swoole-4.2.7/main -I/tmp/pear/install/swoole -I/home/travis/.phpenv/versions/7.1.11/include/php -I/home/travis/.phpenv/versions/7.1.11/include/php/main -I/home/travis/.phpenv/versions/7.1.11/include/php/TSRM -I/home/travis/.phpenv/versions/7.1.11/include/php/Zend -I/home/travis/.phpenv/versions/7.1.11/include/php/ext -I/home/travis/.phpenv/versions/7.1.11/include/php/ext/date/lib -I/thirdparty/hiredis -I/tmp/pear/install/swoole -I/tmp/pear/install/swoole/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /tmp/pear/install/swoole/src/protocol/websocket.c -o src/protocol/websocket.lo\r\n cc -I. -I/tmp/pear/install/swoole -DPHP_ATOM_INC -I/tmp/pear/install/pear-build-travist0se2t/swoole-4.2.7/include -I/tmp/pear/install/pear-build-travist0se2t/swoole-4.2.7/main -I/tmp/pear/install/swoole -I/home/travis/.phpenv/versions/7.1.11/include/php -I/home/travis/.phpenv/versions/7.1.11/include/php/main -I/home/travis/.phpenv/versions/7.1.11/include/php/TSRM -I/home/travis/.phpenv/versions/7.1.11/include/php/Zend -I/home/travis/.phpenv/versions/7.1.11/include/php/ext -I/home/travis/.phpenv/versions/7.1.11/include/php/ext/date/lib -I/thirdparty/hiredis -I/tmp/pear/install/swoole -I/tmp/pear/install/swoole/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /tmp/pear/install/swoole/src/protocol/websocket.c  -fPIC -DPIC -o src/protocol/.libs/websocket.o\r\nIn file included from /tmp/pear/install/swoole/src/protocol/websocket.c:21:0:\r\n/tmp/pear/install/swoole/php_swoole.h:142:2: error: #error \"Enable http2 support, require nghttp2 library.\"\r\n #error \"Enable http2 support, require nghttp2 library.\"\r\n  ^\r\nmake: *** [src/protocol/websocket.lo] Error 1\r\nERROR: `make' failed\r\n```\r\n\r\n补充说明一下，这个项目开发过程都好好的，travis 一直没问题；今天是上线后大概一个月，需要加新功能，本地测试都通过，就是 PR 时 travis 一直卡在 swoole 的安装。请问是否版本有变动？\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n一直使用 `pecl install swoole`，从来没管版本的事\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\n- kernel: \r\n\r\n```\r\nLinux travis-job-f5661ef2-da33-41f2-89f1-38be08cdddeb 4.4.0-101-generic #124~14.04.1-Ubuntu SMP Fri Nov 10 19:05:36 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\n- php: \r\n\r\n```\r\nPHP 7.1.11 (cli) (built: Oct 26 2017 16:25:55) ( ZTS )\r\nCopyright (c) 1997-2017 The PHP Group\r\nZend Engine v3.1.0, Copyright (c) 1998-2017 Zend Technologies\r\n    with Zend OPcache v7.1.11, Copyright (c) 1999-2017, by Zend Technologies\r\n    with Xdebug v2.5.5, Copyright (c) 2002-2017, by Derick Rethans\r\n```\r\n\r\n- gcc:\r\n\r\n```\r\ngcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.3) \r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2115/comments",
    "author": "leoli-dev",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-11-13T01:05:01Z",
        "body": "配置参数有变更，请去掉 nghttp 相关的配置。"
      }
    ]
  },
  {
    "number": 2109,
    "title": "4.2.7 swoole serialize",
    "created_at": "2018-11-10T10:25:20Z",
    "closed_at": "2018-11-10T11:31:30Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2109",
    "body": "Oh no\r\n\r\n> Swoole\\Serialize will be forced to close in PHP73 (unsupported temporarily)\r\n\r\nDo not understand... No future support actually?\r\n\r\nI like swoole\\serialize",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2109/comments",
    "author": "ghost",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-11-10T11:11:32Z",
        "body": "We haven't much more energy to face the constant changes in the PHP kernel, In order to save some memory, its stability is also difficult to guarantee.\r\nNo future support is possible, php serialize is good enough."
      },
      {
        "user": "ghost",
        "created_at": "2018-11-10T11:31:30Z",
        "body": "Ok, good to know :+1: "
      }
    ]
  },
  {
    "number": 2065,
    "title": "有没有考虑将异步调用方式使用 Promise呢",
    "created_at": "2018-10-24T09:11:09Z",
    "closed_at": "2018-10-24T11:15:56Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2065",
    "body": "现在异步处理很多都使用 Promise 回调函数嵌套 层级多很痛苦啊\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2065/comments",
    "author": "shanliu",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-10-24T10:25:02Z",
        "body": "现在都是协程, 比Promise更先进的解决方案, 异步API已经过时了."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-10-24T11:15:56Z",
        "body": "使用协程。"
      }
    ]
  },
  {
    "number": 2063,
    "title": "swoole安装时怎么指定gcc库文件路径",
    "created_at": "2018-10-24T07:18:21Z",
    "closed_at": "2018-10-24T11:16:37Z",
    "labels": [
      "question",
      "installation"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2063",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n系统自带gcc库版本低于4.8.5，我重新源码安装了gcc 4.8.5。并添加到了ld.so.conf.d，为啥swoole还提示我gcc版本低了呢，哪个地方可以指定gcc版本库路径呢？\r\n[root@VM_0_7_centos swoole-src-4.2.2]# /usr/local/gcc4.8.5/bin/gcc --version\r\ngcc (GCC) 4.8.5\r\nCopyright (C) 2015 Free Software Foundation, Inc.\r\nThis is free software; see the source for copying conditions.  There is NO\r\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n[root@VM_0_7_centos swoole-src-4.2.2]# ldconfig -p  |grep gcc\r\n\tlibtsan.so.0 (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libtsan.so.0\r\n\tlibtsan.so (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libtsan.so\r\n\tlibstdc++.so.6 (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libstdc++.so.6\r\n\tlibstdc++.so (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libstdc++.so\r\n\tlibssp.so.0 (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libssp.so.0\r\n\tlibssp.so (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libssp.so\r\n\tlibquadmath.so.0 (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libquadmath.so.0\r\n\tlibquadmath.so (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libquadmath.so\r\n\tlibmudflapth.so.0 (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libmudflapth.so.0\r\n\tlibmudflapth.so (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libmudflapth.so\r\n\tlibmudflap.so.0 (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libmudflap.so.0\r\n\tlibmudflap.so (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libmudflap.so\r\n\tlibitm.so.1 (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libitm.so.1\r\n\tlibitm.so (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libitm.so\r\n\tlibgomp.so.1 (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libgomp.so.1\r\n\tlibgomp.so (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libgomp.so\r\n\tlibgcc_s.so.1 (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libgcc_s.so.1\r\n\tlibgcc_s.so.1 (libc6,x86-64) => /lib64/libgcc_s.so.1\r\n\tlibgcc_s.so.1 (libc6) => /lib/libgcc_s.so.1\r\n\tlibgcc_s.so (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libgcc_s.so\r\n\tlibatomic.so.1 (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libatomic.so.1\r\n\tlibatomic.so (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libatomic.so\r\n\tlibasan.so.0 (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libasan.so.0\r\n\tlibasan.so (libc6,x86-64) => /usr/local/gcc4.8.5/lib64/libasan.so\r\n[root@VM_0_7_centos swoole-src-4.2.2]# make \r\n/bin/sh /data/soft/swoole-src-4.2.2/libtool --mode=compile cc  -I. -I/data/soft/swoole-src-4.2.2 -DPHP_ATOM_INC -I/data/soft/swoole-src-4.2.2/include -I/data/soft/swoole-src-4.2.2/main -I/data/soft/swoole-src-4.2.2 -I/usr/local/php7.1/include/php -I/usr/local/php7.1/include/php/main -I/usr/local/php7.1/include/php/TSRM -I/usr/local/php7.1/include/php/Zend -I/usr/local/php7.1/include/php/ext -I/usr/local/php7.1/include/php/ext/date/lib -I/data/soft/swoole-src-4.2.2 -I/data/soft/swoole-src-4.2.2/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /data/soft/swoole-src-4.2.2/swoole.c -o swoole.lo \r\n cc -I. -I/data/soft/swoole-src-4.2.2 -DPHP_ATOM_INC -I/data/soft/swoole-src-4.2.2/include -I/data/soft/swoole-src-4.2.2/main -I/data/soft/swoole-src-4.2.2 -I/usr/local/php7.1/include/php -I/usr/local/php7.1/include/php/main -I/usr/local/php7.1/include/php/TSRM -I/usr/local/php7.1/include/php/Zend -I/usr/local/php7.1/include/php/ext -I/usr/local/php7.1/include/php/ext/date/lib -I/data/soft/swoole-src-4.2.2 -I/data/soft/swoole-src-4.2.2/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /data/soft/swoole-src-4.2.2/swoole.c  -fPIC -DPIC -o .libs/swoole.o\r\nIn file included from /data/soft/swoole-src-4.2.2/include/swoole.h:170,\r\n                 from /data/soft/swoole-src-4.2.2/php_swoole.h:52,\r\n                 from /data/soft/swoole-src-4.2.2/swoole.c:16:\r\n./swoole_config.h:22:2: error: #error \"GCC 4.8 or later require.\"\r\nmake: *** [swoole.lo] Error 1\r\n\r\n\r\n\r\n2. What did you expect to see?\r\n swoole可以自动识别系统中的库文件\r\n\r\n\r\n3. What did you see instead?\r\n目前不识别我源码安装的gcc库文件\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nswoole-src-4.2.2\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\nLinux VM_0_7_centos 2.6.32-696.6.3.el6.x86_64\r\nphp7.1\r\ngcc 4.8.5\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2063/comments",
    "author": "llxssfm",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-10-24T10:35:03Z",
        "body": "你没有装到系统目录, 当然无法识别, 不可能去扫描你整个路径...\r\n你可以把你的gcc临时添加到环境变量里, 然后编译"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-10-24T11:16:37Z",
        "body": "修改 cc 软链的目标文件。"
      }
    ]
  },
  {
    "number": 2055,
    "title": "使用idea 开发，并打开xdebug 监控后，如果使用同一个端口做监听，会导致无法执行第二个php 命令",
    "created_at": "2018-10-23T06:44:44Z",
    "closed_at": "2018-10-23T08:47:39Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2055",
    "body": "使用idea 开发，并打开xdebug 监控后，如果使用同一个端口做监听，会导致无法执行第二个php 命令",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2055/comments",
    "author": "monkeycraps",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-10-23T08:47:39Z",
        "body": "1. 不能在swoole里使用xdebug\r\n2. 一个端口一个服务\r\n3. 用idea开发和问题无关, 不属于swoole的bug, 想执行两个只能改端口\r\n\r\n可以先去文档里搜索相关问题"
      },
      {
        "user": "monkeycraps",
        "created_at": "2018-11-02T04:42:00Z",
        "body": "恩，只是表现很诡异，是直接卡主了，服务启动也正常，但是执行第二条 cli 的命令的时候，就会卡主，问题不太好找，所以，我提了个issue，方便大家确认问题 "
      }
    ]
  },
  {
    "number": 2044,
    "title": "4.2.3 版本进程模型addprocess报错",
    "created_at": "2018-10-17T07:30:36Z",
    "closed_at": "2018-10-26T06:56:44Z",
    "labels": [
      "duplicate",
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2044",
    "body": "进程模型 选择 SWOOLE_BASE基本模式时\r\n$server->addprocess报错，错误信息看不到，Segmentation fault\r\n\r\n另：\r\nhttpserver的进程模型选择什么（性能推荐），按文档说的一般选base，今天一看模型选择从3中变成2中，是不是以后base进程模型不支持了？\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2044/comments",
    "author": "forever-go",
    "comments": [
      {
        "user": "forever-go",
        "created_at": "2018-10-17T08:42:55Z",
        "body": "process模式下，又是之前的各种丢进程\r\n\r\nroot     26443  0.0  0.1 397172 12668 pts/1    S    15:06   0:00 do_http: inotify\r\nroot     26502  0.0  0.1 397172 12332 pts/1    S    15:09   0:00 do_http: master\r\nroot     26523  0.0  0.1 397172 12340 pts/1    S    15:13   0:00 do_http: master\r\nroot     26569  0.0  0.1 547256 12680 ?        Ssl  15:18   0:00 do_http: master\r\nroot     26577  0.0  0.1 401496 13912 ?        S    15:18   0:00 do_http: inotify\r\nroot     26641  0.0  0.1 393324 13776 ?        S    15:27   0:00 do_http: worker 0\r\nroot     26643  0.0  0.3 476524 25508 ?        S    15:27   0:02 do_http: worker 2\r\nroot     26644  0.0  0.2 399476 20168 ?        S    15:27   0:00 do_http: worker 3\r\nroot     27184  0.0  0.0  15952  1016 pts/3    S+   16:40   0:00 grep --color=auto http\r\nroot@iZ28ug2bgrjZ:/var/www/main-swoole/server# tail /tmp/swoole-http-0.0.0.0\\:9803.log \r\nPHP Warning:  Swoole\\Server::reload(): failed to send the reload signal. Error: No such process[3] in /var/www/main-swoole/core/Util/Inotify.php on line 108\r\nPHP Warning:  Swoole\\Server::reload(): failed to send the reload signal. Error: No such process[3] in /var/www/main-swoole/core/Util/Inotify.php on line 108\r\nPHP Warning:  Swoole\\Server::reload(): failed to send the reload signal. Error: No such process[3] in /var/www/main-swoole/core/Util/Inotify.php on line 108\r\nPHP Warning:  Swoole\\Server::reload(): failed to send the reload signal. Error: No such process[3] in /var/www/main-swoole/core/Util/Inotify.php on line 108\r\nPHP Warning:  Swoole\\Server::reload(): failed to send the reload signal. Error: No su"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-10-17T11:56:34Z",
        "body": "BASE 模式下使用 addProcess 存在一些问题，接下来会解决。\r\n是否使用了 Task 进程，是否使用了 reload_async"
      },
      {
        "user": "forever-go",
        "created_at": "2018-10-17T14:48:53Z",
        "body": "没有使用task进程，reload_async也没有使用"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-10-18T03:19:06Z",
        "body": "本地测试正常的，多次 reload 无问题。支持 SWOOLE_BASE  和 SWOOLE_PROCESS 两种模式。\r\nSWOOLE_BASE 模式主要是作为单进程单线程程序来使用。"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-10-18T03:21:41Z",
        "body": "请再精简一下程序代码，详细描述重现的方法和过程。"
      },
      {
        "user": "forever-go",
        "created_at": "2018-10-18T05:37:09Z",
        "body": "仔细测试排查了下，发下丢进程是因为manager进程崩溃了，所以reload的进程也没有启动起来，感觉应该不是bug，我再运行一段时间再观察下，你说的 base单进程单线程使用怎么理解？"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-10-19T00:27:07Z",
        "body": "可能错误的向 Manager 进程发送了信号。实际上 Swoole 底层有对 Manager 进程的监控，你可以在日志中找到一个 Fatal Error Manager process exit 的相关日志，看到是什么原因退出的。\r\n"
      },
      {
        "user": "forever-go",
        "created_at": "2018-10-19T03:10:50Z",
        "body": "看见了，是错误捕捉的类型不对引起的，修改后已经正常运行了好久了，这个地方没有问题"
      }
    ]
  },
  {
    "number": 2031,
    "title": "Does not work installed signal if in swoole_process run a sleep(1) function",
    "created_at": "2018-10-12T00:49:55Z",
    "closed_at": "2018-10-12T21:23:32Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2031",
    "body": "Hi,\r\n\r\nI wrote a simple daemon program that starts up a few subprocesses. I also set up a signal handler for the master and child processes with swoole::signal(). If I use sleep(1) within the child process, the child process does not respond to the signal given by swoole::kill(). usleep (1000000) function does not have this problem.\r\n\r\n// $worker is master process\r\n```php \r\n        $process = new swoole_process(function(swoole_process $process) use($worker, $id){\r\n            \r\n            if (self::$status === self::STATUS_STARTING) {\r\n                self::resetStd();\r\n            }\r\n            \r\n            self::$pidMap  = array();\r\n            self::$workers = array($worker->workerId => $worker);\r\n            Timer::delAll();\r\n            \r\n            $process->name('Messenger: worker process  ' . $worker->name);\r\n            $worker->setUserAndGroup();\r\n            $worker->id = $id;\r\n            \r\n            self::$status = self::STATUS_RUNNING;\r\n        \r\n            register_shutdown_function(array(\"\\\\Jetmail\\\\Server\\\\Messenger\", 'checkErrors'));\r\n            self::reinstallSignal();\r\n            \r\n            // Init Timer.\r\n            Timer::init();\r\n            \r\n            $timerid = Timer::add(3,function()use($process,&$timerid){\r\n                \r\n                while($msg = $process->pop()){\r\n                    if ($msg === false) {\r\n                        break;\r\n                    }\r\n\r\n                    sleep(1);\r\n                    //usleep(1000000);\r\n                }\r\n            },[1,2,3],true);            \r\n        });\r\n        \r\n        $process->useQueue(rand(1,1000), swoole_process::IPC_NOWAIT);\r\n        $pid = $process->start();\r\n```\r\n\r\n\r\nI do not know this is a bug or my knowledge is incomplete. I applied sleep (1) instead of a specific task until I did the daemon program. Program execution is waiting for 1 second to simulate the execution time of the real task\r\n\r\nSubprocess's reactions to the signal were never responded, and there was a program state when child processes ceased as soon as they received a signal. I always sent the SIGUSR2 signal.\r\n\r\n\r\nswoole support => enabled\r\nVersion => 4.1.2\r\nAuthor => Swoole Group[email: team@swoole.com]\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nbrotli => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nredis client => enabled\r\npostgresql client => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => On => On\r\nswoole.use_shortname => On => On\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\nPhp version: PHP 7.2.9 (cli) (built: Aug 17 2018 16:21:18) ( NTS )\r\nKernel: Arch Linux, Linux malinal-arch 4.18.6-arch1-1-ARCH #1 SMP PREEMPT Wed Sep 5 11:54:09 UTC 2018 x86_64 GNU/Linux\r\ngcc: gcc 8.2.1+20180831-1\r\n\r\n\r\nThanks for your help.\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2031/comments",
    "author": "optimode",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-10-12T02:31:57Z",
        "body": "swoole::signal() is based on signalfd and\r\n eventloop, can not use it in sync blocked server, please use pcntl_signal."
      },
      {
        "user": "optimode",
        "created_at": "2018-10-12T13:23:15Z",
        "body": "Oh, I understand, thank you. So with swoole i can use pcntl_ functions (eg signal, kill)? Actually, I do not want to use sleep (), it was just an occasional idea.\r\n\r\nI would like to develop an email sender application (composer and symfony based) that currently retrieves the data from a redis queue and logs sending data into a mysql database.\r\nWhat php functions or classes can not I use?\r\n\r\nAn another question: in php the sleep() function works in the background: \r\nsleep() -> php_sleep() -> SleepEx() ?"
      },
      {
        "user": "twose",
        "created_at": "2018-10-12T13:45:51Z",
        "body": "as I know, just system call `sleep`."
      }
    ]
  },
  {
    "number": 2012,
    "title": "http_swoole_server经常报这个错误",
    "created_at": "2018-09-28T08:49:23Z",
    "closed_at": "2018-09-28T09:26:20Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2012",
    "body": "NOTICE\tswFactoryProcess_finish (ERROR 1004): send 258 byte failed, because connection[fd=51] is closed.\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2012/comments",
    "author": "andy1219111",
    "comments": [
      {
        "user": "ghost",
        "created_at": "2018-09-28T09:10:08Z",
        "body": "Just a `NOTICE` ;) This could be happen if you test with `wrk` or benchmark-tools, which closes their connections automatically after time period, for example. And `fd=51` sounds like this.\r\n\r\nIf not, it would help if you post your code :)"
      },
      {
        "user": "twose",
        "created_at": "2018-09-28T09:26:08Z",
        "body": "和楼上说的一样\r\n- 指定时间的压力测试, 到达时间后强制断开连接\r\n- 浏览器不断刷新, 未收到响应就断开连接\r\n"
      }
    ]
  },
  {
    "number": 1996,
    "title": "Swoole MySQL SSL support?",
    "created_at": "2018-09-22T02:10:24Z",
    "closed_at": "2018-09-27T13:11:02Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1996",
    "body": "Hi, is it possible for the MySQL SSL Async client to connect a MySQL secured by SSL? I couldn't see this in the configuration. Thanks.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1996/comments",
    "author": "re-thc",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-09-22T14:04:49Z",
        "body": "Use `Swoole\\Coroutine\\MySQL` is a better way, not async now.\r\n\r\nI have received many similar questions recently:\r\nSSL is not necessary, SSL will increase connection overhead, CPU usage, memory usage, and response time.\r\nIn a production environment, MySQL is generally deployed in an intranet environment, even for clusters. The MySQL handshake uses very secure RSA encryption, and MySQL has been enhancing the security of handshakes for a long time. For enterprises, no MySQL uses SSL connections as I know, and the existing methods are safe enough.\r\nMySQL is always a performance bottleneck, we will support SSL in the future, but not the first priority."
      }
    ]
  },
  {
    "number": 1991,
    "title": "Unable to load dynamic library 'swoole'",
    "created_at": "2018-09-19T14:16:40Z",
    "closed_at": "2018-09-19T15:41:06Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1991",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\n    `updated php from 7.1.x to 7.2.10 and rebuilt and reinstalled php-swoole AUR package`\r\n\r\n\r\n2. What did you expect to see?\r\n    `swoole ext loaded with php properly`\r\n\r\n\r\n3. What did you see instead?\r\n`PHP Warning:  PHP Startup: Unable to load dynamic library 'swoole' (tried: /usr/lib/php/modules/swoole (/usr/lib/php/modules/swoole: cannot open shared object file: No such file or directory), /usr/lib/php/modules/swoole.so (/usr/lib/php/modules/swoole.so: undefined symbol: strpprintf)) in Unknown on line 0`\r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\n    `4.2.1`\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n```\r\nArch Linux \r\n4.17.14.a-1-hardened x86_64\r\nphp 7.2.10\r\ngcc 8.2.1+20180831-1\r\n```\r\n\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n    `openssl 1.1.1-1`\r\n\r\nNOTE: `/usr/lib/php/modules/swoole.so does exist in filesystem.`\r\n`swoole ext won't load whether i have .so in php.ini or not.`\r\n\r\nThanks",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1991/comments",
    "author": "ITwrx",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-09-19T15:13:21Z",
        "body": "if you `make clean` and rerun the right(new version's) `phpize` then `./configure xxx && make && sudo make install`?\r\n\r\ncheck your phpize version, it may shows these:\r\n```C\r\nConfiguring for:\r\nPHP Api Version:         20170718\r\nZend Module Api No:      20170718\r\nZend Extension Api No:   320170718\r\n```\r\n\r\ncheck your version num is PHP72"
      },
      {
        "user": "ITwrx",
        "created_at": "2018-09-19T15:41:06Z",
        "body": "@twose just running \"make clean\" in the src directory of the previous build then re-running \"makepkg\" did the trick. thanks for the help."
      }
    ]
  },
  {
    "number": 1990,
    "title": "tcp server and http server",
    "created_at": "2018-09-19T13:33:10Z",
    "closed_at": "2018-09-20T07:21:07Z",
    "labels": [
      "invalid",
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1990",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n 在 new \\Swoole\\Http\\Server 上添加监听了额外的一个tcp端口，options里传入了：\r\n$options += [\r\n                    'package_max_length'    => 65535 ,\r\n                    'open_length_check'     => true ,\r\n                    'package_length_type'   => 'n' ,\r\n                    'package_length_offset' => 0 ,\r\n                    'package_body_offset'   => 2 ,\r\n                ] ;\r\n\r\n监听receive。\r\n然后按照如下方式发送数据。\r\n\r\n        $msg = \"hello world\\n\";\r\n        $size = strlen($msg) ;\r\n        $ret = $tcp->send( pack('n', $size) . $msg) ;\r\n        $tcp->close() ;\r\n\r\n2. What did you expect to see?\r\n\r\n期待receive可以接受到数据！\r\n\r\n3. What did you see instead?\r\n\r\nconnect可以接受到链接，但是receive没有数据。\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\n 4.1.0\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n\r\nmacoSX\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\n\r\n没有。\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1990/comments",
    "author": "patrickkh7788",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-09-19T13:36:35Z",
        "body": "请用markdown语法贴出完整的代码"
      },
      {
        "user": "patrickkh7788",
        "created_at": "2018-09-19T14:26:42Z",
        "body": "```php\r\n<?php\r\n$server = new \\Swoole\\Http\\Server('127.0.0.1' , 8000);\r\n\r\n$options    = [\r\n    'package_max_length'    => 65535 ,\r\n    'open_length_check'     => true ,\r\n    'package_length_type'   => 'n' ,\r\n    'package_length_offset' => 0 ,\r\n    'package_body_offset'   => 2 ,\r\n] ;\r\n\r\n$server->addlistener('127.0.0.1', 8002, SWOOLE_SOCK_TCP) ;\r\n$server->set($options) ;\r\n\r\n$server->on('connect', function(\\swoole_server $server, int $fd)  {\r\n    $info = $server->connection_info($fd) ;\r\n    if( 8002 === $info['server_port'] ) {\r\n        fprintf(STDERR, \"tcp connected(fd=%d, ip=%s)\\n\", $fd, $info['remote_ip']);\r\n    }\r\n} ) ;\r\n\r\n$server->on('receive', function(swoole_server $server, int $fd, int $reactor_id, string $data) {\r\n    var_dump($data) ;\r\n}) ;\r\n\r\n$server->on('request', function(\\Swoole\\Http\\Request $_request, \\Swoole\\Http\\Response $_response){\r\n    $json   = [];\r\n    $tcp = new \\Swoole\\Coroutine\\Client(SWOOLE_SOCK_TCP) ;\r\n    if ($tcp->connect('127.0.0.1', 8002, 1))\r\n    {\r\n        $msg = \"hello world\\n\";\r\n        $json['size']  = strlen($msg) ;\r\n        $json['ret'] = $tcp->send( pack('n', $json['size']) . $msg) ;\r\n        $tcp->close() ;\r\n    } else {\r\n        $json['err'] = $tcp->errCode ;\r\n    }\r\n    $_response->end( json_encode($json));\r\n}) ;\r\n\r\n$server->start() ;\r\n```\r\n\r\n换成tcp server就可以收到消息。\r\n\r\n"
      },
      {
        "user": "patrickkh7788",
        "created_at": "2018-09-20T02:15:51Z",
        "body": "如果我没有理解错误的话，TCP服务共用http服务器才可以共用swoole table。该如何让tcp http服务共存呢？"
      },
      {
        "user": "patrickkh7788",
        "created_at": "2018-09-20T02:18:21Z",
        "body": "可以抽象出一个Event loop层。向里面添加的server可以设置自己的回掉函数以及协议端口，这样就不需要在回掉函数里检查服务端口来判断是那个服务了。\r\n\r\n"
      },
      {
        "user": "twose",
        "created_at": "2018-09-20T07:21:07Z",
        "body": "你这个错误太有迷惑性了, 正确的用法是\r\n```php\r\n$tcp_server = $server->addlistener('127.0.0.1', 8002, SWOOLE_SOCK_TCP);\r\n$tcp_server->set($options);\r\n```"
      },
      {
        "user": "xianqiangzhao",
        "created_at": "2018-09-20T07:30:00Z",
        "body": "太迷惑，我也看了半天，没回过味来。"
      }
    ]
  },
  {
    "number": 1977,
    "title": "Does \\Co::getUid() has the possibility to return same number in a worker process?",
    "created_at": "2018-09-17T11:51:31Z",
    "closed_at": "2018-09-19T12:41:35Z",
    "labels": [
      "question",
      "coroutine"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1977",
    "body": "for example:\r\n\\Co:;getUid() return 117, after some time, but before worker reload, may it return 117 again?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1977/comments",
    "author": "scil",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-09-18T02:27:15Z",
        "body": "it will start at 1."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-09-18T02:51:58Z",
        "body": "Like the process id, It will be reused"
      },
      {
        "user": "scil",
        "created_at": "2018-09-18T11:28:26Z",
        "body": "Thank you.\r\n\r\ndoes the id start with 1 and grow by step 1, and  go back to 1  when reaching a max number ?"
      },
      {
        "user": "twose",
        "created_at": "2018-09-19T07:54:11Z",
        "body": "@scil \r\ncid map uses the bitmap, it will find the first available position.\r\nWe have also considered this problem (use string like uuid is better?)\r\n\r\nwe can confirm it by\r\n```php\r\n\r\nco::set([\r\n    'max_coroutine' => PHP_INT_MAX,\r\n    'log_level' => SWOOLE_LOG_INFO,\r\n    'trace_flags' => 0\r\n]);\r\n$map = [];\r\nwhile (true) {\r\n    if (empty($map)){\r\n        $cid = go(function () {co::sleep(5);});\r\n    }else{\r\n        $cid = go(function () { });\r\n    }\r\n    if (!isset($map[$cid])) {\r\n        $map[$cid] = $cid;\r\n    } else {\r\n        var_dump(end($map));\r\n        var_dump($cid);\r\n        exit;\r\n    }\r\n}\r\n```"
      },
      {
        "user": "twose",
        "created_at": "2018-09-19T07:54:12Z",
        "body": "@scil \r\ncid map uses the bitmap, it will find the first available position.\r\nWe have also considered this problem (use string like uuid is better?)\r\n\r\nwe can confirm it by:\r\n```php\r\nco::set([\r\n    'max_coroutine' => PHP_INT_MAX,\r\n    'log_level' => SWOOLE_LOG_INFO,\r\n    'trace_flags' => 0\r\n]);\r\n$map = [];\r\nwhile (true) {\r\n    if (empty($map)){\r\n        $cid = go(function () {co::sleep(5);});\r\n    }else{\r\n        $cid = go(function () { });\r\n    }\r\n    if (!isset($map[$cid])) {\r\n        $map[$cid] = $cid;\r\n    } else {\r\n        var_dump(end($map));\r\n        var_dump($cid);\r\n        exit;\r\n    }\r\n}\r\n```\r\n\r\nit will print like:\r\n```php\r\nint(524288)\r\nint(2)\r\n```"
      },
      {
        "user": "twose",
        "created_at": "2018-09-19T08:00:34Z",
        "body": "We have MAX_CORO_NUM_LIMIT => 0x80000, coroutine num can not be bigger than 524288 on the same time"
      },
      {
        "user": "scil",
        "created_at": "2018-09-19T12:41:35Z",
        "body": "@twose Thank you! I've got it.  For me, bitmap is good enough!"
      }
    ]
  },
  {
    "number": 1968,
    "title": "redis subscribe回调函数调用swoole_process",
    "created_at": "2018-09-12T09:05:26Z",
    "closed_at": "2018-09-20T14:01:43Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1968",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n    请问在$redis->subscribe的回调函数里面是否可以使用swoole_process来创建和销毁进程？\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n  我自己试验下来的情况，能创建，但是结束不了.\r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n4.0.4\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\nmac os x 10.13.6\r\nPHP 7.2.9\r\n$ gcc --version\r\nConfigured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/usr/include/c++/4.2.1\r\nApple LLVM version 9.1.0 (clang-902.0.39.2)\r\nTarget: x86_64-apple-darwin17.7.0\r\nThread model: posix\r\nInstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n没用\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1968/comments",
    "author": "zhang-bin",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-09-20T14:01:43Z",
        "body": "使用 swoole_prcocess::wait 回收子进程，或者使用 `pcntl_signal(SIGCHLD, SIG_IGN)` 忽略子进程退出。"
      }
    ]
  },
  {
    "number": 1967,
    "title": "Task进程中利用tick重复查询数据库，多次成功执行后报错TCP Provider: Error code 0x2714",
    "created_at": "2018-09-12T07:13:37Z",
    "closed_at": "2018-09-25T06:14:08Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1967",
    "body": "简单的复现代码如下：\r\n```php\r\n<?php\r\n$server = new swoole_websocket_server(\"0.0.0.0\", 6666);\r\n$server->set(array(\r\n    \"worker_num\" => 1, \r\n    \"task_worker_num\" => 1\r\n));\r\n$server->on(\"workerstart\", function() use($server){\r\n    if($server->taskworker){\r\n        //在tick查询之前建立可复用连接\r\n        try{\r\n            $db = new PDO(\r\n                \"sqlsrv: Server = 10.0.2.2, 1433; Database = testdb\", \"username\", \"password\",\r\n                [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION]\r\n            );\r\n        }catch(PDOException $e){\r\n            var_dump($e->errorInfo);\r\n            $server->shutdown();\r\n        }\r\n        $i = 0;//查询次数\r\n        $server->tick(1000, function() use($db, &$i, $server){\r\n            echo ++$i.\" : \";//Log，下同\r\n            try{                    \r\n                if($pre = $db->prepare(\"SELECT 1\"))//某个查询语句\r\n                    echo \"good pre; \";\r\n                if($pre->execute())\r\n                    echo \"good execute; \";\r\n                if($arr = $pre->fetch())\r\n                    echo \"good fetch; \".PHP_EOL;\r\n            }catch(PDOException $e){\r\n                var_dump($e->errorInfo);\r\n                $server->shutdown();\r\n            }\r\n        });\r\n    }\r\n});\r\n$server->on(\"open\", function(){});\r\n$server->on(\"message\", function(){});\r\n$server->on(\"close\", function(){});\r\n$server->on(\"task\", function(){});\r\n$server->on(\"finish\",function(){});\r\n    \r\n$server->start();\r\n\r\n?>\r\n```\r\n执行上述代码一段时间后，在某次数据查询便会报出如下的数据库连接错误：\r\n```\r\narray(3) {\r\n  [0]=>\r\n  string(5) \"08S01\"\r\n  [1]=>\r\n  int(10004)\r\n  [2]=>\r\n  string(73) \"[Microsoft][ODBC Driver 17 for SQL Server]TCP Provider: Error code 0x2714\"\r\n```\r\n偶尔直接出现\r\n```\r\narray(3) {\r\n  [0]=>\r\n  string(5) \"08S02\"\r\n  [1]=>\r\n  int(-1)\r\n  [2]=>\r\n  string(104) \"[Microsoft][ODBC Driver 17 for SQL Server]SMux Provider: Physical connection is not usable [xFFFFFFFF]. \"\r\n```\r\n基本上可以确认在task进程中利用tick定时器查询数据库，一定时间后(一般在i<200时，偶尔较长)就会报出数据库的连接问题，而在worker进程写tick时测试时，1000次之内都没有出现错误；另一方面，在Task进程中弃用tick而采用while循环查询时，10000次都未出现连接错误，可见在task进程中tick定时器与PDO连接貌似有某些未知冲突；\r\n\r\n目前的解决办法，一是每次查询之前或报错后便重新建立连接，二是干脆把tick部分代码写到worker进程内；但还是希望能在task进程内以及PDO连接可复用的前提下稳定查询。\r\n希望能解答小白的提问，谢谢！附上系统环境如下：\r\n```\r\nCentOS Linux release 7.5.1804 (Core)\r\nLinux version 3.10.0-862.11.6.el7.x86_64\r\nPHP 7.0.4\r\nswoole 4.0.3\r\n```\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1967/comments",
    "author": "Tricker5",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-09-18T11:08:55Z",
        "body": "不太了解 `SQLServer`，建议使用短连接或者增加断线重连的逻辑。\r\nswoole的task进程中使用`tick`是使用时钟+信号实现，与`PDO`并无冲突。"
      },
      {
        "user": "412498569",
        "created_at": "2019-06-09T00:48:24Z",
        "body": "遇到同样的问题，最后怎么解决的呢"
      }
    ]
  },
  {
    "number": 1964,
    "title": "异步task是否可以解决IO阻塞, 提升性能",
    "created_at": "2018-09-10T08:34:13Z",
    "closed_at": "2018-09-11T02:26:35Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1964",
    "body": "swoole1.10.4,centos7.4\r\n在worker中投递了一个task,task里需要连接数据库做处理，压测发现，吞吐量与不用task是一样的，调试发现task确实是达到异步效果了，但是感觉task阻塞了worker的进程，等task干完,worker才响应，文档上说mysql连接是同步阻塞的，不能理解的是，难道不是每个进程里面的数据操作同步阻塞吗，怎么会影响到别的进程呢？这是一个迁移项目,如果使用异步mysql，这基本等于推到重来，有什么方式能达到丢到task里面的数据操作不影响worker的直接响应\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1964/comments",
    "author": "shehuaqigai",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-09-10T09:42:35Z",
        "body": "你这么搞当然没什么提升了, task进程是阻塞的, 所以它还是会长时间占用CPU, 尤其是在你核数少的时候, worker也会被阻塞\r\n而且你所有请求都有阻塞IO的话, 就算你扔到task, worker省出来的CPU时间也干不了别的事情, 只能等task返回数据, 吞吐量当然没有变化, 加上进程间的数据传输消耗, 反而比同步写法更慢\r\n除非你用协程/异步重构, 否则这种所谓的异步写法只是自己骗自己"
      },
      {
        "user": "shehuaqigai",
        "created_at": "2018-09-10T11:23:29Z",
        "body": "试过给taskworker单独分配数据库连接资源,效果是一样的，看来如果要实现所谓真正的异步，只能用异步mysql,否则的话task只能做一些耗时的计算，其实我想要的效果就是worker里丢一个task,马上返回，不知除了重构数据连接业务，还有没有别的方式，如果改变过大，原先构建的稳定性就又需要一段时间来沉淀，时间成本不允许,我所了解的有mysqld异步，yield异步，swoole的异步mysql,由于业务的原因,swoole暂时只能停留在1.10.4，php5.6.35,协程不能用"
      },
      {
        "user": "twose",
        "created_at": "2018-09-10T13:38:26Z",
        "body": "长连接只能解决频繁建立连接的CPU占用开销, 往task里丢任务马上返回也不过是后台任务模式, 如果像你想的这么简单就能无缝实现异步高性能....那就不用再搞什么协程了..."
      },
      {
        "user": "LeoYang90",
        "created_at": "2018-09-10T15:46:11Z",
        "body": "简单粗暴的方法就是服务器加核加内存，然后提高 worker 和 tasker 的数量，提高并行的效率"
      },
      {
        "user": "shehuaqigai",
        "created_at": "2018-09-11T10:15:03Z",
        "body": "今天对个别接口采用了swoole的异步mysql,结果让人沮丧，测试发现，没什么改善"
      },
      {
        "user": "twose",
        "created_at": "2018-09-11T10:17:44Z",
        "body": "@shehuaqigai 大概率是你没理解, 写的不对."
      },
      {
        "user": "LeoYang90",
        "created_at": "2018-09-11T10:23:17Z",
        "body": "原则上异步一定会提高整体的运行速度的，毕竟之前一个一个 sql 执行，现在多个 sql 并行执行"
      }
    ]
  },
  {
    "number": 1963,
    "title": "right way to \"include()\" in $http->on(\"request\", ...)",
    "created_at": "2018-09-09T21:45:33Z",
    "closed_at": "2018-09-10T10:54:09Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1963",
    "body": "Whats the right way to **include(_filename_);** from _ramfs/disk_ in the following code?\r\n\r\n```php\r\n<?php\r\n\r\n$http = new swoole_http_server(\"127.0.0.1\", 9501);\r\n\r\n$http->on(\"request\", function ($request, $response) {\r\n\r\n  # ho to use include(/media/ramfs/filename) ?\r\n\r\n});\r\n\r\n$http->start();\r\n?>\r\n```\r\n\r\nI need **include(_filename_);** (_because it parses the file as PHP and so on_) - and i need _ramfs_, too.\r\n\r\nEdit: i mean because of _async_, so only way is coroutine?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1963/comments",
    "author": "ghost",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-09-10T09:46:43Z",
        "body": "normally you just need to know that you should add `require \"autoload.php\"` in `workerStart` event.\r\n\r\nevery file would require only once, and it will keep in memory."
      },
      {
        "user": "ghost",
        "created_at": "2018-09-10T09:56:54Z",
        "body": "@twoose,\r\n\r\ni need to use **include** as HTML-template-parser in _every_ request.\r\n\r\nThere is **_no need_** for a complete overwhelming _template-engine_, because **require/include** processes HTML/PHP perfect, including all scope variables etc.\r\n\r\nSo i just need the correct _async_ form to get those files from my disk / ramdisk :) I do not want to _once.\r\n\r\nMust it be done via coroutine? :)"
      },
      {
        "user": "ghost",
        "created_at": "2018-09-10T10:26:04Z",
        "body": "Personally i did not found a good way to _eval_ such (cached) file-strings. _eval_ needs extra tagging and is error-prone, whereas _included_ files can be normal HTML/PHP files; you can simply edit in every HTML-editor and there is no problem in PHP-parsing - you can do whatever you want - whereas template-engines are almost laggy in feautures"
      },
      {
        "user": "twose",
        "created_at": "2018-09-10T10:30:13Z",
        "body": "if you want to move codes on php-fpm to swoole? it's too difficult, no global vars, no static vars.\r\nif you just want to use the template, just `ob_start` and `ob_get_clean`."
      },
      {
        "user": "ghost",
        "created_at": "2018-09-10T10:35:58Z",
        "body": "no, i just want to include a file, like index.html for GET /\r\n\r\nBut, like file_get_contents, include is blocking?"
      },
      {
        "user": "ghost",
        "created_at": "2018-09-10T10:40:36Z",
        "body": "file_get_contents or include works fine, but swoole wrote somewhere not to use it? Or with coroutine? I did not know actually"
      },
      {
        "user": "ghost",
        "created_at": "2018-09-10T10:45:56Z",
        "body": "Just the question how to use **include** or **file_get_contents** correct in async. Can i use them out of the box in `$http->on(\"request\", ...` ?\r\n\r\n:)"
      },
      {
        "user": "twose",
        "created_at": "2018-09-10T10:48:39Z",
        "body": "it(include file) doesn't matter If you don't abuse it."
      },
      {
        "user": "ghost",
        "created_at": "2018-09-10T10:54:09Z",
        "body": "Hmm, i will make some tests and try over time :) thank you"
      },
      {
        "user": "ghost",
        "created_at": "2018-09-10T22:18:48Z",
        "body": "I have done some tests, and benchmark for all is nearly same requests/s:\r\n\r\n1) `$teststring = \"hello world\"`\r\n2) `file_get_contents()` `# \"hello world\"`\r\n3) `include()` `# \"hello world\"`\r\n\r\nfrom _ramdisk and ssd_. With 10 bytes or 30k bytes and concurrency 100.\r\n\r\nSo i guess callbacks like `$http->on(\"request\", ...` are each already done in single **coroutines**? @twose "
      }
    ]
  },
  {
    "number": 1953,
    "title": "协程文件操作不一致的输出",
    "created_at": "2018-09-05T03:39:27Z",
    "closed_at": "2018-09-05T03:43:17Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1953",
    "body": "> PHP 7.1.21\r\n> swoole 4.1.1\r\n\r\n```php\r\nfunction test()\r\n{\r\n    go (function () {\r\n        co::writeFile(__DIR__.'/test.log', \"hi\");\r\n    });\r\n\r\n    go (function () {\r\n        $c = co::readFile(__DIR__.'/test.log');\r\n        var_dump($c);\r\n    });\r\n}\r\n\r\n$i = 0;\r\nwhile ($i++ < 10) {\r\n    test();\r\n}\r\n```\r\n\r\n```\r\n[root@localhost fssco]# /usr/local/php7/bin/php bin.php \r\nstring(0) \"\"\r\nbool(false)\r\nstring(2) \"hi\"\r\nstring(2) \"hi\"\r\nstring(2) \"hi\"\r\nstring(2) \"hi\"\r\nstring(2) \"hi\"\r\nbool(false)\r\nbool(false)\r\nstring(2) \"hi\"\r\n\r\n```\r\n\r\n输出有三种结果, 输出空字符串应该有问题.\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1953/comments",
    "author": "zszyue",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-09-05T03:43:17Z",
        "body": "协程是并发执行的，不能保证 readFile 和 writeFile 的顺序，如果有依赖关系，请修改代码。"
      }
    ]
  },
  {
    "number": 1922,
    "title": "Parser protection - just thinking about",
    "created_at": "2018-08-29T08:17:26Z",
    "closed_at": "2018-09-02T19:39:31Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1922",
    "body": "In more standard setups of PHP behind a server (apache, nginx, ...) there is the risk, that the PHP parser is dead and server sends the unparsed script to client - so we have to protect.\r\n\r\nHow about the typical swoole setup? (php run-file.php) Here it's not possible or is the parser a module which can be killed and script could be send somehow?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1922/comments",
    "author": "ghost",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-08-29T13:35:33Z",
        "body": "Swoole's core is coroutine and high IO performance, Please use nginx to proxy it."
      },
      {
        "user": "ghost",
        "created_at": "2018-08-29T15:01:24Z",
        "body": "Hmm, generally i would like to avoid this :)\r\n\r\nThere are several kinds of problems by misconfiguration and system failures which ends in serving unparsed php-script-files or directly downloading them by the client, because the misconfiguration of proxy or because php itself is some kind of broken. So, generally, when using php behind a server/proxy, it is needed to protect it against reading usefull information out of those scripts, like DB-Access, Passwords, File-System-Architectur, and so on.\r\n\r\nIn opposite to this _is_ swoole the php-engine, so i would like to tend to say - a misconfig isn't possible, because there is no config this way _and_ i would like to tend to say, that, if swoole is broken, the php engine itself is broken _and would not work anymore_?\r\n\r\nOr is it possible, that the command (with swoole) `php runfile.php` works and serves unparsed content after swoole.so is broken? I do not think that this is possible.\r\n\r\nGenerally - for my projects - i really see no benefit to proxy swoole by another software. As opposite i would have more software to maintain, to secure against ... and to be care of.\r\n\r\nEvery system and software can be broken - i see no relevance to protect swoole by another software that can be broken.\r\n\r\nAnd my tests about the power of swoole are fundamenting, that swoole itself is as powerful as nginx (or Golang or Crystal) - if there is a gap of 10% - maybe... I would like to say that the concept of swoole is completely highest performance and IO and a minimum to maintain :+1: \r\n\r\nSo, back to my initially question: is the command `php` able to send unparsed files _after_ swoole.so is some kind of broken? :)"
      }
    ]
  },
  {
    "number": 1917,
    "title": "WebSocket is already in CLOSING or CLOSED state",
    "created_at": "2018-08-28T12:30:41Z",
    "closed_at": "2019-10-24T06:00:03Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1917",
    "body": "Hi, I implement swoole WebSocket for my application I am also using Cloudflare for SSL in WebSocket to make the connection secure everything is working fine but after a minute or less than a minute, my web socket gets disconnected automatically. can you please help me how we can prevent WebSocket to disconnect automatically.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1917/comments",
    "author": "anehkumar",
    "comments": [
      {
        "user": "Inokinoki",
        "created_at": "2018-08-28T14:37:10Z",
        "body": "Hi, could you please provide the details?\r\nWe can assure that you've used Swoole WebSocket server. \r\n- Then what's the information when WebSocket closes automatically?\r\n- Your Swoole version\r\n- Where does it come from, your WebSocket connection (which is the client)\r\n\r\nThank you very much for further information"
      },
      {
        "user": "anehkumar",
        "created_at": "2018-08-29T04:31:01Z",
        "body": "Hi, Thanks for the reply.\r\nSwoole Version:- 4.0.2\r\nWhen I connect with socket using IP address at that time it was working fine but when I point a domain and also include Cloudflare then it was disconnected connection automatically after 1 minute and I get this error WebSocket is already in CLOSING or CLOSED state.\r\n\r\nWhere does it come from, your WebSocket connection (which is the client)\r\nI connect to socket from my web application.\r\n\r\nDo you have any good tutorial in which you display how to use your swoole_mysql in WebSocket, I did not figure out how to do that I want to save user message in DB and also save socket information in DB.\r\n\r\nThanks\r\n"
      },
      {
        "user": "twose",
        "created_at": "2018-08-29T13:38:58Z",
        "body": "Generally speaking, the client sends the ping frame and swoole websocket server will pong automatically.\r\nOr you met some errors, you should check your close reason.\r\n"
      }
    ]
  },
  {
    "number": 1916,
    "title": "onWorkerStop事件在什么情况下会调用呢。",
    "created_at": "2018-08-28T12:08:33Z",
    "closed_at": "2018-08-29T02:42:56Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1916",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n\r\n\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1916/comments",
    "author": "flyflyhe",
    "comments": [
      {
        "user": "flyflyhe",
        "created_at": "2018-08-28T12:09:24Z",
        "body": "文档上说明不完全。"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-08-29T02:42:56Z",
        "body": "Worker进程正常退出时调用。"
      }
    ]
  },
  {
    "number": 1896,
    "title": "MySQL server has gone away Using Swoole Websocket",
    "created_at": "2018-08-22T04:12:39Z",
    "closed_at": "2018-08-24T01:36:04Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1896",
    "body": "Hi I am using PDO MYSQL inside web socket to store message in DB but after some time I get this error.\r\n\r\n```\r\n[2018-08-22 04:03:43 *12124.0]\tWARNING\tswSignalfd_onSignal: signal[13] callback is null.\r\nPHP Warning:  PDOStatement::execute(): SQLSTATE[HY000]: General error: 2006 MySQL server has gone away in /var/www/html/socket_server/server.php on line 299\r\nError inserting data in roomPHP Warning:  PDOStatement::execute(): SQLSTATE[HY000]: General error: 2006 MySQL server has gone away in /var/www/html/socket_server/server.php on line 299\r\nError inserting data in roomPHP Warning:  PDOStatement::execute(): SQLSTATE[HY000]: General error: 2006 MySQL server has gone away in /var/www/html/socket_server/server.php on line 538\r\n```\r\n\r\nPlease help me to fix this issue I need to restart swoole server to make it work every time.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1896/comments",
    "author": "anehkumar",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-08-22T04:19:00Z",
        "body": "You can't use PDO in swoole except you are using swoole 4.1.0 (not released) and call `Swoole\\Runtime::enableCoroutine();` to make it unblocked\r\nAnd in swoole MySQL connection keep longer, so you must catch the error and reconnect it because MySQL has connection timeout setting."
      }
    ]
  },
  {
    "number": 1887,
    "title": "http server on ssl miss https => on",
    "created_at": "2018-08-16T02:56:51Z",
    "closed_at": "2018-08-16T12:29:52Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1887",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\nin http server when I use ssl , on `request->server` miss `https => on`\r\n\r\n2. What did you expect to see?\r\n\r\ni want to on `request->server` add key value with `https => on`\r\n\r\n3. What did you see instead?\r\n\r\nmiss `https => on`\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\n2.2.0\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n\r\nphp 7.2.5\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\nOpenSSL 1.0.1e-fips 11 Feb 2013\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1887/comments",
    "author": "zpqsunny",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-08-16T03:27:41Z",
        "body": "why should it have https on? you have already known if it is https when you create the server."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-08-16T05:20:34Z",
        "body": "You can detect the server port to determine if it is https.\r\n\r\n```php\r\nif ($server->getClientInfo($request->fd)['server_port'] == '443') {\r\n    echo \"https\";\r\n}\r\n```"
      }
    ]
  },
  {
    "number": 1886,
    "title": "http_sever and websocket_server",
    "created_at": "2018-08-15T17:32:56Z",
    "closed_at": "2018-08-20T06:20:47Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1886",
    "body": "I don't get it. How can I make a http_server and a websocket_server in one process? \r\n\r\ntried to create two instanced but wont work\r\n\r\nWarning: Swoole\\Server::__construct(): server is running. unable to create swoole_server.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1886/comments",
    "author": "Kapsonfire",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-08-16T01:26:14Z",
        "body": "Easy, you should know WebSocket is upgraded by HTTP\r\n```php\r\n<?php\r\n\r\n$server = new swoole_websocket_server('127.0.0.1', 9501);\r\n\r\n$server->on('open', function (swoole_websocket_server $server, swoole_http_request $req) {\r\n    echo \"connection open: {$req->fd}\\n\";\r\n});\r\n\r\n//websocket\r\n$server->on('message', function (swoole_websocket_server $server, swoole_websocket_frame $frame) {\r\n    echo \"received message: {$frame->data}\\n\";\r\n    $server->push($frame->fd, json_encode([\"hello\", \"world\"]));\r\n});\r\n\r\n//http\r\n$server->on('request', function (swoole_http_request $req, swoole_http_response $resp) {\r\n    $resp->end(\"<h1>hello world</h1>\");\r\n});\r\n\r\n$server->on('close', function (swoole_websocket_server $server, int $fd) {\r\n    echo \"connection close: {$fd}\\n\";\r\n});\r\n\r\n$server->start();\r\n```"
      },
      {
        "user": "Kapsonfire",
        "created_at": "2018-08-16T06:33:30Z",
        "body": "ok, i tried it already that way, but with http2 in the option.\r\n\r\nso im not able to use http2 then, since websocket server cant use http2 "
      },
      {
        "user": "Kapsonfire",
        "created_at": "2018-08-18T11:47:10Z",
        "body": "any way to allow http2 in websocket server?"
      },
      {
        "user": "twose",
        "created_at": "2018-08-20T02:30:42Z",
        "body": "@Kapsonfire \r\nNot yet, but on the roadmap. Please use nginx to proxy it."
      },
      {
        "user": "Kapsonfire",
        "created_at": "2018-08-20T06:20:47Z",
        "body": "thanks - this is the only reason for me to use a apache2 reverse proxy to achieve http2 - may be closed"
      }
    ]
  },
  {
    "number": 1852,
    "title": "Coroutine\\Http\\Client 能否支持混合传文件内容",
    "created_at": "2018-07-31T08:19:01Z",
    "closed_at": "2018-08-20T09:50:41Z",
    "labels": [
      "enhancement",
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1852",
    "body": "能否为`Coroutine\\Http\\Client`增加一个方法，可以支持直接传文件内容的方式，添加上传文件。因为并不是所有时候调用接口，上传的文件都是在服务器本地有的。",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1852/comments",
    "author": "Yurunsoft",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-07-31T08:24:56Z",
        "body": "不想用`addFile`的话自己生成包体就可以了, 有个示例:\r\n```php\r\nfunction arrayToMultipartString(array $var, string $boundary): string\r\n{\r\n    $ret = '';\r\n    foreach ($var as $name => $value) {\r\n        $value = (string)($value);\r\n        $ret .= \"--{$boundary}\\r\\nContent-Disposition: form-data; name=\\\"{$name}\\\"\\r\\n\\r\\n{$value}\\r\\n\";\r\n    }\r\n    $ret .= \"--{$boundary}--\\r\\n\";\r\n\r\n    return $ret;\r\n}\r\n```"
      },
      {
        "user": "Yurunsoft",
        "created_at": "2018-07-31T08:37:37Z",
        "body": "如果想同时用大概就不行了吧，是不是实现一下比较好"
      },
      {
        "user": "twose",
        "created_at": "2018-07-31T08:51:52Z",
        "body": "的确是可以实现的, 但这是极为罕见的小众需求, 拼接文件内容也是不建议的, 效率很低容易出错.\r\nswoole的`addFile`发送文件是通过`sendfile`实现的, 和普通的发送内容不同, 几乎没有内存占用."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-08-20T09:54:45Z",
        "body": "已增加 `addData` 方法，可以直接传入数据内容，而不是磁盘文件。"
      }
    ]
  },
  {
    "number": 1836,
    "title": "register_shutdown_function not working",
    "created_at": "2018-07-24T17:44:11Z",
    "closed_at": "2018-07-26T08:01:01Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1836",
    "body": "how to make register_shutdown_function to work within swoole_http_server->onRequest ?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1836/comments",
    "author": "xrjxs",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-07-25T02:14:30Z",
        "body": "↓ onRequest event function\r\n```php\r\ntry{\r\n  // your code here\r\n  if (cache){\r\n    throw new \\ExitException(); // i want to exit\r\n  }\r\n // slow query...\r\n // balabala\r\n} catch (\\ExitException $e){\r\n  // as php exit\r\n} catch (\\Exception $e) {\r\n  // the other exceptions...you can error log here\r\n} finally {\r\n   $response->end(); // must be ended\r\n   then you can call some functions here (as `register_shutdown_function `)\r\n}\r\n```"
      },
      {
        "user": "Petersdavis",
        "created_at": "2022-02-09T15:24:14Z",
        "body": "But primarly we need register_shutdown_function to catch fatal errors.  Would they not skip the finally block if you get out of memory or timelimit exceeded error?"
      }
    ]
  },
  {
    "number": 1831,
    "title": "swoole_http_client->download error",
    "created_at": "2018-07-24T02:05:23Z",
    "closed_at": "2018-07-24T02:06:22Z",
    "labels": [
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1831",
    "body": " \r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n断点续传 download file\r\n$cli = new swoole_http_client('127.0.0.1', 80);\r\n$file = DIR.'/video.avi';\r\n$offset = filesize($file);\r\n$cli->setHeaders([\r\n'Host' => \"localhost\",\r\n\"User-Agent\" => 'Chrome/49.0.2587.3',\r\n'Accept' => '*',\r\n'Accept-Encoding' => 'gzip',\r\n'Range' => \"bytes=$offset-\",\r\n]);\r\n\r\n$cli->download('/video.avi', $file, function ($cli) {\r\nvar_dump($cli->downloadFile);\r\n}, $offset);\r\n\r\nwhen add the fourth params $offset then report error:\r\nswoole_http_client::download() expects exactly 3 parameters, 4 given\r\n \r\n\r\n2. What did you expect to see?\r\n \r\ndownload success\r\n\r\n3. What did you see instead?\r\nswoole_http_client::download() expects exactly 3 parameters, 4 given\r\n\r\n \r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\nswoole 2.0.5\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\nkernel : 4.15.0-29-generic,   php7.0  ,gcc version 7.3.0\r\n\r\n\r\n6. If you are using ssl, what is your openssl version?\r\nno use.\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1831/comments",
    "author": "w3yyb",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-07-24T02:06:22Z",
        "body": "@w3yyb \r\n升级你的swoole版本到最新(现在是4.0.3)."
      }
    ]
  },
  {
    "number": 1820,
    "title": "无法加载swoole.so",
    "created_at": "2018-07-20T06:54:10Z",
    "closed_at": "2018-07-20T07:35:27Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1820",
    "body": "输入php -v显示\r\nPHP Warning:  PHP Startup: Unable to load dynamic library 'swoole.so' (tried: /usr/local/lib/php/extensions/debug-non-zts-20170718/swoole.so (Error relocating /usr/local/lib/php/extensions/debug-non-zts-20170718/swoole.so: __asan_stack_free_7: symbol not found), /usr/local/lib/php/extensions/debug-non-zts-20170718/swoole.so.so (Error loading shared library /usr/local/lib/php/extensions/debug-non-zts-20170718/swoole.so.so: No such file or directory)) in Unknown on line 0\r\n\r\nphp版本7.2.7\r\nswoole版本4.0.1\r\n操作系统docker alpine 3.7",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1820/comments",
    "author": "kawais",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-07-20T07:01:56Z",
        "body": "去掉 `--enable-asan` 编译参数"
      }
    ]
  },
  {
    "number": 1797,
    "title": "How to use channel outside server",
    "created_at": "2018-07-11T09:07:36Z",
    "closed_at": "2018-07-13T01:37:59Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1797",
    "body": "I try to write a console script which will execute functions in coroutines and use channel to collect data from them. How can i use it outside server (http, udp, websocket etc)? I want that script utilizes all cores for his job.\r\n```\r\n<?php\r\n$chan = new chan(1);\r\n\r\ngo(function() use ($chan) {\r\n    $chan->push(1);\r\n});\r\n\r\n// Fatal error:  Swoole\\Coroutine\\Channel::pop(): must be called in the coroutine\r\necho $chan->pop();\r\n```\r\n\r\n2. What did you expect to see?\r\n1\r\n\r\n3. What did you see instead?\r\nFatal error:  Swoole\\Coroutine\\Channel::pop(): must be called in the coroutine\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n2.2.0",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1797/comments",
    "author": "ghost",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-07-12T15:41:08Z",
        "body": "it must be called in the coroutine because it would schedule coroutine.\r\nif you want to use it outside, you should use \\Swoole\\Channel (without coroutine)."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-07-13T01:37:59Z",
        "body": "Chan->pop may cause coroutine scheduling, so it must be executed in the coroutine"
      }
    ]
  },
  {
    "number": 1791,
    "title": "package_max_length option do not work",
    "created_at": "2018-07-07T11:41:40Z",
    "closed_at": "2018-07-07T11:52:26Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1791",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\nSet package_max_length to 200mb\r\n```\r\n$http = new swoole_http_server(\"127.0.0.1\", 8888);\r\n$http->set([\r\n\t'package_max_length' => 1024*200 // 200mb\r\n]);\r\n$http->on(\"request\", function ($request, $response) {\r\n    $response->header(\"Content-Type\", \"text/plain\");\r\n    $response->end(\"Hello World\\n\");\r\n});\r\n$http->start();\r\n```\r\nThen send 100mb image\r\n```\r\ncurl -X POST -F 'image=@world.png' 127.0.0.1:8888\r\n```\r\n\r\n\r\n2. What did you expect to see?\r\n\r\nResponse with text Hello World\r\n\r\n3. What did you see instead?\r\n\r\nClient receives empty response. On server side i get\r\nWARNING swPort_onRead_http: Content-Length is too big, MaxSize=[196608].\r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\n4.0.1\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n\r\nKernel 4.15.0-20-generic\r\nphp 7.2.4\r\ngcc 7.3.0\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\nCompiled without ssl. I selected No for all questions\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1791/comments",
    "author": "ghost",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-07-07T11:52:26Z",
        "body": "1024*200 = 200K not 200M, You should set `package_max_length ` to `1024*1024*200`"
      }
    ]
  },
  {
    "number": 1782,
    "title": "问下，异步redis是否支持Redis::OPT_SERIALIZER, Redis::SERIALIZER_PHP",
    "created_at": "2018-07-04T02:26:13Z",
    "closed_at": "2018-08-21T03:02:01Z",
    "labels": [
      "enhancement",
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1782",
    "body": "",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1782/comments",
    "author": "youngda",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-07-19T02:48:05Z",
        "body": "推荐用协程, 异步还不支持, 在下个版本加入\r\n```php\r\ngo(function () {\r\n    $redis = new \\Swoole\\Coroutine\\Redis;\r\n    $redis->connect('127.0.0.1', 6379, true); // param 3 is serialize\r\n    $redis->set('foo', ['bar' => 'baz']);\r\n    $ret = $redis->get('foo');\r\n    var_dump($ret);\r\n});\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-08-21T03:02:39Z",
        "body": "请使用协程Redis客户端，或使用PHP代码封装实现。异步的客户端不再继续开发了。"
      },
      {
        "user": "abbychau",
        "created_at": "2022-05-29T04:55:09Z",
        "body": "那麼Redis Connection Pool 是不是也不建議用呢? 貌似也不支持Redis::OPT_SERIALIZER "
      }
    ]
  },
  {
    "number": 1759,
    "title": "About fd",
    "created_at": "2018-06-30T22:30:30Z",
    "closed_at": "2018-07-01T01:12:00Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1759",
    "body": "when i connect to web socket every time i connect i have unique $request->fd\r\n\r\nif there way to set it \r\n\r\ni try to pass id with url in connect \r\n\r\nlike this \r\n\r\n```\r\n new WebSocket(\"ws://127.0.0.1:9502?id=4370971530347983\");\r\n```\r\n\r\nthen in server \r\n\r\n```\r\n$server->on('open', function($server, $req) {\r\n    $req->fd = $req->get[\"id\"];\r\n    echo \"connection open: {$req->fd} {$req->get[\"id\"]} \\n\";\r\n});\r\n```\r\n\r\nbut when i check \r\n\r\n```\r\n$server->exist($id)\r\n```\r\n\r\ni did not found the id \r\n\r\nany idea how i do this",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1759/comments",
    "author": "zizohassan",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-07-01T01:12:00Z",
        "body": "FD is the identifier of the TCP connection and cannot be set.\r\nYou can save with global array or swoole_table.\r\n\r\n```php\r\n$array = [];\r\n$server->on('open', function($server, $req) {\r\n    global $array;\r\n    $array[$req->get[\"id\"]] = $req->fd;\r\n    echo \"connection open: {$req->fd} {$req->get[\"id\"]} \\n\";\r\n});\r\n\r\nisset($array[$id]);\r\n```"
      }
    ]
  },
  {
    "number": 1758,
    "title": "register_shutdown_function，多线程继承问题",
    "created_at": "2018-06-30T12:57:37Z",
    "closed_at": "2018-07-01T01:06:58Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1758",
    "body": "在父进程注册\"register_shutdown_function()\"后，创建子进程，当子进程exit退出时，也会触发\"register_shutdown_function()\"事件",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1758/comments",
    "author": "Alion548",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-06-30T13:30:00Z",
        "body": "你这个是多进程问题吧...\r\n如果你是指主进程和worker进程, 在register_shutdown_function里增加判断一下当前在哪个进程就好了.\r\n不知道你要做什么, 进程都有自己的退出事件可以注册.\r\n"
      },
      {
        "user": "Alion548",
        "created_at": "2018-06-30T15:04:05Z",
        "body": "在父进程注册register_shutdown_function，防止父进程exit意外退出导致子进程变成孤儿进程"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-07-01T01:06:58Z",
        "body": "子进程是继承父进程内存的，所以这是符合预期的。你需要在 register_shutdown_function 的函数中处理这个情况。"
      }
    ]
  },
  {
    "number": 1744,
    "title": "task进程卡死",
    "created_at": "2018-06-25T02:58:27Z",
    "closed_at": "2018-07-03T23:49:53Z",
    "labels": [
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1744",
    "body": "swoole版本：2.2.0 和 4.0.1\r\nphp 版本： 7.0.30\r\n表现1 ：\r\n在一定时器中，执行投递任务动作\r\n在定时器中，根据 $server->stats中获取的 tasking_num 判断，如果 tasking_num 大于任务进程数，就不再投递任务。\r\n在执行一段时间后（ 半天至一天，不等） 就没有新任务投递了。\r\n在根据任务的日志分析，任务已执行完毕。\r\n也就是说，定时器中获取的 tasking_num ，在任务完成后没有变化\r\n任务中没有发生死循环的情况\r\n\r\n表现2： \r\n在执行任务卡死后，执行 posix_kill($masterPid, SIGTERM)    一直没响应\r\n\r\n表现3：\r\n直接 kill swoole的进程，无法kill掉，只有kill -9  才可以kill掉主进程和任务进程\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1744/comments",
    "author": "bnubobby",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-06-25T10:47:05Z",
        "body": "@bnubobby 先升级到swoole4"
      },
      {
        "user": "bnubobby",
        "created_at": "2018-07-02T01:14:57Z",
        "body": "@twose \r\n升级到4.0.1 情况一样\r\n另外，在ontask里，执行任务之前及执行任务后，均添加时间戳作为标记，能看到task进程，均已执行完任务，并且执行结束的时间大于执行开始的时间。\r\n"
      },
      {
        "user": "bnubobby",
        "created_at": "2018-07-02T01:16:57Z",
        "body": "在这时候执行post_kill  ，通知应用结束，一直没响应"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-07-02T04:20:47Z",
        "body": "使用 strace gdb 跟踪出现问题的 task 进程。"
      },
      {
        "user": "bnubobby",
        "created_at": "2018-07-02T06:01:55Z",
        "body": "Loaded symbols for /opt/remi/php70/root/usr/lib64/php/modules/jsond.so\r\nReading symbols from /data/extend/php7/phalcon.so...done.\r\nLoaded symbols for /data/extend/php7/phalcon.so\r\nReading symbols from /data/extend/php7/redis.so...done.\r\nLoaded symbols for /data/extend/php7/redis.so\r\nReading symbols from /data/extend/php7/swoole.so...done.\r\nLoaded symbols for /data/extend/php7/swoole.so\r\nReading symbols from /data/extend/php7/thrift_protocol.so...done.\r\nLoaded symbols for /data/extend/php7/thrift_protocol.so\r\nReading symbols from /lib64/libnss_files.so.2...(no debugging symbols found)...done.\r\nLoaded symbols for /lib64/libnss_files.so.2\r\nReading symbols from /lib64/libnss_dns.so.2...(no debugging symbols found)...done.\r\nLoaded symbols for /lib64/libnss_dns.so.2\r\n0x00007fe02fd07f0d in poll () from /lib64/libc.so.6\r\nMissing separate debuginfos, use: debuginfo-install php70-php-cli-7.0.30-1.el7.remi.x86_64\r\n\r\n@matyhtf  \r\n刚刚发生的情况，接下来我再安装yum-utils 再观察一次"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-07-02T06:07:37Z",
        "body": "贴出完整的gdb调用栈"
      },
      {
        "user": "bnubobby",
        "created_at": "2018-07-02T14:50:43Z",
        "body": "#0 Bx00007f32ei92eiaf0d in poll () from /lib64/libc\r\nttl 0x00007f32a0c314ft9 in Curl_poll () from /lib64/libcurl.so.4\r\n#2 0x00007f32a0c2a3cd in curl_raulti_wait C) from /lib64/libcurl.so.4\r\n#3 0x00007f32a0c234ff in curl_easy_perfornn () from /lib64/libcurl.so.4\r\n#4 0x000B7f32a0e6dld4 in zif_curl_exec () from /opt/remi/php70/root/usr/lib64/php/mDdules/curl.so\r\n#5 0x0000564197877bdc in ZEHD_DO_FCALL_BY_HAME_SFEC_HAHDLER ()\r\n#6 0x0000564197839a4b in execute_ex ()\r\n#7 0x00005641977eb3aa in zend_ca11_function ()\r\n#8 0x0000564197738fb0 in zif_call_user_func_array ()\r\n#S 0x0000564197877bdc in ZEND_DO_FCALL_BY_NftME_SPEC_HANDLER ()\r\n#10 0x0000564197839q41) in execute_ex ()\r\nttll 0x00005641977eb3aa in zeind_call_fuinctioin ()\r\n#12 0x00007f3291d34cdc in sw_call_user_function_fast Cparams=0x7ffd925f0800, param_count=4,\r\nretual_ptr_ptr=<synthetic po inter>, fci_cac]ie=<optimized out>, function_¥iame=<optimized aut>)\r\nat /data/CKtend/swoole-src-4.8. l/php?_wrapper. h ： 385\r\n#13 php_swoole_onTask (serv=0x5641995^8500j req=<optimized out>)\r\nat /data/extend/suoole-src-4.0.1/suDOle一seiMjer.c:1046\r\n#14 0x00007f3291d9786c in swiProcessPool_worker_loop Cpool=0x7f32918ff258, worker=0x7f32919020d8)\r\nat /data/ortend/swoole-src-4.8.1/src/network/ProcessPool.c：5B4\r\n#15 0x00007f3291d98cd0 in swiProcessPool_spawn Cpool=pool(?eifitry=0x7f32918ff258,\r\nworker =0x7f32919020dB) at /datei/exteiid/swoole-src-4.0.1/src/network/ProcessFool.c ：367\r\n#16 0x00007f329id98eil in swProcessPool.start (pool=0x7f32918ff258)\r\nat /data/extend/swoole-src-4.0.1/src/network/ProcessPool .c ： 182\r\n#17 0x00007f3291d9eac3 in swManager_start (factory=factoryPentry=0x56419S5a8990)\r\nat /data/eKtend/swoole-src-4.8.l/src/network/rtanager.c：138\r\n#18 Bx00007f3291d8acl2 in swFeictoryFrocess_start (factory=0x5641995^8990)\r\nat /data/extend/suoole-src-4.0.i/src/factory/FactoryProcess.c:87\r\n#19 0x00007f3291d9239b in swSerMer_start (seru=serGentry=0x56419S5a8500)\r\nat /data/ortend/swoole-src-4.8.1/src/network/Seruer.c：762\r\n#20 0x00007f3291d5cB39 in zim_swoole_]ittp_server_start Cexecute_data=0x7f32a8213720,\r\nreturn_value=0x7f32aB213710) at /data/extend/swoole-src-4.0.1/swoole_http_server.c：1687\r\n#21 0x000056419787855b in ZEND_DO_FCALL_SPEC_HANDLER H\r\n#22 0x0000564197839a4b in execute_ex ()\r\n#23 0x000056419788426f in zend_execute ()\r\n#24 0x00005641977fa703 in zend_execute_scripts ()\r\n#25 0x000056419779a598 in php_execute_script ()\r\n---Type <return> to continue, or q <return> to quit----------\r\n@matyhtf  谢谢回复！ 请问以上完整了吗？ "
      },
      {
        "user": "bnubobby",
        "created_at": "2018-07-03T03:50:39Z",
        "body": "补充一点：\r\n onTask 的函数大概是这样的：\r\n```\r\n public function onTask(\\Swoole\\Server $server, int $task_id, int $src_worker_id, $taskInfo){\r\n      try{\r\n          ................\r\n   \r\n        } catch (\\ErrorException $e) {\r\n            ..........\r\n        } catch (\\Exception $e) {\r\n            app('log')->error('Exception: '.$e->getMessage(), \r\n                                [ 'exception' => $e ,'category'=>'SYSTEM']\r\n                             );\r\n        } catch (\\TypeError $e) {\r\n            ..........\r\n        } catch (\\ParseError $e) {\r\n            .........\r\n        } catch (\\DivisionByZeroError $e) {\r\n           ..........\r\n        } catch (\\Error $e) {\r\n            .......\r\n        } finally {\r\n           ...........\r\n        }\r\n}\r\n```\r\n现在观察到，卡死的地方，在抛出错误 Exception  后， 应用已经写完抛出的日志，然后返回，tasking_num 并未减少。\r\n\r\n应用使用monolog写日志，文本文件。在卡死后，其它定时器还有成功写日志\r\n\r\n                    "
      },
      {
        "user": "bnubobby",
        "created_at": "2018-07-03T12:47:32Z",
        "body": "再补充：\r\n在 执行 posix_kill($masterPid, SIGTERM) ，程序没响应后，查看系统进程，通常只有一个swoole的task进程卡死，但是tasking_num 数量还是比较多的\r\n是不是在swoole里，当执行task的时候就已经分配好执行该任务的进程，当这个进程卡死的时候，所有分配到此进程的任务都会卡住？如果是的话，建议修改一下这个机制，等待中的任务不预先分配执行任务进程。"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-07-03T23:49:53Z",
        "body": "你的程序 curl 未设置超时，导致进程阻塞在 curl 请求中了。"
      },
      {
        "user": "bnubobby",
        "created_at": "2018-07-04T00:32:58Z",
        "body": "@matyhtf  应该不是这个原因\r\n1. 已设置超时，超时会抛出错误，日志里能看到抛出的超时错误\r\n2. 如果是超时导致，会很快重现，现在的情况是有时候两三天才重现，有时候半天至一天就能重现，但是超时是常态，每小时都会有数十次（网络状态不好）\r\n    抛出错误后卡死，也只是最近一两次的情况，因为日志太多，所以也不知道是否卡死都是发生在抛出错后，正在持续跟踪。"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-07-09T02:38:48Z",
        "body": "gdb 的信息表面进程阻塞在 curl_poll ，请检查你的应用程序。"
      }
    ]
  },
  {
    "number": 1725,
    "title": "4.0 compile error: unknown type name [01mphp_socket php_socket *swoole_convert_to_socket",
    "created_at": "2018-06-16T08:43:01Z",
    "closed_at": "2018-06-20T05:57:40Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1725",
    "body": "I am compile swoole 4.0, PHP7.2:\r\n\r\nIf I use this:\r\n\" ./configure --with-php-config=/usr/bin/php-config --enable-sockets --enable-openssl --enable-swoole --with-swoole  --enable-coroutine  \"\r\n\r\nI got an error:\r\n\r\n```\r\n error: unknown type name [01mphp_socket php_socket *swoole_convert_to_socket\r\n```\r\n\r\nIf I remove \"--enable-socket\", and all passed.\r\n ./configure --with-php-config=/usr/bin/php-config --enable-openssl --enable-swoole --with-swoole  --enable-coroutine  \r\n\r\n\r\nPHP：\r\n\r\n```\r\n# php -v\r\nPHP 7.2.6-1+ubuntu16.04.1+deb.sury.org+1 (cli) (built: Jun 11 2018 14:59:25) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.2.6-1+ubuntu16.04.1+deb.sury.org+1, Copyright (c) 1999-2018, by Zend Technologies\r\n```\r\n\r\nGCC:\r\n\r\n```\r\n# gcc -v\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/5/lto-wrapper\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 5.4.0-6ubuntu1~16.04.9' --with-bugurl=file:///usr/share/doc/gcc-5/README.Bugs --enable-languages=c,ada,c++,java,go,d,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-5 --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --with-system-zlib --disable-browser-plugin --enable-java-awt=gtk --enable-gtk-cairo --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-5-amd64/jre --enable-java-home --with-jvm-root-dir=/usr/lib/jvm/java-1.5.0-gcj-5-amd64 --with-jvm-jar-dir=/usr/lib/jvm-exports/java-1.5.0-gcj-5-amd64 --with-arch-directory=amd64 --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --enable-objc-gc --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.9) \r\n```\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1725/comments",
    "author": "xueron",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-06-16T09:07:16Z",
        "body": "just: \r\n```shell\r\n./configure \\\r\n--enable-openssl  \\\r\n--enable-sockets\r\n```\r\nand make sure that your PHP has socket extension. "
      },
      {
        "user": "xueron",
        "created_at": "2018-06-16T09:24:28Z",
        "body": "Not work:\r\n\r\n```\r\n# ./configure --with-php-config=/usr/bin/php-config --enable-openssl --enable-sockets --enable-swoole --with-swoole  --enable-coroutine  \r\n\r\n...\r\n\r\n# make\r\n/bin/bash /root/swoole-src-4.0.0/libtool --mode=compile cc  -I. -I/root/swoole-src-4.0.0 -DPHP_ATOM_INC -I/root/swoole-src-4.0.0/include -I/root/swoole-src-4.0.0/main -I/root/swoole-src-4.0.0 -I/usr/include/php/20170718 -I/usr/include/php/20170718/main -I/usr/include/php/20170718/TSRM -I/usr/include/php/20170718/Zend -I/usr/include/php/20170718/ext -I/usr/include/php/20170718/ext/date/lib -I/root/swoole-src-4.0.0 -I/root/swoole-src-4.0.0/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/swoole-src-4.0.0/swoole.c -o swoole.lo \r\nlibtool: compile:  cc -I. -I/root/swoole-src-4.0.0 -DPHP_ATOM_INC -I/root/swoole-src-4.0.0/include -I/root/swoole-src-4.0.0/main -I/root/swoole-src-4.0.0 -I/usr/include/php/20170718 -I/usr/include/php/20170718/main -I/usr/include/php/20170718/TSRM -I/usr/include/php/20170718/Zend -I/usr/include/php/20170718/ext -I/usr/include/php/20170718/ext/date/lib -I/root/swoole-src-4.0.0 -I/root/swoole-src-4.0.0/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/swoole-src-4.0.0/swoole.c  -fPIC -DPIC -o .libs/swoole.o\r\nIn file included from /root/swoole-src-4.0.0/swoole.c:16:0:\r\n/root/swoole-src-4.0.0/php_swoole.h:471:1: error: unknown type name ‘php_socket’\r\n php_socket *swoole_convert_to_socket(int sock);\r\n ^\r\nMakefile:194: recipe for target 'swoole.lo' failed\r\nmake: *** [swoole.lo] Error 1\r\n```"
      },
      {
        "user": "twose",
        "created_at": "2018-06-16T11:54:24Z",
        "body": "`php -i | grep sockets`"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-06-20T05:57:40Z",
        "body": "Install php-sockets extension first"
      },
      {
        "user": "fanybook",
        "created_at": "2018-07-11T11:03:38Z",
        "body": "pecl install swoole  安装\r\n有sockets也会报这个错误"
      },
      {
        "user": "rlgy",
        "created_at": "2018-07-16T03:10:14Z",
        "body": "Ubuntu 18.04 启用了sockets 编译报错\r\nrlgyzhcn@rlgyzhcn-OptiPlex-3050:~/Desktop/github/swoole-src$ php7.0 -m\r\n[PHP Modules]\r\ncalendar\r\nCore\r\nctype\r\ncurl\r\ndate\r\nexif\r\nfileinfo\r\nfilter\r\nftp\r\ngettext\r\nhash\r\niconv\r\nigbinary\r\njson\r\nlibxml\r\nmysqli\r\nmysqlnd\r\nopenssl\r\npcntl\r\npcre\r\nPDO\r\npdo_mysql\r\nPhar\r\nposix\r\nreadline\r\nredis\r\nReflection\r\nsession\r\nshmop\r\nsockets\r\nSPL\r\nstandard\r\nswoole\r\nsysvmsg\r\nsysvsem\r\nsysvshm\r\ntokenizer\r\nZend OPcache\r\nzlib\r\n\r\n[Zend Modules]\r\nZend OPcache"
      },
      {
        "user": "drigolin",
        "created_at": "2018-07-17T15:33:15Z",
        "body": "Same issue for me using pear. I had to add #define HAVE_SOCKETS to compile as php_sockets.h has a #if HAVE_SOCKETS pre processor rule"
      }
    ]
  },
  {
    "number": 1712,
    "title": "Laravel project with \"Unexpected token .\" error",
    "created_at": "2018-06-12T16:12:55Z",
    "closed_at": "2018-06-21T10:55:07Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1712",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\nphp artisan swoole:http start\r\n\r\n2. What did you expect to see?\r\n\r\nthe login screen\r\n\r\n3. What did you see instead?\r\n\r\na broken login screen and an error on the console complaining about a javascript file \"Uncaught SyntaxError: Unexpected token .\". When I run as php artisan serve it works perfectly.\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\n2.2.0\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n\r\nMacOS High Sierra 10.13.4 with PHP 7.2.6 running on Laravel project  5.6\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\nno, no\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1712/comments",
    "author": "george-kar",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-06-13T02:05:32Z",
        "body": "`SyntaxError` \r\nPlease check your php file for syntax errors"
      }
    ]
  },
  {
    "number": 1710,
    "title": "Enable sockets support, require sockets extension.",
    "created_at": "2018-06-12T11:17:00Z",
    "closed_at": "2018-06-13T02:09:59Z",
    "labels": [
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1710",
    "body": "看了 make.sh 里的脚本，启用那几个参数编译的话会报错，到处找了没找到如何处理这里的编译错误，请官方出一个文档说明一下啊，求助了",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1710/comments",
    "author": "huye",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-06-13T02:09:59Z",
        "body": "使用最新版本 4.0.0-rc1 已去掉了此项检测。"
      },
      {
        "user": "huye",
        "created_at": "2018-06-13T06:36:19Z",
        "body": "好吧，看来先不用这些功能，反正现在也用不到"
      }
    ]
  },
  {
    "number": 1695,
    "title": "Possible to integrate applications like Magento or Drupal?",
    "created_at": "2018-06-07T00:29:29Z",
    "closed_at": "2018-06-13T02:13:23Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1695",
    "body": "Hi guys,\r\n\r\nJust putting a dummy questions here. If applications like Magento be integrated into swoole? so we can throw php-fpm away? \r\n\r\nIf yes, what would be the road block? \r\n\r\nCheers.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1695/comments",
    "author": "Adel-Magebinary",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-06-13T02:13:14Z",
        "body": "Objects in swoole are long-lived, You must deal with global and static variables.\r\n\r\nThis may need to modify the php code to achieve compatibility"
      }
    ]
  },
  {
    "number": 1687,
    "title": "Swoole HTTP /1.1 specifications Compliance",
    "created_at": "2018-06-05T02:49:48Z",
    "closed_at": "2018-08-21T03:09:44Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1687",
    "body": "According to the documentation, Swoole is not yet recommended to replace traditional HTTP servers such as nginx or Apache. \r\n`swoole_http_server does not support the complete HTTP protocol, Nginx is recommended to be used as a proxy for Swoole HTTP server.`\r\n\r\nMy question is what exactly is it missing in the implementation?\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1687/comments",
    "author": "aftabnaveed",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-06-05T02:56:26Z",
        "body": "**Details**"
      },
      {
        "user": "aftabnaveed",
        "created_at": "2018-06-05T03:50:34Z",
        "body": "@twose What exactly do you mean by the details here? "
      },
      {
        "user": "twose",
        "created_at": "2018-06-05T11:33:17Z",
        "body": "@aftabnaveed \r\ne.g. \r\n#1600 http2 static files support\r\n#1606  if you send a non-standard HTTP package, swoole can't parse it but nginx can do more(auto fix the lost space).\r\ntoo many details like these so I can't tell you every detail totally.\r\nswoole keep the simple and fast, only do what it should do."
      },
      {
        "user": "aftabnaveed",
        "created_at": "2018-06-05T17:19:58Z",
        "body": "Nice, but the question is about Http /1.1  I guess it would be somewhat similar to what you just described for Http2. \r\n\r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-06-08T11:09:06Z",
        "body": "It is difficult to give an explicit list, the HTTP protocol is very complicated, and web servers also need to be compatible with many bad cases"
      }
    ]
  },
  {
    "number": 1668,
    "title": "swoole2.2.0编译 携带--enable-openssl参数，编译通过但是swoole ssl功能不能正常使用",
    "created_at": "2018-05-28T15:35:41Z",
    "closed_at": "2018-05-30T02:18:14Z",
    "labels": [
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1668",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\n   swoole2.2.0重新编译支持openssl,编译通过，swoole ssl功能不能正常使用。\r\n\r\n2. What did you expect to see?\r\n\r\n   php --ri swoole中可以看到openssl的支持，swoole1.10.5中可以看到。\r\n\r\n3. What did you see instead?\r\n\r\n   php --ri swoole中可以看不到openssl的支持，SWOOLE_SSL常量不识别。\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\n   swoole2.2.0\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n\r\n   centos7 php7.1.4  Linux 3.10.0-514.6.2.el7.x86_64   gcc version 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC)\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\n   openssl1.0.2k\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1668/comments",
    "author": "bodhi-code",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-05-29T02:39:20Z",
        "body": "还有个: `--with-openssl-dir=你的openssl路径`\r\n加入这个参数看看是否可行? 注意一下make的时候是否有错误提示?\r\n最好贴一下你的编译脚本怎么写的"
      },
      {
        "user": "bodhi-code",
        "created_at": "2018-05-29T03:01:20Z",
        "body": "具体的编译命令是:  ./configure --enable-openssl --with-openssl-dir=/usr/local/openssl\r\n执行完并未报错。之后使用make,make install没报错。而且使用 php --ri swoole显示支持中未出现openssl的支持。使用openssl的源码包编译：./configure --enable-openssl --with-openssl-dir=/usr/local/lnamp/openssl-1.0.2k，也是同样的问题，但是在swoole1.10.5中使用相同的命令，ssl功能可以使用。"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-05-30T02:18:14Z",
        "body": "请勿同时使用 `./configure --enable-openssl --with-openssl-dir=/usr/local/openssl` ，检查 `config.h` 中是否有 `HAVE_OPENSSL`"
      },
      {
        "user": "bodhi-code",
        "created_at": "2018-06-01T02:55:51Z",
        "body": "config.h中有HAVE_OPENSSL，编译完成后不能正常使用swoole的ssl功能。"
      },
      {
        "user": "zhangli1",
        "created_at": "2020-05-13T08:17:08Z",
        "body": "使用pecl install swoole安装吧， 我用源码死都装不上去，用pecl一装就行"
      }
    ]
  },
  {
    "number": 1641,
    "title": "swoole_coroutine::writeFile aio_onWriteFileCompleted core dump ",
    "created_at": "2018-05-23T07:01:27Z",
    "closed_at": "2018-05-23T10:56:36Z",
    "labels": [
      "question",
      "fixed"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1641",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\nswoole_coroutine::writeFile\r\n\r\n2. What did you expect to see?\r\nwrite success \r\n\r\n\r\n3. What did you see instead?\r\ncoredump \r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n2.1.3\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\ngcc version 4.4.6 20110731 (Red Hat 4.4.6-4) (GCC)\r\n\r\n\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\n```\r\nProgram terminated with signal SIGSEGV, Segmentation fault.\r\n#0  zend_mm_alloc_small (bin_num=4, size=<optimized out>, heap=0x7f15d8a00040) at /usr/local/services/php-7.1.1/Zend/zend_alloc.c:1261\r\n1261\t\t\theap->free_slot[bin_num] = p->next_free_slot;\r\n(gdb) bt\r\n#0  zend_mm_alloc_small (bin_num=4, size=<optimized out>, heap=0x7f15d8a00040) at /usr/local/services/php-7.1.1/Zend/zend_alloc.c:1261\r\n#1  zend_mm_alloc_heap (size=<optimized out>, heap=0x7f15d8a00040) at /usr/local/services/php-7.1.1/Zend/zend_alloc.c:1332\r\n#2  _emalloc (size=<optimized out>) at /usr/local/services/php-7.1.1/Zend/zend_alloc.c:2417\r\n#3  0x00000000007bf3f0 in zend_string_alloc (persistent=0, len=9) at /usr/local/services/php-7.1.1/Zend/zend_string.h:122\r\n#4  zend_string_init (persistent=0, len=9, str=0x7f15dbd74095 <error: Cannot access memory at address 0x7f15dbd74095>)\r\n    at /usr/local/services/php-7.1.1/Zend/zend_string.h:158\r\n#5  lex_scan (zendlval=0x7fffa53f0630) at Zend/zend_language_scanner.l:1893\r\n#6  0x00000000007d5e01 in zendlex (elem=0x7fffa53f1010) at /usr/local/services/php-7.1.1/Zend/zend_compile.c:1701\r\n#7  0x00000000007b82ea in zendparse () at /usr/local/services/php-7.1.1/Zend/zend_language_parser.c:4450\r\n#8  0x00000000007bb31b in zend_compile (type=2) at Zend/zend_language_scanner.l:585\r\n#9  0x00000000007bc9fb in compile_file (file_handle=0x7fffa53f13f0, type=8) at Zend/zend_language_scanner.l:635\r\n#10 0x000000000065c27f in phar_compile_file (file_handle=0x7fffa53f13f0, type=8) at /usr/local/services/php-7.1.1/ext/phar/phar.c:3318\r\n#11 0x00000000007bc13f in compile_filename (type=8, filename=0x7f15d8a9a110) at Zend/zend_language_scanner.l:662\r\n#12 0x000000000088c53a in zend_include_or_eval (inc_filename=0x7f15d8a9a110, type=8) at /usr/local/services/php-7.1.1/Zend/zend_execute.c:2846\r\n#13 0x000000000088c63d in ZEND_INCLUDE_OR_EVAL_SPEC_CV_HANDLER (execute_data=0x7f15d8a9a060) at /usr/local/services/php-7.1.1/Zend/zend_vm_execute.h:35455\r\n#14 0x000000000084f0e8 in execute_ex (ex=<optimized out>) at /usr/local/services/php-7.1.1/Zend/zend_vm_execute.h:432\r\n#15 0x00007f15ce62eee7 in sw_coro_resume (sw_current_context=<optimized out>, retval=0x7fffa53f1610, coro_retval=<optimized out>)\r\n    at /usr/local/services/swoole-src-2.1.3/swoole_coroutine.c:506\r\n#16 0x00007f15ce63032c in aio_onWriteFileCompleted (event=0x30f1000) at /usr/local/services/swoole-src-2.1.3/swoole_coroutine_util.c:950\r\n#17 0x00007f15ce6b94d2 in swAioBase_onFinish (reactor=<optimized out>, event=<optimized out>) at /usr/local/services/swoole-src-2.1.3/src/os/base.c:159\r\n#18 0x00007f15ce6a375f in swReactorEpoll_wait (reactor=0x2f3cfd0, timeo=<optimized out>) at /usr/local/services/swoole-src-2.1.3/src/reactor/ReactorEpoll.c:255\r\n#19 0x00007f15ce6b5e99 in swWorker_loop (factory=<optimized out>, worker_id=<optimized out>) at /usr/local/services/swoole-src-2.1.3/src/network/Worker.c:782\r\n#20 0x00007f15ce6b2f63 in swManager_spawn_worker (factory=0x2f3c120, worker_id=4) at /usr/local/services/swoole-src-2.1.3/src/network/Manager.c:507\r\n#21 0x00007f15ce6b35a2 in swManager_loop (factory=0x2f3c120) at /usr/local/services/swoole-src-2.1.3/src/network/Manager.c:386\r\n#22 swManager_start (factory=0x2f3c120) at /usr/local/services/swoole-src-2.1.3/src/network/Manager.c:178\r\n#23 0x00007f15ce6a0131 in swFactoryProcess_start (factory=0x2f3c120) at /usr/local/services/swoole-src-2.1.3/src/factory/FactoryProcess.c:86\r\n#24 0x00007f15ce6a781f in swServer_start (serv=0x2f3bc90) at /usr/local/services/swoole-src-2.1.3/src/network/Server.c:755\r\n#25 0x00007f15ce643654 in zim_swoole_http_server_start (execute_data=0x7f15d8a131a0, return_value=0x7fffa53f1ce0)\r\n    at /usr/local/services/swoole-src-2.1.3/swoole_http_server.c:1669\r\n#26 0x00000000008705b0 in ZEND_DO_FCALL_SPEC_RETVAL_UNUSED_HANDLER (execute_data=0x7f15d8a13030) at /usr/local/services/php-7.1.1/Zend/zend_vm_execute.h:970\r\n#27 0x000000000084f0e8 in execute_ex (ex=<optimized out>) at /usr/local/services/php-7.1.1/Zend/zend_vm_execute.h:432\r\n#28 0x000000000089ab20 in zend_execute (op_array=0x7f15d8a84000, return_value=<optimized out>) at /usr/local/services/php-7.1.1/Zend/zend_vm_execute.h:474\r\n#29 0x00000000007f3b23 in zend_execute_scripts (type=8, retval=0x0, file_count=3) at /usr/local/services/php-7.1.1/Zend/zend.c:1474\r\n#30 0x0000000000794370 in php_execute_script (primary_file=0x7fffa53f51c0) at /usr/local/services/php-7.1.1/main/main.c:2537\r\n#31 0x000000000089de7a in do_cli (argc=2, argv=0x2de7c00) at /usr/local/services/php-7.1.1/sapi/cli/php_cli.c:993\r\n#32 0x000000000089e67a in main (argc=2, argv=0x2de7c00) at /usr/local/services/php-7.1.1/sapi/cli/php_cli.c:1381\r\n```\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1641/comments",
    "author": "hello2t",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-05-23T10:56:36Z",
        "body": "Do not use `swoole_coroutine::writeFile ` outside the coroutines."
      }
    ]
  },
  {
    "number": 1633,
    "title": "WARNING sw_coro_create: exceed max number of coro 0",
    "created_at": "2018-05-18T12:04:17Z",
    "closed_at": "2018-05-24T07:15:30Z",
    "labels": [
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1633",
    "body": "I've succesfully build Swoole from master on Ubuntu 17.10 with PHP 7.2 (with php7.2-dev installed)\r\n\r\nUnfortunately, after connecting to the simplest Swoole HTTP server it throws error:\r\n\r\n`WARNING sw_coro_create: exceed max number of coro 0`\r\n\r\nIs it problem of the latest Swoole or PHP 7.2 ?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1633/comments",
    "author": "gotzmann",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-05-20T03:01:26Z",
        "body": "What version of Swoole are you using (`php --ri swoole`)?\r\n"
      },
      {
        "user": "gotzmann",
        "created_at": "2018-05-21T10:23:53Z",
        "body": "```\r\nroot@tkln-dev:/home/tkln/swoole# php --ri swoole\r\n\r\nswoole\r\n\r\nswoole support => enabled\r\nVersion => 3.0.0-alpha\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\ntimerfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nasync http/websocket client => enabled\r\nLinux Native AIO => enabled\r\npcre => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => On => On\r\nswoole.use_shortname => On => On\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-05-24T07:15:30Z",
        "body": "This is a wrong unusable version. Please use 2.2.0 or 4.0.0"
      },
      {
        "user": "jaredwu",
        "created_at": "2018-05-28T01:55:21Z",
        "body": "i have the same  problem，my php version is 7.2.2 & swoole version is 4.0.0-beta"
      }
    ]
  },
  {
    "number": 1631,
    "title": "子进程阻塞，发送信号导致退出问题",
    "created_at": "2018-05-17T11:14:40Z",
    "closed_at": "2018-05-20T02:59:07Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1631",
    "body": "1. What did you do? If possible, provide a recipe for reproducing the error.\r\n```php\r\n<?php\r\nswoole_process::signal(SIGCHLD, function ($sig) {\r\n    while ($process = swoole_process::wait(false)) {\r\n        var_dump($process);\r\n    }\r\n});\r\n\r\n$process = new swoole_process(function (swoole_process $process) {\r\n    swoole_process::signal(SIGUSR1, function ($signo) {\r\n        var_dump('Signal');\r\n    });\r\n\r\n    sleep(10); // 模拟阻塞\r\n    swoole_event_wait();\r\n}, false, true);\r\n\r\n$pid = $process->start();\r\n\r\nsleep(1);\r\n\r\nswoole_process::kill($pid, SIGUSR1);\r\nswoole_event_wait();\r\n```\r\n```\r\n$ php process.php\r\narray(3) {\r\n  [\"pid\"]=>\r\n  int(132241)\r\n  [\"code\"]=>\r\n  int(0)\r\n  [\"signal\"]=>\r\n  int(10)\r\n}\r\n^C\r\n```\r\n\r\n2. What did you expect to see?\r\n```\r\n子进程阻塞时,发送信号(SIGUSR1)会导致子进程退出。\r\n```\r\n\r\n3. What did you see instead?\r\n```\r\n当子进程阻塞时,发送信号(如: SIGUSR1、SIGUSR2)不会导致进程退出。\r\n```\r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n```\r\nswoole support => enabled\r\nVersion => 3.0.0-alpha\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\ntimerfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nasync http/websocket client => enabled\r\nopenssl => enabled\r\nhttp2 => enabled\r\nLinux Native AIO => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => On => On\r\nswoole.use_shortname => On => On\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n```\r\nPHP 7.2.5 (cli) (built: May 16 2018 02:20:51) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n```\r\n```\r\n[PHP Modules]\r\ncoordinate\r\nCore\r\ncurl\r\ndate\r\nhash\r\ninotify\r\njson\r\nopenssl\r\npcre\r\nposix\r\nReflection\r\nSPL\r\nssh2\r\nstandard\r\nswoole\r\nzlib\r\n\r\n[Zend Modules]\r\n\r\n```\r\n```\r\nCFLAGS=\"-O4 -g0 -I/usr/nghttp2/include\" CXXFLAGS=\"-O4 -g0\" LDFLAGS=\"-L/usr/nghttp2/lib\" LIBS=\"-lnghttp2\" ./configure --disable-all --enable-cli --disable-cgi --disable-phpdbg --enable-swoole-static --with-swoole --enable-timewheel --with-zlib=/usr/zlib --enable-openssl --with-openssl=/usr/openssl --with-ssh2=/usr/libssh2 --with-curl=/usr/curl --enable-http2 --enable-coordinate --enable-posix --enable-inotify --enable-hash --enable-json --enable-inline-optimization --with-config-file-path=/etc/php\r\n```\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n```\r\nopenssl-1.1.0h\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1631/comments",
    "author": "Alion548",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-05-20T02:59:07Z",
        "body": "这是因为`swoole`底层用了`signalfd`处理信号。一旦遇到阻塞，epoll 无法触发 signalfd 的 read，而底层操作系统的逻辑是如果在一定时间内没有处理信号，会直接使用默认信号处理的方式 kill 进程。\r\n\r\n如果你的程序是同步阻塞的，请使用 pcntl_signal 处理信号，并关闭 `signalfd`"
      }
    ]
  },
  {
    "number": 1626,
    "title": "mac 机  不管是 tcp websocket 还 http 都是报同一个错误ARNING sw_coro_create: exceed max number of coro 0",
    "created_at": "2018-05-15T23:21:25Z",
    "closed_at": "2018-05-24T07:17:44Z",
    "labels": [
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1626",
    "body": "最开始运行没有问题,但是今天后提示\r\n`ARNING sw_coro_create: exceed max number of coro 0`,开启是没有报错,只有用浏览器去访问时,才报错\r\n\r\n\r\n```\r\nswoole support => enabled\r\nVersion => 3.0.0-alpha\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\ncoroutine => enabled\r\nkqueue => enabled\r\nrwlock => enabled\r\nasync redis client => enabled\r\nasync http/websocket client => enabled\r\npcre => enabled\r\nzlib => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => On => On\r\nswoole.use_shortname => On => On\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1626/comments",
    "author": "idcpj",
    "comments": [
      {
        "user": "idcpj",
        "created_at": "2018-05-15T23:41:09Z",
        "body": "原先是 v3.0.0-alpha 版本 换成2.1.3 就可以了"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-05-24T07:17:44Z",
        "body": "请使用 2.2.0 或 4.0.0，3.0.0 版本已废弃不可用"
      }
    ]
  },
  {
    "number": 1621,
    "title": "when serialize swoole_table on php-7.2.5 && 1.x-lts , it will fatal error",
    "created_at": "2018-05-14T08:47:58Z",
    "closed_at": "2018-05-15T03:21:38Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1621",
    "body": "\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\n```php\r\n<?php\r\necho serialize( new swoole_table( 1024 ) );\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\nIn php 5.6.30 is normal\r\nO:12:\"swoole_table\":0:{}\r\n\r\n3. What did you see instead?\r\n\r\nin php 7.2.5 is fatal error\r\nPHP Fatal error:  Uncaught swoole_exception: cannot serialize or unserialize. in Standard input code:2\r\nStack trace:\r\n#0 [internal function]: swoole_table->__sleep()\r\n#1 Standard input code(2): serialize(Object(swoole_table))\r\n#2 {main}\r\n  thrown in Standard input code on line 2\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\nswoole\r\n\r\nswoole support => enabled\r\nVersion => 1.10.4\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\nepoll => enabled\r\neventfd => enabled\r\ntimerfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nasync http/websocket client => enabled\r\nLinux Native AIO => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => Off => Off\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\nin 2.x-lts still fatal error\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n\r\nphp: 7.2.5\r\nkernel: 4.16.7-1.el7.elrepo.x86_64\r\ngcc: gcc-4.8.5-28.el7.x86_64\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\nopenssl-devel-1.0.2k-8.el7.x86_64\r\nopenssl-libs-1.0.2k-8.el7.x86_64\r\nopenssl-1.0.2k-8.el7.x86_64\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1621/comments",
    "author": "Luckyboys",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-05-14T11:42:05Z",
        "body": "So that is, it always can't be serialized."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-05-15T03:21:37Z",
        "body": "Table object cannot be serialized."
      }
    ]
  },
  {
    "number": 1602,
    "title": "swoole_server->addProcess 是否可以考虑支持 Process\\Pool ？",
    "created_at": "2018-05-08T07:08:15Z",
    "closed_at": "2018-05-15T03:10:36Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1602",
    "body": "When I want to use `addProcess` and `Process\\Pool` in the same time, this will throw an error\r\nIt's there any plan to support it in the `swoole_server->addProcess`?\r\nThis will help us to manage processes more comfortable\r\nOr this suggest is not reasonable?\r\n\r\n目前如果我想同时使用 `addProcess` 和 `Process\\Pool` 实际上是无法实现的\r\n可否有这样的计划？\r\n这样可以在一个应用下方便进行管理\r\n或者说这样其实是不合理的？",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1602/comments",
    "author": "HuangStomach",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-05-15T03:10:36Z",
        "body": "Process\\Pool 相当于是 Manager 的功能，本身 Swoole\\Server 已自带了。"
      },
      {
        "user": "HuangStomach",
        "created_at": "2018-05-15T09:40:31Z",
        "body": "也就是说如果我想利用`Swoole\\Server`来实现类似于`Process\\Pool`的功能，\r\n相当于其实可以指定一部分`work`去接收请求，另一部分可以为我处理其他的后台服务逻辑，如队列监听消费等功能？\r\n可以这么去理解使用吧"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-05-25T02:52:44Z",
        "body": "可以这样用。"
      },
      {
        "user": "HuangStomach",
        "created_at": "2018-05-25T03:24:54Z",
        "body": "多谢解答👍"
      }
    ]
  },
  {
    "number": 1601,
    "title": "swoole_table无法遍历",
    "created_at": "2018-05-07T12:49:01Z",
    "closed_at": "2018-05-24T09:39:53Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1601",
    "body": "```php\r\n<?php\r\n\r\n\r\n$table = new \\swoole_table(1024);\r\n\r\n\r\n$table->column('name', swoole_table::TYPE_STRING, 20);\r\n$table->column('age', swoole_table::TYPE_INT, 8);\r\n\r\n$table->create();\r\n\r\n$table->set(\"1\", [\"name\"=>\"abc1\",\"age\"=>11]);\r\n$table->set(\"2\", [\"name\"=>\"abc2\",\"age\"=>22]);\r\n$table->set(\"3\", [\"name\"=>\"abc3\",\"age\"=>33]);\r\n$table->set(\"4\", [\"name\"=>\"abc4\",\"age\"=>44]);\r\n\r\n\r\nvar_dump(count($table));\r\n//\r\nvar_dump($table);\r\n\r\nforeach ($table as $k => $v){\r\n    var_dump($v);\r\n}\r\n\r\n\r\n\r\n```\r\n输出结果：\r\n\r\nint(1)\r\nobject(swoole_table)#1 (2) {\r\n  [\"size\"]=>\r\n  int(1024)\r\n  [\"memorySize\"]=>\r\n  int(150704)\r\n}\r\nint(1024)\r\nint(150704)\r\n\r\n版本信息:\r\nphp7.0.30\r\nswoole1.10.3\r\n\r\n替换为swoole2.1.0 同样的结果 \r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1601/comments",
    "author": "monkey92",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-05-07T13:01:56Z",
        "body": "遍历Table 依赖pcre 如果发现无法遍历table,检查机器是否安装pcre-devel"
      },
      {
        "user": "monkey92",
        "created_at": "2018-05-07T13:30:50Z",
        "body": "@twose  \r\n\r\n系统是 ： ubuntu16.04 \r\n安装pcre-devel的命令:  sudo apt install libpcre3 libpcre3-dev \r\n\r\nphp扩展：\r\n\r\nPCRE (Perl Compatible Regular Expressions) Support | enabled\r\n-- | --\r\nPCRE Library Version | 8.38 2015-11-23\r\nPCRE JIT Support | enabled\r\n\r\nswoole 扩展:\r\n\r\n\r\nswoole support | enabled\r\n-- | --\r\nVersion | 2.1.0\r\nAuthor | tianfeng.han[email: mikan.tenny@gmail.com]\r\nepoll | enabled\r\neventfd | enabled\r\ntimerfd | enabled\r\nsignalfd | enabled\r\ncpu affinity | enabled\r\nspinlock | enabled\r\nrwlock | enabled\r\nasync http/websocket client | enabled\r\nLinux Native AIO | enabled\r\npcre | enabled\r\nzlib | enabled\r\nmutex_timedlock | enabled\r\npthread_barrier | enabled\r\nfutex | enabled\r\n\r\n\r\n同样的运行效果， swoole已经重新编译 ，php也重新编译， 还是无法遍历swoole_table.  是不是编译swoole的时候需要什么特殊的参数呢\r\n\r\n\r\n\r\n\r\n\r\n\r\n"
      },
      {
        "user": "twose",
        "created_at": "2018-05-07T14:16:13Z",
        "body": "没什么特殊需求的话把php升级到7.1及以上, swoole使用最新的release(如2.1.3)版本试试."
      }
    ]
  },
  {
    "number": 1600,
    "title": "HttpServer使用HTTP2时，document_root参数不生效",
    "created_at": "2018-05-07T12:15:01Z",
    "closed_at": "2018-05-24T07:33:09Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1600",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n---\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\n    我想创建HTTP2服务，可是Document_root参数不生效。\r\n```php\r\n<?php\r\n$http = new swoole_http_server('0.0.0.0', 443, SWOOLE_BASE, SWOOLE_SOCK_TCP | SWOOLE_SSL);\r\n\r\n$http->set([\r\n    'ssl_cert_file'         => '#SSL_Cert#',\r\n    'ssl_key_file'          => '#SSL_Key#',\r\n    'open_http2_protocol'   => true,\r\n    'document_root'         => __DIR__.'/../Public',\r\n    'enable_static_handler' => true,\r\n]);\r\n\r\n$http->on('request', function ($request, swoole_http_response $response) {\r\n    $response->status(404);\r\n    $response->end();\r\n});\r\n\r\n$http->start();\r\n```\r\n---\r\n2. What did you expect to see?\r\n    使用Chrome访问时，出现404错误(文件确实存在)，但去掉“open_http2_protocol”参数时可以正常访问。\r\n\r\n3. What did you see instead?\r\n    可以正常访问“Document_root”目录下指定文件。\r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n```\r\nswoole support => enabled\r\nVersion => 3.0.0-alpha\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\ntimerfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nasync http/websocket client => enabled\r\nopenssl => enabled\r\nhttp2 => enabled\r\nLinux Native AIO => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => On => On\r\nswoole.use_shortname => On => On\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n```\r\nPHP 7.2.5 (cli) (built: May  3 2018 16:36:17) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n```\r\n```\r\nCFLAGS=\"-O3 -g0 -I/usr/nghttp2/include\" CXXFLAGS=\"-O3 -g0\" LDFLAGS=\"-L/usr/nghttp2/lib\" LIBS=\"-lnghttp2\" ./configure --disable-all --enable-cli --disable-cgi --disable-phpdbg --enable-swoole-static --with-swoole --enable-timewheel --with-zlib=/usr/zlib --enable-openssl --with-openssl=/usr/openssl --with-ssh2=/usr/libssh2 --with-curl=/usr/curl --enable-http2 --enable-coordinate --enable-hash --enable-json --enable-inline-optimization --with-config-file-path=/etc/php\r\n```\r\n6. If you are using ssl, what is your openssl version?\r\n```\r\nnghttp2-1.31.1\r\nopenssl-1.1.0h\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1600/comments",
    "author": "Alion548",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-05-07T13:57:09Z",
        "body": "的确有此问题, 但不知道能不能定义为BUG, 应该是swoole在设计静态文件的时候就没有考虑HTTP2.\r\n逻辑上服务器开启HTTP2后, 底层收到浏览器消息会直接进入协议升级的协商逻辑中, 静态文件逻辑就被跳过了, 而且静态文件功能的实现也是HTTP1.1的.\r\n\r\n> swoole_http_server对Http协议的支持并不完整，建议仅作为应用服务器。并且在前端增加Nginx作为代理\r\n\r\n所以最后建议, 如果没有特殊需求, 前面再加个nginx作为代理更为合适."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-05-24T07:33:09Z",
        "body": "`Http2`暂时不支持静态文件处理器。"
      }
    ]
  },
  {
    "number": 1587,
    "title": "Swoole locks never work",
    "created_at": "2018-04-27T07:19:02Z",
    "closed_at": "2018-05-24T11:17:08Z",
    "labels": [
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1587",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n---\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n    A. Lock constants are not defined in swoole 3.0.0-alpha\r\n    ```\r\n    php -r \"echo SWOOLE_RWLOCK;\"\r\n    ```\r\n    ```\r\n    PHP Warning:  Use of undefined constant SWOOLE_RWLOCK - assumed 'SWOOLE_RWLOCK' (this will throw an Error in a future version of PHP) in Command line code on line 1\r\n    \r\n    Warning: Use of undefined constant SWOOLE_RWLOCK - assumed 'SWOOLE_RWLOCK' (this will throw an Error in a future version of PHP) in Command line code on line 1\r\n    ```\r\n\r\n    B. Locks not working:\r\n    ```\r\n    PHP Warning:  Swoole\\Lock::lock_read(): lock[type=3] can't use lock_read\r\n    ```\r\n2. What did you expect to see?\r\n    A. Constants should be defined.\r\n    B. Locks should be acquired in normal conditions.\r\n\r\n3. What did you see instead?\r\n    Errors!\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n    ```\r\n    swoole support => enabled\r\n    Version => 3.0.0-alpha\r\n    Author => tianfeng.han[email: mikan.tenny@gmail.com]\r\n    coroutine => enabled\r\n    cpu affinity => enabled\r\n    async http/websocket client => enabled\r\n    openssl => enabled\r\n    http2 => enabled\r\n    Linux Native AIO => enabled\r\n    zlib => enabled\r\n    futex => enabled\r\n    \r\n    Directive => Local Value => Master Value\r\n    swoole.aio_thread_num => 2 => 2\r\n    swoole.display_errors => On => On\r\n    swoole.use_namespace => On => On\r\n    swoole.use_shortname => On => On\r\n    swoole.fast_serialize => Off => Off\r\n    swoole.unixsock_buffer_size => 8388608 => 8388608\r\n    ```\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n    ```\r\n    uname -r\r\n    4.15.0-20-generic  Ubuntu 18.04\r\n    ```\r\n    ```\r\n    CFLAGS=\"-O3 -g0\" CXXFLAGS=\"-O3 -g0\" ./configure --disable-all --enable-cli --disable-cgi --disable-phpdbg --enable-swoole-static --with-swoole --with-zlib=/usr/zlib --enable-openssl --with-openssl=/usr/openssl --with-ssh2=/usr/libssh2 --with-curl=/usr/curl --enable-http2 --enable-coordinate --enable-json --enable-shmop --enable-inline-optimization --with-config-file-path=/etc/php\r\n    ```\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n    ```\r\n    openssl-1.1.0h\r\n    ```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1587/comments",
    "author": "Alion548",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-05-24T11:17:08Z",
        "body": "请单独编译`swoole.so`，集成编译可能某些检测失效了。未能检测到 `SWOOLE_RWLOCK`\r\n\r\ntype=3 表示为 `Mutex`，不支持`lock_read`"
      }
    ]
  },
  {
    "number": 1583,
    "title": "Segmentation fault 错误",
    "created_at": "2018-04-25T10:37:06Z",
    "closed_at": "2018-04-26T02:35:55Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1583",
    "body": "CentOS 6.9 x64 Kernel 4.4.127\r\nphp 7.1.16 with yac\r\nswoole 2.1.3\r\n\r\n\r\n\r\n下面是有效的调试信息\r\n\r\n(gdb) bt\r\n#0  0x00007fea2e0f595d in swShareMemory_mmap_create (object=0x7ffcc05f0950, size=2097248, mapfile=0x0)\r\n    at /opt/distfiles/php/swoole-src-2.1.3/src/memory/ShareMemory.c:122\r\n#1  0x00007fea2e0f56a5 in sw_shm_malloc (size=2097248) at /opt/distfiles/php/swoole-src-2.1.3/src/memory/ShareMemory.c:25\r\n#2  0x00007fea2e0f5e4e in swMemoryGlobal_new_page (gm=0x7ffcc05f0a10)\r\n    at /opt/distfiles/php/swoole-src-2.1.3/src/memory/MemoryGlobal.c:80\r\n#3  0x00007fea2e0f5d52 in swMemoryGlobal_new (pagesize=2097152, shared=1 '\\001')\r\n    at /opt/distfiles/php/swoole-src-2.1.3/src/memory/MemoryGlobal.c:51\r\n#4  0x00007fea2e0e8985 in swoole_init () at /opt/distfiles/php/swoole-src-2.1.3/src/core/base.c:64\r\n#5  0x00007fea2dff89fb in zm_startup_swoole (type=1, module_number=62) at /opt/distfiles/php/swoole-src-2.1.3/swoole.c:1024\r\n#6  0x0000000000a21478 in zend_startup_module_ex (module=0x27a6f50) at /opt/distfiles/php/php-7.1.16/Zend/zend_API.c:1843\r\n#7  0x0000000000a214da in zend_startup_module_zval (zv=0x2765510) at /opt/distfiles/php/php-7.1.16/Zend/zend_API.c:1858\r\n#8  0x0000000000a2f192 in zend_hash_apply (ht=0x14b10e0, apply_func=0xa214b7 <zend_startup_module_zval>)\r\n    at /opt/distfiles/php/php-7.1.16/Zend/zend_hash.c:1507\r\n#9  0x0000000000a21a9f in zend_startup_modules () at /opt/distfiles/php/php-7.1.16/Zend/zend_API.c:1969\r\n#10 0x0000000000988d00 in php_module_startup (sf=0x1488d80, additional_modules=0x0, num_additional_modules=0)\r\n    at /opt/distfiles/php/php-7.1.16/main/main.c:2300\r\n#11 0x0000000000af930f in php_cli_startup (sapi_module=0x1488d80) at /opt/distfiles/php/php-7.1.16/sapi/cli/php_cli.c:427\r\n#12 0x0000000000afb22a in main (argc=2, argv=0x2722070) at /opt/distfiles/php/php-7.1.16/sapi/cli/php_cli.c:1348\r\n(gdb) f 1\r\n#1  0x00007fea2e0f56a5 in sw_shm_malloc (size=2097248) at /opt/distfiles/php/swoole-src-2.1.3/src/memory/ShareMemory.c:25\r\n25          mem = swShareMemory_mmap_create(&object, size, NULL);\r\n(gdb) f 0\r\n#0  0x00007fea2e0f595d in swShareMemory_mmap_create (object=0x7ffcc05f0950, size=2097248, mapfile=0x0)\r\n    at /opt/distfiles/php/swoole-src-2.1.3/src/memory/ShareMemory.c:122\r\n122             swWarn(\"mmap(%ld) failed. Error: %s[%d]\", size, strerror(errno), errno);\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1583/comments",
    "author": "yxgong",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-04-25T10:45:10Z",
        "body": "请勿使用 ` --enable-hugepage` 编译参数"
      },
      {
        "user": "yxgong",
        "created_at": "2018-04-25T11:07:35Z",
        "body": "多谢啊，果然\r\n不用--enable-hugepage 全新编译后就解决了\r\n\r\n"
      }
    ]
  },
  {
    "number": 1579,
    "title": "swoole HTTP request_time和request_time_float 差很多",
    "created_at": "2018-04-24T12:49:32Z",
    "closed_at": "2018-04-25T02:17:13Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1579",
    "body": "发现request_time和request_time_float相差1s多。\r\n以下是两个请求捕捉到的：\r\n` \"server\": {\r\n            \"request_method\": \"GET\",\r\n            \"request_uri\": \"\\/\",\r\n            \"path_info\": \"\\/\",\r\n            \"request_time\": 1524570828,\r\n            \"request_time_float\": 1524570829.306582,\r\n            \"server_port\": 9501,\r\n            \"remote_port\": 52207,\r\n            \"remote_addr\": \"127.0.0.1\",\r\n            \"server_protocol\": \"HTTP\\/1.1\",\r\n            \"server_software\": \"swoole-http-server\"\r\n        }`\r\n\r\n   `     \"server\": {\r\n            \"request_method\": \"GET\",\r\n            \"request_uri\": \"\\/\",\r\n            \"path_info\": \"\\/\",\r\n            \"request_time\": 1524570823,\r\n            \"request_time_float\": 1524570824.304677,\r\n            \"server_port\": 9501,\r\n            \"remote_port\": 52206,\r\n            \"remote_addr\": \"127.0.0.1\",\r\n            \"server_protocol\": \"HTTP\\/1.1\",\r\n            \"server_software\": \"swoole-http-server\"\r\n        }`",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1579/comments",
    "author": "QQ2021",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-04-25T02:17:13Z",
        "body": "`request_time` 本身粒度为秒，因此可能存在 `1s` 误差值，正常的现象。`request_time` 仅作为宏观的数值，如记录用户请求的时间。不要作为程序性能分析的指标"
      }
    ]
  },
  {
    "number": 1577,
    "title": "swoole_event_cycle 的 bug",
    "created_at": "2018-04-23T04:39:55Z",
    "closed_at": "2018-04-23T10:10:11Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1577",
    "body": "```php\r\n<?php\r\n// 例1\r\n$server = new Swoole\\Server(\"127.0.0.1\", 9503);\r\n$server->set(['worker_num' => 1]);\r\n$server->on('workerstart', function($server)\r\n{\r\n    echo \"worker started\\n\";\r\n    $rs = swoole_event_cycle(function()\r\n    {\r\n        echo 'begin:'. microtime(1).\"\\n\";\r\n    });\r\n    var_dump($rs);\r\n});\r\n$server->on('receive', function ($server, $fd, $reactor_id, $data) {});\r\n$server->start();\r\n```\r\n\r\n例1：在 workerstart 事件中立即设置 `swoole_event_cycle` 不起任何作用，屏幕输出：\r\n\r\n```\r\nworker started\r\nbool(true)\r\n```\r\n\r\n-----------------------\r\n\r\n```php\r\n<?php\r\n// 例2\r\n$server = new Swoole\\Server(\"127.0.0.1\", 9503);\r\n$server->set(['worker_num' => 1]);\r\n$server->on('workerstart', function($server)\r\n{\r\n    echo \"worker started\\n\";\r\n    swoole_timer_after(1000, function()               // 加1个延迟\r\n    {\r\n        $rs = swoole_event_cycle(function() {\r\n            echo 'begin:' . microtime(1) . \"\\n\";\r\n        });\r\n        var_dump($rs);\r\n    });\r\n});\r\n$server->on('receive', function ($server, $fd, $reactor_id, $data) {});\r\n$server->start();\r\n```\r\n\r\n加一个 swoole_timer_after 延迟后，只执行了1次，输出：\r\n\r\n```\r\nworker started\r\nbool(true)\r\nbegin:1524457515.5541\r\n```\r\n\r\n以上在 mac: php 7.1.16, swoole 2.1.3; centos: php 7.1.3, swoole: 1.10.1 里测试都是一样，如果在没有任何 tcp 连接并且触发tcp数据时不会有触发，当使用 `telnet 127.0.0.1 9503` 连接服务器时，敲1次回车，服务端会输出一个 `begin:1524458359.5834` 这样的内容，表示被触发了1次。\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1577/comments",
    "author": "breath-co2",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-04-23T10:10:11Z",
        "body": "这并非 bug，如果没有任何事件，`EventLoop`是处于`wait`状态，自然`swoole_event_cycle`也不会执行。因为根本没有任何循环。"
      },
      {
        "user": "breath-co2",
        "created_at": "2018-05-17T06:11:17Z",
        "body": "@matyhtf 我觉得你说的不bug可以理解，但是它的执行和我之前的预期不一致，我本意是希望能够像 swoole_time_tick(1, $callback) 这样一直循环的快速执行一个方法 ，只要进程有空闲就要执行，然而现在的结果是，如果服务器没有任何事件（包括 socket 相应）它就处于休眠状态，等于假死了，这个还是有问题的。\r\n\r\n\r\n"
      }
    ]
  },
  {
    "number": 1559,
    "title": "swoole redis password",
    "created_at": "2018-04-10T18:29:46Z",
    "closed_at": "2018-04-11T06:37:24Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1559",
    "body": "How to set Redis Connection Password?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1559/comments",
    "author": "DrOctavius",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-04-11T06:37:24Z",
        "body": "```php\r\n$options['timeout'] = 1.5;\r\n$options['password'] = 'passwd';\r\n$options['database'] = 0;\r\n\r\n$client = new swoole_redis($options);\r\n$client->connect('127.0.0.1', 6379, function (swoole_redis $client, $result) {\r\n    echo \"connect\\n\";\r\n    $client->set('key', 'swoole', function (swoole_redis $client, $result) {\r\n        echo \"set key OK\\n\";\r\n    });\r\n});\r\n\r\n```"
      }
    ]
  },
  {
    "number": 1551,
    "title": "TCP Server onReceive wrong $data",
    "created_at": "2018-04-07T11:23:36Z",
    "closed_at": "2018-04-09T02:50:42Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1551",
    "body": " Please help. What can I do with it?\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\nClients:\r\n```php\r\n for( $i = 0; $i <=1; $i++) {\r\n            $client = new \\swoole_client(SWOOLE_SOCK_TCP, SWOOLE_SOCK_ASYNC);\r\n\r\n            $client->on(\"connect\", function($cli) use ($serial_number) {\r\n                $cli->send(\"Data\\r\\n\");\r\n            });\r\n\r\n            $client->on(\"receive\", function($cli, $data) use ($serial_number) {\r\n                echo \"Received: \".$data.' '.date(\"Y-m-d H:i:s\").\"\\r\\n\";\r\n            });\r\n\r\n            $client->on(\"error\", function($cli) use ($client){\r\n                echo \"Connect failed\\n\";\r\n            });\r\n\r\n            $client->on(\"close\", function($cli) use ($serial_number) {\r\n                echo \"Connection close\\n\";\r\n            });\r\n\r\n            $client->connect($ip, $port, 0.5);\r\n        }\r\n```\r\n\r\nServer (short)\r\n```php\r\n$server = new \\swoole_server($ip, $port, SWOOLE_BASE, SWOOLE_SOCK_TCP);\r\n        $server->set(array(\r\n            'task_worker_num'           =>4,\r\n            'worker_num'                => 4,\r\n            'debug_mode'                => 1,\r\n            'open_eof_check'           => true,\r\n            'package_eof'              => \"\\r\\n\",\r\n            'open_eof_split'           => true,\r\n        ));\r\n\r\n\r\n    public function onReceive(\\swoole_server $server, $fd, $from_id, $data )\r\n    {\r\n        var_dump($data);\r\n        echo \"Get Message From Client {$fd}:{$data}\\n\";\r\n    }\r\n```\r\n2. What did you expect to see?\r\n\r\n`string(6) \"Data\r\n\"`\r\n\r\n3. What did you see instead?\r\n\r\n`string(6) \"Data\r\n\"\r\nstring(6) \"Data\r\n\"`\r\n\r\n`string(6) \"string(6) \"Data\r\nData\r\n\"\r\n\"`\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\n 1.10.3\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\nphp  7.1.14\r\nmac os 10.13.4\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1551/comments",
    "author": "iihres",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-04-09T02:48:42Z",
        "body": "This is because multiple processes output the screen at the same time, You can write to file, or set worker_num to 1"
      },
      {
        "user": "iihres",
        "created_at": "2018-04-10T09:38:41Z",
        "body": "Thanks)"
      }
    ]
  },
  {
    "number": 1542,
    "title": "v1.10.3 开启 swoole-debug 模式  不生效",
    "created_at": "2018-03-28T10:17:02Z",
    "closed_at": "2018-03-30T07:44:09Z",
    "labels": [
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1542",
    "body": "如题",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1542/comments",
    "author": "abulo",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-03-30T07:44:09Z",
        "body": "请按照 issue 模板提交，现在 debug 和 trace 日志接受 log_level 控制。"
      }
    ]
  },
  {
    "number": 1538,
    "title": "Warning: Swoole\\Server::on(): Unknown event types[WorkerExit]",
    "created_at": "2018-03-24T02:20:16Z",
    "closed_at": "2018-03-24T02:51:18Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1538",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\n```PHP\r\n$swoole = new \\swoole_http_server('127.0.0.1', 52100, \\SWOOLE_PROCESS);\r\n$swoole->on('WorkerExit', function(){\r\n});\r\n$swoole->on('Request', function(){\r\n});\r\n$swoole->start();\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\nstart without this warning\r\n\r\n3. What did you see instead?\r\n`Warning: Swoole\\Server::on(): Unknown event types[WorkerExit] in xxx.php on line 4`\r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\nswoole\r\n\r\nswoole support => enabled\r\nVersion => 2.0.7\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\nepoll => enabled\r\neventfd => enabled\r\ntimerfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nasync http/websocket client => enabled\r\nLinux Native AIO => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => On => On\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n- `uname -a`: Linux e4ddd26a0eff 4.9.60-linuxkit-aufs #1 SMP Mon Nov 6 16:00:12 UTC 2017 x86_64 GNU/Linux\r\n- `cat /etc/issue`:  Debian GNU/Linux 8 \\n \\l\r\n- `php -v`: \r\nHP 5.6.32 (cli) (built: Nov  4 2017 11:29:44)\r\nCopyright (c) 1997-2016 The PHP Group\r\nZend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies\r\n    with Zend OPcache v7.0.6-dev, Copyright (c) 1999-2016, by Zend Technologies\r\n- `gcc -v`:\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/4.9/lto-wrapper\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Debian 4.9.2-10' --with-bugurl=file:///usr/share/doc/gcc-4.9/README.Bugs --enable-languages=c,c++,java,go,d,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.9 --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.9 --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-gnu-unique-object --disable-vtable-verify --enable-plugin --with-system-zlib --disable-browser-plugin --enable-java-awt=gtk --enable-gtk-cairo --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-4.9-amd64/jre --enable-java-home --with-jvm-root-dir=/usr/lib/jvm/java-1.5.0-gcj-4.9-amd64 --with-jvm-jar-dir=/usr/lib/jvm-exports/java-1.5.0-gcj-4.9-amd64 --with-arch-directory=amd64 --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --enable-objc-gc --enable-multiarch --with-arch-32=i586 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 4.9.2 (Debian 4.9.2-10)\r\n\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\nno ssl\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1538/comments",
    "author": "hhxsv5",
    "comments": [
      {
        "user": "yoigo",
        "created_at": "2018-03-24T02:38:17Z",
        "body": "$swoole->set(['reload_async' => true]);"
      },
      {
        "user": "hhxsv5",
        "created_at": "2018-03-24T02:45:52Z",
        "body": "@yoigo Still get the warning message"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-03-24T02:48:25Z",
        "body": " Extension version is too low, please upgrade to the latest version"
      },
      {
        "user": "hhxsv5",
        "created_at": "2018-03-24T02:51:18Z",
        "body": "Thank you."
      }
    ]
  },
  {
    "number": 1537,
    "title": "1.10.2、2.1.1版swoole_websocket_server->on的BUG",
    "created_at": "2018-03-23T02:34:41Z",
    "closed_at": "2018-03-23T03:06:33Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1537",
    "body": "代码：\r\n```php\r\nclass Server extends \\swoole_websocket_server\r\n{\r\n\tpublic function __construct($ip, $port)\r\n\t{\r\n\t\tparent::__construct($ip, $port);\r\n\t\t$this->init();\r\n\t}\r\n\r\n\tprotected function init()\r\n\t{\r\n\t\t$this->on('open', [$this, '__open']);\r\n\t\t$this->on('message', [$this, '__message']);\r\n\t\t$this->on('close', [$this, '__close']);\r\n\t}\r\n\r\n\tprotected function __open($server, $request)\r\n\t{\r\n\t\techo \"server: handshake success with fd{$request->fd}\\n\";\r\n\t}\r\n\t\r\n\tprotected function __message($server, $frame)\r\n\t{\r\n\t\techo \"receive from {$frame->fd}:{$frame->data},opcode:{$frame->opcode},fin:{$frame->finish}\\n\";\r\n\t\t$this->push($frame->fd, \"this is server\");\r\n\t}\r\n\r\n\tprotected function __close($server, $fd)\r\n\t{\r\n\t\techo \"client {$fd} closed\\n\";\r\n\t}\r\n}\r\n```\r\n\r\n错误信息：\r\n\r\n> PHP Fatal error:  swoole_server_port::on(): Function 'Server::__close' is not callable in /xxx/Server.php on line 16\r\n\r\nopen和message没有问题，只有close有问题\r\n\r\n还有就是通过pecl无法更新到2.x版本，最新只有1.10.2",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1537/comments",
    "author": "Yurunsoft",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-03-23T03:06:33Z",
        "body": "**请所有事件回调函数设置为`public`**\r\n\r\n虽然另外两个事件回调设置成功了，但是这只是绕开了`swoole_websocekt_server::on`方法的检测，在回调这些函数时仍然可能遇到作用域的问题。\r\n\r\n`__close`设置未成功是因为需要调用`swoole_server_port::on`方法将回调函数设置到监听端口上，这个类和`swoole_websocekt_server`没有任何继承关系。"
      },
      {
        "user": "Yurunsoft",
        "created_at": "2018-03-23T03:08:31Z",
        "body": "明白了"
      }
    ]
  },
  {
    "number": 1529,
    "title": "addProcess under the SWOOLE_BASE mode",
    "created_at": "2018-03-19T07:08:56Z",
    "closed_at": "2018-03-23T06:48:27Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1529",
    "body": "```\r\n<?php \r\n$server = new swoole_server('127.0.0.1', 9501, SWOOLE_BASE);\r\n\r\n$process = new swoole_process(function($process) use ($server) {\r\n    while (true) {\r\n        $msg = $process->read();\r\n        foreach($server->connections as $conn) {\r\n            $server->send($conn, $msg);\r\n        }\r\n    }\r\n});\r\n\r\n$server->addProcess($process);\r\n\r\n$server->on('receive', function ($serv, $fd, $from_id, $data) use ($process) {\r\n   \r\n    $process->write($data);\r\n});\r\n\r\n$server->start();\r\n ?>\r\n```\r\ni use the telnet to send the data,  but  can't receive the same data,  the default mode SWOOLE_PROCESS  works fine. i don't know why, show me the right way, thanks",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1529/comments",
    "author": "RootYQ",
    "comments": [
      {
        "user": "RootYQ",
        "created_at": "2018-03-19T07:10:25Z",
        "body": "the version is 1.9.21"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-03-23T06:48:27Z",
        "body": "Please submit an issue in accordance with the issue template and post detailed environmental information.\r\n\r\nI guess your system may not have pcre, and so you cannot use the connections iterator.\r\n\r\nPlease use `php --ri swoole` to confirm  if `pcre => enabled` info is available\r\n\r\nexample\r\n---\r\n```shell\r\nphp --ri swoole\r\n\r\nswoole\r\n\r\nswoole support => enabled\r\nVersion => 1.10.2\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\nepoll => enabled\r\neventfd => enabled\r\ntimerfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nasync redis client => enabled\r\nasync http/websocket client => enabled\r\nsockets => enabled\r\nopenssl => enabled\r\nhttp2 => enabled\r\nLinux Native AIO => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-03-23T06:58:42Z",
        "body": "The server with BASE mode cannot use connections and send."
      }
    ]
  },
  {
    "number": 1527,
    "title": "Swoole not supported HTTP Client SSL SNI? (ssl handshake failure)",
    "created_at": "2018-03-18T03:38:36Z",
    "closed_at": "2018-03-19T10:59:40Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1527",
    "body": "Swoole not supported HTTP_Client SSL SNI?\r\n\r\nTest script:\r\n\r\n```\r\n<?php\r\n\r\n$domain = 'intoconsultoria.com';\r\n$ip = gethostbyname($domain);\r\n\r\n$cli = new swoole_http_client($ip, 443, true);\r\n\r\n$cli->set(array(\r\n    'timeout' => -1,\r\n    'debug_mode'=> 1,\r\n));\r\n\r\n$cli->setHeaders([\r\n    'Host' => $domain,\r\n    'cache-control' => 'no-cache',\r\n]);\r\n\r\n$cli->get('/', function ($cli) {\r\n    print_r($cli->body);\r\n});\r\n\r\n?>\r\n```\r\n\r\nOutput: WARNING swSSL_connect: SSL_connect() failed. Error: (null)[1]\r\n\r\nTest SSL with openssl (without SNI):\r\n```\r\nshell: openssl s_client -connect intoconsultoria.com:443\r\n\r\noutput: SSL routines:ssl3_read_bytes:tlsv1 alert internal error:ssl/record/rec_layer_s3.c:1399:SSL alert number 80\r\n```\r\n\r\nTest SSL with openssl (with SNI):\r\n\r\n```\r\nshell: openssl s_client -connect intoconsultoria.com:443 -servername intoconsultoria.com\r\n\r\nSsl test successfully.\r\n```\r\n\r\nHow to make swoole work properly with SSL-SNI?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1527/comments",
    "author": "emdfreeman",
    "comments": [
      {
        "user": "emdfreeman",
        "created_at": "2018-03-18T16:02:14Z",
        "body": "How to enable ssl_tls_sni in swoole?"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-03-19T06:56:56Z",
        "body": "Please set the `ssl_host_name` option.\r\n\r\n```php\r\n<?php\r\n\r\n$domain = 'intoconsultoria.com';\r\n$ip = gethostbyname($domain);\r\n\r\n$cli = new swoole_http_client($ip, 443, true);\r\n\r\n$cli->set(array(\r\n    'timeout' => -1,\r\n    'ssl_host_name' => $domain,\r\n    'debug_mode'=> 1,\r\n));\r\n\r\n$cli->setHeaders([\r\n    'Host' => $domain,\r\n    'cache-control' => 'no-cache',\r\n]);\r\n\r\n$cli->get('/', function ($cli) {\r\n    print_r($cli->body);\r\n});\r\n\r\n?>\r\n```"
      },
      {
        "user": "emdfreeman",
        "created_at": "2018-03-19T10:59:40Z",
        "body": "Thank you!\r\n\r\nP.S. I checked but with an error ('ssl_host_name' => 'https: /intoconsultoria.com',)"
      }
    ]
  },
  {
    "number": 1524,
    "title": "php的内部异常,在error_handle处理后,worker进程退出,不管是协程版本或非协程版本都是如此",
    "created_at": "2018-03-17T02:45:00Z",
    "closed_at": "2018-03-28T10:51:28Z",
    "labels": [
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1524",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n```php\r\n<?php\r\n\r\nset_error_handler('errorHandle');\r\n$http = new swoole_http_server(\"127.0.0.1\", 9501);\r\n\r\nfunction testWeb(\\Swoole\\Http\\Response $response)\r\n{\r\n    $response->header(\"Content-Type\", \"text/html\");\r\n    //内部异常\r\n    require 'ab.php';\r\n    //普通可捕获\r\n    //$a = $b;\r\n    //throw new \\Exception('aaa');\r\n    $response->end('<html>hello</html>');\r\n}\r\n\r\n$http->on(\"request\", function (\\Swoole\\Http\\Request $request, $response) {\r\n    try{\r\n        testWeb($response);\r\n    }catch (Exception $e){\r\n        echo 'e';\r\n    }catch (Throwable $t){\r\n        echo 't';\r\n    }finally{\r\n        echo 'f';\r\n    }\r\n});\r\n\r\nfunction errorHandle($errno, $errstr, $errfile, $errline)\r\n{\r\n    if (!(error_reporting() & $errno)) {\r\n        // This error code is not included in error_reporting, so let it fall\r\n        // through to the standard PHP error handler\r\n        return false;\r\n    }\r\n    /* Don't execute PHP internal error handler */\r\n    return true;\r\n}\r\n\r\n$http->start();\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n进程不应退出,不应该中断代码的执行,后果也是严重的,比如协程处理中断了\r\n\r\n3. What did you see instead?\r\n\r\n/usr/local/Cellar/php71/7.1.13_24/bin/php -dxdebug.remote_enable=1 -dxdebug.remote_mode=req -dxdebug.remote_port=9000 -dxdebug.remote_host=127.0.0.1 /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php\r\nPHP Fatal error:  require(): Failed opening required 'ab.php' (include_path='.:') in /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php on line 12\r\nPHP Stack trace:\r\nPHP   1. {main}() /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:0\r\nPHP   2. swoole_http_server->start() /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:40\r\nPHP   3. {closure:/Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:16-27}($request = *uninitialized*, $response = *uninitialized*) /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:40\r\nPHP   4. testWeb($response = *uninitialized*) /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:18\r\n\r\nFatal error: require(): Failed opening required 'ab.php' (include_path='.:') in /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php on line 12\r\n\r\nCall Stack:\r\n    0.0387     358592   1. {main}() /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:0\r\n    0.0463     362440   2. swoole_http_server->start() /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:40\r\n    3.5838     367992   3. {closure:/Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:16-27}(???, ???) /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:40\r\n    3.5839     367992   4. testWeb(???) /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:18\r\n\r\n[2018-03-17 10:43:15 *2497.0]\tERROR\tzm_deactivate_swoole (ERROR 503): Fatal error: require(): Failed opening required 'ab.php' (include_path='.:') in /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php on line 12.\r\n[2018-03-17 10:43:15 $2496.0]\tWARNING\tswManager_check_exit_status: worker#0 abnormal exit, status=255, signal=0\r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\nswoole 1.10.1 2.1.1 ,2.0.12 \r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n\r\nmac\r\nphp 7.1.8\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1524/comments",
    "author": "tsingsun",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-03-24T17:07:59Z",
        "body": "好险, 作为php萌新, 差点被这个问题迷惑了.\r\n这和swoole无关, 而且顺带require是有IO操作的.\r\n\r\n### Fatal error\r\n请把你的代码贴到php-cli中跑一下, 你会得到一个`Fatal error`.\r\n然后请看PHP官网文档\r\n> 以下级别的错误不能由用户定义的函数来处理： E_ERROR、 E_PARSE、 E_CORE_ERROR、 E_CORE_WARNING、 E_COMPILE_ERROR、 E_COMPILE_WARNING，和在 调用 set_error_handler() 函数所在文件中产生的大多数 E_STRICT。\r\n\r\n----\r\n### 异常捕获的作用\r\n\r\n对于`进程不应退出,不应该中断代码的执行,后果也是严重的,比如协程处理中断了`这段话我也有不同的意见, 我认为严重的错误应该尽快解决风险而不是抑制它, 严重的错误抛出阻止代码执行是非常有必要的(如set_error_handler会使得代码继续运行,这很危险), 真正需要捕获并抑制的应该是由开发者(库)定义的各种exception或trigger_error和一些(预料中的)可忽视错误(对后续执行无威胁的).\r\n\r\n**我宁愿让服务宕机也不会让错误代码一直跑下去**\r\n\r\n\r\n并且在php官方文档中也有详细解释\r\n错误捕获自定义函数的用途\r\n>本函数可以用你自己定义的方式来处理运行中的错误， 例如，在应用程序中严重错误发生时，或者在特定条件下触发了一个错误(使用 trigger_error())，你需要对数据/文件做清理回收。\r\n并且\r\n>同时注意，在需要时你有责任使用 die()。 如果错误处理程序返回了，脚本将会继续执行发生错误的后一行。\r\n\r\n----\r\n### Swoole的exit\r\n比如在swoole,中途跳出业务逻辑层,实现php的exit效果\r\n```php\r\ntry{\r\n  // 代码又臭又长, 不能用if块来分割影响美观\r\n  if (命中缓存提前输出了, 后续代码不再执行){\r\n    throw new \\ExitException(); //我要退出啦\r\n  }\r\n // 慢查询\r\n // balabala\r\n} catch (\\ExitException $e){\r\n  // 出来啦\r\n} catch (\\Exception $e) {\r\n  // 向用户解释错误原因或者输出500\r\n} finally {\r\n   $response->end();\r\n}\r\n```\r\n----\r\n### 捕获严重错误\r\n\r\n然后, 这种级别的错误, 进程退出是合理且不可避免的, 如果你要做擦屁股处理, 需要用**register_shutdown_function()搭配error_get_last() 处理**, 送上简单的实现代码.\r\n\r\n```php\r\nfunction serializeTrace($traces):string {\r\n    $default_trace = [\r\n        'file'     => 'unknown',\r\n        'line'     => 0,\r\n        'function' => 'unknown'\r\n    ];\r\n    $r = '';\r\n    foreach ($traces as $i => $t) {\r\n        $t = $t + $default_trace;\r\n        $r .= \"#$i {$t['file']}({$t['line']}): \";\r\n        if (isset($t['object']) and is_object($t['object'])) {\r\n            $r .= get_class($t['object']).'->';\r\n        }\r\n        $r .= \"{$t['function']}()\\n\";\r\n    }\r\n    \r\n    return $r;\r\n}\r\n$shutdown_error_handle = function () {\r\n    $error = error_get_last();\r\n    if (!empty($error)) {\r\n        $log = \"Shutdown Error: [{$error['type']}] {$error['message']} \".\r\n            \"in {$error['file']}:{$error['line']}\\n\".\r\n            \"Stack trace:\";\r\n        $log .= serializeTrace(debug_backtrace());\r\n        $this->errorLog($log);\r\n    }\r\n};\r\nregister_shutdown_function($shutdown_error_handle);\r\n```"
      },
      {
        "user": "tsingsun",
        "created_at": "2018-03-26T15:08:50Z",
        "body": "很不幸, 这是swoole的缺陷,php本来有register_exception_handle+register_error_handle来处理各种类型的exception和error,但是swoole并不支持register_exception_handle,导致在处理环节中却了一环,并且这个error是无法被捕获,不可怕吗?由于协程的存在还放大了该问题,想像一下,在一次支付请求,由于某些不可捕获的error,导致进程中的请求全败了."
      },
      {
        "user": "twose",
        "created_at": "2018-03-26T16:43:14Z",
        "body": "@tsingsun \r\nswoole只是不能使用`set_exception_handler`, 但任意exception都可以用try捕获.\r\n因为你示例代码中贴出的`require错误`并不是`exception`而是一个`严重error`, 就算你在php-cli环境下运行也会异常退出而不能被捕获.\r\n而且我也贴了\r\n>以下级别的错误不能由用户定义的函数来处理： E_ERROR、 E_PARSE、 E_CORE_ERROR、 E_CORE_WARNING、 E_COMPILE_ERROR、 E_COMPILE_WARNING，和在 调用 set_error_handler() 函数所在文件中产生的大多数 E_STRICT。"
      },
      {
        "user": "twose",
        "created_at": "2018-03-26T16:52:18Z",
        "body": "@tsingsun 这是在普通的php环境下运行, 并没有任何捕获方法奏效, 只打印出了error_handle, 进程仍旧异常退出了后续代码也未执行.\r\n```php\r\n<?php\r\nset_error_handler(function () {\r\n    echo 'error_handle';\r\n    \r\n    return true;\r\n});\r\n\r\nset_exception_handler(function () {\r\n    echo 'exception_handle';\r\n    \r\n    return true;\r\n});\r\n\r\ntry {\r\n    require 'ab.php';\r\n} catch (Error $e) {\r\n    echo 'catch error';\r\n} catch (Exception $e) {\r\n    echo 'catch exception';\r\n} catch (Throwable $t) {\r\n    echo 'catch throwable';\r\n} finally {\r\n    echo 'finally';\r\n}\r\n```\r\n\r\n```bash\r\nPHP Fatal error:  require(): Failed opening required 'ab.php' (include_path='.:/usr/local/Cellar/php/7.2.3_3/share/pear') in /Users/twosee/Toast/test/error.php on line 21\r\nerror_handle\r\nFatal error: require(): Failed opening required 'ab.php' (include_path='.:/usr/local/Cellar/php/7.2.3_3/share/pear') in /Users/twosee/Toast/test/error.php on line 21\r\n\r\nProcess finished with exit code 255\r\n```"
      },
      {
        "user": "tsingsun",
        "created_at": "2018-03-27T12:52:44Z",
        "body": "@twose 从新看了php文档,你是对的,E_ERROR等异常会导致脚本中断,这样swoole能做的确实有限,但还是觉得进程退出的代价太大."
      }
    ]
  },
  {
    "number": 1521,
    "title": "Http Server 接收multipart/form-data空表单时出错，parse multipart body failed",
    "created_at": "2018-03-15T03:46:01Z",
    "closed_at": "2018-03-15T09:38:00Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1521",
    "body": "[/root/src/swoole-src-2.1.1/swoole_http_server.c:1092@http_onReceive]httpRequest 841 bytes:\r\n---------------------------------------\r\nPOST /api/test HTTP/1.1\r\nHost: localhost:9501\r\nConnection: keep-alive\r\nContent-Length: 44\r\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36\r\nCache-Control: no-cache\r\nOrigin: chrome-extension://aicmkgpgakddgnaphhhpliifpcfhicfo\r\nX-Postman-Interceptor-Id: 32b93ba5-9a80-bc01-578d-b9510e1eb71b\r\nPostman-Token: 0490ad54-c25c-c9b4-4626-d01312c86a40\r\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryhGypiC5Kk68My9Dk\r\nAccept: */*\r\nAccept-Encoding: gzip, deflate\r\nAccept-Language: zh-CN,zh;q=0.9,en;q=0.8\r\nCookie: vivo_cookie_unique_id=CgAAC1qZIC0SJH9qAwMFAg==; ab=WbQTKeMm_Pmc-KByo0_GId5rbKQ; Hm_lvt_a7471116b9007c038d41873ab9121a9e=1520907607; Hm_lpvt_a7471116b9007c038d41873ab9121a9e=1520907607\r\n\r\n------WebKitFormBoundaryhGypiC5Kk68My9Dk--\r\n\r\n\r\nPHP Fatal error:  Uncaught ErrorException: Unknown: parse multipart body failed. in Unknown:0\r\nStack trace:\r\n#0 [internal function]: Application->handleError(2, 'Unknown: parse ...', 'Unknown', 0, NULL)\r\n#1 {main}\r\n  thrown in Unknown on line 0\r\n[2018-03-15 11:39:01 *20898.0]  ERROR   zm_deactivate_swoole (ERROR 503): Fatal error: Uncaught ErrorException: Unknown: parse multipart body failed. in Unknown:0\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1521/comments",
    "author": "wengee",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-03-15T09:37:58Z",
        "body": "忽略此错误，POST 内容可能存在多余的字节。致命错误是因为 使用了 set_error_handler 导致了。"
      }
    ]
  },
  {
    "number": 1520,
    "title": "How create new process when parent process already set timer",
    "created_at": "2018-03-14T16:14:22Z",
    "closed_at": "2018-03-15T10:53:19Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1520",
    "body": "I know I should set timer when all child process created. \r\nBut, I want to catch `SIGCHLD` signal and create a new child process.\r\n```PHP\r\nSwoole\\Process::signal(SIGCHLD, function ($sig) {\r\n    while ($ret = Swoole\\Process::wait(false)) {\r\n        // create a new child process\r\n        $p = new Swoole\\Process('callback_function');\r\n        $p->start();\r\n    }\r\n});\r\n```\r\nThis new child process inherit parent timer ? \r\nHow can I avoid this problem ? \r\nClear timer in child process callback function ?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1520/comments",
    "author": "iyaozhen",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-03-15T09:46:04Z",
        "body": "Do not need to clear the parent process timer, the swoole extension will automatically clear the parent process timer & signal listener & event listener when the child process starts.\r\n\r\ndemo\r\n----\r\n```php\r\nfunction callback_function () {\r\n    Swoole\\Timer::after(10000, function () {\r\n        echo \"hello world\";\r\n    });\r\n};\r\n\r\nSwoole\\Timer::tick(1000, function () {\r\n    echo \"parent timer\\n\";\r\n});\r\n\r\nSwoole\\Process::signal(SIGCHLD, function ($sig) {\r\n    while ($ret = Swoole\\Process::wait(false)) {\r\n        // create a new child process\r\n        $p = new Swoole\\Process('callback_function');\r\n        $p->start();\r\n    }\r\n});\r\n\r\n// create a new child process\r\n$p = new Swoole\\Process('callback_function');\r\n$p->start();\r\n```"
      },
      {
        "user": "iyaozhen",
        "created_at": "2018-03-15T10:53:19Z",
        "body": "Thx\r\nI find you already update document. \r\n\r\n非常感谢韩老大解答"
      }
    ]
  },
  {
    "number": 1518,
    "title": "redis类能不能增加geo相关功能的支持",
    "created_at": "2018-03-14T11:16:54Z",
    "closed_at": "2018-03-14T11:31:43Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1518",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n现在的redis能不能增加geo（geoAdd，geoHash等）相关功能\r\n\r\n\r\n2. What did you expect to see?\r\n\r\nswoole的redis类能直接调用geo相关函数\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\n2.1.0\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\nlinux 3.10.0\r\nphp7.1\r\ngcc 4.8.5\r\n\r\n\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1518/comments",
    "author": "AngusZhang082",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-03-14T11:31:43Z",
        "body": "`2.1.2`版本增加了`Co\\Redis::request`方法，可以发送任意`Redis`指令"
      }
    ]
  },
  {
    "number": 1512,
    "title": "ERROR   zm_deactivate_swoole (ERROR 503): Fatal error: Uncaught RedisException: protocol error, got '",
    "created_at": "2018-03-08T10:07:11Z",
    "closed_at": "2018-03-16T02:11:29Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1512",
    "body": "' as reply type bytet RedisException: protocol error, got '\r\n in /meiktv/htdocs/www/meiktv_websocket/server.php:285\r\nStack trace:\r\n#0 /meiktv/htdocs/www/meiktv_websocket/server.php(285): Redis->get('39.106.5.170_fd...')\r\n#1 [internal function]: {closure}(Object(Swoole\\WebSocket\\Server), 1014, 0)\r\n#2 /meiktv/htdocs/www/meiktv_websocket/server.php(309): Swoole\\Http\\Server->start()\r\n#3 {main}\r\n  thrown in /meiktv/htdocs/www/meiktv_websocket/server.php on line 285\r\n' as reply type byte *15846.2]  ERROR   zm_deactivate_swoole (ERROR 503): Fatal error: Uncaught RedisException: protocol error, got '\r\n in /meiktv/htdocs/www/meiktv_websocket/server.php:285\r\nStack trace:\r\n#0 /meiktv/htdocs/www/meiktv_websocket/server.php(285): Redis->get('39.106.5.170_fd...')\r\n#1 [internal function]: {closure}(Object(Swoole\\WebSocket\\Server), 1014, 0)\r\n#2 /meiktv/htdocs/www/meiktv_websocket/server.php(309): Swoole\\Http\\Server->start()\r\n#3 {main}\r\n  thrown in /meiktv/htdocs/www/meiktv_websocket/server.php on line 28\r\n[2018-03-08 17:23:30 $9433.0]   WARNING swManager_check_exit_status: worker#2 abnormal exit, status=255, signal=0",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1512/comments",
    "author": "jianingguo",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-03-08T10:55:19Z",
        "body": "看起来是phpredis抛出的异常,试试看升级到最新版本或者在redis.conf里设置`protected-mode no`\r\n如果你的PHP代码有抛出异常逻辑，必须在事件回调函数顶层进行try/catch来捕获异常,否则进程会因为异常而退出.\r\n```php\r\n$serv->on('Receive', function() {\r\n    try\r\n    {\r\n        //some code\r\n    }\r\n    catch(Exception $e)\r\n    {\r\n        //exception code\r\n    }\r\n}\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-03-16T02:11:29Z",
        "body": "* 多进程勿公用一个redis连接，在onWorkerStart中创建redis\r\n* 捕获异常进行断线重连"
      }
    ]
  },
  {
    "number": 1511,
    "title": "每次swoole于后台运行都会产生数百兆的错误日志，内容完全一致",
    "created_at": "2018-03-06T12:13:50Z",
    "closed_at": "2018-03-07T02:06:01Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1511",
    "body": "#  PHP 7.0.27    swoole 2.1.0     \r\n这是后台日志的记录，每次都是从这里开始出错，后续全是一模一样的错误提示**“**NOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().****”\r\n\r\n\r\n具体代码见下面：\r\n```\r\nrequest from : \u001b[33m 101.226.162.90\u001b[0m and request for \u001b[32m /\u001b[m   ##[2018-03-06 13:52:02 #18476.0]\tNOTICE\tServer is shutdown now.\r\n[2018-03-06 13:52:02 *18519.0]\tERROR\tswReactorEpoll_del(:148): epoll remove fd[14#0] failed. Error: No such file or directory[2].\r\n[2018-03-06 13:52:02 *18520.1]\tERROR\tswReactorEpoll_del(:148): epoll remove fd[16#1] failed. Error: No such file or directory[2].\r\n[2018-03-06 13:52:02 *18521.2]\tERROR\tswReactorEpoll_del(:148): epoll remove fd[18#2] failed. Error: No such file or directory[2].\r\n[2018-03-06 13:52:02 *18522.3]\tERROR\tswReactorEpoll_del(:148): epoll remove fd[20#3] failed. Error: No such file or directory[2].\r\n[2018-03-06 13:52:02 *18523.4]\tERROR\tswReactorEpoll_del(:148): epoll remove fd[22#4] failed. Error: No such file or directory[2].\r\n[2018-03-06 13:52:02 *18524.5]\tERROR\tswReactorEpoll_del(:148): epoll remove fd[24#5] failed. Error: No such file or directory[2].\r\n[2018-03-06 13:52:02 *18525.6]\tERROR\tswReactorEpoll_del(:148): epoll remove fd[26#6] failed. Error: No such file or directory[2].\r\n[2018-03-06 13:52:02 *18526.7]\tERROR\tswReactorEpoll_del(:148): epoll remove fd[28#7] failed. Error: No such file or directory[2].\r\n[2018-03-06 15:09:01 *26025.7]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 15:09:01 *26024.6]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 15:09:01 *26023.5]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 15:09:01 *26021.3]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 15:09:01 *26019.1]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 15:09:01 *26018.0]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 15:09:01 #25977.0]\tWARNING\tswSignal_callback: signal[1] callback is null.\r\n[2018-03-06 15:09:01 #25977.0]\tWARNING\tswProcessPool_wait: [Manager]unknow worker[pid=-1]\r\n[2018-03-06 15:09:01 *26022.4]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 15:09:01 *26020.2]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 15:09:41 *26022.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26851.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26852.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26853.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26854.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26855.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26856.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26857.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26858.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26859.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26860.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26861.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26862.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26863.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26864.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26865.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26866.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26867.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26868.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26869.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26870.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26871.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26872.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26873.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26874.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26875.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26876.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26877.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26878.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26879.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26880.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26881.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26882.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26883.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26884.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26885.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26886.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26887.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26888.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26889.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26890.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 15:09:41 *26891.4]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n\r\n```\r\n\r\n```\r\n\r\n[2018-03-06 19:38:52 #25977.0]\tNOTICE\tServer is shutdown now.\r\n[2018-03-06 19:38:52 #25977.0]\tERROR\tswProcessPool_shutdown(:281): kill(1804) failed. Error: No such process[3].\r\n[2018-03-06 19:38:52 #25977.0]\tERROR\tswProcessPool_shutdown(:281): kill(16870) failed. Error: No such process[3].\r\n[2018-03-06 19:38:52 #25977.0]\tERROR\tswProcessPool_shutdown(:281): kill(30345) failed. Error: No such process[3].\r\n[2018-03-06 19:38:52 #25977.0]\tERROR\tswProcessPool_shutdown(:281): kill(11733) failed. Error: No such process[3].\r\n[2018-03-06 19:38:52 #25977.0]\tERROR\tswProcessPool_shutdown(:281): kill(15968) failed. Error: No such process[3].\r\n[2018-03-06 19:38:52 #25977.0]\tERROR\tswProcessPool_shutdown(:281): kill(7769) failed. Error: No such process[3].\r\n[2018-03-06 19:38:52 #25977.0]\tERROR\tswProcessPool_shutdown(:281): kill(22305) failed. Error: No such process[3].\r\n[2018-03-06 19:38:52 #25977.0]\tERROR\tswProcessPool_shutdown(:290): waitpid(1804) failed. Error: No child processes[10].\r\n[2018-03-06 19:38:52 #25977.0]\tERROR\tswProcessPool_shutdown(:290): waitpid(16870) failed. Error: No child processes[10].\r\n[2018-03-06 19:38:52 #25977.0]\tERROR\tswProcessPool_shutdown(:290): waitpid(30345) failed. Error: No child processes[10].\r\n[2018-03-06 19:38:52 #25977.0]\tERROR\tswProcessPool_shutdown(:290): waitpid(11733) failed. Error: No child processes[10].\r\n[2018-03-06 19:38:52 #25977.0]\tERROR\tswProcessPool_shutdown(:290): waitpid(15968) failed. Error: No child processes[10].\r\n[2018-03-06 19:38:52 #25977.0]\tERROR\tswProcessPool_shutdown(:290): waitpid(7769) failed. Error: No child processes[10].\r\n[2018-03-06 19:38:52 #25977.0]\tERROR\tswProcessPool_shutdown(:290): waitpid(22305) failed. Error: No child processes[10].\r\n[2018-03-06 20:12:26 *32249.7]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 20:12:26 *32248.6]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 20:12:26 *32247.5]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 20:12:26 *32246.4]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 20:12:26 *32245.3]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 20:12:26 *32239.2]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 20:12:26 *32238.1]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 20:12:26 *32237.0]\tWARNING\tswSignalfd_onSignal: signal[1] callback is null.\r\n[2018-03-06 20:12:26 #32196.0]\tWARNING\tswSignal_callback: signal[1] callback is null.\r\n[2018-03-06 20:12:26 #32196.0]\tWARNING\tswProcessPool_wait: [Manager]unknow worker[pid=-1]\r\n[2018-03-06 20:12:35 *32249.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32648.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32649.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32650.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32651.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32652.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32653.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32654.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32655.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32656.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32657.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32658.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32659.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32660.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32661.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32662.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n[2018-03-06 20:12:35 *32663.7]\tNOTICE\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n```\r\n代码里面没有exit/die代码，日志一般有10到100兆，多大时候500多兆，全是那段错误，起初以为是开启http2的问题，后来完全关闭http2也一样，实在解决不了了，恳请官方介入指导。",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1511/comments",
    "author": "15521956291",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-03-06T15:42:33Z",
        "body": "日志是因为worker进程退出后会被主进程不断拉起形成死循环,所以日志写爆\r\nsignal 13 表示 `SIGPIPE`，说明你的代码中有尝试向已关闭的 Socket 写入数据，底层会触发 `SIGPIPE` 信号，但你的代码中未设置此信号回调\r\n\r\n然后大家不能尽量按模板发issue么...贴个可复现的demo啥的最好啦."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-03-07T02:06:01Z",
        "body": "请勿在请求结束后使用 exit, die 退出进程"
      }
    ]
  },
  {
    "number": 1494,
    "title": "Swoole\\Async::writeFile内存泄漏问题",
    "created_at": "2018-02-22T06:12:09Z",
    "closed_at": "2018-02-23T10:04:46Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1494",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\n循环使用Swoole\\Async::writeFile写文件，php进程内存持续增加。\r\n示例代码：\r\n\r\n$str = str_repeat(\"===\", 1000);\r\nwhile (true) {\r\nSwoole\\Async::writeFile('/tmp/test_sync.log', $str, null, FILE_APPEND);\r\n   echo ( memory_get_peak_usage(true)/ 1024/1024) . \"\\n\";\r\n   usleep(1000);\r\n}\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\nswoole\r\n\r\nswoole support => enabled\r\nVersion => 2.0.10\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\nepoll => enabled\r\neventfd => enabled\r\ntimerfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nasync redis client => enabled\r\nasync http/websocket client => enabled\r\nLinux Native AIO => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => 1 => 1\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n\r\nPHP 7.1.9 (cli) (built: Sep 11 2017 18:23:04) ( NTS )\r\nCopyright (c) 1997-2017 The PHP Group\r\nZend Engine v3.1.0, Copyright (c) 1998-2017 Zend Technologies\r\n\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1494/comments",
    "author": "lgang06",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-02-23T10:04:46Z",
        "body": "使用方法存在问题，`while(true)`死循环后，无法切换到`EventLoop`，匿名回调函数对象和相关数据会持续累积。"
      }
    ]
  },
  {
    "number": 1489,
    "title": "Instantiate swoole_http_request and swoole_http_response",
    "created_at": "2018-02-13T08:21:52Z",
    "closed_at": "2018-02-24T10:11:47Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1489",
    "body": "I am trying to Instantiate response objects to write integration tests but I'm failing at seeing how to do it.\r\nOnce I try to manipulate the newly created object I get a warning.\r\n\r\nIs it possible to do it? I understand it's quite important for having end-to-end integration tests.\r\n\r\nMy attempt:\r\n```php\r\n$swooleResponse = new \\swoole_http_response();\r\n$swooleResponse->initHeader(['foo' => 'bar']);\r\n```\r\nI get\r\n```\r\nSwoole\\Http\\Response::initHeader(): Http request is finished.\r\n```\r\n\r\nRunning version\r\n```\r\nVersion => 2.1.0\r\n```\r\n\r\nThanks\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1489/comments",
    "author": "pachico",
    "comments": [
      {
        "user": "yangxikun",
        "created_at": "2018-02-22T11:10:56Z",
        "body": "swoole_http_request and swoole_http_response object just can be created by swoole_http_server::on('request', callback) when receive http request."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-02-24T10:11:47Z",
        "body": "The `swoole_http_response` object is created by the swoole extension,  do not create it in php code"
      },
      {
        "user": "pachico",
        "created_at": "2018-02-26T08:12:56Z",
        "body": "@matyhtf , this is hardly what I what I was asking.\r\nMy issue is not about if Swoole is able to create req/res objects but how to create them (yes, in PHP code) for functional tests.\r\nIt is a common practice to want to test an application starting from the request object or creating responses to test middlewares or parsers.\r\nIf you say it's not possible then I'd like to suggest it as a feature (especially because of some peculiarities I have found manipulating Swoole responses).\r\n"
      }
    ]
  },
  {
    "number": 1488,
    "title": "Worker not getting free on request completion",
    "created_at": "2018-02-12T12:47:41Z",
    "closed_at": "2018-08-03T15:37:20Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1488",
    "body": "I am using 5 workers while setting swoole server.It works for 5 request but after 5 request it is not working.\r\nFor first 5 request It is returning 404 when URL is incorrect but after 5 request It is returning 200 request.\r\n```php\r\n<?php\r\n\r\nclass HttpServer\r\n{\r\n\tpublic $http;\r\n\tpublic static $instance;\r\n\tpublic static $get;\r\n\tpublic static $post;\r\n\tpublic static $header;\r\n\tpublic static $server;\r\n\tpublic static $body;\r\n\tpublic $response = NULL;\r\n\tprivate $application;\r\n\r\n    public function __construct()\r\n    {\r\n\t\t$http = new Swoole\\Http\\Server('0.0.0.0', 9501);\r\n\t\t$http->set(['worker_num' => 5,'daemonize' => false, 'max_request' => 10, 'dispatch_mode' => 1]);\r\n        $http->on('WorkerStart', [$this, 'onWorkerStart']);\r\n        $http->on('request', function ($request, $response)\r\n\t\t{\r\n\t\t\t//catch the exception\r\n        \tregister_shutdown_function([$this, 'handleFatal']);\r\n            //request filtering\r\n            if ($request->server['path_info'] == '/favicon.ico' || $request->server['request_uri'] == '/favicon.ico')\r\n\t\t\t{\r\n                return $response->end();\r\n            }\r\n            $this->response = $response;\r\n\r\n\t\t\tif (isset($request->server))\r\n\t\t\t{\r\n                HttpServer::$server = $request->server;\r\n                foreach ($request->server as $key => $value)\r\n\t\t\t\t{\r\n                    $_SERVER[strtoupper($key)] = $value;\r\n                }\r\n            }\r\n            if (isset($request->header))\r\n\t\t\t{\r\n                HttpServer::$header = $request->header;\r\n            }\r\n\t\t\tif (!empty($request->rawContent()))\r\n\t\t\t{\r\n\t\t\t\tHttpServer::$body = json_decode($request->rawContent());\r\n            }\r\n            if (isset($request->get))\r\n\t\t\t{\r\n                HttpServer::$get = $request->get;\r\n                foreach ($request->get as $key => $value)\r\n\t\t\t\t{\r\n                \t$_GET[$key] = $value;\r\n                }\r\n            }\r\n            if (isset($request->post))\r\n\t\t\t{\r\n                HttpServer::$post = $request->post;\r\n                foreach ($request->post as $key => $value)\r\n\t\t\t\t{\r\n                    $_POST[$key] = $value;\r\n                }\r\n            }\r\n            ob_start();\r\n            try\r\n\t\t\t{\r\n\t\t\t\trequire_once __DIR__ . '/config/constant.php';\r\n\t\t\t\trequire_once __DIR__ . '/config/routes.php';\r\n            }\r\n\t\t\tcatch (Exception $e)\r\n\t\t\t{\r\n                var_dump($e);\r\n            }\r\n            $result = ob_get_contents();\r\n            ob_end_clean();\r\n\t\t\t$response->header('Content-Type',\"application/json; charset=UTF-8\");\r\n\t\t\t$response->end($result);\r\n            unset($result);\r\n        });\r\n        $http->start();\r\n    }\r\n\r\n    /**\r\n     * Fatal Error Capture.\r\n     */\r\n    public function handleFatal()\r\n    {\r\n        $error = error_get_last();\r\n        if (!isset($error['type']))\r\n\t\t{\r\n            return;\r\n        }\r\n        switch ($error['type'])\r\n\t\t{\r\n            case E_ERROR:\r\n            case E_PARSE:\r\n            case E_DEPRECATED:\r\n            case E_CORE_ERROR:\r\n            case E_COMPILE_ERROR:\r\n                break;\r\n            default:\r\n                return;\r\n        }\r\n        $message = $error['message'];\r\n        $file    = $error['file'];\r\n        $line    = $error['line'];\r\n        $log     = \"\\nAbnormal prompts: $message ($file:$line)\\nStack trace: \\n\";\r\n        $trace   = debug_backtrace(1);\r\n\r\n        foreach ($trace as $i => $t)\r\n\t\t{\r\n            if (!isset($t['file']))\r\n\t\t\t{\r\n                $t['file'] = 'unknown';\r\n            }\r\n            if (!isset($t['line']))\r\n\t\t\t{\r\n                $t['line'] = 0;\r\n            }\r\n            if (!isset($t['function']))\r\n\t\t\t{\r\n                $t['function'] = 'unknown';\r\n            }\r\n            $log .= \"#$i {$t['file']}({$t['line']}): \";\r\n            if (isset($t['object']) && is_object($t['object']))\r\n\t\t\t{\r\n                $log .= get_class($t['object']) . '->';\r\n            }\r\n            $log .= \"{$t['function']}()\\n\";\r\n        }\r\n        if (isset($_SERVER['REQUEST_URI']))\r\n\t\t{\r\n            $log .= '[QUERY] ' . $_SERVER['REQUEST_URI'];\r\n        }\r\n\r\n        if ($this->response)\r\n\t\t{\r\n            $this->response->status(500);\r\n            $this->response->end($log);\r\n        }\r\n        unset($this->response);\r\n    }\r\n\r\n    public function onWorkerStart()\r\n    {\r\n        require __DIR__ . '/vendor/autoload.php';\r\n    }\r\n\r\n    public static function getInstance()\r\n    {\r\n        if (!self::$instance)\r\n\t\t{\r\n            self::$instance = new self();\r\n        }\r\n        return self::$instance;\r\n    }\r\n}\r\nHttpServer::getInstance();\r\n```\r\n\r\nAbove class includes \r\n\r\n```php\r\n<?php\r\n\r\n\t$router = new AltoRouter();\r\n\t$router->map( 'POST', '/register/', function()\r\n\t{\r\n\t\trequire __DIR__ . '/../classes/controllers/UserController.php';\r\n\t\t$object = new UserController();\r\n\t\t$return = $object->register(HttpServer::$body);\r\n\t\tsetHeader($return);\r\n\t\tunset($object);\r\n\t});\r\n\r\n\t$router->map( 'POST', '/login/', function($request, $response)\r\n\t{\r\n\t\trequire __DIR__ . '/../classes/controllers/UserController.php';\r\n\t\t$object = new UserController();\r\n\t\t$return = $object->login();\r\n\t\tunset($object);\r\n\t});\r\n\r\n\t$router->map( 'POST', '/update/', function($request, $response)\r\n\t{\r\n\t\trequire __DIR__ . '/../classes/controllers/UserController.php';\r\n\t\t$object = new UserController();\r\n\t\t$return = $object->update();\r\n\t\tunset($object);\r\n\t});\r\n\r\n\t$router->map( 'GET', '/activate/', function($request, $response)\r\n\t{\r\n\t\trequire __DIR__ . '/../classes/controllers/UserController.php';\r\n\t\t$object = new UserController();\r\n\t\t$return = $object->activate();\r\n\t\tunset($object);\r\n\t});\r\n\r\n\t$router->map( 'PUT', '/forgot/', function($request, $response)\r\n\t{\r\n\t\trequire __DIR__ . '/../classes/controllers/UserController.php';\r\n\t\t$object = new UserController();\r\n\t\t$return = $object->forgot();\r\n\t\tunset($object);\r\n\t});\r\n\r\n\t$router->map( 'GET', '/reset/', function()\r\n\t{\r\n\t\trequire_once __DIR__ . '/../classes/controllers/UserController.php';\r\n\t\t$object = new UserController();\r\n\t\t$return = $object->reset();\r\n\t\tunset($object);\r\n\t});\r\n\r\n\t$router->map( 'GET', '/profile/', function($request, $response)\r\n\t{\r\n\t\trequire __DIR__ . '/../classes/controllers/UserController.php';\r\n\t\t$object = new UserController();\r\n\t\t$return = $object->profile();\r\n\t\tunset($object);\r\n\t});\r\n\r\n\t// match current request url\r\n\t$match = $router->match();\r\n\r\n\t// call closure or throw 404 status\r\n\tif( $match && is_callable( $match['target'] ) )\r\n\t{\r\n\t\tcall_user_func_array( $match['target'], $match['params'] );\r\n\t}\r\n\telse\r\n\t{\r\n\t\t// no route was matched\r\n\t\techo json_encode(['status' => 'error', 'code' => 404, 'msg' => 'The requested URL was not found on this server', 'data'=>NULL], JSON_UNESCAPED_UNICODE);\r\n\t}\r\n\r\n```\r\nfor routing but somehow for first 5 request it is returning 404 status code when no url is matched, which is normal but after 5 request it always returns 200.I hope I made my question clear.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1488/comments",
    "author": "mustanish",
    "comments": [
      {
        "user": "yangxikun",
        "created_at": "2018-02-22T10:56:23Z",
        "body": "I guess maybe there was a bug in your code, try 1 worker, and found out where the 200 response from."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-03-02T07:44:29Z",
        "body": "Do not call `register_shutdown_function` in the onRequest callback function. This will make unlimited memory growth.\r\n\r\nThere may be some global variables in your program that are not cleared after the request is completed"
      }
    ]
  },
  {
    "number": 1484,
    "title": "Post and decode posted Json in Swoole server",
    "created_at": "2018-02-09T12:44:06Z",
    "closed_at": "2018-03-01T05:49:10Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1484",
    "body": "Hi,\r\n\r\nI am using swoole to write APIs, some API get parameters in body in JSON format \r\n{\r\n    \"social_id\": \"error\",\r\n    \"social_platform\": 404,\r\n    \"email\": \"The requested URL was not found on this server\",\r\n    \"password\": \"The requested URL was not found on this server\",\r\n    \"gender\": \"The requested URL was not found on this server\",\r\n    \"full_name\": \"The requested URL was not found on this server\"\r\n    \"fcm_id\": \"The requested URL was not found on this server\",\r\n    \"vendor_id\": \"The requested URL was not found on this server\",\r\n}\r\nI am able fetch these parameters using rawContent() but when I am using json_decode function. It is not working.Does swoole does not support this feature.Thanks in advance.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1484/comments",
    "author": "mustanish",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-02-10T03:44:36Z",
        "body": "Paste the result of `rawContent` method, execute `json_last_error_msg` get more error info.\r\n"
      },
      {
        "user": "mustanish",
        "created_at": "2018-02-12T12:42:32Z",
        "body": "It was my mistake, Now it is working thanks."
      }
    ]
  },
  {
    "number": 1478,
    "title": "Swoole\\WebSocket\\Server startup and shutdown callback issue",
    "created_at": "2018-01-30T19:05:57Z",
    "closed_at": "2018-05-29T10:53:08Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1478",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\nI'm using swoole to write a service that needs to announce itself during startup and shutdown. This needs to happen before it starts accepting connections so the logical place would appear to be to do this in the start/shudown callbacks. However, when I attempt to use any of swoole's coroutine clients inside of the callbacks, I get an error:\r\n\r\n```\r\ncoroutine client should use under swoole server in onRequet, onReceive, onConnect callback.\r\n```\r\n\r\nWhen I attempt to wrap the function in a Swoole\\Coroutine, the coroutine client never executes:\r\n\r\n```\r\nSwoole\\Coroutine::create( function() {\r\n    $redis = new Swoole\\Coroutine\\Redis();\r\n    $redis->connect( 'localhost', 6379 );\r\n    $redis->publish( 'events', \"startup\" );\r\n    $redis->close();\r\n});\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\nI expect to be able to use a coroutine client inside a start/shutdown calback. I expect to at least be able to wrap a coroutine client in a coroutine to communicate the startup and shutdown events with service peers. I'd like to use a swoole supported method to do this. Otherwise, using swoole isn't an option if you need the ability to use network clients within the start/shutdown callbacks.\r\n\r\n3. What did you see instead?\r\n\r\nI either get an error or the coroutine client never executes.\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\nswoole\r\n\r\nswoole support => enabled\r\nVersion => 2.0.12\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\nkqueue => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nasync redis client => enabled\r\nasync http/websocket client => enabled\r\nopenssl => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => On => On\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n\r\nFreeBSD 10.3-RELEASE-p24\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\nn/a\r\n\r\n```\r\n<?php\r\n\r\nclass WSServer\r\n{\r\n    private $server;\r\n\r\n    //--------------------------------------------------------------------------------\r\n    // web socket callbacks\r\n    //\r\n\r\n    function wsockOpen( swoole_websocket_server $server, swoole_http_request $request )\r\n    {\r\n        echo \"sock#{$request->fd}: open\\n\";\r\n    }\r\n\r\n    function wsockClose( swoole_websocket_server $server, $fd )\r\n    {\r\n        echo \"sock#{$fd}: close\\n\";\r\n    }\r\n\r\n    function wsockMessage( swoole_websocket_server $server, $message )\r\n    {\r\n        echo \"sock#{$message->fd}: recv {$message->data}\\n\";\r\n    }\r\n\r\n    //--------------------------------------------------------------------------------\r\n    // server control callbacks\r\n    //\r\n\r\n    public function start( swoole_server $server )\r\n    {\r\n        echo \"starting up ...\\n\";\r\n\r\n        Swoole\\Coroutine::create( function() {\r\n            $redis = new Swoole\\Coroutine\\Redis();\r\n            $redis->connect( 'localhost', 6379 );\r\n            $redis->publish( 'events', \"startup\" );\r\n            $redis->close();\r\n        });\r\n    }\r\n\r\n    public function shutdown( swoole_server $server )\r\n    {\r\n        echo \"shutting down ...\\n\";\r\n\r\n        Swoole\\Coroutine::create( function() {\r\n            $redis = new Swoole\\Coroutine\\Redis();\r\n            $redis->connect( 'localhost', 6379 );\r\n            $redis->publish( 'events', \"shutdown\" );\r\n            $redis->close();\r\n        });\r\n    }\r\n\r\n    //--------------------------------------------------------------------------------\r\n    // server public functions\r\n    //\r\n\r\n    public function __construct( $daemonize = false )\r\n    {\r\n        $this->server = new Swoole\\WebSocket\\Server( \"0.0.0.0\", 9501, SWOOLE_BASE );\r\n\r\n        $this->server->on( 'open', array( $this, 'wsockOpen' ) );\r\n        $this->server->on( 'close', array( $this, 'wsockClose' ) );\r\n        $this->server->on( 'message', array( $this, 'wsockMessage' ) );\r\n\r\n        $this->server->on( 'start', array( $this, 'start' ) );\r\n        $this->server->on( 'shutdown', array( $this, 'shutdown' ) );\r\n\r\n        session_start();\r\n    }\r\n\r\n    public function run()\r\n    {\r\n        $this->server->start();\r\n    }\r\n}\r\n\r\n$server = new WSServer();\r\n$server->run();\r\n\r\n?>\r\n\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1478/comments",
    "author": "mgrooms",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-02-10T03:49:30Z",
        "body": "Cannot call any asynchronous API in onShutdown callback. when onShutdown trigger, the underlying has destroyed epoll handler."
      },
      {
        "user": "mgrooms",
        "created_at": "2018-02-12T17:57:19Z",
        "body": "The async APIs don't appear to work from within the onStarup callback either. Do you plan to change this in the future? It severely limits the utility of having startup and shutdown callback functions if you can't use swoole API calls from within those callbacks. The only other option I can think of would be to use curl or something similar from within the callbacks."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-02-28T08:33:11Z",
        "body": "The onStart callback is executed in the master process, If you executing too many asynchronous APIs, there will have many security risk."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-02-28T08:34:52Z",
        "body": "CURL synchronous blocking relatively simple, not much dependence, it is recommended in onStart and onShutdown use PHP's synchronous blocking IO function"
      }
    ]
  },
  {
    "number": 1476,
    "title": "msg\":\"Call to undefined method Swoole\\\\Coroutine\\\\Redis::setOption(),  Can support it?",
    "created_at": "2018-01-27T14:57:44Z",
    "closed_at": "2018-03-01T09:46:13Z",
    "labels": [
      "enhancement",
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1476",
    "body": "msg\":\"Call to undefined method Swoole\\\\Coroutine\\\\Redis::setOption(),  Can support it?\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1476/comments",
    "author": "jmt33",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-02-09T07:21:42Z",
        "body": "Which option do you want to set?\r\n"
      },
      {
        "user": "jmt33",
        "created_at": "2018-02-11T12:53:05Z",
        "body": "Redis::OPT_PREFIX"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-03-01T09:46:03Z",
        "body": "This option does not support, not the functionality provided by redis, you can use php code to implement"
      }
    ]
  },
  {
    "number": 1464,
    "title": "Stream Audio with Swoole ?",
    "created_at": "2018-01-23T10:44:27Z",
    "closed_at": "2018-05-30T06:12:31Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1464",
    "body": "Hi,\r\nis it possible to steam Audio with Swoole to create a Radio like stream ?\r\n\r\nServerside Playlist needs to know the current possition in a song , so that we can push metadata to clients at any time .\r\n\r\npossible ?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1464/comments",
    "author": "daslicht",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-05-30T06:12:22Z",
        "body": "Swoole is just a library of network communications.\r\nYou may also need to find the library of audio codecs"
      }
    ]
  },
  {
    "number": 1452,
    "title": "swoole_timer_tick定时器里面为什么接受不了退出信号",
    "created_at": "2018-01-17T07:51:53Z",
    "closed_at": "2018-01-18T11:07:57Z",
    "labels": [
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1452",
    "body": "```php\r\nfunction shutdown()\r\n{\r\n    echo PHP_EOL.'shutdown'.PHP_EOL;\r\n}\r\n\r\nregister_shutdown_function('shutdown');\r\n\r\n//使用ticks需要PHP 4.3.0以上版本\r\ndeclare(ticks = 1);\r\n\r\n//信号处理函数\r\nfunction sig_handler($signo)\r\n{\r\n    switch ($signo) {\r\n        case SIGTERM:\r\n            // 处理kill\r\n            echo PHP_EOL.'kill';\r\n            exit;\r\n            break;\r\n        case SIGHUP:\r\n            //处理SIGHUP信号\r\n            break;\r\n        case SIGINT:\r\n            //处理ctrl+c\r\n            echo PHP_EOL.'ctrl+c';\r\n            exit;\r\n            break;\r\n        default:\r\n            exit;\r\n            // 处理所有其他信号\r\n    }\r\n}\r\n\r\n//安装信号处理器\r\npcntl_signal(SIGTERM, \"sig_handler\");\r\npcntl_signal(SIGHUP,  \"sig_handler\");\r\npcntl_signal(SIGINT,  \"sig_handler\");\r\n$timer_id = swoole_timer_tick( 1*1000 , function($timer_id , $params) {\r\n    echo \"tick\";\r\n},\"xx\");\r\necho \"time\";\r\n```\r\n\r\n\r\n为什么以上程序ctl+c 退出不了了，只能强杀，while(1) 却是可以接受信号处理。",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1452/comments",
    "author": "batcom",
    "comments": [
      {
        "user": "mgrooms",
        "created_at": "2018-01-17T22:43:00Z",
        "body": "I've been fighting with this problem for about 2 days. Now. It's hard to trust swoole as a service platform if you can't shut it down correctly."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-01-18T11:07:57Z",
        "body": "`pcntl_signal`是同步阻塞的信号处理方式，与`swoole`底层的`EventLoop`存在冲突，纯异步的程序请使用`swoole_process::signal`\r\n\r\n示例\r\n----\r\n```php\r\nfunction shutdown()\r\n{\r\n    echo PHP_EOL.'shutdown'.PHP_EOL;\r\n}\r\n\r\nregister_shutdown_function('shutdown');\r\n\r\n//信号处理函数\r\nfunction sig_handler($signo)\r\n{\r\n    switch ($signo) {\r\n        case SIGTERM:\r\n            // 处理kill\r\n            echo PHP_EOL.'kill';\r\n            exit;\r\n            break;\r\n        case SIGHUP:\r\n            //处理SIGHUP信号\r\n            break;\r\n        case SIGINT:\r\n            //处理ctrl+c\r\n            echo PHP_EOL.'ctrl+c';\r\n            exit;\r\n            break;\r\n        default:\r\n            exit;\r\n            // 处理所有其他信号\r\n    }\r\n}\r\n\r\n//安装信号处理器\r\nswoole_process::signal(SIGTERM, \"sig_handler\");\r\nswoole_process::signal(SIGHUP,  \"sig_handler\");\r\nswoole_process::signal(SIGINT,  \"sig_handler\");\r\n$timer_id = swoole_timer_tick( 1*1000 , function($timer_id , $params) {\r\n    echo \"tick\";\r\n},\"xx\");\r\necho \"time\";\r\n```\r\n"
      }
    ]
  },
  {
    "number": 1449,
    "title": "register_shutdown_function函数对swoole_client的影响",
    "created_at": "2018-01-12T02:21:32Z",
    "closed_at": "2018-01-12T06:01:19Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1449",
    "body": "```\r\n<?php\r\n\r\nregister_shutdown_function(\"toexit\");\r\n\r\n$client = new swoole_client(SWOOLE_SOCK_TCP, SWOOLE_SOCK_ASYNC);\r\n$client->on(\"connect\", function($cli) {\r\n  echo \"connect\";\r\n\t\t\r\n});\r\n$client->on(\"receive\", function($cli, $data){\r\n        echo \"received: {$data}\\n\";\r\n});\r\n$client->on(\"error\", function($cli){\r\n        echo \"connect failed\\n\";\r\n});\r\n$client->on(\"close\", function($cli){\r\n        echo \"connection close\\n\";\r\n});\r\n\r\n$client->connect(\"ip\", 端口, 0.5);\r\n\r\nfunction toexit()\r\n{\r\n\t exit();\r\n}\r\n```\r\n\r\n应该能看到 输出 connect，\r\n\r\n\r\n但是其实没有任何输出，说明没有连接上服务器\r\n\r\n\r\nswoole版本如下\r\n\r\n```\r\nphp --ri swoole\r\n\r\nswoole\r\n\r\nswoole support => enabled\r\nVersion => 1.7.21-beta\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\nepoll => enabled\r\neventfd => enabled\r\ntimerfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nLinux Native AIO => enabled\r\nGcc AIO => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.message_queue_key => 0 => 0\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1449/comments",
    "author": "nanjixiong",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-01-12T06:01:19Z",
        "body": "请在 `$client->connect(\"ip\", 端口, 0.5);` 代码后面增加一行 `swoole_event_wait();`"
      }
    ]
  },
  {
    "number": 1442,
    "title": "Swoole\\Http\\Server swoole_http_server is same？",
    "created_at": "2018-01-09T05:48:19Z",
    "closed_at": "2018-05-30T05:55:38Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1442",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\n    I see use `Swoole\\Http\\Server` but not `swoole_http_server` in readme document.\r\n\r\n    It means i can use `Swoole\\Server` or `Swoole\\Client` too ? I want know how many class i can use by the namespace way.\r\n\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n    Changelog about this.\r\n\r\n3. What did you see instead?\r\n\r\n    none.\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\n    none.\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n\r\n    none.\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\n    none.\r\n\r\n\r\n\r\n\r\n  ",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1442/comments",
    "author": "godtail",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-01-09T05:49:37Z",
        "body": "Yes, `swoole_http_server` is an alias for `Swoole\\Http\\Server`"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-01-09T05:50:32Z",
        "body": "<table>\r\n<thead>\r\n<tr>\r\n<th>Class</th>\r\n<th>Alias</th>\r\n</tr>\r\n</thead>\r\n<tbody>\r\n<tr><td>swoole_server</td><td>Swoole\\Server</td></tr>\r\n<tr><td>swoole_client</td><td>Swoole\\Client</td></tr>\r\n<tr><td>swoole_process</td><td>Swoole\\Process</td></tr>\r\n<tr><td>swoole_timer</td><td>Swoole\\Timer</td></tr>\r\n<tr><td>swoole_table</td><td>Swoole\\Table</td></tr>\r\n<tr><td>swoole_lock</td><td>Swoole\\Lock</td></tr>\r\n<tr><td>swoole_atomic</td><td>Swoole\\Atomic</td></tr>\r\n<tr><td>swoole_buffer</td><td>Swoole\\Buffer</td></tr>\r\n<tr><td>swoole_redis</td><td>Swoole\\Redis</td></tr>\r\n<tr><td>swoole_event</td><td>Swoole\\Event</td></tr>\r\n<tr><td>swoole_mysql</td><td>Swoole\\MySQL</td></tr>\r\n<tr><td>swoole_mmap</td><td>Swoole\\Mmap</td></tr>\r\n<tr><td>swoole_channel</td><td>Swoole\\Channel</td></tr>\r\n<tr><td>swoole_serialize</td><td>Swoole\\Serialize</td></tr>\r\n<tr><td>swoole_http_server</td><td>Swoole\\Http\\Server</td></tr>\r\n<tr><td>swoole_http_client</td><td>Swoole\\Http\\Client</td></tr>\r\n<tr><td>swoole_http_request</td><td>Swoole\\Http\\Request</td></tr>\r\n<tr><td>swoole_http_response</td><td>Swoole\\Http\\Response</td></tr>\r\n<tr><td>swoole_websocket_server</td><td>Swoole\\WebSocket\\Server</td></tr>\r\n</tbody>\r\n</table>"
      },
      {
        "user": "godtail",
        "created_at": "2018-01-09T05:55:16Z",
        "body": "Thanks, It's excellent."
      },
      {
        "user": "twose",
        "created_at": "2018-01-09T08:11:17Z",
        "body": "| Class                      | Alias                           |\r\n| -------------------------- | ------------------------------- |\r\n| swoole_server              | Swoole\\\\Server                  |\r\n| swoole_timer               | Swoole\\\\Timer                   |\r\n| swoole_event               | Swoole\\\\Event                   |\r\n| swoole_async               | Swoole\\\\Async                   |\r\n| swoole_connection_iterator | Swoole\\\\Connection\\\\Iterator    |\r\n| swoole_exception           | Swoole\\\\Exception               |\r\n| swoole_atomic              | Swoole\\\\Atomic                  |\r\n| swoole_atomic_long         | Swoole\\\\Atomic\\\\Long            |\r\n| swoole_buffer              | Swoole\\\\Buffer                  |\r\n| swoole_channel             | Swoole\\\\Channel                 |\r\n| swoole_client              | Swoole\\\\Client                  |\r\n| swoole_client_coro         | Swoole\\\\Client                  |\r\n| swoole_http_client         | Swoole\\\\Http\\\\Client            |\r\n| swoole_http_client_coro    | Swoole\\\\Coroutine\\\\Http\\\\Client |\r\n| swoole_http_server         | Swoole\\\\Http\\\\Server            |\r\n| swoole_http_response       | Swoole\\\\Http\\\\Response          |\r\n| swoole_http_request        | Swoole\\\\Http\\\\Request           |\r\n| swoole_http2_client        | Swoole\\\\Http2\\\\Client           |\r\n| swoole_http2_response      | Swoole\\\\Http2\\\\Response         |\r\n| swoole_lock                | Swoole\\\\Lock                    |\r\n| swoole_mmap                | Swoole\\\\Mmap                    |\r\n| swoole_mysql               | Swoole\\\\MySQL                   |\r\n| swoole_mysql_exception     | Swoole\\\\MySQL\\\\Exception        |\r\n| swoole_process             | Swoole\\\\Process                 |\r\n| swoole_redis               | Swoole\\\\Redis                   |\r\n| swoole_redis_server        | Swoole\\\\Redis\\\\Server           |\r\n| swoole_serialize           | Swoole\\\\Serialize               |\r\n| swoole_server_port         | Swoole\\\\Server\\\\Port            |\r\n| swoole_table               | Swoole\\\\Table                   |\r\n| swoole_table_row           | Swoole\\\\Table\\\\Row              |\r\n| swoole_websocket_server    | Swoole\\\\WebSocket\\\\Server       |\r\n| swoole_websocket_frame     | Swoole\\\\WebSocket\\\\Frame        |\r\n\r\nreplace ```SWOOLE_CLASS_ALIAS\\(([\\w_]+), *\"([\\w\\\\]+)\"\\);``` to  ```|$1|$2|```\r\n\r\nit's full-fledged version.\r\nRango can consider completing Alias for coroutine Class."
      }
    ]
  },
  {
    "number": 1430,
    "title": "表字段是int,但swoole-mysql 查询出来的数据都是string ?",
    "created_at": "2017-12-26T04:04:54Z",
    "closed_at": "2017-12-26T06:15:49Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1430",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\n表字段是int,但swoole-mysql 查询出来的数据都是string ?\r\n\r\n2. What did you expect to see?\r\n\r\n\r\n\r\n3. What did you see instead?\r\n\r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\nswoole\r\n\r\nswoole support => enabled\r\nVersion => 2.0.9\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\nepoll => enabled\r\neventfd => enabled\r\ntimerfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nasync redis client => enabled\r\nasync http/websocket client => enabled\r\nLinux Native AIO => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => On => On\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n\r\nphp 7.1.x\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1430/comments",
    "author": "wuchuguang",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-12-26T06:15:49Z",
        "body": "MySQL 返回的就是字符串类型，你可以转为整型。"
      },
      {
        "user": "yunnian",
        "created_at": "2018-01-25T09:13:42Z",
        "body": "现在 增加了strict_type参数 ，可参考：#1468"
      }
    ]
  },
  {
    "number": 1429,
    "title": "swoole_http_client 抓取网站直接退出了",
    "created_at": "2017-12-25T05:44:48Z",
    "closed_at": "2017-12-26T03:21:47Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1429",
    "body": "比如下面这段代码,抓百度是可以的,但是stackoverflow就不行了\r\n\r\n```php\r\n<?php\r\n\r\nSwoole\\Async::dnsLookup(\"stackoverflow.com\", function ($domainName, $ip) {\r\n    var_dump($domainName);\r\n    $cli = new swoole_http_client($ip, 443, true);\r\n    $cli->setHeaders([\r\n        'Host' => $domainName,\r\n        \"User-Agent\" => 'Chrome/49.0.2587.3',\r\n        'Accept' => 'text/html,application/xhtml+xml,application/xml',\r\n        'Accept-Encoding' => 'gzip',\r\n    ]);\r\n    \r\n    $cli->get('/', function ($cli) {\r\n        echo \"Length: \" . strlen($cli->body) . \"\\n\";\r\n        //var_dump($cli);\r\n        //echo $cli->body;\r\n    });\r\n});\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1429/comments",
    "author": "jellychen",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-12-26T03:21:47Z",
        "body": "请按照 Issue 模板提交问题，描述不清晰，缺少必要的信息。\r\n\r\n我用你提供的代码执行，显示`-2`错误，表示响应超时。建议调大超时时间。\r\n\r\n```php\r\n$cli->set(['timeout' => 15]); //设置为 15 秒超时\r\n```"
      }
    ]
  },
  {
    "number": 1407,
    "title": "Swoole2.0.10 当在onMasterStart发起异步调用时服务无法启动",
    "created_at": "2017-12-05T09:14:06Z",
    "closed_at": "2017-12-05T09:41:43Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1407",
    "body": "版本环境： php7.1.7+swoole2.0.10.  \r\n\r\n启动：http server\r\n\r\n### 触发条件：\r\n\r\n在onMasterStart的回调中，调用swoole_client \r\n\r\n```$client = new \\swoole_client(SWOOLE_SOCK_TCP, SWOOLE_SOCK_ASYNC); //异步非阻塞\r\n\r\n        $data = $this->tafRequestBuf;\r\n        $client->on(\"connect\", function($cli) use ($data) {\r\n            $cli->send($data);\r\n        });\r\n\r\n        $client->on(\"receive\", function($cli, $data) {\r\n            $cli->close();\r\n        });\r\n\r\n        $client->on(\"error\", function($cli){\r\n\r\n        });\r\n\r\n        $client->on(\"close\", function($cli){\r\n\r\n        });\r\n\r\n        $client->connect($this->sIp, $this->iPort,$timeout);\r\n```\r\n\r\n\r\n### 产生结果：\r\n[2017-12-05 16:07:18 #5471.5]\tWARNING\tswTimer_init: cannot use timer in master and manager process.\r\n\r\n服务无法启动。\r\n\r\n在swoole2.0.7，同样php版本的情况下，启动、调用正常。\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1407/comments",
    "author": "meijing0114",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-12-05T09:41:39Z",
        "body": "目前`master`进程内是禁止执行任何`PHP`代码的（稳定性问题），可以使用`addProcess`添加一个自定义的进程，来实现相关的逻辑。"
      }
    ]
  },
  {
    "number": 1386,
    "title": "Fatal error: Swoole\\Server\\Port::set(): pacakge_eof max length is 8",
    "created_at": "2017-11-08T13:26:57Z",
    "closed_at": "2017-11-09T11:10:31Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1386",
    "body": "Swoole version: 1.9.21/22\r\nDocker Env!\r\n\r\nFatal error: Swoole\\Server\\Port::set(): pacakge_eof max length is 8",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1386/comments",
    "author": "designinlife",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-11-09T11:10:31Z",
        "body": "`EOF`字符串最大长度为`8`个字节。请检查你的设置"
      }
    ]
  },
  {
    "number": 1373,
    "title": "想问下swoole2.0使用的websocket协议版本",
    "created_at": "2017-10-23T09:09:34Z",
    "closed_at": "2017-12-05T07:09:00Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1373",
    "body": "当前在使用swoole2.0,但是在android的一个机型上，无法建立连接，估摸是websocket版本不支持的问题，不知道swoole2.0支持的是哪些websocket协议版本",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1373/comments",
    "author": "tcsp",
    "comments": [
      {
        "user": "kuofp",
        "created_at": "2017-10-24T04:22:37Z",
        "body": "目前大多建議使用13版本\r\n```c\r\n/*swoole_config.h*/\r\n#define SW_WEBSOCKET_VERSION             \"13\"\r\n```"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-12-05T07:09:00Z",
        "body": "默认握手协议版本为`13`，可自定义握手回调函数，支持更低版本的`WebSocket`协议。"
      }
    ]
  },
  {
    "number": 1366,
    "title": "swoole_process异步非阻塞模型下,某种情况父进程获取不到绑定的SIGCHLD信号,产生僵尸进程",
    "created_at": "2017-09-29T08:39:53Z",
    "closed_at": "2017-12-05T05:46:45Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1366",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n在提交Issue前请回答以下问题：\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n请详细描述问题的产生过程，贴出相关的代码，最好能提供可稳定重现的最小实例。\r\n\r\n//异步非阻塞\r\n```php\r\n$work_num = 10;\r\n$worker_func = function(swoole_process $worker)\r\n{\r\n\t$current_work = $GLOBALS['current_work'];\r\n\t$worker->name(\"sw: worker-{$current_work}\");\r\n\t//do something\r\n\tsleep(rand(1,3));\r\n};\r\n\r\n$master = new swoole_process(function(swoole_process $master)use($work_num,$worker_func){\r\n\tswoole_process::signal(SIGCHLD, function($signo) {\r\n  \t\twhile ($ret = swoole_process::wait(false)) {print_r($ret);}; \r\n\t});\r\n\t$master->name('sw: master');\r\n\t$workers_arr = [];\r\n\tfor ($i=0; $i < $work_num; $i++) { \r\n\t\t$worker = new swoole_process($worker_func,false,true);\r\n\t\t$GLOBALS['current_work'] = $i;\r\n\t\t$worker_id = $worker->start();\r\n\t\t$workers_arr[$worker_id] = $worker;\r\n\t}\r\n\t/****master do something start****/\r\n       //当$i<1000000000时无法获取绑定的SIGCHLD信号,当$i<1000000时正常\r\n       //是否是因为for while foreach为阻塞操作,信号捕捉timeout \r\n\tfor ($i=0; $i < 1000000000; $i++) { \r\n\t\t\r\n\t}\r\n\t/****master do something end****/\r\n\r\n},false,false);\r\n$master->start();\r\n```\r\n2. What did you expect to see?\r\n期望的结果是什么？\r\n\r\n父进程获取SIGCHLD信号,wait回收子进程.\r\n\r\n3. What did you see instead?\r\n实际运行的结果是什么？\r\n\r\n父进程获取不到SIGCHLD信号无法回收子进程,产生僵尸进程.\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n你所使用的Swoole版本号是什么（使用php --ri swoole可以获取）？\r\n\r\nVersion => 1.9.3\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n你使用的机器系统环境是什么（包括内核、PHP、gcc编译器版本信息）？\r\n\r\nPHP 5.6.20 (cli) (built: Jun  7 2016 20:21:12) \r\n\r\ngcc version 4.8.5 20150623 (Red Hat 4.8.5-4) (GCC) \r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1366/comments",
    "author": "mrwatcher",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-12-05T05:46:45Z",
        "body": "`swoole_process::signal` 是异步信号处理。你的代码中存在死循环，会导致`EventLoop`出现异常。需要修改程序使用同步阻塞模式，或移除死循环。"
      }
    ]
  },
  {
    "number": 1354,
    "title": "swoole client connect域名解析怎样可以不使用缓存",
    "created_at": "2017-09-20T04:03:01Z",
    "closed_at": "2017-09-22T11:04:25Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1354",
    "body": "\r\n`$swoole_cli = new \\swoole_client(SWOOLE_SOCK_TCP,SWOOLE_SOCK_SYNC);`\r\n`$swoole_cli->connect(\"example.com\", $port, $time_out)`\r\n第一次连接时example.com域名的IP地址为IP_ADDRESS_1，之后修改example.com的DNS解析为IP_ADDRESS_2，修改后无法连接，甚至在/etc/hosts文件中写死example.com的IP地址也不行。目前唯一解决办法只能重启应用，能否在不重启的情况下动态解析域名？",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1354/comments",
    "author": "mistypig",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-09-22T11:04:25Z",
        "body": "现在最新版的Swoole底层并没有缓存，可能是操作系统层面的机制。"
      }
    ]
  },
  {
    "number": 1350,
    "title": "websocket客户端没主动关闭的时候，getLastError没返回正确的错误码",
    "created_at": "2017-09-12T05:50:34Z",
    "closed_at": "2017-09-12T09:17:22Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1350",
    "body": "swoole版本：1.9.17\r\n操作系统：centos\r\n服务端是：websocket\r\n\r\n请问韩老师，当websocket客户端没主动关闭的时候，调用push对这个客户端发消息会出现报错信息，想通过getLastError获取错误码删除掉内存里面的这个无效FD，但是结果发现获得错误码为0没法处理业务逻辑。请问是否还有什么方法解决？\r\n\r\n```js\r\n// $server->push()后出现错误消息：\r\nPHP Warning:  swoole_websocket_server::push(): the connected client of connection[32] is not a websocket client. in /root/mega-filter/classes/Services/TextService.php on line 528\r\n\r\n// 通过$server->getLastError()获得错误码是0\r\n[2017-09-12 13:32:37.879][debug] - [WebSocket推送] 错误码:0\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1350/comments",
    "author": "imRainChen",
    "comments": [
      {
        "user": "imRainChen",
        "created_at": "2017-09-12T06:05:48Z",
        "body": "因为设置了dispatch_mode = 3可能是这个，导致出现这样的情况。"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-09-12T09:09:51Z",
        "body": "出现这个错误，表示连接不是WebSocket协议，但是正常的连接。"
      },
      {
        "user": "Manlinup",
        "created_at": "2019-07-09T01:24:20Z",
        "body": "task push 一直有这个问题。百度谷歌文档了很久都找不到原因。这个fd是通过赋值变量传到task进程中，然后通过这个fd,push到客户端就会报这个错误。如果在message中直接获取$frame->fd,直接push就是正确的。同样都是websocket客户端连接。不知道问题在哪里。"
      }
    ]
  },
  {
    "number": 1344,
    "title": "onWorkerStart回调里定时器投递task报错",
    "created_at": "2017-09-05T08:30:45Z",
    "closed_at": "2017-09-08T02:19:14Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1344",
    "body": "在http server的onWorkerStart回调里面开启一个定时器投递任务\r\n//最后一个worker处理启动定时器\r\n```php\r\nif ($workerId == $this->conf['worker_num'] - 1) {\r\n\t//启动定时器任务\r\n\t$timerId = swoole_timer_tick(100, function () {\r\n\t\t$server->task([]);\r\n\t});\r\n}\r\n```\r\n大概跑了118次后，触发WorkerError，然后worker进程不断报错和重启\r\n\r\nswoole.log里面的日志内容\r\n```shell\r\n[2017-09-05 16:21:30 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:21:42 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:21:54 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:22:05 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:22:17 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:22:29 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:22:41 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n```\r\n\r\ngdb 打印的core信息\r\n\r\nswoole1.9.18版本\r\n```shell\r\nProgram terminated with signal SIGSEGV, Segmentation fault.\r\n#0  zim_swoole_server_port___destruct (execute_data=0x7f2667013c70, return_value=<optimized out>) at /root/swoole-1.9.18/swoole_server_port.c:76\r\n76\t/root/swoole-1.9.18/swoole_server_port.c: 没有那个文件或目录.\r\n(gdb) bt\r\n#0  zim_swoole_server_port___destruct (execute_data=0x7f2667013c70, return_value=<optimized out>) at /root/swoole-1.9.18/swoole_server_port.c:76\r\n#1  0x000055d282be71d0 in zend_call_function (fci=fci@entry=0x7ffd7fb95ba0, fci_cache=fci_cache@entry=0x7ffd7fb95b70) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_execute_API.c:869\r\n#2  0x000055d282c15964 in zend_call_method (object=object@entry=0x7ffd7fb95c80, obj_ce=0x55d284146f90, fn_proxy=fn_proxy@entry=0x7ffd7fb95c78, function_name=function_name@entry=0x55d282ec0482 \"__destruct\", \r\n    function_name_len=function_name_len@entry=10, retval_ptr=retval_ptr@entry=0x0, param_count=0, arg1=0x0, arg2=0x0) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_interfaces.c:99\r\n#3  0x000055d282c30fc2 in zend_objects_destroy_object (object=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_objects.c:156\r\n#4  0x000055d282c21599 in zend_gc_collect_cycles () at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.c:1136\r\n#5  0x000055d282c20e0e in gc_possible_root (ref=0x7f265495ffc0) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.c:286\r\n#6  0x000055d282be5815 in gc_check_possible_root (z=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.h:149\r\n#7  i_zval_ptr_dtor (zval_ptr=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_variables.h:50\r\n#8  _zval_ptr_dtor (zval_ptr=zval_ptr@entry=0x7f26548fd330) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_execute_API.c:550\r\n#9  0x000055d282b3c198 in var_destroy (var_hashx=var_hashx@entry=0x7ffd7fb95e08) at /root/lnmp1.4-full/src/php-7.1.7/ext/standard/var_unserializer.c:234\r\n#10 0x000055d282b3c312 in php_var_unserialize_destroy (d=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/ext/standard/var_unserializer.c:53\r\n#11 0x00007f2665f9a3af in php_swoole_task_unpack (task_result=task_result@entry=0x7ffd7fb96160) at /root/swoole-1.9.18/swoole_server.c:314\r\n#12 0x00007f2665f9a6d0 in php_swoole_onFinish (serv=<optimized out>, req=0x7ffd7fb96160) at /root/swoole-1.9.18/swoole_server.c:840\r\n#13 0x00007f2665fe8b0e in swWorker_onTask (factory=factory@entry=0x55d2841879a8, task=task@entry=0x7ffd7fb96160) at /root/swoole-1.9.18/src/network/Worker.c:278\r\n#14 0x00007f2665fe8eb9 in swWorker_onPipeReceive (reactor=<optimized out>, event=0x7ffd7fb981d0) at /root/swoole-1.9.18/src/network/Worker.c:639\r\n#15 0x00007f2665fd8c0c in swReactorEpoll_wait (reactor=0x55d2841bc8c0, timeo=<optimized out>) at /root/swoole-1.9.18/src/reactor/ReactorEpoll.c:250\r\n#16 0x00007f2665fe9380 in swWorker_loop (factory=factory@entry=0x55d2841879a8, worker_id=worker_id@entry=3) at /root/swoole-1.9.18/src/network/Worker.c:597\r\n#17 0x00007f2665fe6b6b in swManager_spawn_worker (factory=0x55d2841879a8, worker_id=3) at /root/swoole-1.9.18/src/network/Manager.c:435\r\n#18 0x00007f2665fe71bc in swManager_start (factory=factory@entry=0x55d2841879a8) at /root/swoole-1.9.18/src/network/Manager.c:145\r\n#19 0x00007f2665fd5359 in swFactoryProcess_start (factory=0x55d2841879a8) at /root/swoole-1.9.18/src/factory/FactoryProcess.c:86\r\n#20 0x00007f2665fdd008 in swServer_start (serv=serv@entry=0x55d284187570) at /root/swoole-1.9.18/src/network/Server.c:686\r\n#21 0x00007f2665fb58a2 in zim_swoole_http_server_start (execute_data=0x7f2667013c20, return_value=0x7ffd7fb983f0) at /root/swoole-1.9.18/swoole_http_server.c:1561\r\n#22 0x000055d282c9961d in ZEND_DO_FCALL_SPEC_RETVAL_UNUSED_HANDLER () at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:970\r\n#23 0x000055d282c40dcb in execute_ex (ex=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:429\r\n#24 0x000055d282c9b5d8 in zend_execute (op_array=op_array@entry=0x7f2667083000, return_value=return_value@entry=0x7f26670f6120) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:474\r\n#25 0x000055d282bf7273 in zend_execute_scripts (type=1728133968, type@entry=8, retval=0x7f26670f6120, retval@entry=0x0, file_count=file_count@entry=3) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend.c:1476\r\n#26 0x000055d282b93a20 in php_execute_script (primary_file=0x7ffd7fb9aa10) at /root/lnmp1.4-full/src/php-7.1.7/main/main.c:2537\r\n```\r\n\r\n换了1.9.19版本\r\n```shell\r\nProgram terminated with signal SIGSEGV, Segmentation fault.\r\n#0  zim_swoole_server_port___destruct (execute_data=0x7f8745a13c70, return_value=<optimized out>) at /root/swoole-src-1.9.19/swoole_server_port.c:93\r\n93\t        if (property->caches[j])\r\n(gdb) bt\r\n#0  zim_swoole_server_port___destruct (execute_data=0x7f8745a13c70, return_value=<optimized out>) at /root/swoole-src-1.9.19/swoole_server_port.c:93\r\n#1  0x000056397ab471d0 in zend_call_function (fci=fci@entry=0x7fff99434cb0, fci_cache=fci_cache@entry=0x7fff99434c80) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_execute_API.c:869\r\n#2  0x000056397ab75964 in zend_call_method (object=object@entry=0x7fff99434d90, obj_ce=0x56397d3bc180, fn_proxy=fn_proxy@entry=0x7fff99434d88, function_name=function_name@entry=0x56397ae20482 \"__destruct\", \r\n    function_name_len=function_name_len@entry=10, retval_ptr=retval_ptr@entry=0x0, param_count=0, arg1=0x0, arg2=0x0) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_interfaces.c:99\r\n#3  0x000056397ab90fc2 in zend_objects_destroy_object (object=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_objects.c:156\r\n#4  0x000056397ab81599 in zend_gc_collect_cycles () at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.c:1136\r\n#5  0x000056397ab80e0e in gc_possible_root (ref=0x7f873339c578) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.c:286\r\n#6  0x000056397ab45815 in gc_check_possible_root (z=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.h:149\r\n#7  i_zval_ptr_dtor (zval_ptr=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_variables.h:50\r\n#8  _zval_ptr_dtor (zval_ptr=zval_ptr@entry=0x7f873332b330) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_execute_API.c:550\r\n#9  0x000056397aa9c198 in var_destroy (var_hashx=var_hashx@entry=0x7fff99434f18) at /root/lnmp1.4-full/src/php-7.1.7/ext/standard/var_unserializer.c:234\r\n#10 0x000056397aa9c312 in php_var_unserialize_destroy (d=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/ext/standard/var_unserializer.c:53\r\n#11 0x00007f8744996eef in php_swoole_task_unpack (task_result=task_result@entry=0x7fff99435270) at /root/swoole-src-1.9.19/swoole_server.c:371\r\n#12 0x00007f8744997230 in php_swoole_onFinish (serv=<optimized out>, req=0x7fff99435270) at /root/swoole-src-1.9.19/swoole_server.c:905\r\n#13 0x00007f87449e735e in swWorker_onTask (factory=factory@entry=0x56397d402d30, task=task@entry=0x7fff99435270) at /root/swoole-src-1.9.19/src/network/Worker.c:283\r\n#14 0x00007f87449e7709 in swWorker_onPipeReceive (reactor=<optimized out>, event=0x7fff994372e0) at /root/swoole-src-1.9.19/src/network/Worker.c:670\r\n#15 0x00007f87449d725c in swReactorEpoll_wait (reactor=0x56397d437a90, timeo=<optimized out>) at /root/swoole-src-1.9.19/src/reactor/ReactorEpoll.c:250\r\n#16 0x00007f87449e7bd0 in swWorker_loop (factory=factory@entry=0x56397d402d30, worker_id=worker_id@entry=3) at /root/swoole-src-1.9.19/src/network/Worker.c:628\r\n#17 0x00007f87449e52ab in swManager_spawn_worker (factory=0x56397d402d30, worker_id=3) at /root/swoole-src-1.9.19/src/network/Manager.c:437\r\n#18 0x00007f87449e58fc in swManager_start (factory=factory@entry=0x56397d402d30) at /root/swoole-src-1.9.19/src/network/Manager.c:145\r\n#19 0x00007f87449d3969 in swFactoryProcess_start (factory=0x56397d402d30) at /root/swoole-src-1.9.19/src/factory/FactoryProcess.c:86\r\n#20 0x00007f87449db667 in swServer_start (serv=serv@entry=0x56397d402900) at /root/swoole-src-1.9.19/src/network/Server.c:692\r\n#21 0x00007f87449b3582 in zim_swoole_http_server_start (execute_data=0x7f8745a13c20, return_value=0x7fff99437510) at /root/swoole-src-1.9.19/swoole_http_server.c:1578\r\n#22 0x000056397abf961d in ZEND_DO_FCALL_SPEC_RETVAL_UNUSED_HANDLER () at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:970\r\n#23 0x000056397aba0dcb in execute_ex (ex=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:429\r\n#24 0x000056397abfb5d8 in zend_execute (op_array=op_array@entry=0x7f8745a83000, return_value=return_value@entry=0x7f8745af6120) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:474\r\n#25 0x000056397ab57273 in zend_execute_scripts (type=1168194384, type@entry=8, retval=0x7f8745af6120, retval@entry=0x0, file_count=file_count@entry=3) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend.c:1476\r\n#26 0x000056397aaf3a20 in php_execute_script (primary_file=0x7fff99439b30) at /root/lnmp1.4-full/src/php-7.1.7/main/main.c:2537\r\n#27 0x000056397abfd84c in do_cli (argc=3, argv=0x56397d037f00) at /root/lnmp1.4-full/src/php-7.1.7/sapi/cli/php_cli.c:993\r\n#28 0x000056397a71e8d2 in main (argc=3, argv=0x56397d037f00) at /root/lnmp1.4-full/src/php-7.1.7/sapi/cli/php_cli.c:1381\r\n```\r\n\r\n系统版本\r\n```shell\r\nLinux kpc 4.8.0-59-generic #64-Ubuntu SMP Thu Jun 29 19:38:34 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\ngcc version 6.2.0 20161005 (Ubuntu 6.2.0-5ubuntu12) \r\n\r\nOpenSSL 1.0.2g  1 Mar 2016\r\nbuilt on: reproducible build, date unspecified\r\nplatform: debian-amd64\r\noptions:  bn(64,64) rc4(16x,int) des(idx,cisc,16,int) blowfish(idx) \r\ncompiler: cc -I. -I.. -I../include  -fPIC -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -m64 -DL_ENDIAN -g -O2 -fdebug-prefix-map=/build/openssl-eVLBIi/openssl-1.0.2g=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -Wl,-Bsymbolic-functions -Wl,-z,relro -Wa,--noexecstack -Wall -DMD32_REG_T=int -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM -DECP_NISTZ256_ASM\r\nOPENSSLDIR: \"/usr/lib/ssl\"\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1344/comments",
    "author": "kakuilan",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-09-07T08:39:35Z",
        "body": "感谢反馈，我会尽快确认一下。"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-09-07T08:46:42Z",
        "body": "无法重现你的问题。请使用 `USE_ZEND_ALLOC=0 valgrind php test.php` 运行你的代码。然后将`valgrind`打印的内存错误信息贴出来。"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-09-07T09:38:53Z",
        "body": "你是否把 server 作为任务参数发送了？"
      },
      {
        "user": "kakuilan",
        "created_at": "2017-09-08T01:50:41Z",
        "body": "代码如下\r\n```php\r\n<?php\r\n\r\nclass MyServer {\r\n\r\n    public $conf;\r\n    public $server;\r\n\r\n    public function __construct() {\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * 设置配置\r\n     * @param array $conf\r\n     */\r\n    public function setConf(array $conf) {\r\n        $this->conf = $conf;\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * 初始化服务\r\n     * @return $this\r\n     */\r\n    public function initServer() {\r\n\r\n        $this->server = new \\swoole_http_server('0.0.0.0', 6666);\r\n        $this->server->set($this->conf);\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * 启动服务\r\n     * @return $this\r\n     */\r\n    public function startServer() {\r\n        $this->server->on('Start', [$this, 'onStart']);\r\n        $this->server->on('WorkerStart', [$this, 'onWorkerStart']);\r\n        $this->server->on('WorkerStop', [$this, 'onWorkerStop']);\r\n        $this->server->on('WorkerError', [$this, 'onWorkerError']);\r\n        $this->server->on('Connect', [$this, 'onConnect']);\r\n        $this->server->on('Request', [$this, 'onRequest']);\r\n        $this->server->on('Close', [$this, 'onClose']);\r\n        $this->server->on('Task', [$this, 'onTask']);\r\n        $this->server->on('Finish', [$this, 'onFinish']);\r\n\r\n        echo(\"Service start success\\r\\n\");\r\n        $this->server->start();\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * 当服务器启动时[事件]\r\n     * @param object $serv swoole_server对象\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onStart($serv) {\r\n        echo \"Master Start...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * 当worker进程启动[事件]\r\n     * @param object $serv swoole_server对象\r\n     * @param int $workerId 从0-$worker_num之间的数字\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onWorkerStart($serv, $workerId) {\r\n        echo \"Worker Start:[{$workerId}]...\\r\\n\";\r\n\r\n        if ($workerId == 1) {\r\n            //启动定时器任务\r\n            $timerId = swoole_timer_tick(100, function () use($serv) {\r\n                echo \"timer tick \\r\\n\";\r\n                $serv->task([]);\r\n            });\r\n        }\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * 当worker进程停止[事件]\r\n     * @param object $serv swoole_server对象\r\n     * @param int $workerId 从0-$worker_num之间的数字\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onWorkerStop($serv, $workerId) {\r\n        echo \"Worker Stop:[{$workerId}]...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * 当worker进程发生异常时[事件]\r\n     * @param $serv\r\n     * @param $workerId\r\n     * @param $workerPid\r\n     * @param $exitCode\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onWorkerError($serv, $workerId, $workerPid, $exitCode) {\r\n        echo \"on WorkerError...\\r\\n\";\r\n        echo \"workerId[$workerId] workerPid[$workerPid] exitCode[$exitCode]\\r\\n\";\r\n        die;\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * 当有新的连接进入时[事件]\r\n     * @param object $serv swoole_server对象\r\n     * @param mixed $fd 连接的文件描述符,发送数据/关闭连接时需要此参数\r\n     * @param int $fromId 来自那个Reactor线程\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onConnect($serv, $fd, $fromId) {\r\n        echo \"new Connect:[{$fromId}]...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * 当有http请求时[事件]\r\n     * @param object $request 请求对象\r\n     * @param object $response 响应对象\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onRequest($request, $response) {\r\n        echo \"on Request...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * 当客户端连接关闭时[事件]\r\n     * @param object $serv swoole_server对象\r\n     * @param mixed $fd 连接的文件描述符,发送数据/关闭连接时需要此参数\r\n     * @param int $fromId 来自那个Reactor线程\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onClose($serv, $fd, $fromId) {\r\n        echo \"on Close:[{$fromId}]...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * 当任务被调用时[事件]\r\n     * @param object $serv swoole_server对象\r\n     * @param int $taskId 任务ID\r\n     * @param int $fromId 来自那个Reactor线程\r\n     * @param array $taskData 任务数据\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onTask($serv, $taskId, $fromId, $taskData) {\r\n        echo \"on Task...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * 当任务完成时[事件]\r\n     * @param object $serv swoole_server对象\r\n     * @param int $taskId 任务ID\r\n     * @param array $taskData 任务数据\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onFinish($serv, $taskId, $taskData) {\r\n        echo \"on Finish...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n}//end class\r\n\r\n\r\n$conf = [\r\n    //守护进程化\r\n    'daemonize' => 0,\r\n    //线程数,=CPU核数\r\n    'reactor_num' => 2,\r\n    //worker进程数,为CPU的1-4倍\r\n    'worker_num' => 4,\r\n    //worker进程的最大任务数\r\n    'max_request' => 1024,\r\n    //服务最大允许的连接数\r\n    'max_conn' => 1024,\r\n    //task进程的数量\r\n    'task_worker_num' => 5,\r\n    //task进程的最大任务数,0不限制\r\n    'task_max_request' => 1024,\r\n    //task的数据临时目录\r\n    'task_tmpdir' => '/tmp',\r\n    //数据包分发策略\r\n    'dispatch_mode' => 2,\r\n    //Listen队列长度\r\n    'backlog' => 128,\r\n    //指定swoole错误日志文件\r\n    'log_file' => '/tmp/swoole.log',\r\n    //日志级别\r\n    'log_level' => 0,\r\n    //启用心跳检测,每隔N秒轮循一次\r\n    'heartbeat_check_interval' => 5,\r\n    //表示连接最大允许空闲的时间,需要比heartbeat_check_interval大\r\n    'heartbeat_idle_time' => 10,\r\n\r\n    //打开包长检测\r\n    'open_length_check' => true,\r\n    //包长度值的类型\r\n    'package_length_type' => 'N',\r\n    //最大数据包尺寸\r\n    'package_max_length' => 2097152, //2M\r\n    'package_length_offset' => 0,\r\n    'package_body_offset' => 4,\r\n    //管道通信的内存缓存区长度\r\n    'pipe_buffer_size' => 33554432, //32M\r\n    //发送缓存区尺寸\r\n    'buffer_output_size' => 3145728, //3M\r\n\r\n    //立即发往客户端连接,提升响应速度\r\n    'open_tcp_nodelay' => 1,\r\n    //启用CPU亲和性设置\r\n    'open_cpu_affinity' => 1,\r\n    //设置端口重用\r\n    'enable_reuse_port' => 1,\r\n];\r\n$service = new MyServer();\r\n$service->setConf($conf)->initServer()->startServer();\r\n```\r\n\r\n执行 USE_ZEND_ALLOC=0 valgrind php test.php MyServer.php后返回\r\n==21254== Invalid read of size 8\r\n==21254==    at 0x1026F990: zim_swoole_server_port___destruct (swoole_server_port.c:93)\r\n==21254==    by 0x6701CF: zend_call_function (zend_execute_API.c:869)\r\n==21254==    by 0x69E963: zend_call_method (zend_interfaces.c:99)\r\n==21254==    by 0x6B9FC1: zend_objects_destroy_object (zend_objects.c:156)\r\n==21254==    by 0x6AA598: zend_gc_collect_cycles (zend_gc.c:1136)\r\n==21254==    by 0x6A9E0D: gc_possible_root (zend_gc.c:286)\r\n==21254==    by 0x5C5197: var_destroy (var_unserializer.c:234)\r\n==21254==    by 0x5C5311: php_var_unserialize_destroy (var_unserializer.c:53)\r\n==21254==    by 0x10268EEE: php_swoole_task_unpack (swoole_server.c:371)\r\n==21254==    by 0x1026922F: php_swoole_onFinish (swoole_server.c:905)\r\n==21254==    by 0x102B935D: swWorker_onTask (Worker.c:283)\r\n==21254==    by 0x102B9708: swWorker_onPipeReceive (Worker.c:670)\r\n==21254==  Address 0x1f8 is not stack'd, malloc'd or (recently) free'd\r\n==21254== \r\n==21254== \r\n==21254== Process terminating with default action of signal 11 (SIGSEGV): dumping core\r\n==21254==  Access not within mapped region at address 0x1F8\r\n==21254==    at 0x1026F990: zim_swoole_server_port___destruct (swoole_server_port.c:93)\r\n==21254==    by 0x6701CF: zend_call_function (zend_execute_API.c:869)\r\n==21254==    by 0x69E963: zend_call_method (zend_interfaces.c:99)\r\n==21254==    by 0x6B9FC1: zend_objects_destroy_object (zend_objects.c:156)\r\n==21254==    by 0x6AA598: zend_gc_collect_cycles (zend_gc.c:1136)\r\n==21254==    by 0x6A9E0D: gc_possible_root (zend_gc.c:286)\r\n==21254==    by 0x5C5197: var_destroy (var_unserializer.c:234)\r\n==21254==    by 0x5C5311: php_var_unserialize_destroy (var_unserializer.c:53)\r\n==21254==    by 0x10268EEE: php_swoole_task_unpack (swoole_server.c:371)\r\n==21254==    by 0x1026922F: php_swoole_onFinish (swoole_server.c:905)\r\n==21254==    by 0x102B935D: swWorker_onTask (Worker.c:283)\r\n==21254==    by 0x102B9708: swWorker_onPipeReceive (Worker.c:670)\r\n==21254==  If you believe this happened as a result of a stack\r\n==21254==  overflow in your program's main thread (unlikely but\r\n==21254==  possible), you can try to increase the size of the\r\n==21254==  main thread stack using the --main-stacksize= flag.\r\n==21254==  The main thread stack size used in this run was 8388608.\r\n==21254== \r\n==21254== HEAP SUMMARY:\r\n==21254==     in use at exit: 19,312,000 bytes in 112,056 blocks\r\n==21254==   total heap usage: 159,548 allocs, 47,492 frees, 36,081,415 bytes allocated\r\n==21254== \r\n==21254== LEAK SUMMARY:\r\n==21254==    definitely lost: 32 bytes in 1 blocks\r\n==21254==    indirectly lost: 2,048 bytes in 1 blocks\r\n==21254==      possibly lost: 11,013,714 bytes in 91,700 blocks\r\n==21254==    still reachable: 8,296,206 bytes in 20,354 blocks\r\n==21254==         suppressed: 0 bytes in 0 blocks\r\n==21254== Rerun with --leak-check=full to see details of leaked memory\r\n==21254== \r\n==21254== For counts of detected and suppressed errors, rerun with: -v\r\n==21254== Use --track-origins=yes to see where uninitialised values come from\r\n==21254== ERROR SUMMARY: 527 errors from 2 contexts (suppressed: 0 from 0)\r\n==21244== Warning: invalid file descriptor -1 in syscall write()\r\nopen(/tmp/swoole.log) failed. Error: Permission denied[13]write(log_fd, size=112) failed. Error: Bad file descriptor[9].\r\non WorkerError...\r\nworkerId[1] workerPid[21254] exitCode[0]\r\n==21244== Warning: invalid file descriptor -1 in syscall write()\r\nwrite(log_fd, size=119) failed. Error: Bad file descriptor[9].\r\n==21244== \r\n==21244== HEAP SUMMARY:\r\n==21244==     in use at exit: 1,355,388 bytes in 147 blocks\r\n==21244==   total heap usage: 55,939 allocs, 55,792 frees, 7,656,611 bytes allocated\r\n==21244== \r\n==21244== LEAK SUMMARY:\r\n==21244==    definitely lost: 1,052,056 bytes in 32 blocks\r\n==21244==    indirectly lost: 296,840 bytes in 65 blocks\r\n==21244==      possibly lost: 0 bytes in 0 blocks\r\n==21244==    still reachable: 6,492 bytes in 50 blocks\r\n==21244==         suppressed: 0 bytes in 0 blocks\r\n==21244== Rerun with --leak-check=full to see details of leaked memory\r\n==21244== \r\n==21244== For counts of detected and suppressed errors, rerun with: -v\r\n==21244== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)\r\n==21235== Warning: invalid file descriptor -1 in syscall write()\r\nwrite(log_fd, size=119) failed. Error: Bad file descriptor[9].\r\n\r\n\r\n\r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-09-08T02:19:14Z",
        "body": "请勿在 `onTask` 中 ` return $this;` ，否则 `swoole_server`对象作为 它的一个属性，底层会进行序列化和反序列化，发送给 `worker` 进程。\r\n最新版本的`swoole`已经禁止了对`swoole`对象序列化。\r\n"
      },
      {
        "user": "kakuilan",
        "created_at": "2017-09-08T02:23:59Z",
        "body": "好的，谢谢"
      }
    ]
  },
  {
    "number": 1334,
    "title": "协程swoole_async_dns_lookup方法",
    "created_at": "2017-08-24T08:20:03Z",
    "closed_at": "2017-08-24T09:21:03Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1334",
    "body": "峰哥你好：\r\n\r\n我想问下会提供dns协程查询方法么，swoole_async_dns_lookup这方法目前不知道怎么很好的和协程http client结合使用。",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1334/comments",
    "author": "stelin",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-08-24T09:21:03Z",
        "body": "使用`swoole_async_dns_lookup_coro`"
      }
    ]
  },
  {
    "number": 1328,
    "title": "worker由于重启.导致同一个worker_id触发的task,会在新的worker进程的onfinish触发,回调失败",
    "created_at": "2017-08-16T05:29:37Z",
    "closed_at": "2017-08-17T08:24:26Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1328",
    "body": "版本: `ubuntu 16.04 swoole 2.0.8`\r\n\r\n问题描述:\r\n在一个半异步的swoole_server种,设置了worker的max_request,如果某次worker设置了多个task之后重启了,task的onFinish会在新的worker进程中回调.导致部分数据失效\r\n\r\n可以复现的demo:\r\nserver:\r\n```php\r\n<?php\r\n\r\nclass SwooleServer{\r\n    private $serv;\r\n\r\n    private $task_res = [];\r\n    private $fd_list = [];\r\n\r\n    public function __construct() {\r\n        $this -> serv = new swoole_server('127.0.0.1', 9513);\r\n        $this -> serv -> set([\r\n            'worker_num' => 2,\r\n            'max_request' => 5,\r\n            'task_worker_num' => 4,\r\n            'task_max_request' => 10,\r\n\r\n            'open_eof_check' => true,\r\n            'package_eof' => \"\\r\\n\",\r\n            'open_eof_split' => true,\r\n\r\n            'dispatch_mode' => 3,\r\n        ]);\r\n\r\n        $this -> serv -> on('Receive', [$this, 'onReceive']);\r\n        $this -> serv -> on('Task', array($this, 'onTask'));\r\n        $this -> serv -> on('Finish', array($this, 'onFinish'));\r\n\r\n        $this -> serv -> start();\r\n    }\r\n\r\n    public function onReceive(swoole_server $serv, $fd, $from_id, $data) {\r\n        var_dump('recv: '.$fd);\r\n\r\n        $this -> fd_list[$fd] = trim($data);\r\n\r\n        $this -> task_res[$fd] = [];\r\n        for ($i=0;$i<3;$i++) {\r\n            $serv -> task([$fd, 'asdf']);\r\n        }\r\n    }\r\n\r\n    public function onTask(swoole_server $serv, $task_id, $from_id, $data) {\r\n        //模拟慢sql请求\r\n        mt_srand();\r\n        sleep(mt_rand(1,5)*0.1);\r\n        return [$data[0], 'abcdefg'];\r\n    }\r\n\r\n    public function onFinish(swoole_server $serv, $task_id, $data) {\r\n        var_dump($serv->worker_pid);\r\n        $fd = $data[0];\r\n        $this -> task_res[$fd][] = $data[1];\r\n        $done_count = count($this -> task_res[$fd]);\r\n        if ($done_count == 3) {\r\n            $fdinfo = $serv -> connection_info($fd);\r\n            if ($fdinfo) {\r\n                $ret_data = $this -> fd_list[$fd];\r\n                $serv -> send($fd, $ret_data.\"\\r\\n\");\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n$server = new SwooleServer();\r\n```\r\nclient:\r\n```php\r\n<?php\r\n\r\n$client = new swoole_client(SWOOLE_SOCK_TCP, SWOOLE_SOCK_SYNC); //同步阻塞\r\n$client -> set([\r\n    'open_eof_check' => true,\r\n    'package_eof' => \"\\r\\n\",\r\n]);\r\n\r\n$ret = $client->connect('127.0.0.1', 9513, 30, 0);\r\nif (!$ret) {\r\n    echo \"Connect Server fail.errCode=\".$client->errCode;\r\n    exit;\r\n}\r\n$client -> send(\"asdf\\r\\n\");\r\n$rev = $client -> recv();\r\necho $rev;\r\n$client -> close();\r\n```\r\n使用`ab`去并发请求数据,超过5次时候就会出现数据丢失:\r\n\r\n```\r\nPHP Notice:  Undefined offset: 19 in tests/worker_max_req.php on line 58\r\nstring(8) \"recv: 20\"\r\nint(3395)\r\nint(3395)\r\nint(3395)\r\nPHP Notice:  Undefined offset: 20 in tests/worker_max_req.php on line 58\r\n```\r\n\r\n如果worker执行了多次task之后就被重启了,导致task执行完了之后回调数据丢失\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1328/comments",
    "author": "zzjin",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-08-17T08:24:26Z",
        "body": "请在`onWorkerStop`时保存进程的状态，在`onWorkerStart`时进行恢复。"
      }
    ]
  },
  {
    "number": 1327,
    "title": "Swoole\\Coroutine协程问题",
    "created_at": "2017-08-14T03:55:09Z",
    "closed_at": "2017-08-14T09:00:49Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1327",
    "body": "峰哥你好:\r\n\r\n在使用过程中发现了这种场景，协程2.x下面这样使用的时候，如何在子协程里面获取onRequest的协程ID。这个ID,主要用于请求上下文的获取。\r\n\r\n```\r\npublic function onRequest(\\Swoole\\Http\\Request $request, \\Swoole\\Http\\Response $response)\r\n{\r\n\r\n    // 创建了一个子协程\r\n    \\Swoole\\Coroutine::create(function() {\r\n        // 子协程里面，怎么获取onRequest的协程ID\r\n    }\r\n}\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1327/comments",
    "author": "stelin",
    "comments": [
      {
        "user": "xyzhu1120",
        "created_at": "2017-08-14T07:41:26Z",
        "body": "目前还没有API直接获取父协程的id，可以父协程把自己的ID直接作为参数传进去。P.S. 可以描述一下具体场景吗？子协程里无法保证父协程还在或者当前请求还存活"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-08-14T09:00:49Z",
        "body": "```php\r\npublic function onRequest(\\Swoole\\Http\\Request $request, \\Swoole\\Http\\Response $response)\r\n{\r\n    $uid = Coroutine::getUid();\r\n    // 创建了一个子协程\r\n    \\Swoole\\Coroutine::create(function() use ($uid) {\r\n        // 子协程里面，怎么获取onRequest的协程ID\r\n    }\r\n}\r\n```"
      },
      {
        "user": "stelin",
        "created_at": "2017-08-14T09:04:04Z",
        "body": "@matyhtf 我试试"
      },
      {
        "user": "flyhope",
        "created_at": "2018-09-12T13:58:23Z",
        "body": "> 目前还没有API直接获取父协程的id，可以父协程把自己的ID直接作为参数传进去。P.S. 可以描述一下具体场景吗？子协程里无法保证父协程还在或者当前请求还存活\r\n\r\n通过官方文档的说明，通过Context根据uid保存全局数据，在子协程或孙子协程中使用的时候会用到，建议调用子协程回调时自动加入参数传递父协程及顶级协程的ID，或者提供相应的获取方法"
      }
    ]
  },
  {
    "number": 1326,
    "title": "我安装1.7.22时 make时error: conflicting types for       'clock_gettime'",
    "created_at": "2017-08-14T01:19:16Z",
    "closed_at": "2017-08-14T08:37:35Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1326",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n在提交Issue前请回答以下问题：\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n请详细描述问题的产生过程，贴出相关的代码，最好能提供可稳定重现的最小实例。\r\n按照1.7.22，make时报错\r\n\r\n```\r\nIn file included from ./php_swoole.h:41:\r\n/data/src/swoole-1.7.22/include/swoole.h:69:5: error: conflicting types for\r\n      'clock_gettime'\r\nint clock_gettime(clock_id_t which_clock, struct timespec *t);\r\n    ^\r\n/usr/include/time.h:177:5: note: previous declaration is here\r\nint clock_gettime(clockid_t __clock_id, struct timespec *__tp);\r\n    ^\r\n1 error generated.\r\nmake: *** [swoole.lo] Error 1\r\n```\r\n\r\n2. What did you expect to see?\r\n期望的结果是什么？\r\n正常make\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n你所使用的Swoole版本号是什么（使用php --ri swoole可以获取）？\r\nswoole版本1.7.22\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n你使用的机器系统环境是什么（包括内核、PHP、gcc编译器版本信息）？\r\nPHP5.5.16\r\nMac10.12.5\r\n\r\n请问如何解决，并不希望安装新版本。\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1326/comments",
    "author": "congjunwei",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-08-14T08:37:35Z",
        "body": "`1.7.22` 是较早期的版本，已经不再支持，你可以从最新的代码中对比差异，制作补丁。"
      }
    ]
  },
  {
    "number": 1321,
    "title": "mqtt,一次on receive会出现多个包连在一起的情况",
    "created_at": "2017-08-09T13:23:53Z",
    "closed_at": "2017-08-10T02:12:58Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1321",
    "body": "使用的是2.0.7版本的client 做mqtt客户端订阅。发现on receive的data 在并发情况下 会出现多个包连在一起在同一次on receive中返回的情况 会影响解析\r\n\r\n希望onReceive每次只返回一个完整的mqtt数据包",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1321/comments",
    "author": "jesusslim",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-08-10T02:12:58Z",
        "body": "2.0.8 和 1.9.17 已增加 Client Mqtt协议支持。"
      },
      {
        "user": "jesusslim",
        "created_at": "2017-08-10T05:28:30Z",
        "body": "确实 升到2.0.8就ok了 感谢"
      },
      {
        "user": "jesusslim",
        "created_at": "2017-10-17T01:49:27Z",
        "body": "目前是2.0.8版本 在并发量大的情况下偶尔会出现数据包分割的问题 正常情况下是每次onreceive到的是一个完整的包 但偶尔会出现这个包的长度不对 比自身长度多 导致解析出现问题 并且因为多了一些本来不属于这个包的字节 将会导致后续所有的包都产生问题 "
      }
    ]
  },
  {
    "number": 1317,
    "title": "TCP listener on websocket server not firing onReceive",
    "created_at": "2017-08-08T03:11:33Z",
    "closed_at": "2017-08-08T12:37:39Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1317",
    "body": "Hello!,\r\n\r\nSwoole: 1.9.17\r\nPHP: 7.0.18-0ubuntu0.16.04.1\r\n\r\nI'm trying to make a websocket server which also listens for TCP requests, here's my code\r\n\r\n```php\r\n$server = new swoole_websocket_server('0.0.0.0', 9501);\r\n\r\n$server->on('open', function ($serv, $request) {\r\n    echo 'open callback' . PHP_EOL;\r\n    $serv->push($request->fd, \"hello from server!\\n\");\r\n});\r\n\r\n$server->on('message', function ($serv, $frame) {\r\n    echo \"message: {$frame->data}\\n\";\r\n    $serv->push($frame->fd, \"server: {$frame->data}\");\r\n});\r\n\r\n$server->on('close', function ($serv, $fd) {\r\n    echo \"client-{$fd} is closed\\n\";\r\n});\r\n\r\n$tcp = $server->listen('0.0.0.0', 9502, SWOOLE_SOCK_TCP);\r\n\r\n$tcp->set([\r\n      'open_length_check' => true,\r\n      'package_length_type' => 'N',\r\n      'package_length_offset' => 0,\r\n      'package_max_length' => 800000,\r\n]);\r\n\r\n$tcp->on('connect', function ($serv, $fd, $from_id) {\r\n    echo 'connected callback' . PHP_EOL;\r\n});\r\n\r\n$tcp->on('receive', function ($serv, $fd, $from_id, $data) {\r\n    echo 'receive callback' . PHP_EOL;\r\n    var_dump($data);\r\n});\r\n\r\n$server->start();\r\n```\r\n\r\nThe websocket works fine but when I connect on the TCP endpoint I only get the 'connected callback' text but never receive actual data, not event the 'receive callback' is printed to the console.\r\n\r\nCan someone please point out what I'm doing wrong?\r\nThanks in advance!\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1317/comments",
    "author": "kenpb",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-08-08T03:21:39Z",
        "body": "Your program has enabled the length detection protocol, does the client send data according to the protocol?\r\n\r\nLike this:\r\n```php\r\n$client = new swoole_client(SWOOLE_SOCK_TCP);\r\nif (!$client->connect('127.0.0.1', 9502, -1))\r\n{\r\n    exit(\"connect failed. Error: {$client->errCode}\\n\");\r\n}\r\n$data = \"hello world\\n\";\r\n$client->send(pack('N', strlen($data)).$data);\r\nvar_dump($client->recv());\r\n$client->close();\r\n```\r\n\r\nAlso need to add the `package_body_offset` configuration item.\r\n```php\r\n$tcp->set([\r\n      'open_length_check' => true,\r\n      'package_length_type' => 'N',\r\n      'package_length_offset' => 0,\r\n      'package_max_length' => 800000,\r\n      'package_body_offset' => 4,\r\n]);\r\n```\r\n"
      }
    ]
  },
  {
    "number": 1300,
    "title": "在 linux 环境下 onRequest 回调函数加载不了其他类",
    "created_at": "2017-07-27T12:40:32Z",
    "closed_at": "2017-08-03T03:37:57Z",
    "labels": [
      "invalid",
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1300",
    "body": "gcc versin :gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.3) \r\nLinux ubuntu 4.4.0-31-generic #50~14.04.1-Ubuntu SMP Wed Jul 13 01:07:32 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\r\nphp:php-7.1.7\r\nswoole:2.0.7\r\n/usr/local/php/bin/php Webroot/launch/http.php  启动程序\r\n在 Mac 下能够正常加载, Linux 下就不能加载了\r\n\r\n程序已经发到 team@swoole.com ",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1300/comments",
    "author": "abulo",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-08-03T03:37:57Z",
        "body": "你的应用程序存在问题，检测错误日志。"
      }
    ]
  },
  {
    "number": 1299,
    "title": "swoole做RPC client端调用频繁发生8002或8009报错",
    "created_at": "2017-07-26T06:16:25Z",
    "closed_at": "2017-07-31T02:52:18Z",
    "labels": [
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1299",
    "body": "Swoole/Client/RPC.php\r\n`\r\n /**\r\n     * 尝试重连一次\r\n     */\r\n    for ($i = 0; $i < 2; $i++)\r\n    {\r\n        $ret = $socket->connect($host, $port, $this->timeout);\r\n        if ($ret === false and ($socket->errCode == 114 or $socket->errCode == 115))\r\n        {\r\n            //强制关闭，重连\r\n            $socket->close(true);\r\n            continue;\r\n        }\r\n        else\r\n        {\r\n            break;\r\n        }\r\n    }\r\n`\r\n$socket->errCode返回114，115\r\n\r\n请问这是什么原因\r\n ",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1299/comments",
    "author": "congjunwei",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-07-26T07:41:19Z",
        "body": "8002 表示连接失败，114/115 都表示连接超时了，你可以尝试把超时时间调大一些。\r\n8009 表示服务器关闭了连接，检查你的代码逻辑"
      },
      {
        "user": "congjunwei",
        "created_at": "2017-07-26T07:57:26Z",
        "body": "RPC.php里,\r\n$socket->connect($host, $port, $this->timeout)\r\n默认是timeout=0.5，我改成30了，观察已经没有114，115错误了，但是会\r\n88 （Socket operation on non-socket）\r\n"
      },
      {
        "user": "congjunwei",
        "created_at": "2017-07-27T03:43:24Z",
        "body": "swoole 扩展Version => 1.7.16"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-07-27T08:09:28Z",
        "body": "如果有条件更新版本，建议升级一下 1.9 最新版本。再来观察一下"
      },
      {
        "user": "congjunwei",
        "created_at": "2017-08-02T03:41:45Z",
        "body": "升级至v1.7.20后问题解决。"
      }
    ]
  },
  {
    "number": 1290,
    "title": "像在全局搞一个定时器，不跟随worker进程，可以吗",
    "created_at": "2017-07-21T02:49:51Z",
    "closed_at": "2017-07-21T06:46:23Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1290",
    "body": "像在全局搞一个定时器，不跟随worker进程，可以吗\r\nworker进程中的定时器会开启多个，有时候定时任务会被多次执行",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1290/comments",
    "author": "aizuyan",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-07-21T06:46:23Z",
        "body": "可以只在一个worker进程设置定时器。"
      }
    ]
  },
  {
    "number": 1287,
    "title": "not found swoole_redis",
    "created_at": "2017-07-17T09:36:12Z",
    "closed_at": "2017-07-18T02:42:48Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1287",
    "body": "PHP Fatal error:  Uncaught Error: Class 'swoole_redis' not found in",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1287/comments",
    "author": "chenyanlei",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-07-18T02:42:48Z",
        "body": "编译swoole需要增加`--enable-async-redis`"
      },
      {
        "user": "yangw1990",
        "created_at": "2017-08-14T19:23:58Z",
        "body": "PHP Warning:  PHP Startup: Unable to load dynamic library '/usr/lib64/php/modules/swoole.so' - libhiredis.so.0.13: cannot open shared object file: No such file or directory in Unknown on line 0\r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-08-15T03:37:52Z",
        "body": "安装 hiredis 库"
      },
      {
        "user": "cimoing",
        "created_at": "2017-11-15T09:24:49Z",
        "body": "我在阿里云服务器Centos6.9也遇到过这个情况，解决办法是在**/etc/ld.so.conf.d/** 目录下增加 **libc.conf**文件, 内容为\"/usr/local/lib\", 然后再执行教程中的安装过程。可同时解决无法加载libhiredis库的问题"
      },
      {
        "user": "landyli",
        "created_at": "2018-07-09T08:42:49Z",
        "body": "解决办法：\r\nmkdir /usr/lib/hiredis\r\ncp libhiredis.so /usr/lib/hiredis #将动态连接库libhiredis.so至/usr/lib/hiredis目录\r\nmkdir /usr/include/hiredis\r\ncp hiredis.h /usr/include/hiredis\r\necho '/usr/local/lib' >>/etc/ld.so.conf \r\nldconfig"
      }
    ]
  },
  {
    "number": 1281,
    "title": "swoole编译后运行提示symbol lookup error：undefined symbol: OPENSSL_init_ssl",
    "created_at": "2017-07-10T07:41:39Z",
    "closed_at": "2017-07-11T05:29:49Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1281",
    "body": "按照文档说明，phpize后，configure加上enable-openssl参数后，make && make install\r\n然后启动websocket server，提示symbol lookup error：undefined symbol: OPENSSL_init_ssl\r\n机器环境：centos、php7.0.1、swoole 1.9.14",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1281/comments",
    "author": "benlee7",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-07-11T05:29:49Z",
        "body": "openssl存在问题，使用`--with-openssl-dir`指定目录"
      }
    ]
  },
  {
    "number": 1270,
    "title": "协程mysql客户端",
    "created_at": "2017-07-04T08:58:32Z",
    "closed_at": "2017-07-04T09:22:40Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1270",
    "body": "最近在项目里使用协程Mysql客户端，有部分业务必须使用事务操作，但是目前没有支持事务，请问下，有后续增加计划么。",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1270/comments",
    "author": "stelin",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-07-04T09:22:39Z",
        "body": "在Swoole\\MySQL中执行下列SQL语句可以实现事务处理。\r\n\r\n启动事务：START TRANSACTION\r\n提交事务：COMMIT\r\n回滚事务：ROLLBACK"
      },
      {
        "user": "stelin",
        "created_at": "2017-07-04T13:46:10Z",
        "body": "明白怎么做了，谢谢峰哥！"
      }
    ]
  },
  {
    "number": 1268,
    "title": "wilcard in table (get, del)",
    "created_at": "2017-07-02T08:51:46Z",
    "closed_at": "2017-07-05T00:31:22Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1268",
    "body": "can use wilcard in table (get, del) ?\r\nexample :\r\n\r\n`server->table->get('cdef*');`\r\n\r\nor\r\n\r\n`server->table->del('*abcd');`\r\n\r\ncan enter this option? thanks!",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1268/comments",
    "author": "laurenti",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-07-05T00:31:22Z",
        "body": "Use the iterator to traverse the table.\r\n\r\n```php\r\nforeach($table as $key => $value) \r\n{\r\n    if (strpos($key, \"cdef\") !== false) {\r\n        //code\r\n    }\r\n}\r\n```"
      }
    ]
  },
  {
    "number": 1266,
    "title": "返回内容过长导致没法返回",
    "created_at": "2017-06-30T10:47:55Z",
    "closed_at": "2017-07-03T07:12:57Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1266",
    "body": "收到的报错信息如下\r\nWarning: swoole_http_response::end(): send 5122727 byte data fail, max_size is 2097152.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1266/comments",
    "author": "huangzhhui",
    "comments": [
      {
        "user": "lgang06",
        "created_at": "2017-06-30T16:00:07Z",
        "body": "看手册配置buffer_output_size"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-07-03T07:12:57Z",
        "body": "* 修改`buffer_output_size`设置\r\n* 使用`sendfile`接口发送大包"
      }
    ]
  },
  {
    "number": 1257,
    "title": "coroutine memory usage",
    "created_at": "2017-06-28T03:30:55Z",
    "closed_at": "2017-07-05T00:39:14Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1257",
    "body": "when a coroutine is created, zend vm stack is copied to coroutine stack while the heap memory is not copied. In golang a goroutine stack is 80K bytes. But how many bytes does swoole coroutine stack take?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1257/comments",
    "author": "gouchaoer",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-07-05T00:39:14Z",
        "body": "The swoole coroutine only save the PHP function call stack local variable.\r\nThe size of the memory is equal to the size of the local variable in the function call stack."
      }
    ]
  },
  {
    "number": 1255,
    "title": "addProcess 可否返回进程编号",
    "created_at": "2017-06-27T10:41:47Z",
    "closed_at": "2017-07-10T00:00:45Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1255",
    "body": "当前的返回值是BOOL, 希望能返回进程编号(etc, work_num+task_worker_num+<n>) ，更加方便\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1255/comments",
    "author": "jasonhe88",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-07-10T00:00:45Z",
        "body": "在 `addProcess` 时 可能并未调用 `set` ，因此无法得到 `worker_num` 和 `task_worker_num` 的值。这并不需要底层实现，你可以在应用层设置一个 `$process->id` 属性"
      }
    ]
  },
  {
    "number": 1250,
    "title": "swoole+yaf使用协程客户端,onrequest事件yafapp->dispatcher()后的程序不会执行",
    "created_at": "2017-06-22T12:22:07Z",
    "closed_at": "2017-08-14T09:18:54Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1250",
    "body": "swoole: 2.0.7\r\nyaf: 3.0.4\r\n> onrequest代码\r\n>> $httpS2Y = new HttpSwoole2Yaf($request);\r\n            var_dump('--------------------yaf_dispatcher start-------------------------' . \"\\n\");\r\n            $this->_application->getDispatcher()->dispatch($httpS2Y->getYafHttp());\r\n            $this->_setRpcRequestLog('http', microtime(true) - $startTime);\r\n            var_dump(\"--------------------yaf_dispatcher end-------------------------\\n\");\r\n\r\n> yaf中的处理代码\r\n>> public function yaftestAction()\r\n    {\r\n        $host = 'rpc.10jqka.com.cn';\r\n        $ip = gethostbyname($host);\r\n        $httpclient = new Swoole\\Coroutine\\Http\\Client($ip, 80);\r\n        $httpclient->setHeaders(['Host' => $host]);\r\n        $httpclient->set([ 'timeout' => 1]);\r\n        $httpclient->get('/index/index');\r\n        var_dump($httpclient->body);\r\n        echo \"\\nthis is yaf action end\\n\";\r\n    }\r\n\r\n> swoole输出的日志\r\n>> [/home/test/swoole-2.0.7/src/network/Server.c:145@swServer_master_onAccept][Master] Accept new connection. maxfd=4|reactor_id=5|conn=25\r\n[/home/test/swoole-2.0.7/src/network/ReactorThread.c:1261@swReactorThread_dispatch]send string package, size=199 bytes.\r\n[/home/test/swoole-2.0.7/src/network/ReactorThread.c:1320@swReactorThread_dispatch]dispatch, type=10|len=199\r\n[/home/test/swoole-2.0.7/swoole_http_server.c:1008@http_onReceive]httpRequest 199 bytes: \r\n>> ---------------------------------------\r\n>> GET /api/test/yaftest HTTP/1.1\r\nUser-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.16.2.3 Basic ECC zlib/1.2.3 libidn/1.18 libssh2/1.4.2\r\nAccept: */*\r\nHost:syar1.10jqka.com.cn\r\n \r\n>> string(66) \"--------------------yaf_dispatcher start-------------------------\r\n\"\r\n>> [/home/test/swoole-2.0.7/swoole_http_client_coro.c:815@http_client_coro_send_http_request][101]: GET /index/index HTTP/1.1\r\nConnection: keep-alive\r\nAccept-Encoding: gzip\r\nHost: rpc.10jqka.com.cn\r\n\r\n\r\n\r\n>> string(12) \"hello world!\"\r\n\r\n>> this is yaf action end\r\n>> [/home/test/swoole-2.0.7/swoole_coroutine.c:343@coro_close]closing coro and 0 remained. usage size: 1469232. malloc size: 4194304\r\n客户端断开连接后输出\r\n[/home/test/swoole-2.0.7/src/factory/FactoryProcess.c:285@swFactoryProcess_finish][Worker] send: sendn=12|type=4|content=(null)\r\n[/home/test/swoole-2.0.7/src/network/ReactorThread.c:307@swReactorThread_close]Close Event.fd=25|from=0\r\n[/home/test/swoole-2.0.7/src/network/ReactorThread.c:350@swReactorThread_close]set_maxfd=24|close_fd=25",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1250/comments",
    "author": "lgang06",
    "comments": [
      {
        "user": "GXhua",
        "created_at": "2017-06-30T02:39:13Z",
        "body": "@xyzhu1120 "
      },
      {
        "user": "toxmc",
        "created_at": "2017-06-30T02:42:45Z",
        "body": "记得yaf要改源码的，不然dispatcher会越来越大，最后内存泄漏。"
      },
      {
        "user": "lgang06",
        "created_at": "2017-07-04T09:22:54Z",
        "body": "@smalleyes  这个有测试过，不过因为实际使用内存增加不多，且有设置max_request值，所以个人感觉这个影响不大。"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-08-14T09:18:54Z",
        "body": "调用 $response->end 输出结果。"
      }
    ]
  },
  {
    "number": 1246,
    "title": "swoole_timer_tick/swoole_timer_after 平滑重启（kill -USR1 主进程PID）后任务丢失",
    "created_at": "2017-06-20T07:14:03Z",
    "closed_at": "2017-06-20T08:29:07Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1246",
    "body": "swoole_timer_tick/swoole_timer_after 有没有办法保障在平滑重启（kill -USR1 主进程PID）的时候不丢失timer。目前的现象是一定会丢失。",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1246/comments",
    "author": "danchaofan",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-06-20T08:29:07Z",
        "body": "timer是进程生命周期的，使用reload，子进程退出，自然会销毁定时器。如果你一定要存在定时器信息，建议保存到磁盘文件、MySQL等持久存储中。"
      }
    ]
  },
  {
    "number": 1237,
    "title": " serv->max_connection is exceed the maximum value[1024].",
    "created_at": "2017-06-06T03:07:06Z",
    "closed_at": "2017-06-15T09:09:02Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1237",
    "body": "max_conn=10000\r\nulimit -n\r\n65535\r\n为什么还会报 WARNING\tswServer_start_check: serv->max_connection is exceed the maximum value[1024].\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1237/comments",
    "author": "km3945",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-06-15T09:09:02Z",
        "body": "重启进程生效。出现此错误信息，说明底层检测到 ulimit -n 的值是 1024"
      }
    ]
  },
  {
    "number": 1229,
    "title": "process子进程rand方法失效?",
    "created_at": "2017-05-31T06:29:45Z",
    "closed_at": "2017-06-05T04:43:25Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1229",
    "body": "RT,如果在master进程调用过mt_rand之后,再创建的process子进程里面调用mt_rand,所有子进程都返回一样的结果\r\n\r\n似乎是php的rand在初始化之后fork的话seed也被fork了导致所有子进程都是用的同一个seed?\r\n```php\r\n<?php\r\nmt_rand(0, 1);\r\n//开始\r\n$worker_num = 16;\r\n\r\n// fork 进程\r\nfor($i = 0; $i < $worker_num; $i++) {\r\n    $process = new swoole_process('child_async', false, 2);\r\n    $pid = $process -> start();\r\n}\r\n\r\n//异步执行进程\r\nfunction child_async(swoole_process $worker) {\r\n    echo mt_rand(0, 1).PHP_EOL;\r\n    $worker -> exit();\r\n}\r\n\r\nswoole_process::wait();\r\nswoole_event_exit();\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1229/comments",
    "author": "zzjin",
    "comments": [
      {
        "user": "blusewang",
        "created_at": "2017-06-03T02:30:36Z",
        "body": "的确！有意思！"
      },
      {
        "user": "blusewang",
        "created_at": "2017-06-03T02:30:57Z",
        "body": "这不能算错吧！"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-06-05T03:51:58Z",
        "body": "在子进程中调用`mt_srand()` 重新播种"
      }
    ]
  },
  {
    "number": 1221,
    "title": "TCP server执行 一直报check 之前运行没有问题",
    "created_at": "2017-05-24T05:23:10Z",
    "closed_at": "2017-05-24T08:25:40Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1221",
    "body": "在本地虚拟机执行也没有报错，在公司测试服务器报错无法连接\r\n`\r\n[root@localhost test]# php ChipPro.php\r\n[/usr/local/src/swoole-src-1.9.9/swoole_server.c:361@php_swoole_server_before_start]Create swoole_server host=0.0.0.0, port=6000, mode=3, type=1\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:359@swServer_start_proxy]hb timer start, time: 120 live time:600\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:1487@swHeartbeatThread_loop]check fd=3\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:1487@swHeartbeatThread_loop]check fd=3\r\n`\r\n连接时报错\r\n`\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:1487@swHeartbeatThread_loop]check fd=3\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:1487@swHeartbeatThread_loop]check fd=3\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:145@swServer_master_onAccept][Master] Accept new connection. maxfd=3|reactor_id=4|conn=26\r\nSegmentation fault (core dumped)\r\n`\r\n\r\n我代码应该没有问题- -  本地运行成功，对了  本地环境是php7 swoole 2.0.6\r\n测试服务器当前版本php5.6 swoole 1.9.9  之前2.0.5不能用才换的1.9.9\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1221/comments",
    "author": "RandalTeng",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-05-24T08:25:40Z",
        "body": "请勿开启 `--enable-swoole-debug` 编译选项"
      },
      {
        "user": "RandalTeng",
        "created_at": "2017-05-24T08:49:55Z",
        "body": "没有用啊- -  我重新编译了swoole模块- -  还是报一样的错- -\r\n`\r\n./configure --enable-async-redis --enable-coroutine --with-php-config=/usr/local/php5/bin/php-config  --enable-openssl  --enable-sockets  --enable-swoole\r\n`"
      },
      {
        "user": "wangjinbei",
        "created_at": "2017-05-25T02:28:55Z",
        "body": "make clean过？"
      },
      {
        "user": "RandalTeng",
        "created_at": "2017-05-25T03:02:24Z",
        "body": "- -  好吧- -  没有clean- -   重新make可以了  谢谢大佬~~"
      }
    ]
  },
  {
    "number": 1215,
    "title": "swoole_http_client 调用post后如果其匿名回调函数不能执行会造成使用use引用传入的变量实例不能释放",
    "created_at": "2017-05-19T12:47:48Z",
    "closed_at": "2017-05-23T02:22:20Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1215",
    "body": "调用swoole_http_client post函数时候使用use将变量实例引用传入其匿名回调函数，由于某些原因（例如，ip 地址设置错误）post的匿名回调函数不能执行，致使use传入的变量实例引用不能清除，从而造成该变量实例不能被GC释放。\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1215/comments",
    "author": "easyremember",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-05-23T02:22:20Z",
        "body": "设置一个定时器，关闭超时的HttpClient，内存会自动释放。"
      },
      {
        "user": "easyremember",
        "created_at": "2017-05-26T01:09:02Z",
        "body": "无语，这是swoole的架构缺陷吧！"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-05-26T05:45:57Z",
        "body": "1.9.11 会支持 异步客户端连接超时检测。"
      },
      {
        "user": "easyremember",
        "created_at": "2017-05-27T16:30:01Z",
        "body": "谢谢，希望在新的一版可以解决这个问题，这个问题对我现在的实现造成不小的困扰。这个问题表面看来不会影响业务流程，只是内存被悄悄地被泄露了。如果不是我的代码一定会使用到PHP类的destruct函数，还不好发现这个问题。\r\n\r\n另外我觉得这问题的解决不必等待客户端超时检测触发，其实在我的代码中调用post后都会直接触发onclose事件，是否可以在onclose或onerror事件触发时候检查post的callback是否有被执行，如果没有执行就释放掉post的callback中对use传入变量的引用呢？"
      }
    ]
  },
  {
    "number": 1207,
    "title": "make 错误 swoole_redis.lo不存在",
    "created_at": "2017-05-10T07:47:50Z",
    "closed_at": "2017-05-12T02:08:31Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1207",
    "body": "查看MakeFile找到报错的文件行是swoole_redis.lo但是查看文件夹里是swoole_redis.loT重命名后通过\r\n版本1.9.10",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1207/comments",
    "author": "xuzhendan",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-05-12T02:08:31Z",
        "body": "编译错误才会有 .loT 的文件，重命名无效。检查gcc编译时的错误信息，解决问题。"
      }
    ]
  },
  {
    "number": 1192,
    "title": "swoole_server 运行过程中大数组unset后内存不释放",
    "created_at": "2017-04-20T08:54:22Z",
    "closed_at": "2017-08-04T08:00:31Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1192",
    "body": "我的业务比较简单，tcp server接收数据缓存一段时间后后定时解析发送到下游，但运行过程中发现个问题，在qps较高时缓存的数据（数组存储）会占用过多的内存，unset后进程内存占用不下降。下面是可复现的demo:\r\n```PHP\r\n<?php\r\n\r\nclass Server\r\n{\r\n    public $serv;\r\n    public $buffer;\r\n\r\n    function __construct()\r\n    {\r\n        $this->serv = new Swoole\\Server(\"0.0.0.0\", 9501);\r\n        $this->serv->set(array(\r\n            'worker_num' => 8,\r\n            'daemonize' => false,\r\n        ));\r\n\r\n        $this->serv->on('WorkerStart', function (swoole_server $serv, $fd) {\r\n            $this->buffer = [\r\n                'instance' => [\r\n                    'data' => [],\r\n                    'others' => 'others',\r\n                ],\r\n            ];\r\n            $this->log();\r\n            swoole_timer_tick(mt_rand(5000, 6000), function () {\r\n                usleep(500);\r\n                $this->log();\r\n                foreach ($this->buffer as $instance => &$item) {\r\n                    count($item['data']);\r\n                    $item['data'] = [];\r\n                }\r\n                var_dump(gc_collect_cycles());\r\n                var_dump($this->buffer);\r\n            });\r\n        });\r\n\r\n        $this->serv->on('receive', function ($serv, $fd, $from_id, $data) {\r\n            $this->buffer['instance']['data'][] = $data;\r\n        });\r\n    }\r\n\r\n    public function run()\r\n    {\r\n        $this->serv->start();\r\n    }\r\n\r\n    public function log()\r\n    {\r\n        echo \"worker-pid: {$this->serv->worker_pid}: \" . memory_get_usage(true) . PHP_EOL;\r\n    }\r\n}\r\n\r\n$ser = new Server();\r\n$ser->run();\r\n```\r\n运行结果：\r\n```\r\nwork启动时：\r\nworker-pid: 24270: 2097152\r\nint(0)\r\narray(1) {\r\n  [\"instance\"]=>\r\n  &array(2) {\r\n    [\"data\"]=>\r\n    array(0) {\r\n    }\r\n    [\"others\"]=>\r\n    string(6) \"others\"\r\n  }\r\n}\r\n请求峰值期间：\r\nworker-pid: 24270: 27267072\r\n请求量高峰期过后无请求时：\r\nworker-pid: 24270: 23068672\r\nint(0)\r\narray(1) {\r\n  [\"instance\"]=>\r\n  &array(2) {\r\n    [\"data\"]=>\r\n    array(0) {\r\n    }\r\n    [\"others\"]=>\r\n    string(6) \"others\"\r\n  }\r\n}\r\n```\r\n虽然说只要请求不达到最大值也不会OOM（也没有内存泄露），但是一直占用着内存不释放（应该对性能有好处）对机器内存持续占用过大会出现其它问题。感觉即使设置了`max_request`也可能治标不治本。\r\n单纯php-cli程序大数组能及时释放，感觉是swoole的问题。\r\n因此请教下，这个是否是正常现象，需要（有什么方法）解决吗？\r\n\r\n运行环境：\r\nPHP 7.1.4 with Zend OPcache v7.1.4\r\nswoole 1.9.8",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1192/comments",
    "author": "iyaozhen",
    "comments": [
      {
        "user": "badxpgy",
        "created_at": "2017-04-24T14:34:38Z",
        "body": "没看到任何地方对$this->buffer进行unset啊，这种代码内存增加很正常啊，\r\n$item['data'] = []; 这不是unset，可以考虑将foreach改成 array_pop来实现，将$this->buffer数组读出来进行操作"
      },
      {
        "user": "iyaozhen",
        "created_at": "2017-04-24T17:30:56Z",
        "body": "@badxpgy 嗯。谢谢。因为$this->buffer还存储有其它信息，不能直接unset。我试下直接unset\r\narray_pop 这个倒没尝试过，我试下。"
      },
      {
        "user": "iyaozhen",
        "created_at": "2017-04-25T07:03:32Z",
        "body": "@badxpgy 好像都没什么效果。\r\npmap的结果：\r\n```\r\n# pmap -x 8157 | grep -v lib\r\n8157:   php demo.php\r\nAddress           Kbytes     RSS   Dirty Mode   Mapping\r\n0000000000400000   13196     484       0 r-x--  php\r\n00000000012e3000     832     440      80 rw---  php\r\n00000000013b3000    2412    2144    2144 rw---    [ anon ]\r\n000000000160e000     556      88      88 rw---    [ anon ]\r\n000000317ae09000     184       0       0 rw---    [ anon ]\r\n000000317b65e000      16       0       0 rw---    [ anon ]\r\n000000317c596000      16       0       0 rw---    [ anon ]\r\n000000318a600000     128      40       0 r-x--  ld-2.12.so\r\n000000318a81f000       4       4       4 r----  ld-2.12.so\r\n000000318a820000       4       4       4 rw---  ld-2.12.so\r\n000000318a821000       4       4       4 rw---    [ anon ]\r\n000000318b18d000      20      16      16 rw---    [ anon ]\r\n000000318b419000      16       4       4 rw---    [ anon ]\r\n000000318c81e000       4       4       4 rw---    [ anon ]\r\n000000318d018000       8       0       0 rw---    [ anon ]\r\n000000318d417000       8       0       0 rw---    [ anon ]\r\n000000318f83b000       8       4       4 rw---    [ anon ]\r\n0000003190539000       8       0       0 rw---    [ anon ]\r\n000000319143b000       4       0       0 rw---    [ anon ]\r\n0000003192d50000       4       4       4 rw---    [ anon ]\r\n00007f0058a00000    4100    2292    2292 rw---    [ anon ]\r\n00007f0059000000    6144    6144    6144 rw---    [ anon ]\r\n00007f0059614000     228       8       8 rw---    [ anon ]\r\n00007f005964d000    2052       0       0 rw-s-  zero (deleted)\r\n00007f0059a00000   12288   10520   10520 rw---    [ anon ]\r\n00007f005a655000    2244     224     224 rw-s-  zero (deleted)\r\n00007f005a886000    8196       8       8 rw-s-  zero (deleted)\r\n00007f005b087000     516       4       4 rw---    [ anon ]\r\n00007f005b108000  131072      52      52 rw-s-  zero (deleted)\r\n00007f0063108000    2052       8       8 rw-s-  zero (deleted)\r\n00007f0063309000      76       8       0 r-x--  tideways.so\r\n00007f006331c000    2044       0       0 -----  tideways.so\r\n00007f006351b000       8       8       8 rw---  tideways.so\r\n00007f0063adc000      60       4       4 rw---    [ anon ]\r\n00007f0064681000       8       0       0 rw---    [ anon ]\r\n00007f0064ab2000      16       4       4 rw---    [ anon ]\r\n00007f0064d2b000       8       4       4 rw---    [ anon ]\r\n00007f00687b2000     128       4       4 rw---    [ anon ]\r\n00007f00687d2000     140       0       0 r-x--  oci8.so\r\n00007f00687f5000    2048       0       0 -----  oci8.so\r\n00007f00689f5000      16      16      16 rw---  oci8.so\r\n00007f00689f9000     548     172       0 r-x--  swoole.so\r\n00007f0068a82000    2048       0       0 -----  swoole.so\r\n00007f0068c82000      32      32      32 rw---  swoole.so\r\n00007f0068c8a000     500      36      36 rw---    [ anon ]\r\n00007f0068d07000     352       0       0 r-x--  opcache.so\r\n00007f0068d5f000    2048       0       0 -----  opcache.so\r\n00007f0068f5f000      28      28      28 rw---  opcache.so\r\n00007f0068f66000      36      36      36 rw---    [ anon ]\r\n00007f0068f6f000   96836       0       0 r----  locale-archive\r\n00007f006ee00000    2048    1772    1772 rw---    [ anon ]\r\n00007f006f026000    1056     200     200 rw---    [ anon ]\r\n00007f006f35b000      88       4       4 rw---    [ anon ]\r\n00007f006f372000       4       4       4 rw---    [ anon ]\r\n00007fff386bb000      84      36      36 rw---    [ stack ]\r\n00007fff38722000       4       4       0 r-x--    [ anon ]\r\nffffffffff600000       4       0       0 r-x--    [ anon ]\r\n----------------  ------  ------  ------\r\ntotal kB          468376   27780   26376\r\n```\r\n看起来还比较正常。是不是系统内存还剩余比较多（Mem:  132133664k total, 81438464k used），分配给php进程的不会被系统回收。"
      },
      {
        "user": "motecshine",
        "created_at": "2017-05-16T05:46:02Z",
        "body": "unset 掉的 数组 zend_mm 不会立马还给系统而是保留着等待下次使用，这样不会反复的从系统那里申请空间，减少IO"
      },
      {
        "user": "iyaozhen",
        "created_at": "2017-05-16T16:41:26Z",
        "body": "@motecshine 嗯嗯，我目前理解也是这样。但是不知道这个什么时候会返回给操作系统，目前来看也没啥问题，跑了也快一个月了，请求量不是太大，也没出现内存泄露的问题。"
      }
    ]
  },
  {
    "number": 1177,
    "title": "swoole_http_request POST [data] missing",
    "created_at": "2017-04-12T14:51:40Z",
    "closed_at": "2017-04-13T07:25:54Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1177",
    "body": "Recent update has broken POST data. \r\nswoole_http_request no longer see's POST Data\r\n\r\nBefore:\r\nswoole_http_request Object\r\n(\r\n    [fd] => 24\r\n    [header] => Array\r\n        (\r\n            [host] => xxxxxx\r\n            [accept] => */*\r\n            [content-type] => application/json\r\n            [content-length] => 53\r\n        )\r\n\r\n    [server] => Array\r\n        (\r\n            [request_method] => POST\r\n            [request_uri] => /\r\n            [path_info] => /\r\n            [request_time] => 1492008560\r\n            [request_time_float] => 1492008560.1102\r\n            [server_port] => 8080\r\n            [remote_port] => 47712\r\n            [remote_addr] => xxxxxxx\r\n            [server_protocol] => HTTP/1.1\r\n            [server_software] => swoole-http-server\r\n        )\r\n\r\n    [data] => POST / HTTP/1.1\r\nHost: xxxxx:8080\r\nAccept: */*\r\nContent-Type: application/json\r\nContent-Length: 53\r\n\r\n{\"0\":[\"GETSERVERCPU\",\"nodata\"],\"LOGIN\":\"USER\"}\r\n)\r\n\r\nAfter:\r\nswoole_http_request Object\r\n(\r\n    [fd] => 24\r\n    [header] => Array\r\n        (\r\n            [host] => xxxxxx\r\n            [accept] => */*\r\n            [content-type] => application/json\r\n            [content-length] => 0\r\n        )\r\n\r\n    [server] => Array\r\n        (\r\n            [request_method] => POST\r\n            [request_uri] => /\r\n            [path_info] => /\r\n            [request_time] => 1492008560\r\n            [request_time_float] => 1492008560.1102\r\n            [server_port] => 8080\r\n            [remote_port] => 47712\r\n            [remote_addr] => xxxxxxx\r\n            [server_protocol] => HTTP/1.1\r\n            [server_software] => swoole-http-server\r\n        )\r\n)",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1177/comments",
    "author": "mudassarkhan",
    "comments": [
      {
        "user": "kimkit",
        "created_at": "2017-04-12T23:37:24Z",
        "body": "what's your swoole version ?\r\nI test the latest code of master, it's OK.\r\n\r\n```\r\nobject(swoole_http_request)#8 (5) {\r\n  [\"fd\"]=>\r\n  int(2)\r\n  [\"header\"]=>\r\n  array(5) {\r\n    [\"host\"]=>\r\n    string(14) \"localhost:8000\"\r\n    [\"user-agent\"]=>\r\n    string(11) \"curl/7.47.0\"\r\n    [\"accept\"]=>\r\n    string(3) \"*/*\"\r\n    [\"content-length\"]=>\r\n    string(1) \"7\"\r\n    [\"content-type\"]=>\r\n    string(33) \"application/x-www-form-urlencoded\"\r\n  }\r\n  [\"server\"]=>\r\n  array(10) {\r\n    [\"request_method\"]=>\r\n    string(4) \"POST\"\r\n    [\"request_uri\"]=>\r\n    string(1) \"/\"\r\n    [\"path_info\"]=>\r\n    string(1) \"/\"\r\n    [\"request_time\"]=>\r\n    int(1492040037)\r\n    [\"request_time_float\"]=>\r\n    float(1492040037.2994)\r\n    [\"server_port\"]=>\r\n    int(8000)\r\n    [\"remote_port\"]=>\r\n    int(45112)\r\n    [\"remote_addr\"]=>\r\n    string(9) \"127.0.0.1\"\r\n    [\"server_protocol\"]=>\r\n    string(8) \"HTTP/1.1\"\r\n    [\"server_software\"]=>\r\n    string(18) \"swoole-http-server\"\r\n  }\r\n  [\"post\"]=>\r\n  array(2) {\r\n    [\"a\"]=>\r\n    string(1) \"1\"\r\n    [\"b\"]=>\r\n    string(1) \"2\"\r\n  }\r\n  [\"data\"]=>\r\n  string(154) \"POST / HTTP/1.1\r\nHost: localhost:8000\r\nUser-Agent: curl/7.47.0\r\nAccept: */*\r\nContent-Length: 7\r\nContent-Type: application/x-www-form-urlencoded\r\n\r\na=1&b=2\"\r\n}\r\n```\r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-04-13T07:25:54Z",
        "body": "Only the \"application/x-www-form-urlencoded\" type request can be parsed.\r\n\r\nYou can parse it like this.\r\n\r\n```php\r\n$data = json_decode($request->rawContent());\r\n```"
      },
      {
        "user": "mudassarkhan",
        "created_at": "2017-04-18T01:09:08Z",
        "body": "before you could parse it from any type of request not just application/x-www-form-urlencoded \r\n(2 months ago but i'll need to confirm which version I have)\r\nWhy has this changed? Shouldn't it be able to accept for any content type?"
      }
    ]
  },
  {
    "number": 1165,
    "title": "v1.9.8使用队列时设置message_queue_key无效",
    "created_at": "2017-03-30T14:59:02Z",
    "closed_at": "2017-03-31T05:30:02Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1165",
    "body": "发现问题的版本为1.9.8, 重新编译安装1.8.10正常\r\n执行`php --ri swoole`发现缺少`swoole.message_queue_key => 0 => 0`\r\n\r\n    ------ Message Queues --------\r\n    key        msqid      owner      perms      used-bytes   messages   \r\n    0x00000000 294912     root       666        730438       4844       \r\n    0x00000000 327681     root       666        1823079      12066      \r\n    0x00000000 360450     root       666        9115187      60040      \r\n    0x00000000 393219     root       666        0            0          \r\n    0x00000000 425988     root       666        0            0          \r\n    0x00000000 458757     root       666        0            0          \r\n    0x00000000 557062     root       666        0            0          \r\n    0x00000000 589831     root       666        0            0          \r\n    0x00000000 622600     root       666        0            0          \r\n    0x00000000 655369     root       666        0            0          \r\n    0x00000000 688138     root       666        0            0          \r\n    0x00000000 720907     root       666        0            0          \r\n    0x00000000 753676     root       666        0            0          \r\n    0x00000000 786445     root       666        0            0          \r\n    0x00000000 917518     root       666        0            0          \r\n    0x00000000 950287     root       666        0            0          \r\n    0x00000000 983056     root       666        0            0          \r\n    0x00000000 1048594    root       666        0            0          \r\n    0x00000000 1081363    root       666        0            0          \r\n    0x00000000 1114132    root       666        0            0  \r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1165/comments",
    "author": "danbus",
    "comments": [
      {
        "user": "danbus",
        "created_at": "2017-03-30T15:00:24Z",
        "body": "是被移除了吗?"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-03-31T05:30:02Z",
        "body": "对，已经移除。请设置 server->set 参数数组。"
      },
      {
        "user": "danbus",
        "created_at": "2017-03-31T06:11:49Z",
        "body": "不管是新版还是老版本(1.9.8和1.8.10) message_queue_key 设置的值都无效, 都是由程序自动生成,新版设置的值都为`0x00000000` , 运行多个实例时,只能由 msqid 进行区分, 重启后还是可以继续消费(前提不是ctrl+c结束),   遇到问题的朋友请注意"
      }
    ]
  },
  {
    "number": 1158,
    "title": "ERROR\tswFactoryProcess_finish (ERROR 1004): send 3 byte failed, because connection[fd=7] is closed.",
    "created_at": "2017-03-26T04:37:38Z",
    "closed_at": "2017-03-28T06:21:30Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1158",
    "body": "| Q              | A\r\n| -------------- | ---\r\n| Bug?           | yes\r\n| New Feature?   | no\r\n| Swoole Version   | 1.9.9-alpha\r\n| PHP Version | php 7.0.9\r\n| OS             | Ubuntu 16.04\r\n\r\n>Server info\r\n```\r\ntinywan@tinywan:~/swoole$ sudo php Server.php \r\nStart\r\nGet Message From Client 1:hello\r\n[2017-03-26 12:29:51 *12689.2]\tERROR\tswFactoryProcess_finish (ERROR 1004): send 5 byte failed, because connection[fd=1] is closed.\r\nClient 1 close connection\r\nGet Message From Client 2:abx\r\n```\r\n\r\n>Client info\r\n```\r\ntinywan@tinywan:~/swoole$ ls\r\nClient.php  Server.php\r\ntinywan@tinywan:~/swoole$ php Client.php \r\n请输入消息：123\r\nGet Message From Server:Hello 1!\r\ntinywan@tinywan:~/swoole$ php Client.php \r\n请输入消息：hello\r\nGet Message From Server:Hello 1!\r\ntinywan@tinywan:~/swoole$ php Client.php \r\n请输入消息：abx\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1158/comments",
    "author": "Tinywan",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-03-28T06:21:30Z",
        "body": "表示连接已关闭。"
      }
    ]
  },
  {
    "number": 1151,
    "title": "php7.1，swoole2.0.5，centOS7使用HTTP协程并没有达到预期效果",
    "created_at": "2017-03-20T01:38:41Z",
    "closed_at": "2017-04-13T10:37:52Z",
    "labels": [
      "question",
      "coroutine"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1151",
    "body": "如果一个请求有多个new Swoole\\Coroutine\\Http\\Client方法，执行时间不是max（请求1，请求2，请求3,...）,而是请求1+请求2+请求3+...",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1151/comments",
    "author": "limao777",
    "comments": [
      {
        "user": "andot",
        "created_at": "2017-03-20T01:55:41Z",
        "body": "这是你误会了，本来就是这样。在一个请求中，所有的协程都是顺序执行的，并不是并发执行的。不同请求之间才是并发执行的。"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-04-13T10:37:52Z",
        "body": "同一个协程内的代码是串行的。"
      }
    ]
  },
  {
    "number": 1142,
    "title": "求助树莓派下编译swoole卡在linux_aio.lo的问题",
    "created_at": "2017-03-14T16:30:06Z",
    "closed_at": "2017-03-29T11:42:26Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1142",
    "body": "> /bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 \r\n-DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/sof\r\nt/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/\r\nlocal/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/incl\r\nude/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/\r\nsoft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.\r\n9.6/src/os/linux_aio.c -o src/os/linux_aio.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/\r\nsoft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/loc\r\nal/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include\r\n/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib \r\n-I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread \r\n-g -O2 -c /root/soft/swoole-1.9.6/src/os/linux_aio.c  -fPIC -DPIC -o src/os/.libs/linux_aio\r\n.o\r\nMakefile:336: recipe for target 'src/os/linux_aio.lo' failed\r\n\r\n总是卡到这里，试了1.9.6 1.9.5 1.8.13都过不去，试了网上说的要手工去掉Makefile中 -O2项也不行。\r\n环境：PHP 7.0.0\r\ngcc --version\r\ngcc (Debian 4.9.2-10) 4.9.2\r\ncpu ARMv7 Processor rev 2 (v7l)\r\n编译步骤：\r\n/usr/local/php7.0/bin/phpize\r\n./configure --with-php-config=/usr/local/php7.0/bin/php-config\r\nmake\r\nmemcached redis yaf 等扩展安装都能正常。\r\n求助~~",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1142/comments",
    "author": "dth801",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-03-15T02:21:46Z",
        "body": "贴出编译错误的信息"
      },
      {
        "user": "dth801",
        "created_at": "2017-03-15T08:38:29Z",
        "body": "编译信息错误处：\r\n> /bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc -I. -I/root/soft/swoole-1.9.6\r\n-DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/sof\r\nt/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/\r\nlocal/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/incl\r\nude/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/\r\nsoft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.\r\n9.6/src/os/linux_aio.c -o src/os/linux_aio.lo\r\ncc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/\r\nsoft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/loc\r\nal/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include\r\n/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib\r\n-I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread\r\n-g -O2 -c /root/soft/swoole-1.9.6/src/os/linux_aio.c -fPIC -DPIC -o src/os/.libs/linux_aio\r\n.o\r\nMakefile:336: recipe for target 'src/os/linux_aio.lo' failed\r\n\r\n全部编译输出太长没贴，如果需要稍后我提供上来"
      },
      {
        "user": "dth801",
        "created_at": "2017-03-15T09:01:20Z",
        "body": "全部编译信息：\r\n\r\n> /bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole.c -o swoole.lo \r\nmkdir .libs\r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole.c  -fPIC -DPIC -o .libs/swoole.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_server.c -o swoole_server.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_server.c  -fPIC -DPIC -o .libs/swoole_server.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_server_port.c -o swoole_server_port.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_server_port.c  -fPIC -DPIC -o .libs/swoole_server_port.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_atomic.c -o swoole_atomic.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_atomic.c  -fPIC -DPIC -o .libs/swoole_atomic.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_lock.c -o swoole_lock.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_lock.c  -fPIC -DPIC -o .libs/swoole_lock.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_client.c -o swoole_client.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_client.c  -fPIC -DPIC -o .libs/swoole_client.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_event.c -o swoole_event.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_event.c  -fPIC -DPIC -o .libs/swoole_event.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_timer.c -o swoole_timer.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_timer.c  -fPIC -DPIC -o .libs/swoole_timer.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_async.c -o swoole_async.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_async.c  -fPIC -DPIC -o .libs/swoole_async.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_process.c -o swoole_process.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_process.c  -fPIC -DPIC -o .libs/swoole_process.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_serialize.c -o swoole_serialize.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_serialize.c  -fPIC -DPIC -o .libs/swoole_serialize.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_buffer.c -o swoole_buffer.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_buffer.c  -fPIC -DPIC -o .libs/swoole_buffer.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_table.c -o swoole_table.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_table.c  -fPIC -DPIC -o .libs/swoole_table.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_http_server.c -o swoole_http_server.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_http_server.c  -fPIC -DPIC -o .libs/swoole_http_server.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_http_v2_server.c -o swoole_http_v2_server.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_http_v2_server.c  -fPIC -DPIC -o .libs/swoole_http_v2_server.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_websocket_server.c -o swoole_websocket_server.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_websocket_server.c  -fPIC -DPIC -o .libs/swoole_websocket_server.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_http_client.c -o swoole_http_client.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_http_client.c  -fPIC -DPIC -o .libs/swoole_http_client.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_mysql.c -o swoole_mysql.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_mysql.c  -fPIC -DPIC -o .libs/swoole_mysql.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_redis.c -o swoole_redis.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_redis.c  -fPIC -DPIC -o .libs/swoole_redis.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_redis_server.c -o swoole_redis_server.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_redis_server.c  -fPIC -DPIC -o .libs/swoole_redis_server.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_module.c -o swoole_module.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_module.c  -fPIC -DPIC -o .libs/swoole_module.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_mmap.c -o swoole_mmap.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_mmap.c  -fPIC -DPIC -o .libs/swoole_mmap.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/swoole_channel.c -o swoole_channel.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/swoole_channel.c  -fPIC -DPIC -o .libs/swoole_channel.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/core/base.c -o src/core/base.lo \r\nmkdir src/core/.libs\r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/core/base.c  -fPIC -DPIC -o src/core/.libs/base.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/core/log.c -o src/core/log.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/core/log.c  -fPIC -DPIC -o src/core/.libs/log.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/core/hashmap.c -o src/core/hashmap.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/core/hashmap.c  -fPIC -DPIC -o src/core/.libs/hashmap.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/core/RingQueue.c -o src/core/RingQueue.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/core/RingQueue.c  -fPIC -DPIC -o src/core/.libs/RingQueue.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/core/Channel.c -o src/core/Channel.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/core/Channel.c  -fPIC -DPIC -o src/core/.libs/Channel.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/core/string.c -o src/core/string.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/core/string.c  -fPIC -DPIC -o src/core/.libs/string.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/core/array.c -o src/core/array.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/core/array.c  -fPIC -DPIC -o src/core/.libs/array.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/core/socket.c -o src/core/socket.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/core/socket.c  -fPIC -DPIC -o src/core/.libs/socket.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/core/list.c -o src/core/list.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/core/list.c  -fPIC -DPIC -o src/core/.libs/list.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/core/heap.c -o src/core/heap.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/core/heap.c  -fPIC -DPIC -o src/core/.libs/heap.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/memory/ShareMemory.c -o src/memory/ShareMemory.lo \r\nmkdir src/memory/.libs\r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/memory/ShareMemory.c  -fPIC -DPIC -o src/memory/.libs/ShareMemory.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/memory/MemoryGlobal.c -o src/memory/MemoryGlobal.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/memory/MemoryGlobal.c  -fPIC -DPIC -o src/memory/.libs/MemoryGlobal.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/memory/RingBuffer.c -o src/memory/RingBuffer.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/memory/RingBuffer.c  -fPIC -DPIC -o src/memory/.libs/RingBuffer.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/memory/FixedPool.c -o src/memory/FixedPool.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/memory/FixedPool.c  -fPIC -DPIC -o src/memory/.libs/FixedPool.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/memory/Malloc.c -o src/memory/Malloc.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/memory/Malloc.c  -fPIC -DPIC -o src/memory/.libs/Malloc.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/memory/Table.c -o src/memory/Table.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/memory/Table.c  -fPIC -DPIC -o src/memory/.libs/Table.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/memory/Buffer.c -o src/memory/Buffer.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/memory/Buffer.c  -fPIC -DPIC -o src/memory/.libs/Buffer.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/factory/Factory.c -o src/factory/Factory.lo \r\nmkdir src/factory/.libs\r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/factory/Factory.c  -fPIC -DPIC -o src/factory/.libs/Factory.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/factory/FactoryThread.c -o src/factory/FactoryThread.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/factory/FactoryThread.c  -fPIC -DPIC -o src/factory/.libs/FactoryThread.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/factory/FactoryProcess.c -o src/factory/FactoryProcess.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/factory/FactoryProcess.c  -fPIC -DPIC -o src/factory/.libs/FactoryProcess.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/reactor/ReactorBase.c -o src/reactor/ReactorBase.lo \r\nmkdir src/reactor/.libs\r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/reactor/ReactorBase.c  -fPIC -DPIC -o src/reactor/.libs/ReactorBase.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/reactor/ReactorSelect.c -o src/reactor/ReactorSelect.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/reactor/ReactorSelect.c  -fPIC -DPIC -o src/reactor/.libs/ReactorSelect.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/reactor/ReactorPoll.c -o src/reactor/ReactorPoll.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/reactor/ReactorPoll.c  -fPIC -DPIC -o src/reactor/.libs/ReactorPoll.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/reactor/ReactorEpoll.c -o src/reactor/ReactorEpoll.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/reactor/ReactorEpoll.c  -fPIC -DPIC -o src/reactor/.libs/ReactorEpoll.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/reactor/ReactorKqueue.c -o src/reactor/ReactorKqueue.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/reactor/ReactorKqueue.c  -fPIC -DPIC -o src/reactor/.libs/ReactorKqueue.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/pipe/PipeBase.c -o src/pipe/PipeBase.lo \r\nmkdir src/pipe/.libs\r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/pipe/PipeBase.c  -fPIC -DPIC -o src/pipe/.libs/PipeBase.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/pipe/PipeEventfd.c -o src/pipe/PipeEventfd.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/pipe/PipeEventfd.c  -fPIC -DPIC -o src/pipe/.libs/PipeEventfd.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/pipe/PipeUnsock.c -o src/pipe/PipeUnsock.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/pipe/PipeUnsock.c  -fPIC -DPIC -o src/pipe/.libs/PipeUnsock.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/lock/Semaphore.c -o src/lock/Semaphore.lo \r\nmkdir src/lock/.libs\r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/lock/Semaphore.c  -fPIC -DPIC -o src/lock/.libs/Semaphore.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/lock/Mutex.c -o src/lock/Mutex.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/lock/Mutex.c  -fPIC -DPIC -o src/lock/.libs/Mutex.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/lock/RWLock.c -o src/lock/RWLock.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/lock/RWLock.c  -fPIC -DPIC -o src/lock/.libs/RWLock.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/lock/SpinLock.c -o src/lock/SpinLock.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/lock/SpinLock.c  -fPIC -DPIC -o src/lock/.libs/SpinLock.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/lock/FileLock.c -o src/lock/FileLock.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/lock/FileLock.c  -fPIC -DPIC -o src/lock/.libs/FileLock.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/network/Server.c -o src/network/Server.lo \r\nmkdir src/network/.libs\r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/network/Server.c  -fPIC -DPIC -o src/network/.libs/Server.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/network/TaskWorker.c -o src/network/TaskWorker.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/network/TaskWorker.c  -fPIC -DPIC -o src/network/.libs/TaskWorker.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/network/Client.c -o src/network/Client.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/network/Client.c  -fPIC -DPIC -o src/network/.libs/Client.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/network/Connection.c -o src/network/Connection.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/network/Connection.c  -fPIC -DPIC -o src/network/.libs/Connection.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/network/ProcessPool.c -o src/network/ProcessPool.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/network/ProcessPool.c  -fPIC -DPIC -o src/network/.libs/ProcessPool.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/network/ThreadPool.c -o src/network/ThreadPool.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/network/ThreadPool.c  -fPIC -DPIC -o src/network/.libs/ThreadPool.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/network/ReactorThread.c -o src/network/ReactorThread.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/network/ReactorThread.c  -fPIC -DPIC -o src/network/.libs/ReactorThread.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/network/ReactorProcess.c -o src/network/ReactorProcess.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/network/ReactorProcess.c  -fPIC -DPIC -o src/network/.libs/ReactorProcess.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/network/Manager.c -o src/network/Manager.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/network/Manager.c  -fPIC -DPIC -o src/network/.libs/Manager.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/network/Worker.c -o src/network/Worker.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/network/Worker.c  -fPIC -DPIC -o src/network/.libs/Worker.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/network/Timer.c -o src/network/Timer.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/network/Timer.c  -fPIC -DPIC -o src/network/.libs/Timer.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/network/Port.c -o src/network/Port.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/network/Port.c  -fPIC -DPIC -o src/network/.libs/Port.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/network/DNS.c -o src/network/DNS.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/network/DNS.c  -fPIC -DPIC -o src/network/.libs/DNS.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/os/base.c -o src/os/base.lo \r\nmkdir src/os/.libs\r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/os/base.c  -fPIC -DPIC -o src/os/.libs/base.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/os/dl.c -o src/os/dl.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/os/dl.c  -fPIC -DPIC -o src/os/.libs/dl.o\r\n/bin/bash /root/soft/swoole-1.9.6/libtool --mode=compile cc  -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /root/soft/swoole-1.9.6/src/os/linux_aio.c -o src/os/linux_aio.lo \r\n cc -I. -I/root/soft/swoole-1.9.6 -DPHP_ATOM_INC -I/root/soft/swoole-1.9.6/include -I/root/soft/swoole-1.9.6/main -I/root/soft/swoole-1.9.6 -I/usr/local/php7.0/include/php -I/usr/local/php7.0/include/php/main -I/usr/local/php7.0/include/php/TSRM -I/usr/local/php7.0/include/php/Zend -I/usr/local/php7.0/include/php/ext -I/usr/local/php7.0/include/php/ext/date/lib -I/root/soft/swoole-1.9.6 -I/root/soft/swoole-1.9.6/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /root/soft/swoole-1.9.6/src/os/linux_aio.c  -fPIC -DPIC -o src/os/.libs/linux_aio.o\r\nMakefile:336: recipe for target 'src/os/linux_aio.lo' failed\r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-03-29T11:42:26Z",
        "body": "修改`config.h`去掉`HAVE_LINUX_AIO`重新编译。"
      },
      {
        "user": "php-include",
        "created_at": "2017-08-15T07:51:10Z",
        "body": "docker 中 php7.1.7 的编译也是这样,去掉就可以了."
      },
      {
        "user": "kasnet",
        "created_at": "2018-03-07T11:30:51Z",
        "body": "v2.1.1这个版本, 在docker中 alpine系统 我修改了swoole_config.h, 注释了HAVE_LINUX_AIO的定义就可以了"
      }
    ]
  },
  {
    "number": 1133,
    "title": "\\Swoole\\Mysql coredump",
    "created_at": "2017-03-11T09:47:08Z",
    "closed_at": "2017-03-13T06:00:31Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1133",
    "body": "I write a simple mysql code,  but I aways got a core dump\r\nswoole version: 1.9.3\r\nphp version: 5.6.13\r\nsystem: centos 6.5\r\n\r\n\r\n`\r\n$serv = new Swoole\\Http\\Server(\"0.0.0.0\", 10000);\r\n\r\n$serv->on('Request', function($request, $response) {\r\n$db = new \\Swoole\\MySQL;\r\n$server = array(\r\n    'host' => '127.0.0.1',\r\n    'user' => 'root',\r\n    'password' => '123',\r\n    'database' => 'abccef',\r\n);\r\n\r\necho \"onrequest\\n\";\r\n$db->connect($server, function ($db, $result) use($response) {\r\n    echo \"conneced\\n\";\r\n    $db->query(\"select * from simetable limit 1\", function (Swoole\\MySQL $db, $result) use($response) {\r\n    echo \"onquery\\n\";\r\n        if ($result === false) {\r\n            var_dump($db->error, $db->errno);\r\n        } elseif ($result === true) {\r\n            var_dump($db->affected_rows, $db->insert_id);\r\n        } else {\r\n           $response->end(\"OK\");\r\n            var_dump($result);\r\n        }\r\n        $db->close();\r\n    });\r\n});\r\n});\r\n\r\n$serv->start();\r\n`\r\n\r\ncore dump\r\n`\r\n#0  _zend_mm_alloc_int (heap=0x2be3120, size=32) at /root/php-5.6.13/Zend/zend_alloc.c:1910\r\n#1  0x000000000085a890 in add_assoc_stringl_ex (arg=0x7f5675d030e0, key=0x7f5675d0ad6e \"starttm\", key_len=8,\r\n    str=0x30614c5 \"0\\001\\060\\001\\060\\001\\060\\001\\060\\017\\061\\061\\066.41743778979\\017\\064\\060.032089830583\\002\\063\\060\\066北京 市 朝阳区奥运村街道北苑路甲13号院\\001\\060\\001\\060\\006longtu\\005\\060\\060:12\\001\\062\\001\\061\\001\\060\\n1451909889\\001\\060\\001\\060\\023\\061\\061\\065.29.139.255:7071\\n1489137708\\n1475055417\\n1489137708\\n148913883\"..., length=1,\r\n    duplicate=<value optimized out>) at /root/php-5.6.13/Zend/zend_API.c:1294\r\n#2  0x00007f566f4b6b2a in mysql_decode_row (reactor=0x304fd80, event=0x7fff932a0ed0)\r\n    at /home/php/swoole/swoole-src-1.9.3-stable/swoole_mysql.h:681\r\n#3  mysql_read_rows (reactor=0x304fd80, event=0x7fff932a0ed0) at /home/php/swoole/swoole-src-1.9.3-stable/swoole_mysql.h:834\r\n#4  mysql_response (reactor=0x304fd80, event=0x7fff932a0ed0) at /home/php/swoole/swoole-src-1.9.3-stable/swoole_mysql.c:664\r\n#5  swoole_mysql_onRead (reactor=0x304fd80, event=0x7fff932a0ed0)\r\n    at /home/php/swoole/swoole-src-1.9.3-stable/swoole_mysql.c:1338\r\n#6  0x00007f566f4cab80 in swReactorEpoll_wait (reactor=0x304fd80, timeo=<value optimized out>)\r\n    at /home/php/swoole/swoole-src-1.9.3-stable/src/reactor/ReactorEpoll.c:258\r\n#7  0x00007f566f4db82f in swWorker_loop (factory=<value optimized out>, worker_id=<value optimized out>)\r\n    at /home/php/swoole/swoole-src-1.9.3-stable/src/network/Worker.c:518\r\n#8  0x00007f566f4d86e3 in swManager_spawn_worker (factory=0x301bab0, worker_id=2)\r\n    at /home/php/swoole/swoole-src-1.9.3-stable/src/network/Manager.c:644\r\n#9  0x00007f566f4d90d9 in swManager_start (factory=0x301bab0)\r\n    at /home/php/swoole/swoole-src-1.9.3-stable/src/network/Manager.c:133\r\n#10 0x00007f566f4c774a in swFactoryProcess_start (factory=0x301bab0)\r\n    at /home/php/swoole/swoole-src-1.9.3-stable/src/factory/FactoryProcess.c:86\r\n#11 0x00007f566f4ce19f in swServer_start (serv=0x301b680)\r\n    at /home/php/swoole/swoole-src-1.9.3-stable/src/network/Server.c:696\r\n#12 0x00007f566f4aa583 in zim_swoole_http_server_start (ht=<value optimized out>, return_value=0x7f5675d05760,\r\n    return_value_ptr=<value optimized out>, this_ptr=0x7f5675d08888, return_value_used=<value optimized out>,\r\n    tsrm_ls=0x2be2b20) at /home/php/swoole/swoole-src-1.9.3-stable/swoole_http_server.c:1437\r\n#13 0x00000000008d68f3 in zend_do_fcall_common_helper_SPEC (execute_data=<value optimized out>, tsrm_ls=0x2be2b20)\r\n    at /root/php-5.6.13/Zend/zend_vm_execute.h:558\r\n#14 0x00000000008c45eb in execute_ex (execute_data=0x7f5675ccf1c0, tsrm_ls=0x2be2b20)\r\n    at /root/php-5.6.13/Zend/zend_vm_execute.h:363\r\n#15 0x000000000084c6a7 in zend_execute_scripts (type=8, tsrm_ls=0x2be2b20, retval=0x0, file_count=3)\r\n    at /root/php-5.6.13/Zend/zend.c:1341\r\n#16 0x00000000007deffa in php_execute_script (primary_file=0x7fff932a47b0, tsrm_ls=0x2be2b20)\r\n    at /root/php-5.6.13/main/main.c:2597\r\n#17 0x0000000000900f04 in do_cli (argc=2, argv=0x2be2a40, tsrm_ls=0x2be2b20) at /root/php-5.6.13/sapi/cli/php_cli.c:994\r\n#18 0x000000000090178d in main (argc=2, argv=0x2be2a40) at /root/php-5.6.13/sapi/cli/php_cli.c:1378\r\n\r\n`",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1133/comments",
    "author": "roobo",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-03-13T06:00:31Z",
        "body": "Modify the makefile, add gcc compile option `-fno-strict-aliasing`."
      }
    ]
  },
  {
    "number": 1131,
    "title": "swoole_process:exec 和 swoole_process:name  不能共存么",
    "created_at": "2017-03-10T02:38:38Z",
    "closed_at": "2017-03-10T03:02:09Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1131",
    "body": "当使用swoole_process->exec()时，对子进程设置name好像无效！",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1131/comments",
    "author": "pakey",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-03-10T03:02:09Z",
        "body": "exec底层相当于执行了新程序，进程名称由新程序控制。"
      }
    ]
  },
  {
    "number": 1110,
    "title": "swoole wss除ie9都正常了",
    "created_at": "2017-03-04T17:14:11Z",
    "closed_at": "2017-03-10T05:14:45Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1110",
    "body": "ie9下采用flash结合 但是报这个错误\r\nWARNING\tswSSL_accept: bad SSL client[39.xx.102.95:54652].\r\n怎么处理呢\r\n其它浏览器都正常接收发送",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1110/comments",
    "author": "mienv567",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-03-10T05:14:45Z",
        "body": "表示客户端连接用的不是SSL，检查是否支持SSL连接"
      },
      {
        "user": "mienv567",
        "created_at": "2017-03-10T07:18:22Z",
        "body": "使用的websocketmain 是支持wss的. 你能给个flash嘛支持wss ssl的谢谢"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-03-10T08:04:47Z",
        "body": "flash的请自行解决。IE可以使用Comet实现推送的功能"
      }
    ]
  },
  {
    "number": 1100,
    "title": "WARNING swManager_check_exit_status: worker#0 abnormal exit, status=0, signal=11",
    "created_at": "2017-02-22T08:38:15Z",
    "closed_at": "2017-03-02T05:20:58Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1100",
    "body": "请求时不时会出现 WARNING\tswManager_check_exit_status: worker#0 abnormal exit, status=0, signal=11\r\n\r\n(gdb) bt\r\n#0  0x00007f2b299caad1 in ?? ()\r\n#1  0x00007f2b12005b5e in swoole_mysql_coro_onRead (\r\n    reactor=0x7f2b2a89b1a0, event=0x7ffff61101f0)\r\n    at /root/swoole-src-2.0.6/swoole_mysql_coro.c:938\r\n#2  0x00007f2b1203b81f in swReactorEpoll_wait (reactor=0x7f2b2a89b1a0, \r\n    timeo=<optimized out>)\r\n    at /root/swoole-src-2.0.6/src/reactor/ReactorEpoll.c:258\r\n#3  0x00007f2b1204b2cf in swWorker_loop (\r\n    factory=factory@entry=0x7f2b2a865820, worker_id=worker_id@entry=0)\r\n    at /root/swoole-src-2.0.6/src/network/Worker.c:518\r\n#4  0x00007f2b120484dc in swManager_spawn_worker (\r\n    factory=0x7f2b2a865820, worker_id=0)\r\n    at /root/swoole-src-2.0.6/src/network/Manager.c:644\r\n#5  0x00007f2b12048a3f in swManager_start (\r\n    factory=factory@entry=0x7f2b2a865820)\r\n    at /root/swoole-src-2.0.6/src/network/Manager.c:133\r\n#6  0x00007f2b1203861a in swFactoryProcess_start (\r\n    factory=0x7f2b2a865820)\r\n    at /root/swoole-src-2.0.6/src/factory/FactoryProcess.c:86\r\n#7  0x00007f2b1203f423 in swServer_start (\r\n    serv=serv@entry=0x7f2b2a8653f0)\r\n    at /root/swoole-src-2.0.6/src/network/Server.c:696\r\n#8  0x00007f2b11ff406a in zim_swoole_http_server_start (\r\n    ht=<optimized out>, return_value=0x7f2b11b15c10, \r\n    return_value_ptr=<optimized out>, this_ptr=0x7f2b11b22970, \r\n    return_value_used=<optimized out>)\r\n    at /root/swoole-src-2.0.6/swoole_http_server.c:1477\r\n#9  0x00007f2b299e344b in dtrace_execute_internal ()\r\n#10 0x00007f2b29a9d4f4 in ?? ()\r\n#11 0x00007f2b29a317f8 in execute_ex ()\r\n#12 0x00007f2b299e3329 in dtrace_execute_ex ()\r\n#13 0x00007f2b29a9d9a9 in ?? ()\r\n#14 0x00007f2b29a317f8 in execute_ex ()\r\n#15 0x00007f2b299e3329 in dtrace_execute_ex ()\r\n#16 0x00007f2b299f60db in zend_execute_scripts ()\r\n#17 0x00007f2b29990e32 in php_execute_script ()\r\n#18 0x00007f2b29a9f408 in ?? ()\r\n#19 0x00007f2b2986b17a in ?? ()\r\n#20 0x00007f2b2633ab35 in __libc_start_main () from /lib64/libc.so.6\r\n#21 0x00007f2b2986b215 in _start ()\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1100/comments",
    "author": "huangzhhui",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-02-22T09:16:35Z",
        "body": "swoole版本多少？"
      },
      {
        "user": "xyzhu1120",
        "created_at": "2017-02-23T08:59:56Z",
        "body": "可以有稳定复现的case吗？"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-03-02T05:20:58Z",
        "body": "请手动编辑Makefile，将CFLAGS = -Wall -pthread -g -O2替换为CFLAGS = -Wall -pthread -g -O2 -fno-strict-aliasing"
      }
    ]
  },
  {
    "number": 1083,
    "title": "How i can check is connecton was closed clean or not in WebsocketServer?",
    "created_at": "2017-02-14T01:21:37Z",
    "closed_at": "2017-02-14T06:15:27Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1083",
    "body": "In JavaScript i can check is connection was normaly closed or not by this code:\r\n```\r\n                var socket = new WebSocket(\"ws://127.0.0.1:9501\");\r\n                socket.onclose = function(event){\r\n                  if(event.wasClean){\r\n                    alert('Good close.');\r\n                  }else{\r\n                    alert('Bad close. Connection broken');\r\n                  }\r\n                };\r\n```\r\n\r\nCan I check it in Swoole WebsocketServer?\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1083/comments",
    "author": "kse300489",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-02-14T05:53:39Z",
        "body": "```php\r\n$info = $serv->getClientInfo($fd);\r\n$errno = $info['close_errno'];\r\n```\r\n\r\nIf it is abnormal, the value of errno is non-zero."
      },
      {
        "user": "kse300489",
        "created_at": "2017-02-14T06:14:07Z",
        "body": "Big thanks for fast answer."
      },
      {
        "user": "matyhtf",
        "created_at": "2017-02-14T06:15:27Z",
        "body": ":)"
      }
    ]
  },
  {
    "number": 1036,
    "title": "swoole_mysql 后期会支持多个sql一起执行么",
    "created_at": "2017-01-29T13:11:07Z",
    "closed_at": "2017-01-31T13:58:35Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1036",
    "body": "swoole_mysql 后期会支持多个sql一起执行么",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1036/comments",
    "author": "keaixiaou",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-01-31T13:58:35Z",
        "body": "并发执行多条SQL需要创建多个MySQL连接。"
      }
    ]
  },
  {
    "number": 1011,
    "title": "Mac OS X 10.11.6 源码编译 swoole-src-1.9.0-stable  开启 --enable-openssl 编译不通过",
    "created_at": "2017-01-07T08:27:27Z",
    "closed_at": "2017-01-07T13:09:35Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1011",
    "body": "**gcc -v** 版本                                                 \r\nConfigured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/usr/include/c++/4.2.1\r\nApple LLVM version 8.0.0 (clang-800.0.42.1)\r\nTarget: x86_64-apple-darwin15.6.0\r\nThread model: posix\r\nInstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin\r\n\r\n**openssl version -a** 版本\r\nOpenSSL 1.0.2j  26 Sep 2016\r\nbuilt on: reproducible build, date unspecified\r\nplatform: darwin64-x86_64-cc\r\noptions:  bn(64,64) rc4(ptr,int) des(idx,cisc,16,int) idea(int) blowfish(idx)\r\ncompiler: clang -I. -I.. -I../include  -fPIC -fno-common -DOPENSSL_PIC -DZLIB_SHARED -DZLIB -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -arch x86_64 -O3 -DL_ENDIAN -Wall -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM -DECP_NISTZ256_ASM\r\nOPENSSLDIR: \"/usr/local/etc/openssl\"\r\n\r\n**Mac OS X 版本**\r\nProductName:\tMac OS X\r\nProductVersion:\t10.11.6\r\nBuildVersion:\t15G1108\r\n\r\n**PHP版本**\r\n\r\nPHP 5.6.29 (cli) (built: Dec  8 2016 23:03:30)\r\nCopyright (c) 1997-2016 The PHP Group\r\nZend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies\r\n\r\n**编译参数：**\r\n\r\n./configure --with-php-config=/usr/bin/php-config --enable-openssl\r\n\r\n**报错信息：（有省略）**\r\n/Users/ws/Downloads/swoole-src-1.9.0-stable/include/swoole.h/Users/ws/Downloads/swoole-src-1.9.0-stable/include/swoole.h::353353::1010::  fatal errorfatal error: : 'openssl/ssl.h''openssl/ssl.h'  filefile  notnot  foundfound\r\n\r\n#include <openssl/ssl.h>#include <openssl/ssl.h>\r\n\r\n         ^         ^\r\n\r\n1 error generated.\r\n\r\n/Users/ws/Downloads/swoole-src-1.9.0-stable/include/swoole.h:353:10: fatal error: 'openssl/ssl.h' file not found\r\n#include <openssl/ssl.h>\r\n         ^\r\n\r\n/Users/ws/Downloads/swoole-src-1.9.0-stable/include/swoole.h:353:10: fatal error: 'openssl/ssl.h' file not found\r\n#include <openssl/ssl.h>\r\n         ^\r\nmake: *** [swoole_websocket_server.lo] Error 1\r\n1 error generated.\r\n1 error generated.\r\nmake: *** [swoole_mmap.lo] Error 1\r\nmake: *** [src/protocol/MimeTypes.lo] Error 1\r\n1 error generated.\r\nmake: *** [swoole_mysql.lo] Error 1\r\n1 error generated.\r\nmake: *** [swoole_http_server.lo] Error 1\r\n1 error generated.\r\n1 error generated.\r\nmake: *** [swoole_module.lo] Error 1\r\nmake: *** [swoole_http_client.lo] Error 1\r\n1 error generated.\r\n1 error generated.\r\nmake: *** [swoole_server.lo] Error 1\r\nmake: *** [swoole_client.lo] Error 1\r\n1 error generated.\r\nmake: *** [swoole.lo] Error 1\r\n\r\n原来是通过 brew 安装的swoole\r\n\r\nswoole\r\n\r\nswoole support => enabled\r\nVersion => 1.8.11\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\nkqueue => enabled\r\nrwlock => enabled\r\nasync http/websocket client => enabled\r\npcre => enabled\r\nzlib => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => Off => Off\r\nswoole.message_queue_key => 0 => 0\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n现在想使用 wss ，所以想重新编译 开启 openssl 支持",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1011/comments",
    "author": "iMactool",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-01-07T13:09:35Z",
        "body": "你的系统没有安装openssl头文件，请先安装"
      },
      {
        "user": "iMactool",
        "created_at": "2017-01-09T02:29:04Z",
        "body": "谢谢，解决方案：\r\n下载 openssl-1.0.*\r\n ./config --prefix=/usr/local --openssldir=/usr/local/openssl\r\nmake \r\nmake install\r\n\r\n然后重新编译swoole"
      },
      {
        "user": "zsmhub",
        "created_at": "2018-12-26T07:27:41Z",
        "body": "MACOS X 10.11开始移除了openssl头文件，但是保留了openssl的动态链接库去支持现有的程序。 故如果你在苹果系统pecl install swoole时，请选择disable openssl support即可。"
      }
    ]
  },
  {
    "number": 1010,
    "title": "swoole-1.9.3  安装 pecl install swoole  ",
    "created_at": "2017-01-07T07:59:02Z",
    "closed_at": "2017-01-07T13:10:01Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1010",
    "body": "系统 Fedora25   php7 \r\n执行 `pecl install swoole ` ，安装时的错误\r\n\r\n`/var/tmp/swoole/swoole_http_client.c: 在函数‘http_client_onReceive’中:\r\n/var/tmp/swoole/swoole_http_client.c:689:9: 警告：隐式声明函数‘inflateEnd’ [-Wimplicit-function-declaration]\r\n         inflateEnd(&http->gzip_stream);\r\n         ^~~~~~~~~~\r\n/var/tmp/swoole/swoole_http_client.c:689:25: 错误：‘http_client {或称 struct <匿名>}’没有名为‘gzip_stream’的成员\r\n         inflateEnd(&http->gzip_stream);\r\n                         ^~\r\n/var/tmp/swoole/swoole_http_client.c: 在函数‘http_client_free’中:\r\n/var/tmp/swoole/swoole_http_client.c:1131:25: 错误：‘http_client {或称 struct <匿名>}’没有名为‘gzip_stream’的成员\r\n         inflateEnd(&http->gzip_stream);\r\n                         ^~\r\nMakefile:224: recipe for target 'swoole_http_client.lo' failed\r\nmake: *** [swoole_http_client.lo] Error 1\r\nERROR: `make' failed\r\n`\r\n\r\n寻大神 求帮助～～～",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1010/comments",
    "author": "ghost",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-01-07T13:10:01Z",
        "body": "请安装 zlib-dev"
      }
    ]
  },
  {
    "number": 1005,
    "title": "swoole server使用TCP连接传输8K大小数据的时候报错",
    "created_at": "2017-01-05T13:06:34Z",
    "closed_at": "2017-01-06T12:40:37Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1005",
    "body": "WARN    swWorker_discard_data: [1]received the wrong data[8180 bytes] from socket#1\r\n\r\n帮忙看看是啥问题呢，是哪里限制了吗？",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1005/comments",
    "author": "idonkeyliu",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-01-06T12:40:37Z",
        "body": "这表示连接已经关闭了，收到的数据会被丢弃。"
      },
      {
        "user": "idonkeyliu",
        "created_at": "2017-01-10T12:23:32Z",
        "body": "怎么才能解决这个问题啊，，是数据过大的原因吗？还是说是连接的时间要调整"
      }
    ]
  },
  {
    "number": 991,
    "title": "php7编译swoole1.9.3，报下面的错误",
    "created_at": "2016-12-30T12:09:07Z",
    "closed_at": "2016-12-30T12:13:01Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/991",
    "body": "/bin/sh /home/swoole-src-1.9.3-stable/libtool --mode=compile cc  -I. -I/home/swoole-src-1.9.3-stable -DPHP_ATOM_INC -I/home/swoole-src-1.9.3-stable/include -I/home/swoole-src-1.9.3-stable/main -I/home/swoole-src-1.9.3-stable -I/usr/include/php -I/usr/include/php/main -I/usr/include/php/TSRM -I/usr/include/php/Zend -I/usr/include/php/ext -I/usr/include/php/ext/date/lib -I/home/swoole-src-1.9.3-stable -I/home/swoole-src-1.9.3-stable/include  -DHAVE_CONFIG_H  -Wall -pthread -g -O2   -c /home/swoole-src-1.9.3-stable/swoole_http_client.c -o swoole_http_client.lo\r\nlibtool: compile:  cc -I. -I/home/swoole-src-1.9.3-stable -DPHP_ATOM_INC -I/home/swoole-src-1.9.3-stable/include -I/home/swoole-src-1.9.3-stable/main -I/home/swoole-src-1.9.3-stable -I/usr/include/php -I/usr/include/php/main -I/usr/include/php/TSRM -I/usr/include/php/Zend -I/usr/include/php/ext -I/usr/include/php/ext/date/lib -I/home/swoole-src-1.9.3-stable -I/home/swoole-src-1.9.3-stable/include -DHAVE_CONFIG_H -Wall -pthread -g -O2 -c /home/swoole-src-1.9.3-stable/swoole_http_client.c  -DDLL_EXPORT -DPIC -o .libs/swoole_http_client.o\r\n/home/swoole-src-1.9.3-stable/swoole_http_client.c: 在函数‘http_client_onReceive’中:\r\n/home/swoole-src-1.9.3-stable/swoole_http_client.c:689:9: 警告：隐式声明函数‘inflateEnd’ [-Wimplicit-function-declaration]\r\n         inflateEnd(&http->gzip_stream);\r\n         ^\r\n/home/swoole-src-1.9.3-stable/swoole_http_client.c:689:25: 错误：‘http_client {或称 struct <匿名>}’没有名为‘gzip_stream’的成员\r\n         inflateEnd(&http->gzip_stream);\r\n                         ^\r\n/home/swoole-src-1.9.3-stable/swoole_http_client.c: 在函数‘http_client_free’中:\r\n/home/swoole-src-1.9.3-stable/swoole_http_client.c:1131:25: 错误：‘http_client {或称 struct <匿名>}’没有名为‘gzip_stream’的成员\r\n         inflateEnd(&http->gzip_stream);\r\n                         ^\r\nmake: *** [Makefile:223：swoole_http_client.lo] 错误 1\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/991/comments",
    "author": "birdy0815",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-12-30T12:13:01Z",
        "body": "请安装zlib-dev"
      }
    ]
  },
  {
    "number": 985,
    "title": "Make use_namespace as default for v2.x",
    "created_at": "2016-12-30T02:02:15Z",
    "closed_at": "2016-12-30T06:01:01Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/985",
    "body": "As v2.x is new major upgrade release, could you make the `use_namespace` as default?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/985/comments",
    "author": "taoso",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-12-30T06:01:01Z",
        "body": "You can use both styles now."
      },
      {
        "user": "taoso",
        "created_at": "2016-12-30T06:09:36Z",
        "body": "let $a = new Swoole\\Server, get_class($a) will return swoole_server"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-12-30T08:04:47Z",
        "body": "version 2.0 has been opened by default use_namespace."
      }
    ]
  },
  {
    "number": 983,
    "title": "client建立连接之后，然后服务端断开，这时候client第一次send仍然可以成功，之后才会报错。",
    "created_at": "2016-12-28T10:35:02Z",
    "closed_at": "2016-12-29T06:07:44Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/983",
    "body": "client建立连接之后，然后服务端断开，这时候client第一次send仍然可以成功，之后才会报错。",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/983/comments",
    "author": "everedit",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-12-29T06:07:44Z",
        "body": "send是写入socket缓存区，这时fin的包还未达到。"
      }
    ]
  },
  {
    "number": 961,
    "title": "swoole_http_request->$server[\"request_uri\"]和$_SERVER[\"REQUEST_URI\"]不一致",
    "created_at": "2016-12-19T08:17:23Z",
    "closed_at": "2016-12-19T09:38:09Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/961",
    "body": "php的原生$_SERVER[\"REQUEST_URI\"]是有带query string的，如“/index.php?name=hello”\r\nswoole的swoole_http_request->$server[\"request_uri\"]是不带query_string的\r\n建议统一一下向官方靠拢",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/961/comments",
    "author": "huangnaiang",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-12-19T09:38:09Z",
        "body": "swoole和fpm是完全不同的，需要特殊处理。"
      }
    ]
  },
  {
    "number": 954,
    "title": "swoole-client后台运行",
    "created_at": "2016-12-16T04:04:49Z",
    "closed_at": "2016-12-16T08:21:46Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/954",
    "body": "让client一直在后台运行要设置的参数是什么？还有logfile",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/954/comments",
    "author": "wgpqys",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-12-16T08:21:46Z",
        "body": "使用 `nohup php client.php > logfile`"
      }
    ]
  },
  {
    "number": 949,
    "title": "task in swoole_websocket_server",
    "created_at": "2016-12-12T14:24:33Z",
    "closed_at": "2016-12-13T02:01:30Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/949",
    "body": "$_server->connections is empty in onTask callback \r\n```\r\n$serv = new swoole_websocket_server(\"0.0.0.0\", 443, SWOOLE_BASE, SWOOLE_SOCK_TCP | SWOOLE_SSL);\r\n$serv->set([\r\n    'worker_num' => 2,\r\n   'task_worker_num' => 4\r\n]);\r\n\r\n$serv->on('message', function (swoole_websocket_server $_server, $frame) {\r\n   echo $frame->fd; // ---> 7\r\n   $_server->task([\"data\"=>$frame->data, \"fd\"=>$frame->fd])\r\n});\r\n$serv->on('task', function ($_server, $worker_id, $task_id, $data) {\r\n   echo $data['fd']; // ---> 7\r\n   foreach($_server->connections as $fd) {\r\n          // nothing / empty\r\n   }\r\n   $_server->push($data['fd'], $data[\"data\"]);  // ---> PHP Warning : swoole_websocket_server::push(): connection[7] is not a websocket client \r\n   /*** BUT ***/\r\n   echo count($_server->connections); // ---> 2    ???\r\n}\r\n$serv->start();\r\n```\r\nIf my code is wrong, how should I proceed? thanks!",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/949/comments",
    "author": "laurenti",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-12-13T02:01:30Z",
        "body": "If you need to communicate across processes, do not use BASE mode."
      }
    ]
  },
  {
    "number": 947,
    "title": "websocket 发送 ping 包可以，但是接收 pong 包依然还会跳过心跳检测而断开连接",
    "created_at": "2016-12-12T10:53:41Z",
    "closed_at": "2016-12-13T09:49:55Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/947",
    "body": "```php\r\n$serv = new swoole_websocket_server('127.0.0.1', '9501') or die('Swoole启动失败!');\r\n\r\n$serv->set([\r\n    'heartbeat_idle_time' => 20,\r\n    'heartbeat_check_interval' => 10,\r\n    'worker_num' => 1\r\n]);\r\n\r\n$serv->on('workerstart', function($serv){\r\n    $serv->tick(10000, function ($id) use ($serv) {\r\n        foreach($serv->connections as $fd){\r\n            $serv->push($fd, 0, 0x9);\r\n        }\r\n    });\r\n});\r\n\r\n$serv->on('open', function($server, $request){\r\n});\r\n\r\n$serv->on('message', function($server, $frame){\r\n});\r\n\r\n$serv->on('close', function($serv, $fd){\r\n});\r\n\r\n$serv->start();\r\n```\r\n\r\n\r\n**firefox websocket插件反馈信息：**\r\n```shell\r\nSocketID\tSize\tPayload\tOpCode\tMaskBit\tFinBit\tTime\r\n\t6\t1 B\t0\t\tPONG\ttrue\t\ttrue\t\t18:40:27.946\r\n\t6\t1 B\t0\t\tPING\tfalse\t\ttrue\t\t18:40:27.946\r\n\t6\t1 B\t0\t\tPONG\ttrue\t\ttrue\t\t18:40:37.946\r\n\t6\t1 B\t0\t\tPING\tfalse\t\ttrue\t\t18:40:37.946\r\n\t6\t1 B\t0\t\tPONG\ttrue\t\ttrue\t\t18:40:47.946\r\n\t6\t1 B\t0\t\tPING\tfalse\t\ttrue\t\t18:40:47.946\r\n\t6\tDisconnectedcode: 1006\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/947/comments",
    "author": "simoole",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-12-13T09:49:55Z",
        "body": "无法重现你的问题。请使用tcpdump抓包分析，检查服务器是否正常运行。"
      },
      {
        "user": "wonlon",
        "created_at": "2017-11-17T09:11:05Z",
        "body": "客户端发送ping 服务端能有事件监听pong吗？"
      }
    ]
  },
  {
    "number": 943,
    "title": "关于zm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().",
    "created_at": "2016-12-11T10:19:18Z",
    "closed_at": "2016-12-12T07:47:59Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/943",
    "body": "[2016-12-11 14:17:20 @2071.0]\tERROR\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n\r\n这个问题有很多答案,,很多说的都是 swoole内的进程不允许结束,,结束之后,master会重新fork出进程.\r\n\r\n但是addProces里面也存在这种情况,而且addProcess里面的子进程结束之后也存在这种情况, 如果仅仅是addProces本身的话倒是很有必要,但是addProces里面的子进程也这样处理, 是不是不太好?\r\n不知道swoole这样设计是不是不合理?\r\n\r\n个人认为, 父进程只管理好子进程的问题就可以了, 孙子进程就还交给孙子进程的父进程处理.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/943/comments",
    "author": "lauid",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-12-12T07:47:59Z",
        "body": "此信息只是一个提示，不影响功能，请使用`Swoole\\Event::exit`或者在进程中`return`，代替`exit/die`"
      },
      {
        "user": "kimkit",
        "created_at": "2017-03-19T10:34:54Z",
        "body": "在使用`addProcess`的时候有这个错误日志，@matyhtf 上面的解释没看明白。\r\n\r\n代码如下：\r\n```\r\n<?php\r\n\r\n$server = new swoole_http_server('127.0.0.1', 7788);\r\n\r\n$server->on('request', function ($request, $response) {\r\n    $response->end('hello world');\r\n});\r\n\r\n$server->set([\r\n    'daemonize' => true,\r\n    'log_file' => '/tmp/test.log',\r\n]);\r\n$server->addProcess(new swoole_process(function () {\r\n    $data = new ArrayObject();\r\n    $data['exit'] = false;\r\n\r\n    echo \"worker start\\n\";\r\n    pcntl_signal(15, function () use ($data) {\r\n        $data['exit'] = true;\r\n    });\r\n\r\n    while (true) {\r\n        pcntl_signal_dispatch();\r\n        if ($data['exit']) {\r\n            break;\r\n        }\r\n        echo date(\"Y-m-d H:i:s\\n\");\r\n        sleep(2);\r\n    }\r\n    echo \"worker stop\\n\";\r\n}));\r\n\r\n$server->start();\r\n```\r\n\r\n日志如下：\r\n```\r\nworker start\r\n2017-03-19 10:22:27\r\n2017-03-19 10:22:29\r\n2017-03-19 10:22:31\r\n2017-03-19 10:22:33\r\n2017-03-19 10:22:35\r\n2017-03-19 10:22:37\r\n2017-03-19 10:22:39\r\n[2017-03-19 10:22:41 #32572.0]\tNOTICE\tServer is shutdown now.\r\nworker stop\r\n[2017-03-19 10:22:41 @32582.0]\tERROR\tzm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die().\r\n```"
      },
      {
        "user": "Dragonbuf",
        "created_at": "2018-08-09T11:59:59Z",
        "body": "`class WebWorker extends Worker {\r\n\t\r\n\tpublic function run() {\r\n\t\techo \"this one\\n\";\r\n\t}\r\n\t\r\n}\r\n\r\nclass WebWork extends Threaded {\r\n\r\n\tpublic function run() {\r\n\t\techo \"webWork\\n\";\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n$http->on(\"request\", function ($request, $response) {\r\n    $response->header(\"Content-Type\", \"text/plain\");\r\n\r\n\r\n    $pool = new Pool(8, 'WebWorker');\r\n   \r\n    $pool->submit(new WebWork());\r\n    $pool->submit(new WebWork());\r\n    $pool->submit(new WebWork());\r\n    $pool->submit(new WebWork());\r\n\r\n\r\n    $response->end(\"Hello World\\n\");\r\n});\r\n\r\n$http->start();`\r\n\r\n在 swoole 最新版本中，使用 pthreads 扩展也会出现这个问题。"
      }
    ]
  },
  {
    "number": 941,
    "title": "centos7 php7.1.0",
    "created_at": "2016-12-10T02:32:13Z",
    "closed_at": "2016-12-12T07:49:45Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/941",
    "body": " 版本号 swoole1.9.1  php 7.1.0 操作系统 centos7.1 安装完毕后 php web 访问 phpinfo swoole显示正常\r\ncli 执行 php-m 提示 PHP Warning:  PHP Startup: Unable to load dynamic library '/usr/local/php/lib/php/extensions/no-debug-non-zts-20160303/swoole.so' - /usr/local/php/lib/php/extensions/no-debug-non-zts-20160303/swoole.so: undefined symbol: sapi_globals_id in Unknown on line 0\r\n这是php的编译选项\r\nphp.ini 及php-cli.ini配置都一样\r\n./configure --prefix=/usr/local/php --with-config-file-path=/usr/local/php/ --with-gd  --with-jpeg-dir --with-png-dir --with-zlib-dir --with-freetype-dir=/usr/include/freetype2/freetype --enable-fpm --enable-mbstring  --enable-json --enable-libxml --enable-gd-native-ttf  --enable-gd-jis-conv --with-iconv-dir=/usr/local/libiconv --enable-bcmath --enable-dom --enable-filter --enable-xml --enable-xmlreader --enable-xmlwriter --with-openssl --enable-calendar --enable-soap --with-mhash --with-mcrypt  --with-curl  --enable-sockets  --with-gettext --with-libdir=lib64 --without-pear --enable-opcache --disable-ipv6  --enable-shmop --with-pcre-dir=/usr/local/pcre --enable-mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd  --with-pdo-pgsql=/usr/local/pgsql/bin --enable-ftp --with-xmlrpc --enable-pcntl --enable-sockets --without-pear \r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/941/comments",
    "author": "lizigeng111",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-12-12T07:49:45Z",
        "body": "重新编译安装swoole"
      }
    ]
  },
  {
    "number": 940,
    "title": "zend_mm_heap corrupted",
    "created_at": "2016-12-09T18:52:38Z",
    "closed_at": "2016-12-12T03:01:25Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/940",
    "body": "When declare swoole server in class, like so :\r\n\r\n```\r\n<?php\r\nclass Server {\r\n  private $server;\r\n  public function run() {\r\n    $this->server = new swoole_websocket_server(\"0.0.0.0\", 443, SWOOLE_BASE, SWOOLE_SOCK_TCP | SWOOLE_SSL);\r\n    $this->server->start();\r\n  }\r\n}\r\n$srv = new Server();\r\n$srv->run();\r\n```\r\n\r\nI get \"zend_mm_heap corrupted\" error\r\nBUT\r\nwhen you run the server directly :\r\n\r\n```\r\n<?php\r\n$server = new swoole_websocket_server(\"0.0.0.0\", 443, SWOOLE_BASE, SWOOLE_SOCK_TCP | SWOOLE_SSL);\r\n```\r\n\r\nit's ok",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/940/comments",
    "author": "laurenti",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-12-12T03:01:25Z",
        "body": "This is caused by the `server::set` method.\r\nThe latest code has been fixed."
      },
      {
        "user": "laurenti",
        "created_at": "2016-12-12T13:57:12Z",
        "body": "with latest code it's ok."
      }
    ]
  },
  {
    "number": 938,
    "title": "使用swoole_websocket_server, 客户端主动断开连接, 该连接依然存在于$server->connections中",
    "created_at": "2016-12-08T15:44:14Z",
    "closed_at": "2016-12-10T01:51:59Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/938",
    "body": "> 无论由客户端发起close还是服务器端主动调用$serv->close()关闭连接，都会触发此事件。因此只要连接关闭，就一定会回调此函数\r\n1.7.7+版本以后onClose中依然可以调用connection_info方法获取到连接信息，在onClose回调函数执行完毕后才会调用close关闭TCP连接\r\n\r\n请问哪个方法可以过滤掉该连接?还是说该连接程序里自己处理掉.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/938/comments",
    "author": "koiding",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-12-10T01:51:59Z",
        "body": "onClose回调完成后就会清理此链接。"
      }
    ]
  },
  {
    "number": 934,
    "title": "高并发下的socket如何处理",
    "created_at": "2016-12-08T00:03:28Z",
    "closed_at": "2016-12-12T08:24:14Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/934",
    "body": "场景是这样的：\r\n用swoole作http server，提供RESTful API给客户使用，在http server的 request异步调用里我需要用php的socket连接另外的一台服务器进行认证、发送信息、等待发送报告、处理报告状态显示给客户看这4个步骤，现在设计要求支持800请求每秒，第三步骤等报告的时间是5分钟之内的随机时间里会发送到我这边先前经过认证的socket，请问一下这个怎么处理，swoole有没有全局共享的socket，这样的话只要做一次socket认证就可以了，发送信息和等待报告重复使用这个socket；或者每一个请求都走上述4个步骤，到第三步时把socket发送到task池里，这样的话，服务器是不是会有很多socket挂在那里等报告？",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/934/comments",
    "author": "wgpqys",
    "comments": [
      {
        "user": "captainQW",
        "created_at": "2016-12-08T12:00:43Z",
        "body": "swoole task应该可以支持你的这个需求。"
      },
      {
        "user": "wgpqys",
        "created_at": "2016-12-09T00:17:36Z",
        "body": "那TASK里会挂非常多的socket，不知道一个task进程是不是只能处理一个等待读取报告的socket，好像socket是资源类型还没法投到task里去"
      },
      {
        "user": "wgpqys",
        "created_at": "2016-12-09T09:12:35Z",
        "body": "像这种要等待时间的socket怎么解决比较好，发task又发不过去，阻塞在那里等又不行，求解？"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-12-12T08:24:14Z",
        "body": "使用`addProcess`添加一个异步的进程维持这些Socket"
      }
    ]
  },
  {
    "number": 933,
    "title": "http server, SWOOLE_BASE 模式下为什么要所有的进程都会监听端口, 而 SWOOLE_PROCESS只有master在监听端口,?",
    "created_at": "2016-12-07T01:58:20Z",
    "closed_at": "2016-12-07T06:30:09Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/933",
    "body": "swoole base 可不可以也只让master进程监听端口?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/933/comments",
    "author": "lauid",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-12-07T06:30:08Z",
        "body": "那不就变成PROCESS模式了。"
      },
      {
        "user": "lauid",
        "created_at": "2016-12-07T08:27:15Z",
        "body": "我的情况是addProcess里面有管理其他的swoole_proces进程\r\n在SWOOLE_PROCESS模式下,kill -15 masterPid之后 , 只有worker进程结束了,其他的都还在.\r\n\r\n[root@xxx:src]#ps axu| grep xxxx\r\nroot 13194 0.0 0.7 376400 8068 ? Ssl 10:49 0:00 xxxx: master process 13194\r\nroot 13195 0.0 0.7 300164 7788 ? S 10:49 0:00 xxxx: manager 13195\r\nroot 13197 0.0 0.7 298340 7916 ? S 10:49 0:00 xxxx: worker process 13197\r\nroot 13198 0.0 0.7 298340 7916 ? S 10:49 0:00 xxxx: worker process 13198\r\nroot 13199 0.0 0.7 298340 7916 ? S 10:49 0:00 xxxx: worker process 13199\r\nroot 13200 0.2 0.8 301052 9052 ? S 10:49 0:00 xxxx: cron process 13200\r\nroot 13201 0.0 0.7 301004 7544 ? S 10:49 0:00 xxxx: job process 13201\r\nroot 13209 0.0 0.7 301004 7556 ? S 10:49 0:00 xxxx: job process 13209\r\nroot 13216 0.0 0.0 103252 868 pts/2 S+ 10:49 0:00 grep xxxx\r\n[root@xxx:src]#pstree -alp 13194\r\nphp,13194\r\n├─php,13195\r\n│ ├─php,13197\r\n│ ├─php,13198\r\n│ ├─php,13199\r\n│ └─php,13200\r\n│ ├─php,13201\r\n│ │ └─usleep,13202 32413000\r\n│ ├─php,13209\r\n│ │ └─usleep,13210 27996000\r\n│ └─php,13217\r\n│ └─usleep,13218 8703000\r\n└─{php},13196\r\n[root@xxx:src]#kill -15 13194\r\n[root@xxx:src]#ps axu| grep xxxx\r\nroot 13194 0.0 0.7 376400 8104 ? Ssl 10:49 0:00 xxxx: master process 13194\r\nroot 13195 0.0 0.7 300164 7796 ? S 10:49 0:00 xxxx: manager 13195\r\nroot 13200 0.1 0.8 301052 9076 ? S 10:49 0:00 xxxx: cron process 13200\r\nroot 13223 0.0 0.7 301004 7536 ? S 10:49 0:00 xxxx: job process 13223\r\nroot 13228 0.0 0.7 301004 7536 ? S 10:49 0:00 xxxx: job process 13228\r\nroot 13289 0.0 0.0 103252 868 pts/2 S+ 10:50 0:00 grep xxxx\r\n[root@xxx:src]#pstree -alp 13194\r\nphp,13194\r\n├─php,13195\r\n│ └─php,13200\r\n│ ├─php,13223\r\n│ │ └─usleep,13224 31386000\r\n│ └─php,13228\r\n│ └─usleep,13229 24676000\r\n└─{php},13196\r\n\r\nkill SIGTERM master之后,只有worker 进程结束了,,其他的都没有\r\n"
      },
      {
        "user": "GXhua",
        "created_at": "2016-12-07T08:37:57Z",
        "body": "你需要在addProcess进程里面监听sigterm信号  收到信号后向所有的swoole_process发送结束进程的信号"
      },
      {
        "user": "lauid",
        "created_at": "2016-12-07T09:29:11Z",
        "body": "这个倒是无所谓的,就算不给结束信号,,,这些swoole_proces也会被1进程接管,,\r\n我只想让master和manager这些正常结束,,,目前的情况只有worker结束了,master和manger没有结束而且也没有走shutdown,更何况是addProces了,这是很纳闷的"
      }
    ]
  },
  {
    "number": 931,
    "title": "addProcess 应该是单独进程为什么也要继承master监听端口?",
    "created_at": "2016-12-05T10:48:42Z",
    "closed_at": "2016-12-05T11:01:15Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/931",
    "body": "",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/931/comments",
    "author": "lauid",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-12-05T11:01:15Z",
        "body": "addProcess的子进程TCP监听端口不会继承，但会保留UDP端口，因为可能需要向对端发送数据。UDP的实现与TCP不同，UDP是直接在当前进程内发送数据到对端的，不需要经过master进程的reactor线程。"
      },
      {
        "user": "lauid",
        "created_at": "2016-12-05T11:11:37Z",
        "body": "但是我的addProcess就是继承了swoole server的端口, 本想server shutdown之后,让系统回收addProces,但是现在addProces还在,端口占用,server就起不来了."
      },
      {
        "user": "GXhua",
        "created_at": "2016-12-05T13:08:10Z",
        "body": "swoole是先创建管理进程主进程再去监听 管理再去创建addprocess的进程所以理论上是不应该的   可是把你的代码贴上  还有版本   另外确认下reuse开没"
      },
      {
        "user": "lauid",
        "created_at": "2016-12-05T15:01:00Z",
        "body": "swoole support => enabled\r\nVersion => 1.8.12\r\n这个版本没有reuse的,况且我的内核版本2.6\r\n我用losf 检测占用端口,addproces是在的"
      }
    ]
  },
  {
    "number": 923,
    "title": "swoole_pop and swoole_push",
    "created_at": "2016-11-28T08:30:42Z",
    "closed_at": "2016-11-29T06:47:12Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/923",
    "body": "前提：$process->useQueue(0, 1);\r\nPHP_METHOD(swoole_process, push) 和PHP_METHOD(swoole_process, pop) 中\r\nmessage.type = process->id;\r\n这样对一个进程独享一个消息队列，和子进程通过type来存取时，这样是OK的，但是对于多个进程共享一个消息队列，在队列中，和各自的子进程通过type来存取时，就会发生错乱，因为不同进程可能具有相同的id，所以建议这里改成**message.type = process->pid;**",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/923/comments",
    "author": "yhl54199",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-11-29T06:47:12Z",
        "body": "$process对象与进程不是绑定关系，只要$process对象不销毁，就可以使用管道，进程意外退出可以继续用start方法启用新的进程。"
      }
    ]
  },
  {
    "number": 921,
    "title": "coredump with swoole_http_server",
    "created_at": "2016-11-24T15:00:09Z",
    "closed_at": "2016-11-25T05:41:43Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/921",
    "body": "swoole配置：\r\n\r\n> \r\n            'worker_num'      => 8, //worker process num\r\n            'backlog'         => 16, //listen backlog \r\n            'max_request'     => 5000,\r\n            'task_worker_num' => 8,\r\n            'task_worker_max' => 16,\r\n            'dispatch_mode'      => 3,   \r\n            'user'               => 'rrxuser',\r\n            'group'              => 'rrxuser',\r\n            'open_tcp_nodelay'   => 1,   \r\n            'enable_reuse_port'  => 1,\r\n            'log_file'           => '/data/logs/swoole.log',\r\n            'log_level'          => 0,   \r\n            'daemonize'          => 1,   \r\n            'package_max_length' => 5242880,\r\n\r\n\r\n\r\n\r\ncore bt:\r\n\r\n#0  zend_mm_alloc_small (heap=0x7fa343800040, ptr=0x7fa31fb3c540, size=<value optimized out>, copy_size=352) at /data/php7-src/php-7.0.9/Zend/zend_alloc.c:1295\r\n#1  zend_mm_alloc_heap (heap=0x7fa343800040, ptr=0x7fa31fb3c540, size=<value optimized out>, copy_size=352) at /data/php7-src/php-7.0.9/Zend/zend_alloc.c:1366\r\n#2  zend_mm_realloc_heap (heap=0x7fa343800040, ptr=0x7fa31fb3c540, size=<value optimized out>, copy_size=352) at /data/php7-src/php-7.0.9/Zend/zend_alloc.c:1644\r\n#3  0x0000000000850dc2 in zend_string_realloc (execute_data=0x7fa343814bf0) at /data/php7-src/php-7.0.9/Zend/zend_string.h:187\r\n#4  ZEND_CONCAT_SPEC_TMPVAR_TMPVAR_HANDLER (execute_data=0x7fa343814bf0) at /data/php7-src/php-7.0.9/Zend/zend_vm_execute.h:44737\r\n#5  0x0000000000805190 in execute_ex (ex=<value optimized out>) at /data/php7-src/php-7.0.9/Zend/zend_vm_execute.h:417\r\n#6  0x00000000007b8ba8 in zend_call_function (fci=0x7ffdaf001620, fci_cache=0x7ffdaf001670) at /data/php7-src/php-7.0.9/Zend/zend_execute_API.c:866\r\n#7  0x00000000006be0b9 in zif_array_map (execute_data=<value optimized out>, return_value=0x7fa3438147c0) at /data/php7-src/php-7.0.9/ext/standard/array.c:5349\r\n#8  0x000000000083c998 in ZEND_DO_FCALL_BY_NAME_SPEC_HANDLER (execute_data=0x7fa343814710) at /data/php7-src/php-7.0.9/Zend/zend_vm_execute.h:714\r\n#9  0x0000000000805190 in execute_ex (ex=<value optimized out>) at /data/php7-src/php-7.0.9/Zend/zend_vm_execute.h:417\r\n#10 0x00000000007b8ba8 in zend_call_function (fci=0x7ffdaf0018a0, fci_cache=0x7ffdaf001820) at /data/php7-src/php-7.0.9/Zend/zend_execute_API.c:866\r\n#11 0x00000000007b913a in call_user_function_ex (function_table=<value optimized out>, object=<value optimized out>, function_name=<value optimized out>, retval_ptr=<value optimized out>, \r\n    param_count=<value optimized out>, params=<value optimized out>, no_separation=0, symbol_table=0x0) at /data/php7-src/php-7.0.9/Zend/zend_execute_API.c:685\r\n#12 0x00007fa342c4a311 in sw_call_user_function_ex (serv=0x193bc20, req=<value optimized out>) at /data/php7-src/swoole-src/php7_wrapper.h:232\r\n#13 http_onReceive (serv=0x193bc20, req=<value optimized out>) at /data/php7-src/swoole-src/swoole_http_server.c:981\r\n#14 0x00007fa342c75b02 in swWorker_onTask (factory=<value optimized out>, task=0x7ffdaf001b30) at /data/php7-src/swoole-src/src/network/Worker.c:193\r\n#15 0x00007fa342c75c6b in swWorker_onPipeReceive (reactor=<value optimized out>, event=0x7ffdaf003ba0) at /data/php7-src/swoole-src/src/network/Worker.c:563\r\n#16 0x00007fa342c675d0 in swReactorEpoll_wait (reactor=0x193cdd0, timeo=<value optimized out>) at /data/php7-src/swoole-src/src/reactor/ReactorEpoll.c:258\r\n#17 0x00007fa342c76abf in swWorker_loop (factory=<value optimized out>, worker_id=<value optimized out>) at /data/php7-src/swoole-src/src/network/Worker.c:510\r\n#18 0x00007fa342c73d63 in swManager_spawn_worker (factory=0x193c050, worker_id=2) at /data/php7-src/swoole-src/src/network/Manager.c:669\r\n#19 0x00007fa342c747a9 in swManager_start (factory=0x193c050) at /data/php7-src/swoole-src/src/network/Manager.c:133\r\n#20 0x00007fa342c6464a in swFactoryProcess_start (factory=0x193c050) at /data/php7-src/swoole-src/src/factory/FactoryProcess.c:86\r\n#21 0x00007fa342c6a4ff in swServer_start (serv=0x193bc20) at /data/php7-src/swoole-src/src/network/Server.c:658\r\n#22 0x00007fa342c48eaf in zim_swoole_http_server_start (execute_data=0x7fa343813a50, return_value=0x7fa343813a40) at /data/php7-src/swoole-src/swoole_http_server.c:1388\r\n#23 0x000000000083d2b8 in ZEND_DO_FCALL_SPEC_HANDLER (execute_data=0x7fa343813840) at /data/php7-src/php-7.0.9/Zend/zend_vm_execute.h:842\r\n#24 0x0000000000805190 in execute_ex (ex=<value optimized out>) at /data/php7-src/php-7.0.9/Zend/zend_vm_execute.h:417\r\n#25 0x00000000008582eb in zend_execute (op_array=0x7fa34387d000, return_value=<value optimized out>) at /data/php7-src/php-7.0.9/Zend/zend_vm_execute.h:458\r\n#26 0x00000000007c5b43 in zend_execute_scripts (type=8, retval=0x0, file_count=3) at /data/php7-src/php-7.0.9/Zend/zend.c:1427\r\n#27 0x00000000007680b0 in php_execute_script (primary_file=0x7ffdaf0072b0) at /data/php7-src/php-7.0.9/main/main.c:2494\r\n#28 0x000000000085c64a in do_cli (argc=3, argv=0x1803440) at /data/php7-src/php-7.0.9/sapi/cli/php_cli.c:974\r\n#29 0x000000000085ce4a in main (argc=3, argv=0x1803440) at /data/php7-src/php-7.0.9/sapi/cli/php_cli.c:1344\r\n\r\n\r\nphp版本：7.0.\r\nswoole版本：1.9.0\r\n把worker_num和backlog调成4就没问题，8就会core,16也会，\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/921/comments",
    "author": "lscgzwd",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-11-25T05:41:42Z",
        "body": "关闭opcache试试。或者设置 php.ini  `opcache.enable_cli = off`"
      },
      {
        "user": "lscgzwd",
        "created_at": "2016-11-28T05:10:26Z",
        "body": "确实关闭后可以了，但是同样的参数或者更大的参数，在某些环境下确不会coredump,  生产上也是开了Opcache,并且参数是256也没有报错，线下环境确报错。"
      }
    ]
  },
  {
    "number": 920,
    "title": "opcode缓存对于swoole-http-server是不是没有作用了？",
    "created_at": "2016-11-24T14:32:28Z",
    "closed_at": "2016-11-25T05:39:49Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/920",
    "body": "如题，swoole-http-serve一直都在运行没有退出，也就是代码不需要重新语法分析、编译opcode过程，这样的话是不是各种opcode缓存方案对于swoole来说就没什么作用了？如果有作用，开启opcode加速对swoole的作用大吗？",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/920/comments",
    "author": "wgpqys",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-11-25T05:39:49Z",
        "body": "swoole本身就是常驻内存的，PHP类的代码只加载一次，opcache作用不太大，可以关闭。"
      }
    ]
  },
  {
    "number": 919,
    "title": "WARNING: unrecognized options: --enable-coroutine",
    "created_at": "2016-11-24T10:25:30Z",
    "closed_at": "2016-11-25T05:39:05Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/919",
    "body": "在编译时增加--enable-coroutine，--enable-async-redis是官方文档的说明。加上后出现如上错误，在开启命名空间的时候\r\n```\r\nnew Swoole\\Coroutine\\Redis();\r\n```\r\n提示找不到Redis类。php redis扩展hiredis也都安装了。\r\n我的环境：centos7.2,php7.0,swoole1.9.0",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/919/comments",
    "author": "similarJ",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-11-25T05:39:05Z",
        "body": "coroutine是2.0的特性，1.9.0不支持。"
      }
    ]
  },
  {
    "number": 912,
    "title": "在swoole_websocket_server start回调启动的swoole_process中无法向客户端push消息?",
    "created_at": "2016-11-15T02:39:40Z",
    "closed_at": "2016-11-15T07:56:16Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/912",
    "body": "实例代码如下:\r\n```php\r\n<?php\r\n$server = new \\swoole_websocket_server(\"0.0.0.0\", 9443);\r\n\r\n$server->set(array(\r\n    'worker_num' => 1,\r\n    'max_request' => 500,\r\n    'task_worker_num' => 1,\r\n    'max_connection' => 1024\r\n));\r\n\r\n$server->on('start', function (\\swoole_websocket_server $server) {\r\n    $pid = getmypid();\r\n    $mPid = getmypid();\r\n    echo \"this is Master pid: $mPid\\n\";\r\n    \r\n    $process = new swoole_process('process');\r\n    $pid = $process->start();\r\n});\r\n\r\n$server->on('message', function (\\swoole_websocket_server $server, $frame) {\r\n    echo \"receive from {$frame->fd}:{$frame->data},opcode:{$frame->opcode},fin:{$frame->finish} workerid: {$server->worker_id}\\n\";\r\n});\r\n\r\n$server->on('task', function (\\swoole_server $serv, $task_id, $from_id, $data) {});\r\n$server->on('finish', function (\\swoole_server $serv, $task_id, $from_id, $data) {});\r\n\r\n$server->start();\r\n\r\nfunction process(swoole_process $process)\r\n{\r\n    global $server;\r\n    swoole_set_process_name(\"php processor\");\r\n    // 等待客户端连接, 20秒后向客户端循环发送数据\r\n    swoole_timer_after(20 * 1000, function() use ($server){\r\n        foreach ($server->connections as $fd) {\r\n            var_dump($fd);\r\n            $server->push($fd, 'hello');\r\n        }\r\n    });\r\n    \r\n}\r\n```\r\n20秒后, var_dump出了fd, 但是客户端没有收到数据.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/912/comments",
    "author": "kings36503",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-11-15T07:56:16Z",
        "body": "使用`addProcess`，不要在`onStart`回调函数中创建process\n"
      },
      {
        "user": "kings36503",
        "created_at": "2016-11-15T09:04:16Z",
        "body": "ok, 可以了, 多谢.\n"
      },
      {
        "user": "kings36503",
        "created_at": "2016-11-15T09:04:52Z",
        "body": "贴上修改后的实例代码:\n\n``` php\n<?php\n$server = new \\swoole_websocket_server(\"0.0.0.0\", 9443);\n\n$server->set(array(\n    'worker_num' => 1,\n    'max_request' => 500,\n    'task_worker_num' => 1,\n    'max_connection' => 1024\n));\n\n$process = new swoole_process('process');\n$pid = $process->start();\n$server->addProcess($process);\n\n\n$server->on('start', function (\\swoole_websocket_server $server) {\n    $pid = getmypid();\n    echo \"this is Master pid: $pid\\n\";\n});\n\n$server->on('message', function (\\swoole_websocket_server $server, $frame) {\n    echo \"receive from {$frame->fd}:{$frame->data},opcode:{$frame->opcode},fin:{$frame->finish} workerid: {$server->worker_id}\\n\";\n});\n\n$server->on('task', function (\\swoole_server $serv, $task_id, $from_id, $data) {});\n$server->on('finish', function (\\swoole_server $serv, $task_id, $from_id, $data) {});\n\n$server->start();\n\nfunction process(swoole_process $process)\n{\n    global $server;\n    swoole_set_process_name(\"php processor\");\n\n    swoole_timer_after(10 * 1000, function() use ($server){\n        foreach ($server->connections as $fd) {\n            var_dump($fd);\n            $server->push($fd, 'hello');\n        }\n    });\n\n}\n```\n"
      }
    ]
  },
  {
    "number": 907,
    "title": "Strange perfomace",
    "created_at": "2016-11-10T06:01:52Z",
    "closed_at": "2016-11-11T06:02:21Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/907",
    "body": "Hi. I run benchmark swoole.php and compared it with walkor/Workerman. My results:\r\n\r\n**Swoole**\r\n```php\r\n$serv = new swoole_server(\"127.0.0.1\", 9502, SWOOLE_BASE);\r\n$serv->set([\r\n    'worker_num' => 4,\r\n]);\r\n$serv->on('receive', function (swoole_server $serv, $fd, $from_id, $data) {\r\n    $serv->send($fd, \"HTTP/1.1 200 OK\\r\\nConnection: keep-alive\\r\\nServer: workerman\\r\\nContent-Length: 5\\r\\n\\r\\nhello\");\r\n    //$serv->close($fd);\r\n});\r\n$serv->start();\r\n```\r\n**Result**\r\n```Requests per second: 167618.24 [#/sec] (mean)```\r\n\r\n---\r\n**Workerman**\r\n```php\r\nuse Workerman\\Worker;\r\nrequire_once 'your/path/Workerman/Autoloader.php';\r\n\r\n$worker = new Worker('tcp://0.0.0.0:1234');\r\n$worker->count=4;\r\n$worker->onMessage = function($connection, $data)\r\n{\r\n    $connection->send(\"HTTP/1.1 200 OK\\r\\nConnection: keep-alive\\r\\nServer: workerman\\r\\nContent-Length: 5\\r\\n\\r\\nhello\");\r\n};\r\nWorker::runAll();\r\n```\r\n\r\n```Result: Requests per second: 125142.43 [#/sec] (mean)```\r\n\r\n---\r\n**My machine**\r\n\r\nOS: Debian 8u3 32Bit\r\nPHP: PHP 5.6.23-0+deb8u1\r\nSwoole version: v1.8.13\r\n\r\nPHP modules:\r\n```\r\nbcmath\r\nbz2\r\ncalendar\r\nCore\r\nctype\r\ncurl\r\ndate\r\ndba\r\ndom\r\nereg\r\nevent\r\nexif\r\nfileinfo\r\nfilter\r\nftp\r\ngd\r\ngeoip\r\ngettext\r\ngmp\r\nhash\r\nhttp\r\niconv\r\nimagick\r\nimap\r\nintl\r\njson\r\nlibpuzzle\r\nlibxml\r\nmbstring\r\nmcrypt\r\nmhash\r\nmurmurhash3\r\nmysql\r\nmysqli\r\nopenssl\r\npcntl\r\npcre\r\nPDO\r\npdo_mysql\r\npdo_pgsql\r\npgsql\r\nphalcon\r\nPhar\r\nposix\r\npropro\r\npsr\r\nraphf\r\nreadline\r\nReflection\r\nsass\r\nsession\r\nshmop\r\nSimpleXML\r\nsoap\r\nsockets\r\nSPL\r\nstandard\r\nswoole\r\nsysvmsg\r\nsysvsem\r\nsysvshm\r\ntidy\r\ntokenizer\r\nwddx\r\nxdebug\r\nxml\r\nxmlreader\r\nxmlrpc\r\nxmlwriter\r\nxsl\r\nyaf\r\nzip\r\nzlib\r\n```\r\n\r\nI guess swoole must be more faster or it is OK? Can you compare swoole tcp benchmark with walkor/Workerman.\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/907/comments",
    "author": "kse300489",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-11-10T06:29:04Z",
        "body": "The performance of this scenario is not very different. The advantages of swoole in protocol handling and data parsing. \n\nYou should compare `swoole\\http\\server` or `swoole\\websocket\\server` benchmark with walkor/Workerman http server.\n"
      },
      {
        "user": "oohook",
        "created_at": "2016-11-10T06:39:54Z",
        "body": "good job!\n"
      },
      {
        "user": "xiaoxintiaoda",
        "created_at": "2016-11-10T06:40:22Z",
        "body": "yo,what's up,man....\n"
      },
      {
        "user": "lizhichao",
        "created_at": "2016-11-10T06:57:34Z",
        "body": "围观\n"
      },
      {
        "user": "kse300489",
        "created_at": "2016-11-10T06:58:40Z",
        "body": "@matyhtf ty for answer, i compare http servers.\n"
      },
      {
        "user": "kse300489",
        "created_at": "2016-11-18T04:44:38Z",
        "body": "May be somebody this will be interesting.\n\n```\nswoole\\http\\server\nRequests per second:    67213.61 [#/sec] (mean)\n```\n\n```\nwalkor/Workerman\nRequests per second:    41669.86 [#/sec] (mean)\n```\n"
      }
    ]
  },
  {
    "number": 902,
    "title": "swArray_fetch: fetch index[1289]",
    "created_at": "2016-11-06T05:07:08Z",
    "closed_at": "2016-11-07T02:33:22Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/902",
    "body": "centos7,swoole ver 1.7.22 stable\r\n[2016-11-06 13:05:58 *24594.9]\tWARN\tswArray_fetch: fetch index[1289] out of array\r\nHow to solve it?upgrade?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/902/comments",
    "author": "pangbolike",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-11-07T02:33:10Z",
        "body": "Upgrade swoole or ignore this error message.\n"
      }
    ]
  },
  {
    "number": 897,
    "title": "有没有可能在$server->start()后 ，依然能够调用$server->addListener() 注册监听端口呢。 ",
    "created_at": "2016-10-31T08:04:06Z",
    "closed_at": "2016-11-03T06:23:24Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/897",
    "body": "server start开启之后 on 事件里面的回调函数 对 这之后 addListener 注册的新的 端口 依然适用。\r\n有没有什么注册机制实现这个功能呢。很有用啊。",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/897/comments",
    "author": "liaozibo",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-11-03T06:23:11Z",
        "body": "目前不支持动态添加，必须在启动前设置好监听端口。\n"
      }
    ]
  },
  {
    "number": 896,
    "title": "ERROR: The DSP swoole.dsp does not exist.",
    "created_at": "2016-10-29T04:23:05Z",
    "closed_at": "2016-10-31T02:17:46Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/896",
    "body": "ERROR: The DSP swoole.dsp does not exist.~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/896/comments",
    "author": "hanwenbo",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-10-31T02:17:46Z",
        "body": "Windows is not supported, You can use cygwin.\n"
      }
    ]
  },
  {
    "number": 893,
    "title": "work proces高并发长期出现TASK_UNINTERRUPTIBLE状态",
    "created_at": "2016-10-27T05:03:33Z",
    "closed_at": "2016-10-27T10:28:10Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/893",
    "body": "`\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\n\nroot     11155  0.0  0.8 296692  8532 ?        D    04:26   0:00 worker process\n`\n长期处在这个状态,无法结束\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/893/comments",
    "author": "lauid",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-10-27T06:17:19Z",
        "body": "检查磁盘状态，D的状态表示等待系统资源，一般是无法写入磁盘。\n"
      },
      {
        "user": "lauid",
        "created_at": "2016-10-27T08:45:25Z",
        "body": "谢谢,是的,是多个请求写日志,造成的.\n"
      },
      {
        "user": "lauid",
        "created_at": "2016-10-27T08:47:26Z",
        "body": "swoole有没有异步写日志功能?asyncio现在可以生产环境?\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-10-27T10:28:10Z",
        "body": "虽然有但是解决不了你的问题，AsyncIO也是用多线程同步阻塞模拟的。\n"
      }
    ]
  },
  {
    "number": 892,
    "title": "swoole_http_server addProcess 如何优雅结束",
    "created_at": "2016-10-27T01:59:40Z",
    "closed_at": "2016-10-27T04:06:12Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/892",
    "body": "``` php\n$http = new swoole_http_server( '0.0.0.0', 9501, SWOOLE_BASE );\n$http->on('Shutdown', function(){\n});\n\n$myProcess = new swoole_process( function() {\n    for( $i = 0 ; $i < 5 ; $i++ )\n    {\n        $pid = ( new swoole_process )->start();\n    }\n    swoole_process::signal(SIGCHLD, function ($signo) { //wait; });\n    pcntl_signal(SIGTERM, function ($signo) {\n        echo 'signal term.'; /// send term to http. 结束这里没有收到信号?怎么优雅结束myProces以及他的子进程\n        exit();\n    });\n}, false );\n$http->addProcess($myProcess);\n$http->start();\n```\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/892/comments",
    "author": "lauid",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-10-27T04:02:14Z",
        "body": "你的代码不可执行，存在错误。\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-10-27T04:06:12Z",
        "body": "如果你要用`pcntl_signal`需要在增加`declare(ticks = 1);`\n"
      }
    ]
  },
  {
    "number": 878,
    "title": "swoole_server->addProcess创建的进程阻塞在epoll_wait(154, ^C <unfinished ...>是什么原因呢",
    "created_at": "2016-10-12T11:37:41Z",
    "closed_at": "2016-10-13T09:45:10Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/878",
    "body": "swoole_server->addProcess创建的进程阻塞在epoll_wait(154, ^C <unfinished ...>是什么原因呢\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/878/comments",
    "author": "wheelswang",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-10-13T09:45:10Z",
        "body": "异步IO就是在`epoll_wait`上循环。\n"
      }
    ]
  },
  {
    "number": 871,
    "title": "HttpServer segfault with Thread mode",
    "created_at": "2016-10-10T18:10:51Z",
    "closed_at": "2016-10-28T10:05:46Z",
    "labels": [
      "enhancement",
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/871",
    "body": "I try the threading mode with this code:\n\n``` php\nclass myCounter{\n    private static $i = 0;\n    public static function inc(){ return ++self::$i;}\n}\n$http = new swoole_http_server(\"0.0.0.0\", 9100, SWOOLE_THREAD);\n$http->set([ 'daemonize' => FALSE, 'worker_num' => 4]);\n\n$http->on('request', function(swoole_http_request $request, swoole_http_response $response){\n    $response->end(sprintf('Counter: %s' . PHP_EOL, myCounter::inc()));\n});\n$http->start();\n```\n\nUnfortunately I get lot of different segfaults:\n\n```\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7fffeb7fe700 (LWP 26)]\n0x00005555557cb644 in zend_hash_find ()\n(gdb) backtrace\n#0  0x00005555557cb644 in zend_hash_find ()\n#1  0x00005555557f33dc in zend_std_get_static_property ()\n#2  0x00005555558103fa in ?? ()\n#3  0x00005555557f76db in execute_ex ()\n#4  0x00005555557a7348 in dtrace_execute_ex ()\n#5  0x000055555583c48d in ?? ()\n#6  0x00005555557f76db in execute_ex ()\n#7  0x00005555557a7348 in dtrace_execute_ex ()\n#8  0x00005555557a905e in zend_call_function ()\n#9  0x00005555557a9449 in call_user_function_ex ()\n#10 0x00007ffff32aedec in sw_call_user_function_ex (ymbol_table=<optimized out>, no_separation=<optimized out>, params=<optimized out>, param_count=<optimized out>, retval_ptr_ptr=<optimized out>, \n    function_name=<optimized out>, object_pp=<optimized out>, function_table=<optimized out>) at /usr/local/src/swoole-src/php7_wrapper.h:231\n#11 http_onReceive (serv=0x555555c5a100 <executor_globals>, req=0x5555565b61e0) at /usr/local/src/swoole-src/swoole_http_server.c:981\n#12 0x00007ffff32d44fb in swWorker_onTask (factory=0x8, task=0x5555565b61e0) at /usr/local/src/swoole-src/src/network/Worker.c:193\n#13 0x00007ffff32c26e2 in swFactoryThread_onTask (pool=<optimized out>, data=0x5555565b61e0, len=<optimized out>) at /usr/local/src/swoole-src/src/factory/FactoryThread.c:241\n#14 0x00007ffff32ce487 in swThreadPool_loop (arg=<optimized out>) at /usr/local/src/swoole-src/src/network/ThreadPool.c:181\n#15 0x00007ffff62b30a4 in start_thread (arg=0x7fffeb7fe700) at pthread_create.c:309\n#16 0x00007ffff65b062d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\n```\n\n```\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7fffeb7fe700 (LWP 40)]\n0x0000555555793f53 in _emalloc ()\n(gdb) backtrace\n#0  0x0000555555793f53 in _emalloc ()\n#1  0x00005555557c5162 in _zend_hash_str_update ()\n#2  0x00005555557ba891 in add_assoc_stringl_ex ()\n#3  0x00007ffff32aeb74 in http_onReceive (serv=0x55555657a000, req=0x5555565b6420) at /usr/local/src/swoole-src/swoole_http_server.c:918\n#4  0x00007ffff32d44fb in swWorker_onTask (factory=0x4, task=0x5555565b6420) at /usr/local/src/swoole-src/src/network/Worker.c:193\n#5  0x00007ffff32c26e2 in swFactoryThread_onTask (pool=<optimized out>, data=0x5555565b6420, len=<optimized out>) at /usr/local/src/swoole-src/src/factory/FactoryThread.c:241\n#6  0x00007ffff32ce487 in swThreadPool_loop (arg=<optimized out>) at /usr/local/src/swoole-src/src/network/ThreadPool.c:181\n#7  0x00007ffff62b30a4 in start_thread (arg=0x7fffeb7fe700) at pthread_create.c:309\n#8  0x00007ffff65b062d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\n```\n\nI played with `--enable-tcmalloc` complier options, but it's not helped :(\n\nI use the PHP with ZTS, but it's not started:\n\n```\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7fffe989b700 (LWP 18)]\n0x00005555557e023f in zend_update_property ()\n(gdb) backtrace\n#0  0x00005555557e023f in zend_update_property ()\n#1  0x00005555557e03f8 in zend_update_property_long ()\n#2  0x00007fffebe30ae8 in php_swoole_onWorkerStart (serv=0x5555565fc000, worker_id=0) at /usr/local/src/swoole-src/swoole_server.c:943\n#3  0x00007fffebe5c4ff in swFactoryThread_onStart (pool=<optimized out>, id=0) at /usr/local/src/swoole-src/src/factory/FactoryThread.c:191\n#4  0x00007fffebe68157 in swThreadPool_loop (arg=<optimized out>) at /usr/local/src/swoole-src/src/network/ThreadPool.c:152\n#5  0x00007ffff665e0a4 in start_thread (arg=0x7fffe989b700) at pthread_create.c:309\n#6  0x00007ffff639362d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\n```\n\nMy system:\n- Debian8 \n- PHP 7.0.11\n- Swoole - master\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/871/comments",
    "author": "szicsu",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-10-11T03:38:11Z",
        "body": "Thread mode is still a problem, please use the process mode\n"
      }
    ]
  },
  {
    "number": 870,
    "title": "请问swoole_http_request->header 能支持发送 nginx sendfile 的X-Accel-Redirect 吗",
    "created_at": "2016-10-10T12:08:30Z",
    "closed_at": "2016-10-11T10:04:41Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/870",
    "body": "如题\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/870/comments",
    "author": "hackingluoluo",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-10-11T10:04:41Z",
        "body": "header方法可以发送任意Http头。\n"
      },
      {
        "user": "hackingluoluo",
        "created_at": "2016-10-12T03:44:56Z",
        "body": "谢谢!  那应该是我nginx配置有问题\n"
      }
    ]
  },
  {
    "number": 866,
    "title": "installer/php-7.0.11/ext/swoole/swoole_event.c:187: undefined reference to `swSignalfd_setup'",
    "created_at": "2016-09-30T12:12:24Z",
    "closed_at": "2016-10-28T10:06:15Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/866",
    "body": "Hello,\n\nWhen try to compile php7 with swoole, i am getting this error could you  help me?\n\n```\n[root@localhost ~]# cat /etc/redhat-release\nCentOS release 6.8 (Final)\n\n[root@localhost ~]# uname -r\n2.6.32-642.4.2.el6.x86_64\n\n```\n\n```\n./configure --with-freetype-dir=/usr/include/freetype2 --enable-sockets --enable-pcntl --enable-mbstring --enable-shmop --enable-fpm --enable-cli --with-gd --with-webp-dir --with-jpeg-dir --with-png-dir --enable-ftp --with-openssl-dir --with-zlib --with-zlib-dir --with-curl --with-bz2 --with-mysqli --with-pdo-mysql --with-zlib-dir --with-xmlrpc --with-mcrypt --with-ssh2 --enable-soap --enable-intl --without-pear --enable-mysqlnd --with-zlib-dir --enable-opcache --enable-sigchild --enable-sysvmsg --enable-sysvsem --enable-sysvshm --with-openssl --enable-memcache --with-zlib-dir --enable-swoole --enable-sockets --enable-openssl --enable-http2 --enable-thread --with-swoole --enable-jemalloc --with-yaml --enable-maintainer-zts --enable-zend-signals --with-tsrm-pthreads\n\n...\nsapi/cli/.libs/php_http_parser.o: In function `php_http_should_keep_alive':\n/installer/php-7.0.11/sapi/cli/php_http_parser.c:1591: multiple definition of `php_http_should_keep_alive'\next/swoole/thirdparty/.libs/php_http_parser.o:/installer/php-7.0.11/ext/swoole/thirdparty/php_http_parser.c:1575: first defined here\nsapi/cli/.libs/php_http_parser.o: In function `php_http_method_str':\n/installer/php-7.0.11/sapi/cli/php_http_parser.c:1610: multiple definition of `php_http_method_str'\next/swoole/thirdparty/.libs/php_http_parser.o:/installer/php-7.0.11/ext/swoole/thirdparty/php_http_parser.c:1594: first defined here\nsapi/cli/.libs/php_http_parser.o: In function `php_http_parser_init':\n/installer/php-7.0.11/sapi/cli/php_http_parser.c:1618: multiple definition of `php_http_parser_init'\next/swoole/thirdparty/.libs/php_http_parser.o:/installer/php-7.0.11/ext/swoole/thirdparty/php_http_parser.c:1602: first defined here\nsapi/cli/.libs/php_http_parser.o: In function `php_http_parser_execute':\n/installer/php-7.0.11/sapi/cli/php_http_parser.c:329: multiple definition of `php_http_parser_execute'\next/swoole/thirdparty/.libs/php_http_parser.o:/installer/php-7.0.11/ext/swoole/thirdparty/php_http_parser.c:327: first defined here\next/swoole/.libs/swoole_server_port.o: In function `zim_swoole_server_port_set':\n/installer/php-7.0.11/ext/swoole/swoole_server_port.c:318: undefined reference to `swPort_enable_ssl_encrypt'\next/swoole/.libs/swoole_lock.o: In function `zim_swoole_lock___construct':\n/installer/php-7.0.11/ext/swoole/swoole_lock.c:82: undefined reference to `swRWLock_create'\n/installer/php-7.0.11/ext/swoole/swoole_lock.c:104: undefined reference to `swSpinLock_create'\next/swoole/.libs/swoole_client.o: In function `zim_swoole_client_verifyPeerCert':\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1696: undefined reference to `swSSL_verify'\next/swoole/.libs/swoole_client.o: In function `zim_swoole_client_getPeerCert':\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1670: undefined reference to `swSSL_get_client_certificate'\next/swoole/.libs/swoole_client.o: In function `zim_swoole_client_enableSSL':\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1608: undefined reference to `swClient_enable_ssl_encrypt'\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1647: undefined reference to `swClient_ssl_handshake'\next/swoole/.libs/swoole_event.o: In function `php_swoole_event_wait':\n/installer/php-7.0.11/ext/swoole/swoole_event.c:187: undefined reference to `swSignalfd_setup'\ncollect2: ld returned 1 exit status\nmake: *** [sapi/cli/php] Error 1\nmake: *** Waiting for unfinished jobs....\next/swoole/.libs/swoole_server_port.o: In function `zim_swoole_server_port_set':\n/installer/php-7.0.11/ext/swoole/swoole_server_port.c:318: undefined reference to `swPort_enable_ssl_encrypt'\next/swoole/.libs/swoole_lock.o: In function `zim_swoole_lock___construct':\n/installer/php-7.0.11/ext/swoole/swoole_lock.c:82: undefined reference to `swRWLock_create'\n/installer/php-7.0.11/ext/swoole/swoole_lock.c:104: undefined reference to `swSpinLock_create'\next/swoole/.libs/swoole_client.o: In function `zim_swoole_client_verifyPeerCert':\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1696: undefined reference to `swSSL_verify'\next/swoole/.libs/swoole_client.o: In function `zim_swoole_client_getPeerCert':\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1670: undefined reference to `swSSL_get_client_certificate'\next/swoole/.libs/swoole_client.o: In function `zim_swoole_client_enableSSL':\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1608: undefined reference to `swClient_enable_ssl_encrypt'\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1647: undefined reference to `swClient_ssl_handshake'\next/swoole/.libs/swoole_event.o: In function `php_swoole_event_wait':\n/installer/php-7.0.11/ext/swoole/swoole_event.c:187: undefined reference to `swSignalfd_setup'\ncollect2: ld returned 1 exit status\nmake: *** [sapi/cgi/php-cgi] Error 1\next/swoole/.libs/swoole_server_port.o: In function `zim_swoole_server_port_set':\n/installer/php-7.0.11/ext/swoole/swoole_server_port.c:318: undefined reference to `swPort_enable_ssl_encrypt'\next/swoole/.libs/swoole_lock.o: In function `zim_swoole_lock___construct':\n/installer/php-7.0.11/ext/swoole/swoole_lock.c:82: undefined reference to `swRWLock_create'\n/installer/php-7.0.11/ext/swoole/swoole_lock.c:104: undefined reference to `swSpinLock_create'\next/swoole/.libs/swoole_client.o: In function `zim_swoole_client_verifyPeerCert':\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1696: undefined reference to `swSSL_verify'\next/swoole/.libs/swoole_client.o: In function `zim_swoole_client_getPeerCert':\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1670: undefined reference to `swSSL_get_client_certificate'\next/swoole/.libs/swoole_client.o: In function `zim_swoole_client_enableSSL':\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1608: undefined reference to `swClient_enable_ssl_encrypt'\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1647: undefined reference to `swClient_ssl_handshake'\next/swoole/.libs/swoole_event.o: In function `php_swoole_event_wait':\n/installer/php-7.0.11/ext/swoole/swoole_event.c:187: undefined reference to `swSignalfd_setup'\ncollect2: ld returned 1 exit status\nmake: *** [sapi/phpdbg/phpdbg] Error 1\next/swoole/.libs/swoole_server_port.o: In function `zim_swoole_server_port_set':\n/installer/php-7.0.11/ext/swoole/swoole_server_port.c:318: undefined reference to `swPort_enable_ssl_encrypt'\next/swoole/.libs/swoole_lock.o: In function `zim_swoole_lock___construct':\n/installer/php-7.0.11/ext/swoole/swoole_lock.c:82: undefined reference to `swRWLock_create'\n/installer/php-7.0.11/ext/swoole/swoole_lock.c:104: undefined reference to `swSpinLock_create'\next/swoole/.libs/swoole_client.o: In function `zim_swoole_client_verifyPeerCert':\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1696: undefined reference to `swSSL_verify'\next/swoole/.libs/swoole_client.o: In function `zim_swoole_client_getPeerCert':\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1670: undefined reference to `swSSL_get_client_certificate'\next/swoole/.libs/swoole_client.o: In function `zim_swoole_client_enableSSL':\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1608: undefined reference to `swClient_enable_ssl_encrypt'\n/installer/php-7.0.11/ext/swoole/swoole_client.c:1647: undefined reference to `swClient_ssl_handshake'\next/swoole/.libs/swoole_event.o: In function `php_swoole_event_wait':\n/installer/php-7.0.11/ext/swoole/swoole_event.c:187: undefined reference to `swSignalfd_setup'\ncollect2: ld returned 1 exit status\nmake: *** [sapi/fpm/php-fpm] Error 1\n[root@localhost php-7.0.11]#\n```\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/866/comments",
    "author": "mitsh",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-10-09T02:51:10Z",
        "body": "Try to compile a separate swoole extension, dynamic load so module.\n\n``` shell\ncd php-src/ext/swoole\nphpize\n./configure\nmake && make install\n```\n"
      }
    ]
  },
  {
    "number": 850,
    "title": "swoole client网络断线问题",
    "created_at": "2016-09-14T06:54:26Z",
    "closed_at": "2016-11-10T09:56:29Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/850",
    "body": "swoole的朋友们，我在开发过程中遇到一些问题，特来请教\n\n问题描述：\n我在swoole server中开启了一个子进程，该子进程会创建一个swoole client来连接第三方提供的tcp socket服务，当我手动关闭网络后要隔一段时间才触发onclose事件，而在onclose事件中，当我试图去重连接远程socket服务时，会报一个php warning的警告：\nPHP Warning:  swoole_client::connect(): connect to server[ip,port] failed. Error: Network is unreachable[51].\n\n开发环境：\n系统：Mac OS X EI Captian\nphp： php-7.0.6\nswoole： swoole-src-1.8.11-stable\n\n问题：\n1：如何在网络断开的瞬间，就能在onclose中捕获到这个事件？\n2：onerror事件一般都是哪几种原因触发的（我之前以为上面的情况会触发onerror事件，并在该事件中做一些逻辑处理，结果发现该事件并没有被调用）？\n\n感谢各位的解答，谢谢\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/850/comments",
    "author": "jocky4012",
    "comments": [
      {
        "user": "WeijiaNing",
        "created_at": "2016-09-21T01:09:17Z",
        "body": "MAC上面怎么搭建环境呢 哥们\n"
      },
      {
        "user": "WeijiaNing",
        "created_at": "2016-09-21T01:13:11Z",
        "body": "我刚开始接触Mac  以前用的是window 和 linux \n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-11-10T09:56:29Z",
        "body": "网络断线是无法发出FIN包的，服务器端收不到onClose，onError表示连接失败。\n"
      }
    ]
  },
  {
    "number": 849,
    "title": "swoole_table 可否生产环境使用 ？",
    "created_at": "2016-09-14T06:27:09Z",
    "closed_at": "2016-10-18T07:27:35Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/849",
    "body": "swoole_table模块目前为实验性质，不建议在生产环境使用。\n这个tips，在1.8.11-stable中 是否仍然有效 ？\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/849/comments",
    "author": "wangjinbei",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-10-18T07:27:35Z",
        "body": "foreach时执行del会出现问题，其他情况下没问题。1.8.12已修复了此问题。\n"
      }
    ]
  },
  {
    "number": 841,
    "title": "使用swoole_mysql出现一个warning",
    "created_at": "2016-08-29T01:15:03Z",
    "closed_at": "2016-08-29T14:06:08Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/841",
    "body": "php 7.0.0\nswoole版本是1.8.11-alpha\n\nWarning: swoole_mysql::query(): mysql client is waiting response, cannot send new sql query\n\n嵌套sql，查询记录出来 push之后我要删除已经push的记录，会出warning。\n\n``` php\n$db->query($sql, function (swoole_mysql $db, $r) use($ws)\n            {\n                global $s;\n                if ($r === false)\n                {\n                    var_dump($db->error, $db->errno);\n                }\n                elseif ($r === true)\n                {\n                    var_dump($db->affected_rows, $db->insert_id);\n                }\n                echo \"count=\" . count($r) . \", time=\" . (microtime(true) - $s), \"\\n\";\n\n                foreach($r as $cron){\n                    var_dump(serialize($cron)) . \"\\n\";\n                    // \n                    $ws->push($fd, $msg); // 这边有push消息给客户端\n\n                    // 下边这个query会提示：Warning: swoole_mysql::query(): mysql client is waiting response, cannot send new sql query.\n                    $db->query(\"delete from table where id=\".$cron['id'], function(swoole_mysql $db, $r){}); \n                }\n\n\n\n                $db->close();\n            });\n```\n\n不能这样做，那怎么做。\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/841/comments",
    "author": "chaegumi",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-08-29T14:06:08Z",
        "body": "你的用法存在问题，单个MySQL无法实现并发。MySQL是请求响应式的，必须要等第一个SQL返回结果，才能继续在这个连接上发起新的SQL，所以你需要创建多个Swoole\\MySQL\n"
      }
    ]
  },
  {
    "number": 836,
    "title": "swoole-src-1.8.10-stable 没有参数 --enable-async-mysql ",
    "created_at": "2016-08-25T05:21:37Z",
    "closed_at": "2016-08-25T15:29:23Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/836",
    "body": "在用到异步数据库的时候用到一个 swoole_get_mysqli_sock 方法。查阅得知需要在编译的时候加入\n--enable-async-mysql 参数。但是编译结果显示：\n configure: WARNING: unrecognized options: --enable-async-mysql\n求解。。。。。。\n谢谢\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/836/comments",
    "author": "zanedeng",
    "comments": [
      {
        "user": "chaegumi",
        "created_at": "2016-08-25T08:50:43Z",
        "body": "1.8.6版本已移除对mysqli和mysqlnd扩展的依赖，并改为内置，无需额外的编译参数开启\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-08-25T15:29:23Z",
        "body": "已经内置了，不需要这个编译参数。\n"
      }
    ]
  },
  {
    "number": 826,
    "title": "Warning: swoole_server::taskwait(): taskwait failed. Error: Resource temporarily unavailable[11]",
    "created_at": "2016-08-23T02:40:17Z",
    "closed_at": "2016-08-23T05:10:18Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/826",
    "body": "如标题的错误，下面是具体代码：\n\n``` php\n$server->on('Request', function(swoole_http_request $request,\n                                        swoole_http_response $response) use($server){\n            $response->header('content-type', 'application/json');\n            $response->status(200);\n            $server->taskwait($request, $timeout);\n            $response->end(json_encode(array('code' => 200, 'message' => '', 'data' => array())));\n\n            return true;\n        });\n```\n\n然后 日志里面 全部是标题所诉的错误，紧跟着是如下错误：\n\n``` shell\n[2016-08-23 10:34:26 *11493.13] ERROR   swFactoryProcess_finish (ERROR 1004): send 195 byte failed, because session#100 is closed.\n[2016-08-23 10:34:26 *11493.13] ERROR   swFactoryProcess_finish (ERROR 1004): send 159 byte failed, because session#100 is closed.\n```\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/826/comments",
    "author": "minr",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-08-23T05:10:18Z",
        "body": "这是因为你的Task执行太慢了，taskwait接口超时导致的。可以调大超时时间，优化onTask代码性能提升处理速度。\n"
      }
    ]
  },
  {
    "number": 815,
    "title": "swoole_http_server的使用提醒还有效吗",
    "created_at": "2016-08-17T10:10:34Z",
    "closed_at": "2016-08-17T10:43:08Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/815",
    "body": "文档中关于swoole_http_server，有一条提醒：”对Http协议的支持并不完整，建议仅作为应用服务器。并且在前端增加Nginx作为代理；”\n请问：现在的1.8.8-stable版本，这条notice还有效吗？\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/815/comments",
    "author": "wangjinbei",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-08-17T10:43:08Z",
        "body": "有效。Swoole\\Http\\Server并不是一个Web服务器。\n"
      }
    ]
  },
  {
    "number": 807,
    "title": "Tcp主进程内存不释放，导致内存泄漏",
    "created_at": "2016-08-09T14:48:37Z",
    "closed_at": "2016-08-19T06:15:34Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/807",
    "body": "我是用PHP7+Swoole1.8.6起的tcp server（做弹幕服务），设置的process模式，16个rector，32个worker，32个task\n\n服务器是centos系统，8核16G，\n\n做压测的逻辑是这样子的，先挂5000个连接上去，然后再起40个并发发消息，发现没一会儿工夫master进程就已经占用了75%左右的内存了，重启子进程貌似也没有多大效果，内存一直被主进程占用，只有restart内存才释放，照这样的话生产环境不太现实。求解答！\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/807/comments",
    "author": "yaoxiaofeng1989",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-08-10T01:22:03Z",
        "body": "主进程内存占用过高一般是有大量数据未发送保存在内存缓存区中，请开启心跳检测功能，剔除坏连接。\n"
      },
      {
        "user": "shenzhe",
        "created_at": "2016-08-10T04:01:52Z",
        "body": "是不是只有send, 客户端没有recv\n"
      },
      {
        "user": "yaoxiaofeng1989",
        "created_at": "2016-08-11T09:38:56Z",
        "body": "谢谢韩哥、半桶水，系统里已有心跳检测功能。还想请问下，剔除了坏连接内存就释放了吗？ @matyhtf @shenzhe \n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-08-11T11:00:10Z",
        "body": "close时会释放所有连接相关的内存资源。\n"
      }
    ]
  },
  {
    "number": 790,
    "title": "swoole_websocket_server里的onMessage接收到异常数据",
    "created_at": "2016-07-29T08:21:47Z",
    "closed_at": "2016-08-01T07:27:47Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/790",
    "body": "```\n[2016-07-29 15:43:11 #22826.1]  WARNING swWebSocket_dispatch_frame: unknown opcode [7].\n[2016-07-29 15:43:11 #22826.1]  WARNING swWebSocket_dispatch_frame: unknown opcode [14].\n[2016-07-29 15:43:11 #22826.1]  WARNING swWebSocket_dispatch_frame: unknown opcode [4].\n[2016-07-29 15:43:11 #22826.1]  WARNING swWebSocket_dispatch_frame: unknown opcode [3].\n[2016-07-29 15:43:11 #22826.1]  WARNING swWebSocket_dispatch_frame: unknown opcode [3].\n[2016-07-29 15:43:11]onReceiveData----->.80:8080\nUpgrade: websocket\nCache-Control: no-ca\n[2016-07-29 15:43:12]onClient Called===:fd: 258\n[2016-07-29 15:43:12]onClose===:Client 251 closed connection\n[2016-07-29 15:43:13 #22826.2]  WARNING swWebSocket_dispatch_frame: unknown opcode [7].\n[2016-07-29 15:43:13 #22826.2]  WARNING swWebSocket_dispatch_frame: unknown opcode [15].\n[2016-07-29 15:43:13]onReceiveData----->e-Id: 100.64.192.145\nX-Up-Bear-Type: CDMA\nHost: 112.26.212.80:8080\nConnection: Upgrade\nSec-Webs\n[2016-07-29 15:43:15]onClient Called===:fd: 259\n[2016-07-29 15:43:15]onClose===:Client 252 closed connection\n[2016-07-29 15:43:17 #22826.3]  WARNING swWebSocket_dispatch_frame: unknown opcode [7].\n[2016-07-29 15:43:17 #22826.3]  WARNING swWebSocket_dispatch_frame: unknown opcode [15].\n[2016-07-29 15:43:17]onReceiveData----->e-Id: 100.64.192.145\nX-Up-Bear-Type: CDMA\nHost: 112.26.212.80:8080\nConnection: Upgrade\nSec-Webs\n[2016-07-29 15:43:18]onClient Called===:fd: 260\n[2016-07-29 15:43:18]onClose===:Client 253 closed connection\n[2016-07-29 15:43:20 #22826.3]  WARNING swWebSocket_dispatch_frame: unknown opcode [7].\n[2016-07-29 15:43:20 #22826.3]  WARNING swWebSocket_dispatch_frame: unknown opcode [15].\n[2016-07-29 15:43:20]onReceiveData----->e-Id: 100.64.192.145\nX-Up-Bear-Type: CDMA\nHost: 112.26.212.80:8080\nConnection: Upgrade\nSec-Webs\n```\n\n`onReceiveData----->`里打印的是`onMessage($server, $frame)`里的`$frame->data`,服务器突然在某段时间内收到了这种异常信息。找不到原因。重启server后还会有这种数据，过了半小时后就没有收到这种异常数据了。\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/790/comments",
    "author": "52fhy",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-08-01T07:27:47Z",
        "body": "客户端没有按照WebSocket协议来发送数据。\n"
      }
    ]
  },
  {
    "number": 789,
    "title": "在read的函数中读取不超过限制的时候，是否保证接受到的是完整的一个或者多个包？？",
    "created_at": "2016-07-29T04:11:51Z",
    "closed_at": "2016-08-03T09:58:22Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/789",
    "body": "swoole_process->write： “管道通信默认的方式是流式，write写入的数据在read可能会被底层合并。可以设置swoole_process构造函数的第三个参数为2改变为数据报式。”\n在swoole_process->read的函数中读取数据在不超过限制的时候，是否保证接受到的都是完整的一个或者多个包？？\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/789/comments",
    "author": "wangjinbei",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-08-03T09:58:22Z",
        "body": "数据包模式下，read读取是完整的。\n"
      }
    ]
  },
  {
    "number": 788,
    "title": "swoole_lock 的 SWOOLE_MUTEX trylock 在 unlock 后仍无法获取锁",
    "created_at": "2016-07-28T09:24:44Z",
    "closed_at": "2016-07-29T02:28:01Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/788",
    "body": "测试代码如下：\n\n```\n<?php\nuse Swoole\\Lock;\n\n$lock = new Lock(SWOOLE_MUTEX);\n// $lock = new Lock(SWOOLE_SPINLOCK);                                                                                                                                                                         \n\n$pids = [];\nforeach (range(1, 2) as $process) {\n    $pid = pcntl_fork();\n    if ($pid < 0) {\n        throw new RuntimeException();\n    } elseif ($pid) {\n        $pids[] = $pid;\n    } else {\n        $timeout = 3;\n        while ($timeout > 0) {\n            if ($lock->trylock()) {\n                error_log(\"lock success\");\n                break;\n            }\n            error_log(\"try lock fail\");\n            sleep(1);\n            $timeout -= 1;\n        }\n        if ($timeout <= 0) {\n            error_log(\"lock fail\");\n        } else {\n            sleep(1);\n            error_log('release lock');\n            $lock->unlock();\n        }\n        exit(0);\n    }\n}\n\nforeach ($pids as $pid) {\n    pcntl_waitpid($pid, $status);\n}\n```\n\n同样的代码在 SWOOLE_SPINLOCK 是可以运行的。\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/788/comments",
    "author": "wenbinye",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-07-29T02:27:59Z",
        "body": "可能是`pthread_mutex_trylock`在多进程下存在一些问题，请使用`lock`方法\n"
      }
    ]
  },
  {
    "number": 775,
    "title": "Multi-port and mixed protocol示例代码无法运行 swoole1.8.7稳定版",
    "created_at": "2016-07-21T09:48:56Z",
    "closed_at": "2016-07-22T05:50:42Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/775",
    "body": "`$serv = new swoole_http_server(\"127.0.0.1\", 9501, SWOOLE_BASE);\n\n$port2 = $serv->listen(\"0.0.0.0\", 9502, SWOOLE_SOCK_TCP);\n$port2->on('receive', function (swoole_server $serv, $fd, $from_id, $data) {\n    var_dump($data);\n    $serv->send($fd, $data);  \n});\n\n$serv->on('request', function($req, $resp) {\n    $resp->end(\"Hello World\");\n});\n\n$serv->start();`\n里只有http协议有回应 tcp没反应\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/775/comments",
    "author": "Corzcode",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-07-22T05:50:42Z",
        "body": "未调用 $port->set 方法，因此监听的端口会继承 主服务器的设置，也就是 新监听的端口也是Http服务器，同样也会触发 onRequest，而不是 onReceive\n"
      }
    ]
  },
  {
    "number": 766,
    "title": "dispatch_mode = 2 时，分配worker有问题",
    "created_at": "2016-07-16T03:05:13Z",
    "closed_at": "2016-07-18T01:13:25Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/766",
    "body": "文档里说：\n\n> 2.固定模式，根据连接的文件描述符分配worker。这样可以保证同一个连接发来的数据只会被同一个worker处理。\n\n但是我实际测试后发现并不是这样：\n\n``` php\n$serv = new swoole_server(\"127.0.0.1\", 8100);\n$serv->set(['worker_num' => 3, 'daemonize' => false, 'dispatch_mode' => 2]);\n$serv->on('receive', function(swoole_server $serv, $fd, $from_id, $data)\n{\n    echo '$worker_id = '.$serv->worker_id . ', $fd = ' . $fd . ', $data = '. $data;\n});\n$serv->start();\n```\n\n执行(或用 telnet 127.0.0.1 8100 发送完毕后退出再发送)\n\n``` bash\necho \"a\" > /dev/tcp/127.0.0.1/8100\necho \"b\" > /dev/tcp/127.0.0.1/8100\necho \"c\" > /dev/tcp/127.0.0.1/8100\necho \"d\" > /dev/tcp/127.0.0.1/8100\n```\n\n结果如下：\n\n```\n$worker_id = 2, $fd = 1, $data = a\n$worker_id = 2, $fd = 2, $data = b\n$worker_id = 2, $fd = 3, $data = c\n$worker_id = 2, $fd = 4, $data = d\n```\n\nfd 会不断的增加，但是被分配到的 worker id 始终是同一个。这样会导致worker进程不能够平均分摊任务的问题。\n\n由于这样的问题导致了我的服务出现了个别 worker 负载特别高，其它 worker 永远分配不到的问题，加worker数也不行（由于服务的特殊情况，只能选择按 fd 分配worker）\n\n连接我的 swoole 服务器只有少数几个（4个）客户端，每次客户端连接都是 tcp 连接后发送很多数据（几k - 几M不等）后断开，再重新连接发送，虽然客户端不多但请求非常的频繁（同步数据）。\n这时候即便我开了30个worker进程，但也是只有id是26，27，28，29的4个进程会被onReceive，其它worker都白费，直接导致了这几个进程一直要满负荷处理数据，而其它的进程都一直是空闲状态，加再多worker也无济于事~~ \n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/766/comments",
    "author": "breath-co2",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-07-18T01:13:25Z",
        "body": "PHP层的fd不是真正的文件描述符。你的测试中，多次telnet实际上是同一个文件描述符，所以只会分配到一个Worker进程。请并发多个连接进行测试。\n"
      },
      {
        "user": "breath-co2",
        "created_at": "2016-07-18T06:59:52Z",
        "body": "@matyhtf 此问题只是表象，最终的结果就是在只有少数几个连接却大量使用短连接请求会导致个别worker 爆满，其它worker空闲这样负载不均衡的问题\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-07-18T07:42:36Z",
        "body": "`dispatch_mode=2/4/5` 这些固定分配的模式，如果并发客户端数量比Worker进程少，一定是无法利用所有Worker进程的。\n"
      }
    ]
  },
  {
    "number": 760,
    "title": "swoole2.0的coroutine的httpclient并发问题",
    "created_at": "2016-07-11T13:13:09Z",
    "closed_at": "2016-12-02T03:59:05Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/760",
    "body": "在微博上看到2.0的coroutine特性，请问协程版的httpclient如果要并发发送大量的http请求，是开多个httpclient呢还是可以直接一个httpclient就可以了呢？\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/760/comments",
    "author": "gouchaoer",
    "comments": [
      {
        "user": "yangxikun",
        "created_at": "2016-07-18T10:43:50Z",
        "body": "得开多个httpclient，一个httpclient一条http连接\n"
      }
    ]
  },
  {
    "number": 759,
    "title": "某些NAT环境下，swoole_server TCP方式无法获取真实的客户端IP",
    "created_at": "2016-07-08T07:37:05Z",
    "closed_at": "2016-07-08T08:08:00Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/759",
    "body": "在NAT环境下，通过反向代理，比如A10或者HA之类的，TCP的swoole_server用swoole_server->connection_info方法拿到的remote_ip是代理服务器的地址，无法拿到真实的客户端地址\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/759/comments",
    "author": "gufei",
    "comments": [
      {
        "user": "lilien1010",
        "created_at": "2016-07-08T07:47:54Z",
        "body": "网络层次不一样，拿不到客户端的IP\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-07-08T08:08:00Z",
        "body": "符合预期。\n"
      }
    ]
  },
  {
    "number": 758,
    "title": "swoole怎么使用xdebug调试呢？",
    "created_at": "2016-07-07T14:20:19Z",
    "closed_at": "2016-07-08T08:10:37Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/758",
    "body": "单步调试太好用了，但是swoole支持单步调试么\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/758/comments",
    "author": "gouchaoer",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-07-08T08:10:37Z",
        "body": "支持，和普通的PHP程序一样。\n"
      }
    ]
  },
  {
    "number": 757,
    "title": "swoole的http_client可以并发发请求么",
    "created_at": "2016-07-07T14:18:41Z",
    "closed_at": "2016-07-12T01:47:04Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/757",
    "body": "rt，可以的话能给个例子么，发请求能控制header和method\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/757/comments",
    "author": "gouchaoer",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-07-12T01:47:04Z",
        "body": "创建多个httpClient就可以并发。\n"
      }
    ]
  },
  {
    "number": 741,
    "title": "swoole_server->close调用会阻塞",
    "created_at": "2016-06-27T18:25:10Z",
    "closed_at": "2016-06-28T02:36:27Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/741",
    "body": "write(114, \"\\327\\236a\\0\\0\\0\\2\\0\\4\\346uv\", 12) = -1 EAGAIN (Resource temporarily unavailable)\npoll([{fd=114, events=POLLOUT}], 1, 1000) = 0 (Timeout)\nwrite(114, \"\\327\\236a\\0\\0\\0\\2\\0\\4\\346uv\", 12) = -1 EAGAIN (Resource temporarily unavailable)\npoll([{fd=114, events=POLLOUT}], 1, 1000) = 0 (Timeout)\nwrite(114, \"\\327\\236a\\0\\0\\0\\2\\0\\4\\346uv\", 12) = -1 EAGAIN (Resource temporarily unavailable)\npoll([{fd=114, events=POLLOUT}], 1, 1000) = 0 (Timeout)\nwrite(114, \"\\327\\236a\\0\\0\\0\\2\\0\\4\\346uv\", 12) = -1 EAGAIN (Resource temporarily unavailable)\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/741/comments",
    "author": "wheelswang",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-06-28T02:36:27Z",
        "body": "在Task进程内调用了close，而且你的Worker进程存在阻塞无法即时处理。Task进程没有EventLoop，只能阻塞等待。\n"
      },
      {
        "user": "wheelswang",
        "created_at": "2016-06-28T03:09:18Z",
        "body": "我在new swoole_process生成的进程里close一个连接，有办法可以不用等待worker进程响应么？\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-06-28T09:30:01Z",
        "body": "可以调用`write`向Worker进程发指令。\n"
      },
      {
        "user": "wheelswang",
        "created_at": "2016-06-29T16:39:27Z",
        "body": "swoole_websocket_server->push 有可能会阻塞么 我在线上业务上看日志 push给八百个fd，耗时6s\n"
      }
    ]
  },
  {
    "number": 731,
    "title": "Swoole\\Process::wait 输出错误日志",
    "created_at": "2016-06-18T14:15:01Z",
    "closed_at": "2016-06-20T03:27:28Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/731",
    "body": "通过子进程启动服务，调用 wait 时会输出一条错误日志 ::\n\n```\nERROR   zm_deactivate_swoole (ERROR 9003): worker process is terminated by exit()/die()\n```\n\n代码如下：\n\n``` php\n<?php\n$process = new Swoole\\Process(function() {\n    start_server();\n    exit(0);\n});\n$process->start();\n$result = Swoole\\Process::wait();\n\nfunction start_server() {\n    $server = new Swoole\\Http\\Server('localhost', '9222');\n    $server->set(['daemonize' => true]);\n    $server->on('request', function($req, $resp) {\n        $resp->end('hello');\n    });\n    $server->start();\n}\n```\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/731/comments",
    "author": "wenbinye",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-06-20T03:27:28Z",
        "body": "开启守护进程后，子进程会与父进程脱离关系。父进程会得到子进程退出的消息。实际上子进程并没有退出，只是转入后台作为守护进程运行了。\n"
      },
      {
        "user": "wenbinye",
        "created_at": "2016-06-21T23:00:28Z",
        "body": "有什么办法可以忽略这个日志吗？\n"
      },
      {
        "user": "yuexue0",
        "created_at": "2016-12-29T02:46:00Z",
        "body": "同问，如何忽略或者每分钟打印一条"
      }
    ]
  },
  {
    "number": 730,
    "title": "运行一段时候后，tasker进程会异常 无法接受到pipeMessage 1.8.5版本",
    "created_at": "2016-06-18T03:40:48Z",
    "closed_at": "2016-06-27T05:20:17Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/730",
    "body": "poll([{fd=101, events=POLLIN|POLLPRI|POLLRDNORM|POLLRDBAND}], 1, 0) = 0 (Timeout)\nclock_gettime(CLOCK_MONOTONIC, {3889194, 223690779}) = 0\nclock_gettime(CLOCK_MONOTONIC, {3889194, 223709624}) = 0\nclock_gettime(CLOCK_MONOTONIC, {3889194, 223741761}) = 0\npoll([{fd=101, events=POLLIN|POLLPRI|POLLRDNORM|POLLRDBAND}], 1, 1000) = 0 (Timeout)\npoll([{fd=101, events=POLLIN|POLLPRI|POLLRDNORM|POLLRDBAND}], 1, 0) = 0 (Timeout)\nclock_gettime(CLOCK_MONOTONIC, {3889195, 224911239}) = 0\nclock_gettime(CLOCK_MONOTONIC, {3889195, 224930123}) = 0\nclock_gettime(CLOCK_MONOTONIC, {3889195, 224948556}) = 0\npoll([{fd=101, events=POLLIN|POLLPRI|POLLRDNORM|POLLRDBAND}], 1, 1000) = 0 (Timeout)\npoll([{fd=101, events=POLLIN|POLLPRI|POLLRDNORM|POLLRDBAND}], 1, 0) = 0 (Timeout)\nclock_gettime(CLOCK_MONOTONIC, {3889196, 226092142}) = 0\nclock_gettime(CLOCK_MONOTONIC, {3889196, 226110068}) = 0\nclock_gettime(CLOCK_MONOTONIC, {3889196, 226127580}) = 0\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/730/comments",
    "author": "wheelswang",
    "comments": [
      {
        "user": "wheelswang",
        "created_at": "2016-06-18T04:30:22Z",
        "body": "这是strace takser进程的系统调用\n"
      },
      {
        "user": "fznply",
        "created_at": "2016-06-19T02:59:01Z",
        "body": "建议使用最新的master分支，再进行一次测试，因为1.8.5并非一个稳定的版本；如果最新的分支依然存在你说的问题，请把精简一下测试代码后贴出来，这样方便定位问题。\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-06-20T03:24:49Z",
        "body": "使用`lsof`查看101的socket是什么。这个可能是你PHP程序的问题。\n"
      },
      {
        "user": "wheelswang",
        "created_at": "2016-06-22T14:36:13Z",
        "body": "write(98, \"\\0\\0\\0\\0Y\\2 \\0\\17\\0\\0\\0{\\\"cmd\\\":\\\"sendToUsers\\\"\"..., 613) = -1 EAGAIN (Resource temporarily unavailable)\npoll([{fd=98, events=POLLOUT}], 1, 1000) = 0 (Timeout)\nwrite(98, \"\\0\\0\\0\\0Y\\2 \\0\\17\\0\\0\\0{\\\"cmd\\\":\\\"sendToUsers\\\"\"..., 613) = -1 EAGAIN (Resource temporarily unavailable)\npoll([{fd=98, events=POLLOUT}], 1, 1000) = 0 (Timeout)\nwrite(98, \"\\0\\0\\0\\0Y\\2 \\0\\17\\0\\0\\0{\\\"cmd\\\":\\\"sendToUsers\\\"\"..., 613) = -1 EAGAIN (Resource temporarily unavailable)\n"
      },
      {
        "user": "wheelswang",
        "created_at": "2016-06-22T14:37:52Z",
        "body": "sendMessage向tasker发送的数据比较大会有问题，上面这是strace跟踪到的\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-06-23T00:28:18Z",
        "body": "你第一段贴的strace信息和第二段是两个不同的问题。\n1. 建议使用`lsof`查看对应的fd是什么连接，存在超时问题\n2. sendMessage数据较大，从你的strace信息看只有613字节并不大\n3. 你应该是指sendMessage过多，对应的Worker进程或Task进程处于阻塞状态，无法处理消息。这里就会卡住。\n"
      },
      {
        "user": "wheelswang",
        "created_at": "2016-06-25T11:55:59Z",
        "body": "上面是我的worker进程阻塞造成的错误\n还有一个问题，server运行一段时间后会报too many open file\nlsof查看发现master进程有大量下面这样的的sock句柄，而server实际端口占用的句柄并不多\nphp     16828 root  211u  sock                0,7       0t0 10226647 can't identify protocol\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-06-27T05:20:17Z",
        "body": "修改 ulimit -n ，设置为 65535或更高。\n"
      }
    ]
  },
  {
    "number": 726,
    "title": "同步阻塞模式里，connect到一个没开的服务时，直接PHP Fatal error，而不是返回false",
    "created_at": "2016-06-14T05:03:09Z",
    "closed_at": "2016-06-15T06:13:25Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/726",
    "body": "PHP 5.5.36\nswoole 1.8.5\n这种错误catch不到，有没有好的方法解决？\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/726/comments",
    "author": "zgr0629",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-06-15T06:13:25Z",
        "body": "connect失败只会抛出WARNING，不是 ERROR，Fatal Error可能是别的原因，请检查你的PHP代码。\n"
      }
    ]
  },
  {
    "number": 719,
    "title": "请问Swoole_Server能否获取客户端的ip地址？",
    "created_at": "2016-06-06T10:18:08Z",
    "closed_at": "2016-06-07T08:19:06Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/719",
    "body": "在OnReceive中只有一个$fd标识，如果想知道真实的ip地址该怎么办？\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/719/comments",
    "author": "huijimuhe",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-06-07T08:19:06Z",
        "body": "使用 `$serv->getClientInfo($fd)` 就可以得到相关信息。\n"
      }
    ]
  },
  {
    "number": 717,
    "title": "扩展没有执行RSHUTDOWN",
    "created_at": "2016-06-06T01:25:54Z",
    "closed_at": "2016-06-07T08:20:42Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/717",
    "body": "最近在使用swoole的过程中,发现一个比较大的问题,我们写扩展的时候(比如mysql,redis),每个请求都会调用RINIT和RSHUTDOWN,但swoole模式下,只有第一个请求执行了RINIT,这样mysql,redis扩展在使用过程中,就有一些不确定性,也就是说所有现有的扩展如果在swoole中使用了,是有隐患的,不知道我的这个担忧是否成立,望解答\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/717/comments",
    "author": "muyilangjun1",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-06-07T08:20:42Z",
        "body": "内存和资源的销毁，是按照变量的生命周期处理的。按照Zend VM的引用计数GC方式，当变量的引用计数为0时就会回收对应的内存和资源。扩展不依赖`RSHUTDOWN`回收资源。\n"
      }
    ]
  },
  {
    "number": 715,
    "title": "How do you pronounce `SWOOLE` ?",
    "created_at": "2016-06-04T03:41:32Z",
    "closed_at": "2016-06-28T02:40:55Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/715",
    "body": "It is a problem in communication, so what's the official pronunciation?\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/715/comments",
    "author": "bg5hfc",
    "comments": [
      {
        "user": "joy2fun",
        "created_at": "2016-06-13T01:50:30Z",
        "body": "According to the video, the author pronounced it like this: S-wall.\n"
      }
    ]
  },
  {
    "number": 706,
    "title": "swoole+gearman，使用时，出现worker进程卡死",
    "created_at": "2016-05-26T05:21:50Z",
    "closed_at": "2016-05-26T11:19:39Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/706",
    "body": "通过ps查看，发现有一部分worker不再处理请求。使用strace -p查看\n\n```\nstrace -p 25886\nProcess 25886 attached\nrestart_syscall(<... resuming interrupted call ...>\n```\n\n一直卡在这。使用pstack 25886：\n\n``` shell\n#0  0x00007f60e0bcac20 in __poll_nocancel () from /lib64/libc.so.6\n#1  0x00007f60d67e3e8f in gearman_wait (universal=...) at libgearman/universal.cc:316\n#2  0x00007f60d67dbbef in gearman_connection_st::recv_socket (this=this@entry=0x23dd7e0, data=0x23dfde9, data_size=8192, ret=@0x7ffe970b59cc: GEARMAN_SUCCESS) at libgearman/connection.cc:1198\n#3  0x00007f60d67dbefa in gearman_connection_st::receiving (this=0x23dd7e0, packet_arg=..., ret=@0x7ffe970b59cc: GEARMAN_SUCCESS, recv_data=recv_data@entry=true) at libgearman/connection.cc:1013\n#4  0x00007f60d67d9cdc in _client_run_tasks (exit_task=0x23e7ed0, client_shell=<optimized out>) at libgearman/client.cc:1545\n#5  gearman_client_run_block_tasks (client=client@entry=0x23dc650, exit_task=exit_task@entry=0x23e7ed0) at libgearman/client.cc:1757\n#6  0x00007f60d67da4b2 in _client_do_background (client_shell=<optimized out>, command=GEARMAN_COMMAND_SUBMIT_JOB_BG, function=..., unique=..., workload=..., job_handle=0x233a9e0 \"\\340\\200:\\002\") at libgearman/client.cc:255\n#7  0x00007f60d67da5fa in gearman_client_do_background (client_shell=client_shell@entry=0x23a6790, function_name=<optimized out>, unique=0x0, workload_str=0x23a6b60, workload_size=80, job_handle=job_handle@entry=0x233a9e0 \"\\340\\200:\\002\") at libgearman/client.cc:783\n#8  0x00007f60d6a04edb in zif_gearman_client_do_background (ht=<optimized out>, return_value=0x23afba8, return_value_ptr=<optimized out>, this_ptr=<optimized out>, return_value_used=<optimized out>) at /var/soft/gearman-1.1.2/php_gearman.c:2140\n#9  0x00000000007eb9c6 in zend_call_function (fci=fci@entry=0x7ffe970b5cf0, fci_cache=fci_cache@entry=0x7ffe970b5cc0) at /var/soft/php-5.6.18/Zend/zend_execute_API.c:847\n#10 0x00000000007006f2 in zif_call_user_func_array (ht=<optimized out>, return_value=0x23a2370, return_value_ptr=<optimized out>, this_ptr=<optimized out>, return_value_used=<optimized out>) at /var/soft/php-5.6.18/ext/standard/basic_functions.c:4786\n#11 0x000000000089f36f in zend_do_fcall_common_helper_SPEC (execute_data=<optimized out>) at /var/soft/php-5.6.18/Zend/zend_vm_execute.h:558\n#12 0x0000000000830448 in execute_ex (execute_data=0x7f60e333c960) at /var/soft/php-5.6.18/Zend/zend_vm_execute.h:363\n#13 0x00000000007eba63 in zend_call_function (fci=fci@entry=0x7ffe970b6030, fci_cache=<optimized out>, fci_cache@entry=0x7ffe970b6000) at /var/soft/php-5.6.18/Zend/zend_execute_API.c:829\n#14 0x0000000000811775 in zend_call_method (object_pp=object_pp@entry=0x7ffe970b60e0, obj_ce=<optimized out>, obj_ce@entry=0x17e8008, fn_proxy=fn_proxy@entry=0x17e8160, function_name=function_name@entry=0xd630f3 \"__call\", function_name_len=function_name_len@entry=6, retval_ptr_ptr=retval_ptr_ptr@entry=0x7ffe970b6108, param_count=param_count@entry=2, arg1=arg1@entry=0x2395dc0, arg2=0x23b3290) at /var/soft/php-5.6.18/Zend/zend_interfaces.c:97\n#15 0x0000000000820cbc in zend_std_call_user_call (ht=<optimized out>, return_value=0x2395df0, return_value_ptr=0x7f60e333c740, this_ptr=0x2398588, return_value_used=<optimized out>) at /var/soft/php-5.6.18/Zend/zend_object_handlers.c:931\n#16 0x000000000089f36f in zend_do_fcall_common_helper_SPEC (execute_data=<optimized out>) at /var/soft/php-5.6.18/Zend/zend_vm_execute.h:558\n#17 0x0000000000830448 in execute_ex (execute_data=0x7f60e333c758) at /var/soft/php-5.6.18/Zend/zend_vm_execute.h:363\n#18 0x00000000007eba63 in zend_call_function (fci=fci@entry=0x7ffe970b63d0, fci_cache=<optimized out>, fci_cache@entry=0x7ffe970b63a0) at /var/soft/php-5.6.18/Zend/zend_execute_API.c:829\n#19 0x00000000007006f2 in zif_call_user_func_array (ht=<optimized out>, return_value=0x23771e0, return_value_ptr=<optimized out>, this_ptr=<optimized out>, return_value_used=<optimized out>) at /var/soft/php-5.6.18/ext/standard/basic_functions.c:4786\n#20 0x000000000089f36f in zend_do_fcall_common_helper_SPEC (execute_data=<optimized out>) at /var/soft/php-5.6.18/Zend/zend_vm_execute.h:558\n#21 0x0000000000830448 in execute_ex (execute_data=0x7f60e333c590) at /var/soft/php-5.6.18/Zend/zend_vm_execute.h:363\n#22 0x00000000007eba63 in zend_call_function (fci=fci@entry=0x7ffe970b6690, fci_cache=<optimized out>, fci_cache@entry=0x0) at /var/soft/php-5.6.18/Zend/zend_execute_API.c:829\n#23 0x00000000007ebc4e in call_user_function_ex (function_table=<optimized out>, object_pp=object_pp@entry=0x0, function_name=<optimized out>, retval_ptr_ptr=retval_ptr_ptr@entry=0x7ffe970b6728, param_count=param_count@entry=2, params=params@entry=0x7ffe970b6730, no_separation=no_separation@entry=0, symbol_table=symbol_table@entry=0x0) at /var/soft/php-5.6.18/Zend/zend_execute_API.c:617\n#24 0x00007f60d55b6fc1 in http_onReceive (serv=<optimized out>, req=<optimized out>) at /var/soft/swoole-src-swoole-1.8.5-stable/swoole_http_server.c:1188\n#25 0x00007f60d55d5d59 in swWorker_onTask (factory=factory@entry=0x7f60d46b7430, task=task@entry=0x7ffe970b67c0) at /var/soft/swoole-src-swoole-1.8.5-stable/src/network/Worker.c:192\n#26 0x00007f60d55d6081 in swWorker_onPipeReceive (reactor=<optimized out>, event=0x7ffe970b8820) at /var/soft/swoole-src-swoole-1.8.5-stable/src/network/Worker.c:542\n#27 0x00007f60d55c8a19 in swReactorEpoll_wait (reactor=0x7f60d47e8000, timeo=<optimized out>) at /var/soft/swoole-src-swoole-1.8.5-stable/src/reactor/ReactorEpoll.c:258\n#28 0x00007f60d55d6bf0 in swWorker_loop (factory=factory@entry=0x7f60d46b7430, worker_id=worker_id@entry=7) at /var/soft/swoole-src-swoole-1.8.5-stable/src/network/Worker.c:489\n#29 0x00007f60d55d4250 in swManager_spawn_worker (factory=0x7f60d46b7430, worker_id=7) at /var/soft/swoole-src-swoole-1.8.5-stable/src/network/Manager.c:682\n#30 0x00007f60d55d4647 in swManager_start (factory=factory@entry=0x7f60d46b7430) at /var/soft/swoole-src-swoole-1.8.5-stable/src/network/Manager.c:135\n#31 0x00007f60d55c5ce2 in swFactoryProcess_start (factory=0x7f60d46b7430) at /var/soft/swoole-src-swoole-1.8.5-stable/src/factory/FactoryProcess.c:86\n#32 0x00007f60d55cbd79 in swServer_start (serv=serv@entry=0x7f60d46b7000) at /var/soft/swoole-src-swoole-1.8.5-stable/src/network/Server.c:634\n#33 0x00007f60d55b2ee7 in zim_swoole_http_server_start (ht=<optimized out>, return_value=0x7f60e33760b0, return_value_ptr=<optimized out>, this_ptr=0x7f60e31ac920, return_value_used=<optimized out>) at /var/soft/swoole-src-swoole-1.8.5-stable/swoole_http_server.c:1677\n#34 0x000000000089f36f in zend_do_fcall_common_helper_SPEC (execute_data=<optimized out>) at /var/soft/php-5.6.18/Zend/zend_vm_execute.h:558\n#35 0x0000000000830448 in execute_ex (execute_data=0x7f60e333c258) at /var/soft/php-5.6.18/Zend/zend_vm_execute.h:363\n#36 0x00000000007fc050 in zend_execute_scripts (type=type@entry=8, retval=retval@entry=0x0, file_count=file_count@entry=3) at /var/soft/php-5.6.18/Zend/zend.c:1341\n#37 0x000000000079b122 in php_execute_script (primary_file=primary_file@entry=0x7ffe970baf80) at /var/soft/php-5.6.18/main/main.c:2610\n#38 0x00000000008a0f91 in do_cli (argc=3, argv=0x1131b00) at /var/soft/php-5.6.18/sapi/cli/php_cli.c:994\n```\n\n经过一段时间后所有worker不能工作。。使用swoole-1.8.5，php5.6.19\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/706/comments",
    "author": "liupdhc",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-05-26T11:19:39Z",
        "body": "`gearman_wait` 它自己进入循环了，无法交出控制器，会导致Swoole的Worker进程逻辑无法执行。建议使用`addProcess`创建一个单独的子进程去执行gearman的操作。\n"
      }
    ]
  },
  {
    "number": 701,
    "title": "多协议监听 (websock && tcp) tcp收到不到消息",
    "created_at": "2016-05-24T14:19:06Z",
    "closed_at": "2016-05-25T08:06:23Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/701",
    "body": "多协议监听，websocket的message可以收到消息 而 tcp的receive收不到？ php5.5.34 && swoole-1.8.[ 3 - 5 ] 都有这个问题 而 swoole-1.8.2 却没有问题\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/701/comments",
    "author": "kaykay012",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-05-25T08:06:23Z",
        "body": "需要调用 set 方法 覆盖掉主服务器的协议设置。否则会继承主服务器的设置，也会按照WebSocket处理。\n"
      },
      {
        "user": "ZavierZh",
        "created_at": "2016-05-25T09:58:46Z",
        "body": "set 那些参数?\n"
      }
    ]
  },
  {
    "number": 681,
    "title": "http server中，worker进程halt后应该自动关闭socket",
    "created_at": "2016-05-17T08:10:59Z",
    "closed_at": "2016-05-31T06:03:46Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/681",
    "body": "之前试了下手，在worker进程出错中止后socket没有关闭，服务端这个工作进程都退出了，浏览器还在那死等，希望修复这个问题，能在子进程异常退出时同时把这个连接也关闭了\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/681/comments",
    "author": "huye",
    "comments": [
      {
        "user": "badxpgy",
        "created_at": "2016-05-19T10:20:28Z",
        "body": "你试试nginx，访问时直接把nginx kill掉，应该也会有同样问题吧，这个跟swoole应该没关系吧。\n"
      },
      {
        "user": "huye",
        "created_at": "2016-05-20T02:46:39Z",
        "body": "你只看nginx为什么不看看apache呢，nginx用的是cgi，swoole又没用cgi。这本来就是bug，为什么你会这么认为？\n"
      },
      {
        "user": "shenzhe",
        "created_at": "2016-05-20T04:05:58Z",
        "body": "这个用心跳，可一定程度是缓解。\nworker出错，会有worker_error的事件回调，你也可以在这里做相关的操作。\n比如，onRequest的时候，把request存起起，在收到worker error的时候，遍历发送end或close\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-05-31T06:03:46Z",
        "body": "默认使用PROCESS模式，连接是在master进程中维持的，Worker进程退出不会关闭连接。你可以使用register_shutdown_function+error_get_last，捕获Worker进程退出的致命错误事件，然后调用 $resp->end 将错误信息发给浏览器。\n\n或者使用BASE模式，当出错进程退出时关闭所有连接。\n"
      }
    ]
  },
  {
    "number": 660,
    "title": "swoole_http_server 无响应",
    "created_at": "2016-05-06T07:48:56Z",
    "closed_at": "2016-05-06T11:25:07Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/660",
    "body": "使用swoole_http_server创建的http服务，\n当程序出运行过程中出了问题时导致当前worker重启，会导致当前这个http请求一直没有响应，\n在onWorkerError里想执行一下response->end，但发现response似乎已经被清除了，\n\n希望当程序出问题后能返回给用户http 500 这样的错误而不是一直等待响应\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/660/comments",
    "author": "vlike",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-05-06T11:25:07Z",
        "body": "将$response对象保存起来，然后捕获PHP致命错误，输出错误页面。\n`onWorkerError` 是在Manager进程内执行的，没有$response对象 \n"
      }
    ]
  },
  {
    "number": 649,
    "title": "swSSL_accept: swSSL_accept() failed. Error: DH lib[5]",
    "created_at": "2016-05-01T03:27:59Z",
    "closed_at": "2016-05-04T08:40:43Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/649",
    "body": "部署好的wss 也就是在ssl下的 webscoket 在页面上是正常的 但是我用了阿里云的slb转发 转发中部署的有端口健康状态监听，他会去访问我这个端口 他们的访问是非ssl的，导致服务端大量的报这个警告 \n\n环境：centos 6.5\n版本： master分支 1.8.5 beta\n阿里云：slb 转发\nphp ：5.6\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/649/comments",
    "author": "nosun",
    "comments": [
      {
        "user": "nosun",
        "created_at": "2016-05-01T03:35:17Z",
        "body": "阿里云，检测的发包是这样的 “HEAD /HTTP/1.0\\r\\n\\r\\n\"，一次发8个\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-05-01T11:06:04Z",
        "body": "SSL端口必须使用SSL协议才能访问。\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-05-01T11:06:29Z",
        "body": "你可以监听一个非SSL的明文端口。\n"
      },
      {
        "user": "nosun",
        "created_at": "2016-05-02T02:10:37Z",
        "body": "关键的问题是，master进程会挂掉…\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-05-03T10:34:52Z",
        "body": "挂掉是指core dump吗，请贴出core信息。\n非SSL访问SSL端口底层会报`WARNING   swSSL_accept: bad SSL client[127.0.0.1:53505]`\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-05-04T08:40:41Z",
        "body": "WebSocket的多端口监听有BUG, 请试试 `1.8.5-beta`\n"
      }
    ]
  },
  {
    "number": 642,
    "title": "PHP 7 Support",
    "created_at": "2016-04-24T02:28:07Z",
    "closed_at": "2016-04-25T09:59:43Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/642",
    "body": "Is this supported in PHP7?\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/642/comments",
    "author": "ganeshkbhat",
    "comments": [
      {
        "user": "GXhua",
        "created_at": "2016-04-24T02:42:59Z",
        "body": "yes\n"
      }
    ]
  },
  {
    "number": 639,
    "title": "stop会报端口无法绑定错误",
    "created_at": "2016-04-21T02:33:10Z",
    "closed_at": "2016-04-21T02:54:00Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/639",
    "body": "版本号1.8.4\n\n报错信息如下\n\nWARNING swSocket_bind: bind(0.0.0.0:9502) failed. Error: Address already in use [48]\nPHP Fatal error:  swoole_server::__construct(): listen server port failed.\n\nstart的时候要绑定端口容易理解，stop的时候报这个错实在是想不通\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/639/comments",
    "author": "diaosj",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-04-21T02:54:00Z",
        "body": "stop是给程序内部调的，不能重新new swoole_server去执行stop，你应该使用kill发信号给Server进程关闭服务器。\n"
      }
    ]
  },
  {
    "number": 636,
    "title": "Unix domain Socket套接字文件属性如何更改？",
    "created_at": "2016-04-19T08:51:19Z",
    "closed_at": "2016-04-19T09:12:14Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/636",
    "body": "增加linux domain socket的支持\n$serv->addlistener(\"/var/run/myserv.sock\", 0, SWOOLE_UNIX_STREAM);\n\n本机fpm模式(nobody用户)下，php无法通过 /var/run/myserv.sock 连接服务\n/var/run/myserv.sock文件只有root用户才具有读写权限，如何改变此文件属性，让其它用户可以连接\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/636/comments",
    "author": "stcer",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-04-19T09:10:04Z",
        "body": "可以在`onStart`回调函数中修改`unixsock`文件的权限。\n\n``` php\nchmod('/var/run/myserv.sock', 0777);\n```\n"
      },
      {
        "user": "stcer",
        "created_at": "2016-04-20T01:23:11Z",
        "body": "ok, thanks\n"
      }
    ]
  },
  {
    "number": 618,
    "title": "swoole_http_server共享http连接",
    "created_at": "2016-04-06T01:51:57Z",
    "closed_at": "2016-04-07T02:38:46Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/618",
    "body": "全异步的swoole_http_server下如何把swoole_http_response共享给task或者其他woker处理并返回呢?\n虽然可以遍历connection_list,但如何构建swoole_http_response对象呢?\n\n``` php\nfunction onTask($server,$taskId,$fromId,$data){\n//只传递fd会报错http client is not exist\n$res=new swoole_http_response();\n$res->fd=$data['fd'];\n$res->end('ok');\n//直接传递response对象也报同样的错误\n$data['http_response']->end('ok');\n}\n```\n\n我的场景是通过http提交一个长时间的任务job由woker+task或者新建进程处理返回一个job_id,用户随时可以通过http带job_id查询job进度.前后的请求可能分配在不同的woker上,如果可以通过共享fd之类的其他woker或者task可以处理http请求会很方便\n\n谢谢\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/618/comments",
    "author": "sanwv",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-04-07T02:38:46Z",
        "body": "将`response`对象保存到worker进程的全局变量数组中，task进程返回结果后会回调worker进程的`onFinish`，这时再从全局变量数组中取出来执行end\n"
      },
      {
        "user": "sanwv",
        "created_at": "2016-04-07T02:49:30Z",
        "body": "可否建议这个feature在以后版本实现呢,像WebSocket的push方法也只能在当前worker中调用,在wokrer/task间来回通信稍有不便,相对TcpServer的send方法只需要一个fd简真太方便了\n\n按我的理解应该可以通过两个方式实现:1.通过fd sock之类显式new出对象2.在server上添加getResponseByFd($fd)之类的方法由低层构建对象\n\n期待评估,多谢\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-04-07T02:58:43Z",
        "body": "http-server在设计上是有上下文关联的，所以无法实现上述的功能。\n"
      },
      {
        "user": "sanwv",
        "created_at": "2016-04-07T03:02:30Z",
        "body": "了解了,多谢\n"
      },
      {
        "user": "safecat",
        "created_at": "2016-08-29T07:19:20Z",
        "body": "我使用的方式是worker发到task，task执行完之后再回给worker，然后worker response\n\n但是如果使用了max_request配置，worker在执行完（发到task）之后就会结束，task回过来的时候发现存储在worker里的response对象不见了，因为worker整个进程都重启了。。。\n\n请问@matyhtf 这个情况怎么办比较好\n"
      }
    ]
  },
  {
    "number": 613,
    "title": "swoole_http_client 报segmentation fault (core dumped)",
    "created_at": "2016-03-31T08:30:40Z",
    "closed_at": "2016-04-01T05:40:21Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/613",
    "body": "代码如下\n\n```\n<?php\nfor ($i = 0; $i < 10000; $i ++) {\n    runHttp($i);\n}\n\nfunction runHttp($i)\n{\n    $cli = new swoole_http_client('127.0.0.1', 80);\n    $cli->post('/test.php', array(\n        \"test\" => $i\n    ), function ($cli) {\n        echo $cli->body;\n    });\n}\n\n```\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/613/comments",
    "author": "sanwv",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-03-31T08:41:57Z",
        "body": "$cli 对象无任何地方引用，函数退出时就自动析构了，连接也会直接关闭。所以你需要保存到一个全局变量中。\n"
      },
      {
        "user": "sanwv",
        "created_at": "2016-03-31T09:07:02Z",
        "body": "以下两种写法还是报同样的错误\n\n```\n<?php\nfor ($i = 0; $i < 10000; $i ++) {\n    runHttp($i);\n}\n\nfunction runHttp($i)\n{\n    static $list = [];\n    $cli = new swoole_http_client('127.0.0.1', 80);\n    $cli->post('/test.php', array(\n        \"test\" => $i\n    ), function ($cli) {\n        echo $cli->body;\n    });\n    $list[$i] = $cli;\n}\n\n```\n\n或者\n\n```\n<?php\n$list = [];\nfor ($i = 0; $i < 10000; $i ++) {\n    $list[$i] = new swoole_http_client('127.0.0.1', 80);\n    $list[$i]->post('/test.php', array(\n        \"test\" => $i\n    ), function ($cli) {\n        echo $cli->body;\n    });\n}\n```\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-03-31T09:16:19Z",
        "body": "我这里用你的代码测试无问题。请使用 PHP5.6 + Swoole1.8.4-beta测试一下。\n"
      },
      {
        "user": "sanwv",
        "created_at": "2016-03-31T09:34:14Z",
        "body": "我的环境是这样的:\n\n```\n cod git:(dev) ✗ php -v\nPHP 7.0.4-7+deb.sury.org~trusty+2 (cli) ( NTS )\nCopyright (c) 1997-2016 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2016 Zend Technologies\n    with Zend OPcache v7.0.6-dev, Copyright (c) 1999-2016, by Zend Technologies\n➜  cod git:(dev) ✗ uname -a\nLinux web-dev 3.13.0-83-generic #127-Ubuntu SMP Fri Mar 11 00:25:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n➜  cod git:(dev) ✗ php -a\nInteractive mode enabled\n\nphp > echo SWOOLE_VERSION;\n1.8.4-beta\nphp >\n```\n"
      },
      {
        "user": "sanwv",
        "created_at": "2016-04-01T01:38:54Z",
        "body": "请教两个问题:\n1.swoole_client/http_client是基于epoll还是select呢\n2.假设需要调取10w次接口,用swoole_http_client异步如何做并发控制呢,如同时最多有5000个请求\n\n多谢\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-04-01T05:40:21Z",
        "body": "基于epoll，Reactor模型\n"
      }
    ]
  },
  {
    "number": 609,
    "title": "无法处理 file_get_contents('php://input')",
    "created_at": "2016-03-30T09:42:08Z",
    "closed_at": "2016-03-31T08:44:33Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/609",
    "body": "很多composer库用到了file_get_contents('php://input')\nswoole的setGlobal( )不处理这个\n虽然可以在回调通过$request->rawContent()获取数据，但不兼容第三库\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/609/comments",
    "author": "zxz054321",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-03-31T08:44:33Z",
        "body": "底层实现原理不同所以无法支持 file_get_contents('php://input')，建议使用PHP代码做兼容。\n"
      },
      {
        "user": "52fhy",
        "created_at": "2018-08-13T10:37:48Z",
        "body": "```\r\n$GLOBALS['HTTP_RAW_POST_DATA'] = $request->rawContent();\r\n```\r\n即可。"
      },
      {
        "user": "twose",
        "created_at": "2018-08-13T10:45:02Z",
        "body": "@52fhy 这样会产生严重问题, 不管是异步还是协程全局变量都不会随之切换, 如果代码中间有IO事件, 会造成污染读错数据, 所以你这个方法是错误的"
      },
      {
        "user": "52fhy",
        "created_at": "2018-08-13T15:56:56Z",
        "body": "@twose 打算在request回调里中调用。这么一说，还是直接从`$request->rawContent()`取比较好，不去修改`$GLOBALS['HTTP_RAW_POST_DATA']`。"
      }
    ]
  },
  {
    "number": 606,
    "title": "swoole_http_server->listen的问题",
    "created_at": "2016-03-30T03:30:20Z",
    "closed_at": "2016-03-30T10:36:09Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/606",
    "body": "```\n$http = new swoole_http_server(\"0.0.0.0\", 9501);\n$http->on('request', function ($request, $response)\n{\n    $response->end(\"<h1>Hello Swoole. #\".rand(1000, 9999).\"</h1>\");\n});\n\n$tunnel = $http->listen('0.0.0.0', 5555, SWOOLE_SOCK_TCP);\n$tunnel->on('receive', function ($serv, $fd, $from_id, $data) use($http) {\n    $http->send($fd, 'Swoole: '.$data);\n    $http->close($fd);\n});\n\n$http->start();\n```\n# \n\n$tunnel->on('receive', ...) 这一行无效，我翻阅文档后，知道 swoole_http_server 不接受 onReceive，但在 http->listen 之后是我的目的是使用四层TCP链接，我想知道这个是算BUG，还是正确的设计?\n\nPHP7.0.2 / swoole 1.8.2\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/606/comments",
    "author": "gowandering",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-03-30T10:36:09Z",
        "body": "1. 请使用1.8.3版本\n2. 新增了端口，但是未设定任何协议处理会继承主Server的设置也就是`http`协议。你可以调用`$tunnel->set()`方法设置`open_length_check`或`open_eof_check`等选项实现独立的协议处理。\n"
      }
    ]
  },
  {
    "number": 604,
    "title": "swoole 1.8.3 版本又出现大量 worker# is not exists 警告!",
    "created_at": "2016-03-29T16:07:24Z",
    "closed_at": "2016-03-30T11:26:38Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/604",
    "body": "发现只要在用户进程中调用 $serv->send() 给指定的客户端发送消息就会报这个错! 工作进程中 send 没问题。（实际上消息正常发出去了）\n\n[2016-03-30 00:01:26 @29833.0]  WARNING swServer_get_worker: worker#55 is not exist.\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/604/comments",
    "author": "designinlife",
    "comments": [
      {
        "user": "minr",
        "created_at": "2016-03-29T16:51:25Z",
        "body": "[2016-03-30 00:50:14 #15471.0]  WARN    swReactorThread_onReceive_http_request#1331: recv from connection#60 failed. Error: Socket operation on non-socket[88].\n\n出现大量的 警告日志。 1.7.22 和 最新版均存在这样的情况。\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-03-30T11:26:38Z",
        "body": "连接关闭了。所以会报此错误。\n"
      }
    ]
  },
  {
    "number": 602,
    "title": "swoole 1.8.3 版本 stats 中 tasking_num 为什么是0？？？",
    "created_at": "2016-03-28T14:51:20Z",
    "closed_at": "2016-04-21T10:25:41Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/602",
    "body": "127.0.0.1:1766 运行状态:\n\nstart_time:     1459162450\nconnection_num: 18\naccept_count:   4816969\nclose_count:    4816951\ntasking_num:    0\nrequest_count:  4956485\nworker_request_count:   1737\ntask_process_num:       200\n\n为什么tasking_num 为0呢？\n\n版本是 swoole 1.8.3 + php 5.6.19 \n\nswoole 版本是从 1.7.22 升级上来的。然后重启之后就出现这个问题？\n\n是什么原因呢？？？ 还有worker_request_count 是个什么意思呢？\n\nnginx 进行了一层proxy_pass  转发\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/602/comments",
    "author": "minr",
    "comments": [
      {
        "user": "minr",
        "created_at": "2016-03-29T17:12:42Z",
        "body": "@matyhtf \n进凌晨两台服务器突然进程全部假死，所有的tasking都无法正常工作。\n无法kill无法restart，但是ps -ef |grep 确能看到所有的进程。但是所有进程均不再工作。\n\n服务器出现大量如下日志：\n\n[2016-03-29 23:05:37 #10169.3]  WARNING swFactoryProcess_dispatch: dispatch[type=4] failed, connection#59[session_id=11970131] is closed by server.\nDate:2016-03-29 23:05:45     swoole_http_server[Charon  worker:50 shutdown\n[2016-03-29 23:06:25 #10169.3]  WARNING swFactoryProcess_dispatch: dispatch[type=4] failed, connection#59[session_id=11990602] is closed by server.\n[2016-03-29 23:06:49 #10169.3]  WARNING swFactoryProcess_dispatch: dispatch[type=4] failed, connection#59[session_id=12000529] is closed by server.\n[2016-03-29 23:06:54 #10169.3]  WARNING swFactoryProcess_dispatch: dispatch[type=4] failed, connection#59[session_id=12002990] is closed by server.\n[2016-03-29 23:08:30 #10169.3]  WARNING swFactoryProcess_dispatch: dispatch[type=4] failed, connection#59[session_id=12043960] is closed by server.\nDate:2016-03-29 23:10:12     swoole_http_server[Charon  worker:16 shutdown\n[2016-03-29 23:10:24 #10169.3]  WARNING swFactoryProcess_dispatch: dispatch[type=4] failed, connection#59[session_id=12093164] is closed by server.\n[2016-03-29 23:11:06 #10169.3]  WARNING swFactoryProcess_dispatch: dispatch[type=4] failed, connection#59[session_id=12111149] is closed by server.\n\n不知是否和上面我提交的tasking_num为0 有关系。 \n目前我已将一台服务器的swoole 版本降低为 1.7.22 和 1.8.3 （最新）\n"
      },
      {
        "user": "minr",
        "created_at": "2016-03-30T03:03:20Z",
        "body": "@matyhtf 果然 新版本 1.8.3 task 肯定有问题！ 刚刚服务又宕了！\n进程存在，但是实际上已经不工作了。 \n\n这些是日志：\n\n[2016-03-30 10:44:51 *11665.11] ERROR   swFactoryProcess_finish (ERROR 1004): send 190 byte failed, because session#5089484 is closed.\n[2016-03-30 10:44:51 *11665.11] ERROR   swFactoryProcess_finish (ERROR 1004): send 190 byte failed, because session#5089500 is closed.\n\nps -ef 可以看到如下进程，但是这些进程已经不工作了。\n\nwork     11516     1  1 00:33 ?        00:10:57 master\nwork     11517 11516  0 00:33 ?        00:00:00  manager\nwork     11582 11517  0 00:33 ?        00:00:41 task\nwork     11654 11517  0 00:33 ?        00:00:00 event\nwork     11655 11517  0 00:33 ?        00:00:00 event\nwork     11656 11517  0 00:33 ?        00:00:00 event\n\n用$serv->stats无法响应了。\n\n我先降级为1.7.22吧\n"
      },
      {
        "user": "minr",
        "created_at": "2016-04-19T08:43:03Z",
        "body": "@matyhtf 刚刚发布的swoole 1.8.4稳定版 貌似依旧还是会出现上面我说的这个情况。\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-04-21T10:25:41Z",
        "body": "上面的错误信息表示连接已关闭仍然在向它发数据。\ntasking_num 表示当前正在排队的Task\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-04-21T10:26:08Z",
        "body": "worker_request_count 表示当前Worker进程处理的请求数量。\n"
      }
    ]
  },
  {
    "number": 600,
    "title": "定时器执行完后如何自动退出程序",
    "created_at": "2016-03-28T14:50:59Z",
    "closed_at": "2016-03-29T06:47:48Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/600",
    "body": "现在程序里面只要调用了 `swoole_timer_after` 或者 `swoole_timer_tick`，不管定时器是否已经执行结束，程序都不会退出。这样的话，在客户端程序或者 Web 页面中就无法使用定时器了，因为使用之后，整个程序卡死在那里，不能结束了。能否像 `event` 或 `libevent` 扩展一样，当定时器上的任务都执行完之后，自动结束事件循环，退出程序啊？\n\n另外，`event` 和 `libevent` 的定时器精度是微秒级的（microseconds），`swoole` 的定时器能否也做成微秒级的啊。\n\n还有 `event` 和 `libevent` 都允许将等待时间设置为 0，这样就可以实现 `nextTick` 的功能了，`swoole` 能否加上设置为 0 的支持。\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/600/comments",
    "author": "andot",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-03-29T06:47:48Z",
        "body": "目前不支持微妙。时间为0你可以用 `swoole_event_defer`，退出使用 `swoole_event_exit`\n"
      },
      {
        "user": "andot",
        "created_at": "2016-03-29T11:20:47Z",
        "body": "`swoole_timer_after` 设置为 0 时，会有一个警告信息：\n\n```\nWarning: swoole_timer_after(): Timer must be greater than 0 ...\n```\n\n而且定时器并不会执行。\n\n`swoole_event_defer` 在没有 IO 时会卡住。\n\n另外，因为不知道事件循环中的所有事件何时会执行完，所以没办法手动调用 `swoole_event_exit` 结束。\n"
      }
    ]
  },
  {
    "number": 588,
    "title": "swoole在热重启时,会不会释放掉pipe_buffer_size?",
    "created_at": "2016-03-24T02:51:52Z",
    "closed_at": "2016-03-24T10:12:05Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/588",
    "body": "swoole在热重启时,会不会释放掉pipe_buffer_size?\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/588/comments",
    "author": "ltanme",
    "comments": [
      {
        "user": "ltanme",
        "created_at": "2016-03-24T09:31:01Z",
        "body": "@matyhtf  \n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-03-24T10:12:05Z",
        "body": "进程结束会释放所有资源。\n"
      }
    ]
  },
  {
    "number": 486,
    "title": "Swoole and PHP 7",
    "created_at": "2016-01-18T01:01:44Z",
    "closed_at": "2016-06-12T07:42:31Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/486",
    "body": "Hello,\n\nCongratulations for the project, it's really a good idea.\n\nUnfortunately I couldn't install Swoole using PHP 7.0.0 or PHP 7.0.2.\n\n```\n$ pecl install swoole\nCould not open input file: /Applications/MAMP/bin/php/php7.0.0/lib/php/peclcmd.php\n```\n\nAre you aware of it or do I need to do an alternate configuration?\n\nBest,\nCesar\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/486/comments",
    "author": "cesarkohl",
    "comments": [
      {
        "user": "lscgzwd",
        "created_at": "2016-01-18T02:03:52Z",
        "body": "May be you need run command with sudo or manually build.  On my mac , I install swoole and php7.0.2 by brew , It works ok.\n"
      },
      {
        "user": "cesarkohl",
        "created_at": "2016-01-18T08:39:49Z",
        "body": "Good to know, I'll try again. Thanks!\n"
      }
    ]
  },
  {
    "number": 485,
    "title": "swoole_http_response 是否能proxy",
    "created_at": "2016-01-14T18:23:10Z",
    "closed_at": "2016-01-15T08:47:01Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/485",
    "body": "static PHP_METHOD(swoole_http_response, write);\nstatic PHP_METHOD(swoole_http_response, end);\nstatic PHP_METHOD(swoole_http_response, sendfile);\nstatic PHP_METHOD(swoole_http_response, cookie);\nstatic PHP_METHOD(swoole_http_response, rawcookie);\nstatic PHP_METHOD(swoole_http_response, header);\nstatic PHP_METHOD(swoole_http_response, gzip);\nstatic PHP_METHOD(swoole_http_response, status);\n\nwrite和end方法都会默认加上头部信息\n\nHTTP/1.1 200 OK\nServer: swoole-http-server\nContent-Type: text/html\n\n不知道是否支持发送raw content, 实现proxy功能\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/485/comments",
    "author": "mysteriouss",
    "comments": [
      {
        "user": "mysteriouss",
        "created_at": "2016-01-14T18:26:57Z",
        "body": " $swoole_http_server::send($swoole_http_request->fd,$rawdata) \n $swoole_http_server::close($swoole_http_request->fd); ?\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-01-15T08:47:01Z",
        "body": "支持\n"
      },
      {
        "user": "mysteriouss",
        "created_at": "2016-01-15T09:05:29Z",
        "body": "send完后直接close会不会有问题呀？\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2016-01-21T12:33:02Z",
        "body": "没问题。你可以测试一下，如果有问题可以反馈给我\n"
      }
    ]
  },
  {
    "number": 464,
    "title": "onReceive中会收到截断的数据",
    "created_at": "2015-12-31T09:01:10Z",
    "closed_at": "2016-01-02T10:57:19Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/464",
    "body": "设置了\\r\\n\\r\\n为结束符,连续发送100段数据(用fsockopen打开, 然后通过write发送, 循环100次, 最后close), 其中每段数据的最后也用\\r\\n\\r\\n作为结束\n但是有些时候, 发送的100段数据中,会有1-2段数据出错, 经过日志打印, 发现数据被截断了\n中间并没有\\r\\n\\r\\n, 但是被拆成了2次onReceive\n\n我自己用日志打印了一下, 发现onReceive的回调函数里面打印的数据, 被拆成了2次\n[2015-12-31 16:52:53][DEBUG][Command][IndexManager/save_log:81][0][save_log]{\"logger_name\":\"Story_online\",\"timestamp\":\"2015-12-31 16:52:53\",\"file\":\"App\\/Lib\\/Action\\/Story\\/T\n[2015-12-31 16:52:53][DEBUG][Command][IndexManager/save_log:89]save log to db error: <E9><9D><9E><E6><B3><95><E6><95><B0><E6><8D><AE>\n<E5><AF><B9><E8><B1><A1><EF><BC><81>\n[2015-12-31 16:52:53][DEBUG][Command][IndexManager/save_log:81][0][save_log]estAction.class.php\",\"line\":23,\"class_name\":\"TestAction\",\"method\":\"log\",\"level\":6,\"message\":\"bianwei42\",\"thread\":\"29697\"}\n[2015-12-31 16:52:53][DEBUG][Command][IndexManager/save_log:89]save log to db error: <E9><9D><9E><E6><B3><95><E6><95><B0><E6><8D><AE>\n<E5><AF><B9><E8><B1><A1><EF><BC><81>\n[2015-12-31 16:52:53][DEBUG][Command][IndexManager/save_log:81][0][save_log]{\"logger_name\":\"Story_online\",\"timestamp\":\"2015-12-31 16:52:53\",\"file\":\"App\\/Lib\\/Action\\/Story\\/TestAction.class.php\",\"line\":23,\"class_name\":\"TestAction\",\"method\":\"log\",\"level\":6,\"message\":\"bianwei43\",\"thread\":\"29697\"}\n[2015-12-31 16:52:53][DEBUG][Command][IndexManager/save_log:81][0][save_log]{\"logger_name\":\"Story_online\",\"timestamp\":\"2015-12-31 16:52:53\",\"file\":\"App\\/Lib\\/Action\\/Story\\/TestAction.class.php\",\"line\":23,\"class_name\":\"TestAction\",\"method\":\"log\",\"level\":6,\"message\":\"bianwei44\",\"thread\":\"29697\"}\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/464/comments",
    "author": "poisonbian",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2015-12-31T09:20:31Z",
        "body": "是否启用了 open_eof_split\n"
      },
      {
        "user": "poisonbian",
        "created_at": "2016-01-02T06:28:58Z",
        "body": "之前没有开启open_eof_split，因为会出错，看到你另外一个回复，关闭了ringbuffer，重新开启了open_eof_split之后，这个问题就没有再复现了~\n"
      }
    ]
  },
  {
    "number": 457,
    "title": "发现很多 swFactoryProcess_finish: session#XX does not exist. 警告",
    "created_at": "2015-12-30T02:24:55Z",
    "closed_at": "2015-12-30T13:35:50Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/457",
    "body": "[2015-12-30 10:22:01 @6264.0]   WARN    swFactoryProcess_finish: session#61 does not exist.\n[2015-12-30 10:22:01 @6264.0]   WARN    swFactoryProcess_finish: session#26 does not exist.\n[2015-12-30 10:22:09 *6231.1]   WARN    swFactoryProcess_finish: session#12 does not exist.\n[2015-12-30 10:22:10 @6264.0]   WARN    swFactoryProcess_finish: session#27 does not exist.\n[2015-12-30 10:22:10 @6264.0]   WARN    swFactoryProcess_finish: session#12 does not exist.\n[2015-12-30 10:22:10 @6264.0]   WARN    swFactoryProcess_finish: session#20 does not exist.\n[2015-12-30 10:22:10 @6264.0]   WARN    swFactoryProcess_finish: session#24 does not exist.\n[2015-12-30 10:22:10 @6264.0]   WARN    swFactoryProcess_finish: session#43 does not exist.\n[2015-12-30 10:22:10 @6264.0]   WARN    swFactoryProcess_finish: session#61 does not exist.\n[2015-12-30 10:22:10 @6264.0]   WARN    swFactoryProcess_finish: session#26 does not exist.\n\n但是数据流转都看似挺正常的!\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/457/comments",
    "author": "designinlife",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2015-12-30T13:35:50Z",
        "body": "这是正常的现象，用户在接收数据前关闭了连接。\n"
      }
    ]
  },
  {
    "number": 302,
    "title": "Is there a possible conflict between php_swoole and php_zookeeper?",
    "created_at": "2015-07-01T11:05:43Z",
    "closed_at": "2017-08-28T10:54:33Z",
    "labels": [
      "question",
      "timeout (7 days)"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/302",
    "body": "I wrote a small program to explain this.\n\nAfter I run this:\n\n```\n<?php\nswoole_process::signal(SIGTERM, function() {\n        echo \"TERM\\n\";\n});\n\nswoole_event_wait();\n```\n\nI opened another terminal and send a TERM signal by:\n\n```\nkill <pid>\n```\n\nAnd the original terminal printed:\n\n```\nTERM\n```\n\nBut when I added only one line:\n\n```\n$zk = new \\Zookeeper('106.39.209.43:2182');\n```\n\nThe program was terminated directly after sending TERM signal.\nIt seems that after creating Zookeeper instance, the swoole_process::signal() fails.\n\nCould you guys help me to solve this?\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/302/comments",
    "author": "Timandes",
    "comments": [
      {
        "user": "Timandes",
        "created_at": "2015-07-01T11:11:52Z",
        "body": "```\n$ uname -a\nLinux xxx 2.6.32-220.el6.x86_64 #1 SMP Tue Dec 6 19:48:22 GMT 2011 x86_64 x86_64 x86_64 GNU/Linux\n\n$ php -v\nPHP 5.4.29 (cli) (built: Apr  9 2015 17:17:25)\nCopyright (c) 1997-2014 The PHP Group\nZend Engine v2.4.0, Copyright (c) 1998-2014 Zend Technologies\n    with Xdebug v2.2.4, Copyright (c) 2002-2014, by Derick Rethans\n```\n"
      },
      {
        "user": "Timandes",
        "created_at": "2015-07-01T14:08:12Z",
        "body": "This only happens under PHP 5.4.\n\nProgram under PHP 5.3 does not have this issue.\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-08-28T10:54:33Z",
        "body": "disable signalfd\r\n```php\r\nSwoole\\Async::set([\r\n    'enable_signalfd' => false,\r\n]);\r\n```"
      }
    ]
  }
]