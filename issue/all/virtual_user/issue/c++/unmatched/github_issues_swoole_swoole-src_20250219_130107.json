[
  {
    "number": 4610,
    "title": "\u5173\u4e8eswoole-cli swoole\u7684\u914d\u7f6e\u4fee\u6539",
    "created_at": "2022-02-16T10:13:40Z",
    "closed_at": "2022-02-16T16:28:34Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4610",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n```\r\n\u4f7f\u7528 v4.8.6 swoole-cli \u542f\u52a8hyperf\u65f6\r\n ./swoole-cli bin/hyperf.php start\r\n```\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n**v4.8.6  swoole-cli\u600e\u4e48\u4fee\u6539swoole\u7684\u914d\u7f6e\u5440\uff1f\r\n\u4f8b\u5982 swoole.use_shortname \u4fee\u6539\u4e3a Off**\r\n\r\n3. What did you see instead?\r\n\r\n**\u9700\u8981\u5173\u95ed swoole.use_shortname**\r\n`ERROR Swoole short function names must be disabled before the server starts, please set swoole.use_shortname='Off' in your php.ini.`\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n./swoole-cli --ri swoole\r\n\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.8.6\r\nBuilt => Jan 11 2022 11:48:24\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1m  14 Dec 2021\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\nc-ares => 1.18.1\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n```\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4610/comments",
    "author": "shimianxiang",
    "comments": [
      {
        "user": "leocavalcante",
        "created_at": "2022-02-16T12:23:47Z",
        "body": "`swoole-cli --ini` \u7684\u8f93\u51fa\u662f\u4ec0\u4e48?\r\n\r\n\u4f5c\u4e3a\u4e00\u79cd\u89e3\u51b3\u65b9\u6cd5\uff0c\u60a8\u53ef\u4ee5\u5c1d\u8bd5 `swoole-cli -dswoole.use_shortname=Off bin/hyperf.php` "
      }
    ]
  },
  {
    "number": 2905,
    "title": "Socket::recvAll \u83b7\u5f97\u7684\u7ed3\u679c\u548c\u9884\u60f3\u7684\u4e0d\u592a\u4e00\u6837\u3002",
    "created_at": "2019-10-23T05:56:36Z",
    "closed_at": "2019-10-23T08:26:58Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2905",
    "body": "```php\r\n<?php\r\n\r\nuse Swoole\\Process;\r\n\r\n$process = new Process(function (Process $process) {\r\n    $socket = $process->exportSocket();\r\n    $head = $socket->recvAll(4,1);\r\n    var_dump($head);\r\n    $len = unpack('Nlen', $head)['len'];\r\n    var_dump($len);\r\n    $data = $socket->recvAll($len,1);\r\n    var_dump($data);\r\n\r\n    $socket->send('xxxx');\r\n}, false, 2, true);\r\n\r\n$process->start();\r\n\r\nSwoole\\Coroutine\\Run(function () use ($process) {\r\n    $socket = $process->exportSocket();\r\n    $data = 'Hello World.';\r\n    $socket->sendAll(pack('N', strlen($data)) . $data);\r\n    $socket->sendAll(pack('N', strlen($data)) . $data);\r\n    var_dump('send');\r\n    $socket->recv();\r\n});\r\n```\r\n\r\n\u7ed3\u679c\r\n\r\n```\r\n$ php demo.php\r\nstring(4) \"send\"\r\nstring(4) \"\r\n           \"\r\nint(12)\r\nstring(12) \"\r\n            Hello Wo\"\r\n```\r\n\r\n\u9884\u60f3\u7ed3\u679c\u5e94\u8be5\u662f\r\n\r\n```\r\n$ php demo.php\r\nstring(4) \"send\"\r\nstring(4) \"\r\n           \"\r\nint(12)\r\nstring(12) \"Hello World.\"\r\n```\r\n\r\n\u9ebb\u70e6\u5e2e\u5fd9\u770b\u4e00\u4e0b\u3002\u3002\u3002",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2905/comments",
    "author": "limingxinleo",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-10-23T08:26:58Z",
        "body": "pipe type \u8bbe\u7f6e\u4e3a 2 (SOCK_DGRAM) \u6a21\u5f0f\u4e0b, \u4e0d\u662f\u6d41\u5f0f\u4f20\u8f93\u7684, \u76f4\u63a5send\u548crecv\u5373\u53ef"
      }
    ]
  },
  {
    "number": 2854,
    "title": "Swoole\\Timer::tick \u7684\u6267\u884c\u6b21\u6570round\u4e3a\u4f55\u6c38\u8fdc\u90fd\u662f0\uff1f",
    "created_at": "2019-09-25T07:13:45Z",
    "closed_at": "2019-09-25T08:29:00Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2854",
    "body": "\u4e1a\u52a1\u662f\u6839\u636e\u6267\u884c\u6b21\u6570\u81ea\u52a8\u7ec8\u6b62timer\uff0cSwoole\\Timer::info\uff08$timerid\uff09\u6240\u8fd4\u56de\u7684round\u6c38\u8fdc\u90fd\u662f0\uff1f\r\n```\r\n\t$limit_times=5;$interval=3;\r\n\tSwoole\\Timer::tick($interval*1000,function($timerid)use($limit_times){\r\n\t\t$timer_info=Swoole\\Timer::info($timerid);\r\n\t\tvar_dump($timer_info);\r\n\t     $round=$timer_info['round'];\r\n\t\tif($limit_times>0&&$round>=$limit_times){\r\n\t\t\tSwoole\\Timer::clear($timerid);\r\n\t\t}else{\r\n\t\t\techo 'job done by timer'.PHP_EOL;\r\n\t\t}\r\n\t});\r\n```\r\nphp\u7248\u672c\u662f 7.2 \r\n\r\n```\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.3\r\nBuilt => Aug 28 2019 17:51:00\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.0.2l  25 May 2017\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2854/comments",
    "author": "15521956291",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-09-25T08:29:00Z",
        "body": "\u8fd9\u4e2around\u4e0d\u662f\u6307tick\u6267\u884c\u4e86\u51e0\u8f6e, \u800c\u662f\u5b9a\u65f6\u5668\u521b\u5efa\u65f6\u5168\u5c40\u4e8b\u4ef6\u5faa\u73af\u662f\u7b2c\u51e0\u8f6e, \u6240\u4ee5\u4f60\u7684\u4f8b\u5b50\u4e2d\u6052\u4e3a0\r\n"
      },
      {
        "user": "15521956291",
        "created_at": "2019-09-25T13:27:06Z",
        "body": "\u90a3\u6709\u6ca1\u6709\u529e\u6cd5\u53ef\u4ee5\u8fc7\u53bb\u5f53\u524d\u5faa\u73af\u7684\u6b21\u6570\uff1f\r\narray(4) {\r\n  [\"exec_msec\"]=>\r\n  int(162)\r\n  [\"interval\"]=>\r\n  int(0)\r\n  [\"round\"]=>\r\n  int(0)\r\n  [\"removed\"]=>\r\n  bool(false)\r\n}\r\n\u8fd9\u4e2a\u8fd4\u56de\u7684\u6570\u7ec4\u6ca1\u6709\u76f8\u5173\u4fe1\u606f\u5462\uff0c\u60f3\u8fd9\u4e2aexec_msec\u4ee3\u8868\u4ec0\u4e48\uff0c\u539f\u672c\u6253\u7b97\u901a\u8fc7\u8fd9\u4e2a\u9664\u4ee5inrerval\u8ba1\u7b97\u6267\u884c\u6b21\u6570\u7684\uff0c\u53ef\u662f\u53d1\u73b0\u5e76\u4e0d\u80fd\u7528\r\n\u8fd8\u6709\uff0c\u8fd9\u4e1c\u897f\u7248\u672c\u66f4\u65b0\u91cc\u9762\u8ddf\u6587\u6863\u91cc\u5c45\u7136\u90fd\u6ca1\u6709\u8bf4\u660e\uff0c\u5199\u66f4\u65b0\u8bb0\u5f55\u8ddf\u6587\u6863\u771f\u7684\u4e0d\u591f\u7528\u5fc3\uff01\r\n"
      },
      {
        "user": "twose",
        "created_at": "2019-09-26T03:07:50Z",
        "body": "\u8fd9\u4e2aAPI\u53ea\u662f\u66b4\u9732\u4e86\u5e95\u5c42\u7684\u4fe1\u606f\u65b9\u4fbfPHP\u5c42\u505a\u8c03\u8bd5\u5668\u7528\u7684\r\n\r\n\u5faa\u73af\u6b21\u6570\u9700\u8981\u81ea\u5df1\u8bb0\u5f55\r\n\r\n\u8981\u4e48\u5c31\u4f7f\u7528README\u91cc\u5199\u7684\u65b9\u6cd5\r\n\r\n```php\r\ngo(function(){\r\n$round = 0;\r\nwhile (true) {\r\n    $round++;\r\n    Co::sleep(0.001);\r\n}\r\n});\r\n```\r\n\r\n"
      }
    ]
  },
  {
    "number": 2785,
    "title": "hook+ProcessPool bug",
    "created_at": "2019-08-27T06:06:16Z",
    "closed_at": "2019-08-31T00:19:26Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2785",
    "body": "\u5f00\u542fhook\u534f\u7a0b\u5316\u540e\uff0c\u5728\u8fdb\u7a0b\u6c60\u8fdb\u7a0b\u4e2d\u7684\u534f\u7a0b\u91cc\u6267\u884c\u5982 `file_get_contents`\u3001`sleep` \u88abhook\u7684\u51fd\u6570\u65f6\uff0c\u5c31\u4f1a\u5d29\r\n\r\nSwoole 4.4.3\u30014.4.4\r\n\r\n\u590d\u73b0\u4ee3\u7801\uff1a\r\n```php\r\n<?php\r\n$workerNum = 1;\r\n$pool = new Swoole\\Process\\Pool($workerNum);\r\n\r\n$pool->on(\"WorkerStart\", function ($pool, $workerId) {\r\n    var_dump(1);\r\n    \\Swoole\\Runtime::enableCoroutine(true); // hook \u540e\uff0c\u6267\u884c\u4e0b\u9762\u90a3\u53e5\u8bdd\u5c31\u5d29\r\n    go(function() use($pool, $workerId){\r\n        var_dump(2);\r\n        file_get_contents(__FILE__); // \u6267\u884c\u8fd9\u53e5\u8bdd\u5c31\u5d29\r\n        var_dump(3);\r\n        sleep(1000);\r\n    });\r\n});\r\n\r\n$pool->on(\"WorkerStop\", function ($pool, $workerId) {\r\n    echo \"Worker#{$workerId} is stopped\\n\";\r\n});\r\n\r\n$pool->start();\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2785/comments",
    "author": "Yurunsoft",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-08-27T06:28:41Z",
        "body": "\u8bf7\u5728`WorkerStart`\u672b\u5c3e\u6dfb\u52a0\u3000swoole\\event::wait();"
      },
      {
        "user": "twose",
        "created_at": "2019-08-27T07:41:48Z",
        "body": "\u6784\u9020\u65b9\u6cd5\u6ca1\u5f00\u542fenable_coroutine, \u4e8b\u4ef6\u88ab\u5ffd\u7565\u4e86"
      }
    ]
  },
  {
    "number": 2569,
    "title": "\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u521b\u5efa\u591a\u4e2a\u534f\u6210\u8bf7\u6c42redis\uff0c\u534f\u6210\u4e0d\u80fd\u6b63\u5e38\u7ed3\u675f\uff1f",
    "created_at": "2019-05-10T03:35:49Z",
    "closed_at": "2019-05-11T05:24:02Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2569",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n### server.php\r\n```php\r\n<?php\r\nrequire_once 'redisPool.php';\r\nextension_loaded('swoole') ? '' : die (\"Please install swoole \");\r\nextension_loaded('redis') ? '' :die (\"Please install redis\");\r\nclass swooleServer{\r\n    private $server = '';\r\n    const LISTENHOST = '0.0.0.0';\r\n    const PORT = 9502;\r\n    private $config = [];\r\n    private $redisPool = '';\r\n\r\n    public function __construct($config = [])\r\n    {\r\n        $this->redisPool = new redisPool(true);\r\n        $this->server = new swoole_server(self::LISTENHOST, self::PORT, SWOOLE_PROCESS, SWOOLE_TCP);\r\n\r\n    }\r\n\r\n    public function onCallback()\r\n    {\r\n        $this->server->on('Receive', [$this, 'onReceive']);\r\n        $this->server->on('WorkerStart', [$this, 'onWorkerStart']);\r\n    }\r\n\r\n    public function onReceive(swoole_server $server, int $fd, int $reactor_id, string $data)\r\n    {\r\n        $data = $this->upack($data);\r\n        $message = $data['message'];\r\n        $this->handel($message);\r\n        $this->send($fd,2000, 'SUCCESS');\r\n    }\r\n\r\n    public function handel($data)\r\n    {\r\n        $type = $data['type'];\r\n        $key = $data['key'];\r\n        $value = intval($data['value']);\r\n\r\n        if ($value >1000) {\r\n            $ms = 1;\r\n            $num = intval($value/1000);\r\n        } else {\r\n            $ms = intval(1000/$value);\r\n            $num = 1;\r\n        }\r\n\r\n        if ($type == 'addSecondTick') {\r\n\r\n            swoole_timer_tick($ms,function($tick_id) use($key,$num,$value) {\r\n                swoole_timer_after(1000*60,function() use($tick_id,$key){\r\n                    swoole_timer_clear($tick_id);\r\n                    $redis = $this->redisPool->getRedis();\r\n                    $redis->del($key);\r\n                    $this->redisPool->relasePool($redis);\r\n                });\r\n\r\n                    $redis = $this->redisPool->getRedis();\r\n                    $now = $redis->get($key);\r\n                    if ($now < $value) {\r\n                        $redis->incrBy($key,$num);\r\n                    }\r\n                    $this->redisPool->relasePool($redis);\r\n\r\n\r\n\r\n            });\r\n\r\n        }\r\n        return;\r\n    }\r\n    public function upack($message)\r\n    {\r\n\r\n        $type = substr($message, 0,2);\r\n        $length = substr($message,2,4);\r\n        $message = substr($message,6);\r\n        $type = unpack('n', $type);\r\n        $length = unpack('N', $length);\r\n        return ['type'=>$type[1],'length'=>$length[1],'message'=>json_decode($message, true)];\r\n    }\r\n\r\n    public function send($fd, $code, $message)\r\n    {\r\n        $data['code'] = $code;\r\n        $data['message'] = $message;\r\n        $this->server->send($fd, json_encode($data));\r\n    }\r\n\r\n    public function setConfig()\r\n    {\r\n        $this->config  = [\r\n            'worker_num' =>2,\r\n            'dispatch_mode'=>2,\r\n            'open_length_check' => true,\r\n            'package_max_length' => 10*1024,\r\n            'package_length_type' => 'N',\r\n            'package_length_offset' => 2,\r\n            'package_body_offset' => 6,\r\n            'daemonize' =>0\r\n        ];\r\n    }\r\n\r\n    public function onWorkerStart(swoole_server $server, int $worker_id)\r\n    {\r\n\r\n    }\r\n\r\n    public function getRedis()\r\n    {\r\n        if (isset($this->server->redis)) {\r\n            if ($this->server->redis->ping() == 'pong') return $this->server->redis;\r\n        }\r\n        $this->server->redis = new \\Redis();\r\n        $this->server->redis->connect('127.0.0.1', 6379);\r\n        return $this->server->redis;\r\n    }\r\n\r\n\r\n\r\n    public function start()\r\n    {\r\n        $this->setConfig();\r\n        $this->server->set($this->config);\r\n        $this->onCallback();\r\n        $this->server->start();\r\n    }\r\n\r\n\r\n    public function pack($message)\r\n    {\r\n\r\n    }\r\n}\r\n$server = new swooleServer();\r\n$server->start();\r\n```\r\n\r\n### redisPool.php\r\n```php\r\n<?php\r\n/**\r\n * Created by PhpStorm.\r\n * User: shenyang.qiu\r\n * Date: 2019/5/9\r\n * Time: 15:21\r\n */\r\nclass redisPool {\r\n    const host = '127.0.0.1';\r\n    const port = 6379;\r\n    public $maxnum = 100;\r\n    public $nownum = 0;\r\n    public $pool = [];\r\n    public $coroutine = false;\r\n    public function __construct($coroutine = false)\r\n    {\r\n        $this->pool = new SplQueue();\r\n        $this->coroutine = $coroutine;\r\n    }\r\n\r\n    public function getRedis()\r\n    {\r\n        if ($this->pool->count()) {\r\n            return $this->pool->pop();\r\n        } else {\r\n            try {\r\n                if ($this->nownum >$this->maxnum) {\r\n                    $timeout = 1;\r\n                    while ($timeout) {\r\n                        co::sleep(0.05);\r\n                        $timeout = $timeout -0.05;\r\n                        if($this->pool->count()) {\r\n                            return $this->pool->pop();;\r\n                        }\r\n                    }\r\n                    return false;\r\n                } else {\r\n                    if ($this->coroutine) {\r\n                        $redis = new \\Swoole\\Coroutine\\Redis();\r\n                    } else {\r\n                        $redis = new \\Redis();\r\n                    }\r\n\r\n                    $this->nownum  ++;\r\n                    $redis->connect(self::host,self::port);\r\n\r\n                    return $redis;\r\n                }\r\n            } catch (RedisException $exception) {\r\n                return false;\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    public function relasePool($redis)\r\n    {\r\n        return $this->pool->push($redis);\r\n    }\r\n}\r\n```\r\n\r\n### client.php\r\n```php\r\n<?php\r\n/**\r\n * Created by PhpStorm.\r\n * User: shenyang.qiu\r\n * Date: 2019/4/29\r\n * Time: 11:35\r\n */\r\nrequire_once 'redisPool.php';\r\n$redisPool = new redisPool();\r\n$atomic = new \\Swoole\\Atomic();\r\nfor ($i = 0; $i < 200; $i++) {\r\n    go(function() use($redisPool,$atomic) {\r\n\r\n            $redis = $redisPool->getRedis();\r\n            $num = $redis->get('test');\r\n            var_dump($num);\r\n            if ($num === null || $num === false) {\r\n                $redis->set('test',0);\r\n                $client = new \\Swoole\\Client(SWOOLE_SOCK_TCP);\r\n                $client->connect('127.0.0.1', 9502);\r\n                $data['type'] = 'addSecondTick';\r\n                $data['key'] = 'test';\r\n                $data['value'] = 100;\r\n                $message = json_encode($data);\r\n                $length = strlen($message);\r\n                $client->send(pack('nN', 1, $length) . $message);\r\n                $msg = $client->recv();\r\n                $client->close();\r\n\r\n            } else {\r\n                if ($num > 0) {\r\n\r\n                    $redis->decr('test');\r\n\r\n                } else {\r\n\r\n                }\r\n            }\r\n\r\n    });\r\n}\r\nvar_dump('\u603b\u5171\u8c03\u7528\u4e86:');\r\nvar_dump($atomic->get());\r\n```\r\n\r\n\r\n\r\n2. What did you expect to see?\r\n\u5f53\u8fd0\u884c\u5b8cclient.php\u7684\u65f6\u5019\u5e94\u8be5\u80fd\u6b63\u5e38\u9000\u51fa\r\n\r\n\r\n3. What did you see instead?\r\n\u8fd0\u884c\u5b8c\u4e0d\u80fd\u6b63\u5e38\u9000\u51fa\uff0c\u4e0d\u77e5\u9053\u5361\u5728\u54ea\u91cc\u4e86\u3002 \u5f53\u628aclitent.php\u4e2d\u7684\u6539\u6210\u5faa\u73af100\u6b21\u5c31\u80fd\u6b63\u5e38\u9000\u51fa\uff0c\u8fd9\u662f\u4e3a\u4ec0\u4e48\uff1f\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.3.1\r\nBuilt => Mar 15 2019 13:09:57\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\u4f7f\u7528\u7684\u662fwin10\u5b50\u7cfb\u7edf\r\n\r\nPHP 7.1.29-1+ubuntu18.04.1+deb.sury.org+1 (cli) (built: May  3 2019 09:51:29) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.1.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.1.29-1+ubuntu18.04.1+deb.sury.org+1, Copyright (c) 1999-2018, by Zend Technologies\r\n\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/7/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 7.3.0-27ubuntu1~18.04' --with-bugurl=file:///usr/share/doc/gcc-7/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-7 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 7.3.0 (Ubuntu 7.3.0-27ubuntu1~18.04)\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2569/comments",
    "author": "qiushengyang",
    "comments": [
      {
        "user": "huanghantao",
        "created_at": "2019-05-10T04:57:16Z",
        "body": "@qiushengyang \u4f60\u4ee3\u7801\u7684\u903b\u8f91\u95ee\u9898\uff0c\u95ee\u9898\u51fa\u5728\u4e86`getRedis`\u8fd9\u4e2a\u51fd\u6570\u7684\r\n```php\r\nwhile ($timeout) {\r\n                        co::sleep(0.05);\r\n                        $timeout = $timeout -0.05;\r\n                        if($this->pool->count()) {\r\n                            return $this->pool->pop();;\r\n                        }\r\n                    }\r\n```\r\n\u9677\u5165\u4e86\u6b7b\u5faa\u73af\u3002"
      },
      {
        "user": "qiushengyang",
        "created_at": "2019-05-10T05:03:47Z",
        "body": "\u540e\u6765\u6211\u4e5f\u53d1\u73b0\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u7b2c\u4e00\u4e2a\u5c31\u662f\u8fd9\u4e2a$timeout\u51fa\u73b0\u7cbe\u5ea6\u95ee\u9898\u4e0d\u80fd\u9000\u51fa\u5faa\u73af\uff0c\u8fd8\u6709\u4e00\u4e2a\u5c31\u662f\u524d\u7aef\u6ca1\u6709\u56de\u6536redis\u5bf9\u8c61  \u8c22\u8c22\u6307\u51fa\r\n\r\n> @qiushengyang \u4f60\u4ee3\u7801\u7684\u903b\u8f91\u95ee\u9898\uff0c\u95ee\u9898\u51fa\u5728\u4e86`getRedis`\u8fd9\u4e2a\u51fd\u6570\u7684\r\n> \r\n> ```\r\n> while ($timeout) {\r\n>                         co::sleep(0.05);\r\n>                         $timeout = $timeout -0.05;\r\n>                         if($this->pool->count()) {\r\n>                             return $this->pool->pop();;\r\n>                         }\r\n>                     }\r\n> ```\r\n> \r\n> \u9677\u5165\u4e86\u6b7b\u5faa\u73af\u3002\r\n\r\n\u540e\u6765\u6211\u4e5f\u53d1\u73b0\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u7b2c\u4e00\u4e2a\u5c31\u662f\u8fd9\u4e2a$timeout\u51fa\u73b0\u7cbe\u5ea6\u95ee\u9898\u4e0d\u80fd\u9000\u51fa\u5faa\u73af\uff0c\u8fd8\u6709\u4e00\u4e2a\u5c31\u662f\u524d\u7aef\u6ca1\u6709\u56de\u6536redis\u5bf9\u8c61  \u8c22\u8c22\u6307\u51fa\r\n"
      },
      {
        "user": "twose",
        "created_at": "2019-05-11T05:24:01Z",
        "body": "`while ($timeout > 0)`, \u592a\u57fa\u7840\u4e86"
      }
    ]
  },
  {
    "number": 2534,
    "title": "Connection gets outdated data.",
    "created_at": "2019-04-27T14:27:23Z",
    "closed_at": "2019-04-28T15:25:30Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2534",
    "body": "Hi! I have an issue with Swoole WebSocket Server. I created an object to use Swoole Server. Here is the constructor: \r\n\r\n`public function __construct()\r\n    {\r\n        $this->serverWS = new Swoole\\WebSocket\\Server(\"192.168.56.2\", 9502);\r\n        \r\n        $this->serverWS->on('open', \r\n            function(Server $serverWS, Request $request) \r\n            {\r\n                $this->onConnection($request);\r\n            }\r\n        );\r\n\r\n        $this->serverWS->on('message', \r\n            function(Server $serverWS, Frame $frame)\r\n            {\r\n                $this->onMessage($frame);\r\n            }\r\n        );\r\n\r\n        $this->serverWS->on('close',\r\n            function(Server $serverWS, int $fd)\r\n            {\r\n                $this->onClose($fd);\r\n            }\r\n        );\r\n\r\n        $this->serverWS->on('workerStart',\r\n            function(Server $serverWS)\r\n            {\r\n                $this->onWorkerStart($this->serverWS);\r\n            }\r\n        );\r\n\r\n        $this->serverWS->start();\r\n    }`\r\n\r\nAlso, I have a desktop client written in Python (I start it with Linux terminal). Connection is established by the following example:\r\n\r\n`if __name__ == \"__main__\":\r\n    websocket.enableTrace(True)\r\n    ws = websocket.WebSocketApp(\"ws://192.168.56.2:9502\",\r\n                            on_message = on_message,\r\n                            on_error = on_error,\r\n                            on_close = on_close,\r\n                            header   = {\r\n                                'User-Agent: RaspberryPi/3B+' + ' ' + str(os.uname()), \r\n                                'Access-Token: ' + generate_token()\r\n                            }\r\n    )\r\n    ws.on_open = on_open\r\n    ws.run_forever()`\r\n\r\nWhat I do on server side is set current Python connection ID (I'm defining a Python client by the certain request header) to private property of my custom WebsocketServer object (this property is equal 0 by default). And by triggering onClose event I set this property to 0 again. If this property is not 0 and the same client tries to establish the connection, server closes it.\r\nI do this because i need to identify this client and have only one instance of it's connection.\r\n\r\nAnd the problem is that I can have two connections at the same time (two terminal windows with started clients). If there's three or more clients - all works fine: server closes connections.\r\n\r\nI tried to debug and what I noticed is when the first PythonClient connection triggers, WebsocketServer sets ID property from 0 to 1 (and I can easily read this property and it will surely be equal 1). Then I'm running the second PythonClient and what i got on server is 0 ID property again, which will be setted to 2...\r\nThe third connection (and following ones) get ID that is equal 1, untill I'm keeping first connection opened. (As it should be)\r\n\r\nThis is so strange. I have no any idea why this happens. Please, tell me what I'm doing wrong!\r\n\r\nMy Swoole version is:\r\n`php --ri swoole\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.3.1\r\nBuilt => Mar 22 2019 11:50:29\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.0g  2 Nov 2017\r\nhttp2 => enabled\r\npcre => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n`\r\n\r\nMy Linux kernel is:\r\n`Linux elephant 4.15.0-47-generic #50-Ubuntu SMP Wed Mar 13 10:44:52 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux`\r\n\r\nMy PHP version is:\r\n`PHP 7.2.17-0ubuntu0.18.04.1 (cli) (built: Apr 18 2019 14:12:38) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.2.17-0ubuntu0.18.04.1, Copyright (c) 1999-2018, by Zend Technologies`\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2534/comments",
    "author": "shumichenko",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-04-28T06:19:46Z",
        "body": "I can only tell you the following points due to my poor English language proficiency:\r\n1. The server is asynchronous, multiple requests may be processed at the same time\r\n2. Server use multi-process mode by default, you can try `new Swoole\\WebSocket\\Server(\"192.168.56.2\", 9502, SWOOLE_BASE);` to make it be a single process Server\r\n"
      }
    ]
  },
  {
    "number": 2384,
    "title": "\u8fdb\u5165redis\u534f\u7a0b\u5ba2\u6237\u7aef\u4e4b\u540e\u534f\u7a0bid\u4e0d\u4e00\u81f4",
    "created_at": "2019-02-25T06:49:56Z",
    "closed_at": "2019-02-26T01:43:11Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2384",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\u76d1\u542conRequest\u65b9\u6cd5\uff0cdisPatch\u8c03\u7528redis\u534f\u7a0b\u5ba2\u6237\u7aef\u6267\u884c\u4e86\u4e00\u6b21incr\u64cd\u4f5c\r\n```php\r\n$register->set($register::onRequest,function (\\swoole_http_request $request,\\swoole_http_response $response)use($dispatcher){\r\n            $request_psr = new Request($request);\r\n            $response_psr = new Response($response);\r\n            try{\r\n                EasySwooleEvent::onRequest($request_psr,$response_psr);\r\n                        file_put_contents(\"/tmp/ee.log\", \"put1\\t\" . SERVER_NAME . \"\\t\" . Coroutine::getUid() . \"\\t\" . var_export($response_psr,true) . \"\\n\", FILE_APPEND);\r\n                    $dispatcher->dispatch($request_psr,$response_psr);\r\n            file_put_contents(\"/tmp/ee.log\", \"put2\\t\" . SERVER_NAME . \"\\t\" . Coroutine::getUid() . \"\\t\" . var_export($response_psr, true) . \"\\n\", FILE_APPEND);\r\n}\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n\u534f\u7a0bid\u4e00\u81f4\r\n\r\n3. What did you see instead?\r\n```php\r\nput1    Demo    52641   EasySwoole\\Core\\Http\\Response::__set_state(array(\r\n   'response' =>\r\n  Swoole\\Http\\Response::__set_state(array(\r\n     'fd' => 52640,\r\n     'header' => NULL,\r\n     'cookie' => NULL,\r\n     'trailer' => NULL,\r\n  )),\r\n   'sendFile' => NULL,\r\n   'isEndResponse' => 0,\r\n   'statusCode' => 200,\r\n   'reasonPhrase' => 'OK',\r\n   'cookies' =>\r\n  array (\r\n  ),\r\n   'protocolVersion' => '1.1',\r\n   'headers' =>\r\n  array (\r\n  ),\r\n   'body' => NULL,\r\n))\r\nput2    Demo    52632   EasySwoole\\Core\\Http\\Response::__set_state(array(\r\n   'response' =>\r\n  Swoole\\Http\\Response::__set_state(array(\r\n     'fd' => 52631,\r\n     'header' =>\r\n    array (\r\n      'Content-Type' => 'application/json;charset=utf-8',\r\n    ),\r\n     'cookie' => NULL,\r\n     'trailer' => NULL,\r\n  )),\r\n   'sendFile' => NULL,\r\n   'isEndResponse' => 2,\r\n   'statusCode' => 200,\r\n   'reasonPhrase' => 'OK',\r\n   'cookies' =>\r\n  array (\r\n  ),\r\n   'protocolVersion' => '1.1',\r\n   'headers' =>\r\n  array (\r\n    'Content-type' =>\r\n    array (\r\n      0 => 'application/json;charset=utf-8',\r\n    ),\r\n  ),\r\n   'body' => NULL,\r\n))\r\n```\r\n\u534f\u7a0bid\u548creponse fd\u4e0d\u4e00\u81f4\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n4.2.10\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nkernel  Linux version 3.10.106\r\nphp 7.1\r\ngcc 4.8.5",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2384/comments",
    "author": "highwayliu",
    "comments": [
      {
        "user": "mabu233",
        "created_at": "2019-02-25T08:00:51Z",
        "body": "\u6211\u8bb0\u5f97\u4f60\u5728es\u7fa4\u8bf4\u8fc7\u8fd9\u662f\u538b\u6d4b\u65f6\u51fa\u73b0\u7684\uff0c\u9ad8\u5e76\u53d1\u7684\u65f6\u5019\u4e24\u4e2a file_put_contents\u4e4b\u95f4\u53ef\u80fd\u4f1a\u6709\u53e6\u4e00\u4e2a\u8bf7\u6c42\u7684file_put_contents\u63d2\u5165\uff0c\u8fd9\u4e0d\u662f\u5f88\u6b63\u5e38\u5417\uff1f"
      },
      {
        "user": "highwayliu",
        "created_at": "2019-02-25T08:05:52Z",
        "body": "> \u6211\u8bb0\u5f97\u4f60\u5728es\u7fa4\u8bf4\u8fc7\u8fd9\u662f\u538b\u6d4b\u65f6\u51fa\u73b0\u7684\uff0c\u9ad8\u5e76\u53d1\u7684\u65f6\u5019\u4e24\u4e2a file_put_contents\u4e4b\u95f4\u53ef\u80fd\u4f1a\u6709\u53e6\u4e00\u4e2a\u8bf7\u6c42\u7684file_put_contents\u63d2\u5165\uff0c\u8fd9\u4e0d\u662f\u5f88\u6b63\u5e38\u5417\uff1f\r\n\r\n\u662f\u591a\u8f6e\u9ad8\u5e76\u53d1\u4e4b\u540e\u505c\u6b62\u7b56\u7565\uff0c\u5355\u72ec\u53d1\u4e00\u4e2acurl\uff0c\u4f1a\u51fa\u73b0\u8fd9\u6837\u7684\u60c5\u51b5\uff0c\u8fd9\u65f6\u5019swoole\u7684\u65e5\u5fd7\u663e\u793a\u56de\u5305\u56de\u4e0d\u51fa\u53bb\uff0c\u8fde\u63a5\u5df2\u65ad\u5f00\u3002\r\n[2019-02-25 15:18:54 *30295.0]\tNOTICE\tswFactoryProcess_finish (ERROR 1005): connection[fd=9172] does not exists.\r\n[2019-02-25 15:18:54 *30295.0]\tNOTICE\tswFactoryProcess_finish (ERROR 1005): connection[fd=9173] does not exists.\r\n[2019-02-25 15:18:54 *30295.0]\tNOTICE\tswFactoryProcess_finish (ERROR 1005): connection[fd=9174] does not exists.\r\n"
      },
      {
        "user": "highwayliu",
        "created_at": "2019-02-25T08:06:41Z",
        "body": "> \u6211\u8bb0\u5f97\u4f60\u5728es\u7fa4\u8bf4\u8fc7\u8fd9\u662f\u538b\u6d4b\u65f6\u51fa\u73b0\u7684\uff0c\u9ad8\u5e76\u53d1\u7684\u65f6\u5019\u4e24\u4e2a file_put_contents\u4e4b\u95f4\u53ef\u80fd\u4f1a\u6709\u53e6\u4e00\u4e2a\u8bf7\u6c42\u7684file_put_contents\u63d2\u5165\uff0c\u8fd9\u4e0d\u662f\u5f88\u6b63\u5e38\u5417\uff1f\r\n\r\n\u5347\u7ea7\u4e3a4.2.13 \u5728\u540c\u6837\u7684\u591a\u8f6e\u538b\u6d4b\u7b56\u7565\u4e4b\u540e\uff0c\u6ca1\u53d1\u73b0\u8fd9\u6837\u7684\u95ee\u9898"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-02-26T01:43:11Z",
        "body": "\u8bf4\u660e\u8fd9\u662f\u4e0d\u540c\u7684\u8bf7\u6c42\u3002\u6240\u4ee5\u534f\u7a0bID\u4e0d\u4e00\u6837\u3002"
      }
    ]
  },
  {
    "number": 1583,
    "title": "Segmentation fault \u9519\u8bef",
    "created_at": "2018-04-25T10:37:06Z",
    "closed_at": "2018-04-26T02:35:55Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1583",
    "body": "CentOS 6.9 x64 Kernel 4.4.127\r\nphp 7.1.16 with yac\r\nswoole 2.1.3\r\n\r\n\r\n\r\n\u4e0b\u9762\u662f\u6709\u6548\u7684\u8c03\u8bd5\u4fe1\u606f\r\n\r\n(gdb) bt\r\n#0  0x00007fea2e0f595d in swShareMemory_mmap_create (object=0x7ffcc05f0950, size=2097248, mapfile=0x0)\r\n    at /opt/distfiles/php/swoole-src-2.1.3/src/memory/ShareMemory.c:122\r\n#1  0x00007fea2e0f56a5 in sw_shm_malloc (size=2097248) at /opt/distfiles/php/swoole-src-2.1.3/src/memory/ShareMemory.c:25\r\n#2  0x00007fea2e0f5e4e in swMemoryGlobal_new_page (gm=0x7ffcc05f0a10)\r\n    at /opt/distfiles/php/swoole-src-2.1.3/src/memory/MemoryGlobal.c:80\r\n#3  0x00007fea2e0f5d52 in swMemoryGlobal_new (pagesize=2097152, shared=1 '\\001')\r\n    at /opt/distfiles/php/swoole-src-2.1.3/src/memory/MemoryGlobal.c:51\r\n#4  0x00007fea2e0e8985 in swoole_init () at /opt/distfiles/php/swoole-src-2.1.3/src/core/base.c:64\r\n#5  0x00007fea2dff89fb in zm_startup_swoole (type=1, module_number=62) at /opt/distfiles/php/swoole-src-2.1.3/swoole.c:1024\r\n#6  0x0000000000a21478 in zend_startup_module_ex (module=0x27a6f50) at /opt/distfiles/php/php-7.1.16/Zend/zend_API.c:1843\r\n#7  0x0000000000a214da in zend_startup_module_zval (zv=0x2765510) at /opt/distfiles/php/php-7.1.16/Zend/zend_API.c:1858\r\n#8  0x0000000000a2f192 in zend_hash_apply (ht=0x14b10e0, apply_func=0xa214b7 <zend_startup_module_zval>)\r\n    at /opt/distfiles/php/php-7.1.16/Zend/zend_hash.c:1507\r\n#9  0x0000000000a21a9f in zend_startup_modules () at /opt/distfiles/php/php-7.1.16/Zend/zend_API.c:1969\r\n#10 0x0000000000988d00 in php_module_startup (sf=0x1488d80, additional_modules=0x0, num_additional_modules=0)\r\n    at /opt/distfiles/php/php-7.1.16/main/main.c:2300\r\n#11 0x0000000000af930f in php_cli_startup (sapi_module=0x1488d80) at /opt/distfiles/php/php-7.1.16/sapi/cli/php_cli.c:427\r\n#12 0x0000000000afb22a in main (argc=2, argv=0x2722070) at /opt/distfiles/php/php-7.1.16/sapi/cli/php_cli.c:1348\r\n(gdb) f 1\r\n#1  0x00007fea2e0f56a5 in sw_shm_malloc (size=2097248) at /opt/distfiles/php/swoole-src-2.1.3/src/memory/ShareMemory.c:25\r\n25          mem = swShareMemory_mmap_create(&object, size, NULL);\r\n(gdb) f 0\r\n#0  0x00007fea2e0f595d in swShareMemory_mmap_create (object=0x7ffcc05f0950, size=2097248, mapfile=0x0)\r\n    at /opt/distfiles/php/swoole-src-2.1.3/src/memory/ShareMemory.c:122\r\n122             swWarn(\"mmap(%ld) failed. Error: %s[%d]\", size, strerror(errno), errno);\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1583/comments",
    "author": "yxgong",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-04-25T10:45:10Z",
        "body": "\u8bf7\u52ff\u4f7f\u7528 ` --enable-hugepage` \u7f16\u8bd1\u53c2\u6570"
      }
    ]
  },
  {
    "number": 1537,
    "title": "1.10.2\u30012.1.1\u7248swoole_websocket_server->on\u7684BUG",
    "created_at": "2018-03-23T02:34:41Z",
    "closed_at": "2018-03-23T03:06:33Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1537",
    "body": "\u4ee3\u7801\uff1a\r\n```php\r\nclass Server extends \\swoole_websocket_server\r\n{\r\n\tpublic function __construct($ip, $port)\r\n\t{\r\n\t\tparent::__construct($ip, $port);\r\n\t\t$this->init();\r\n\t}\r\n\r\n\tprotected function init()\r\n\t{\r\n\t\t$this->on('open', [$this, '__open']);\r\n\t\t$this->on('message', [$this, '__message']);\r\n\t\t$this->on('close', [$this, '__close']);\r\n\t}\r\n\r\n\tprotected function __open($server, $request)\r\n\t{\r\n\t\techo \"server: handshake success with fd{$request->fd}\\n\";\r\n\t}\r\n\t\r\n\tprotected function __message($server, $frame)\r\n\t{\r\n\t\techo \"receive from {$frame->fd}:{$frame->data},opcode:{$frame->opcode},fin:{$frame->finish}\\n\";\r\n\t\t$this->push($frame->fd, \"this is server\");\r\n\t}\r\n\r\n\tprotected function __close($server, $fd)\r\n\t{\r\n\t\techo \"client {$fd} closed\\n\";\r\n\t}\r\n}\r\n```\r\n\r\n\u9519\u8bef\u4fe1\u606f\uff1a\r\n\r\n> PHP Fatal error:  swoole_server_port::on(): Function 'Server::__close' is not callable in /xxx/Server.php on line 16\r\n\r\nopen\u548cmessage\u6ca1\u6709\u95ee\u9898\uff0c\u53ea\u6709close\u6709\u95ee\u9898\r\n\r\n\u8fd8\u6709\u5c31\u662f\u901a\u8fc7pecl\u65e0\u6cd5\u66f4\u65b0\u52302.x\u7248\u672c\uff0c\u6700\u65b0\u53ea\u67091.10.2",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1537/comments",
    "author": "Yurunsoft",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-03-23T03:06:33Z",
        "body": "**\u8bf7\u6240\u6709\u4e8b\u4ef6\u56de\u8c03\u51fd\u6570\u8bbe\u7f6e\u4e3a`public`**\r\n\r\n\u867d\u7136\u53e6\u5916\u4e24\u4e2a\u4e8b\u4ef6\u56de\u8c03\u8bbe\u7f6e\u6210\u529f\u4e86\uff0c\u4f46\u662f\u8fd9\u53ea\u662f\u7ed5\u5f00\u4e86`swoole_websocekt_server::on`\u65b9\u6cd5\u7684\u68c0\u6d4b\uff0c\u5728\u56de\u8c03\u8fd9\u4e9b\u51fd\u6570\u65f6\u4ecd\u7136\u53ef\u80fd\u9047\u5230\u4f5c\u7528\u57df\u7684\u95ee\u9898\u3002\r\n\r\n`__close`\u8bbe\u7f6e\u672a\u6210\u529f\u662f\u56e0\u4e3a\u9700\u8981\u8c03\u7528`swoole_server_port::on`\u65b9\u6cd5\u5c06\u56de\u8c03\u51fd\u6570\u8bbe\u7f6e\u5230\u76d1\u542c\u7aef\u53e3\u4e0a\uff0c\u8fd9\u4e2a\u7c7b\u548c`swoole_websocekt_server`\u6ca1\u6709\u4efb\u4f55\u7ee7\u627f\u5173\u7cfb\u3002"
      }
    ]
  },
  {
    "number": 1344,
    "title": "onWorkerStart\u56de\u8c03\u91cc\u5b9a\u65f6\u5668\u6295\u9012task\u62a5\u9519",
    "created_at": "2017-09-05T08:30:45Z",
    "closed_at": "2017-09-08T02:19:14Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1344",
    "body": "\u5728http server\u7684onWorkerStart\u56de\u8c03\u91cc\u9762\u5f00\u542f\u4e00\u4e2a\u5b9a\u65f6\u5668\u6295\u9012\u4efb\u52a1\r\n//\u6700\u540e\u4e00\u4e2aworker\u5904\u7406\u542f\u52a8\u5b9a\u65f6\u5668\r\n```php\r\nif ($workerId == $this->conf['worker_num'] - 1) {\r\n\t//\u542f\u52a8\u5b9a\u65f6\u5668\u4efb\u52a1\r\n\t$timerId = swoole_timer_tick(100, function () {\r\n\t\t$server->task([]);\r\n\t});\r\n}\r\n```\r\n\u5927\u6982\u8dd1\u4e86118\u6b21\u540e\uff0c\u89e6\u53d1WorkerError\uff0c\u7136\u540eworker\u8fdb\u7a0b\u4e0d\u65ad\u62a5\u9519\u548c\u91cd\u542f\r\n\r\nswoole.log\u91cc\u9762\u7684\u65e5\u5fd7\u5185\u5bb9\r\n```shell\r\n[2017-09-05 16:21:30 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:21:42 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:21:54 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:22:05 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:22:17 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:22:29 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:22:41 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n```\r\n\r\ngdb \u6253\u5370\u7684core\u4fe1\u606f\r\n\r\nswoole1.9.18\u7248\u672c\r\n```shell\r\nProgram terminated with signal SIGSEGV, Segmentation fault.\r\n#0  zim_swoole_server_port___destruct (execute_data=0x7f2667013c70, return_value=<optimized out>) at /root/swoole-1.9.18/swoole_server_port.c:76\r\n76\t/root/swoole-1.9.18/swoole_server_port.c: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55.\r\n(gdb) bt\r\n#0  zim_swoole_server_port___destruct (execute_data=0x7f2667013c70, return_value=<optimized out>) at /root/swoole-1.9.18/swoole_server_port.c:76\r\n#1  0x000055d282be71d0 in zend_call_function (fci=fci@entry=0x7ffd7fb95ba0, fci_cache=fci_cache@entry=0x7ffd7fb95b70) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_execute_API.c:869\r\n#2  0x000055d282c15964 in zend_call_method (object=object@entry=0x7ffd7fb95c80, obj_ce=0x55d284146f90, fn_proxy=fn_proxy@entry=0x7ffd7fb95c78, function_name=function_name@entry=0x55d282ec0482 \"__destruct\", \r\n    function_name_len=function_name_len@entry=10, retval_ptr=retval_ptr@entry=0x0, param_count=0, arg1=0x0, arg2=0x0) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_interfaces.c:99\r\n#3  0x000055d282c30fc2 in zend_objects_destroy_object (object=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_objects.c:156\r\n#4  0x000055d282c21599 in zend_gc_collect_cycles () at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.c:1136\r\n#5  0x000055d282c20e0e in gc_possible_root (ref=0x7f265495ffc0) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.c:286\r\n#6  0x000055d282be5815 in gc_check_possible_root (z=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.h:149\r\n#7  i_zval_ptr_dtor (zval_ptr=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_variables.h:50\r\n#8  _zval_ptr_dtor (zval_ptr=zval_ptr@entry=0x7f26548fd330) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_execute_API.c:550\r\n#9  0x000055d282b3c198 in var_destroy (var_hashx=var_hashx@entry=0x7ffd7fb95e08) at /root/lnmp1.4-full/src/php-7.1.7/ext/standard/var_unserializer.c:234\r\n#10 0x000055d282b3c312 in php_var_unserialize_destroy (d=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/ext/standard/var_unserializer.c:53\r\n#11 0x00007f2665f9a3af in php_swoole_task_unpack (task_result=task_result@entry=0x7ffd7fb96160) at /root/swoole-1.9.18/swoole_server.c:314\r\n#12 0x00007f2665f9a6d0 in php_swoole_onFinish (serv=<optimized out>, req=0x7ffd7fb96160) at /root/swoole-1.9.18/swoole_server.c:840\r\n#13 0x00007f2665fe8b0e in swWorker_onTask (factory=factory@entry=0x55d2841879a8, task=task@entry=0x7ffd7fb96160) at /root/swoole-1.9.18/src/network/Worker.c:278\r\n#14 0x00007f2665fe8eb9 in swWorker_onPipeReceive (reactor=<optimized out>, event=0x7ffd7fb981d0) at /root/swoole-1.9.18/src/network/Worker.c:639\r\n#15 0x00007f2665fd8c0c in swReactorEpoll_wait (reactor=0x55d2841bc8c0, timeo=<optimized out>) at /root/swoole-1.9.18/src/reactor/ReactorEpoll.c:250\r\n#16 0x00007f2665fe9380 in swWorker_loop (factory=factory@entry=0x55d2841879a8, worker_id=worker_id@entry=3) at /root/swoole-1.9.18/src/network/Worker.c:597\r\n#17 0x00007f2665fe6b6b in swManager_spawn_worker (factory=0x55d2841879a8, worker_id=3) at /root/swoole-1.9.18/src/network/Manager.c:435\r\n#18 0x00007f2665fe71bc in swManager_start (factory=factory@entry=0x55d2841879a8) at /root/swoole-1.9.18/src/network/Manager.c:145\r\n#19 0x00007f2665fd5359 in swFactoryProcess_start (factory=0x55d2841879a8) at /root/swoole-1.9.18/src/factory/FactoryProcess.c:86\r\n#20 0x00007f2665fdd008 in swServer_start (serv=serv@entry=0x55d284187570) at /root/swoole-1.9.18/src/network/Server.c:686\r\n#21 0x00007f2665fb58a2 in zim_swoole_http_server_start (execute_data=0x7f2667013c20, return_value=0x7ffd7fb983f0) at /root/swoole-1.9.18/swoole_http_server.c:1561\r\n#22 0x000055d282c9961d in ZEND_DO_FCALL_SPEC_RETVAL_UNUSED_HANDLER () at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:970\r\n#23 0x000055d282c40dcb in execute_ex (ex=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:429\r\n#24 0x000055d282c9b5d8 in zend_execute (op_array=op_array@entry=0x7f2667083000, return_value=return_value@entry=0x7f26670f6120) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:474\r\n#25 0x000055d282bf7273 in zend_execute_scripts (type=1728133968, type@entry=8, retval=0x7f26670f6120, retval@entry=0x0, file_count=file_count@entry=3) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend.c:1476\r\n#26 0x000055d282b93a20 in php_execute_script (primary_file=0x7ffd7fb9aa10) at /root/lnmp1.4-full/src/php-7.1.7/main/main.c:2537\r\n```\r\n\r\n\u6362\u4e861.9.19\u7248\u672c\r\n```shell\r\nProgram terminated with signal SIGSEGV, Segmentation fault.\r\n#0  zim_swoole_server_port___destruct (execute_data=0x7f8745a13c70, return_value=<optimized out>) at /root/swoole-src-1.9.19/swoole_server_port.c:93\r\n93\t        if (property->caches[j])\r\n(gdb) bt\r\n#0  zim_swoole_server_port___destruct (execute_data=0x7f8745a13c70, return_value=<optimized out>) at /root/swoole-src-1.9.19/swoole_server_port.c:93\r\n#1  0x000056397ab471d0 in zend_call_function (fci=fci@entry=0x7fff99434cb0, fci_cache=fci_cache@entry=0x7fff99434c80) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_execute_API.c:869\r\n#2  0x000056397ab75964 in zend_call_method (object=object@entry=0x7fff99434d90, obj_ce=0x56397d3bc180, fn_proxy=fn_proxy@entry=0x7fff99434d88, function_name=function_name@entry=0x56397ae20482 \"__destruct\", \r\n    function_name_len=function_name_len@entry=10, retval_ptr=retval_ptr@entry=0x0, param_count=0, arg1=0x0, arg2=0x0) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_interfaces.c:99\r\n#3  0x000056397ab90fc2 in zend_objects_destroy_object (object=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_objects.c:156\r\n#4  0x000056397ab81599 in zend_gc_collect_cycles () at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.c:1136\r\n#5  0x000056397ab80e0e in gc_possible_root (ref=0x7f873339c578) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.c:286\r\n#6  0x000056397ab45815 in gc_check_possible_root (z=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.h:149\r\n#7  i_zval_ptr_dtor (zval_ptr=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_variables.h:50\r\n#8  _zval_ptr_dtor (zval_ptr=zval_ptr@entry=0x7f873332b330) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_execute_API.c:550\r\n#9  0x000056397aa9c198 in var_destroy (var_hashx=var_hashx@entry=0x7fff99434f18) at /root/lnmp1.4-full/src/php-7.1.7/ext/standard/var_unserializer.c:234\r\n#10 0x000056397aa9c312 in php_var_unserialize_destroy (d=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/ext/standard/var_unserializer.c:53\r\n#11 0x00007f8744996eef in php_swoole_task_unpack (task_result=task_result@entry=0x7fff99435270) at /root/swoole-src-1.9.19/swoole_server.c:371\r\n#12 0x00007f8744997230 in php_swoole_onFinish (serv=<optimized out>, req=0x7fff99435270) at /root/swoole-src-1.9.19/swoole_server.c:905\r\n#13 0x00007f87449e735e in swWorker_onTask (factory=factory@entry=0x56397d402d30, task=task@entry=0x7fff99435270) at /root/swoole-src-1.9.19/src/network/Worker.c:283\r\n#14 0x00007f87449e7709 in swWorker_onPipeReceive (reactor=<optimized out>, event=0x7fff994372e0) at /root/swoole-src-1.9.19/src/network/Worker.c:670\r\n#15 0x00007f87449d725c in swReactorEpoll_wait (reactor=0x56397d437a90, timeo=<optimized out>) at /root/swoole-src-1.9.19/src/reactor/ReactorEpoll.c:250\r\n#16 0x00007f87449e7bd0 in swWorker_loop (factory=factory@entry=0x56397d402d30, worker_id=worker_id@entry=3) at /root/swoole-src-1.9.19/src/network/Worker.c:628\r\n#17 0x00007f87449e52ab in swManager_spawn_worker (factory=0x56397d402d30, worker_id=3) at /root/swoole-src-1.9.19/src/network/Manager.c:437\r\n#18 0x00007f87449e58fc in swManager_start (factory=factory@entry=0x56397d402d30) at /root/swoole-src-1.9.19/src/network/Manager.c:145\r\n#19 0x00007f87449d3969 in swFactoryProcess_start (factory=0x56397d402d30) at /root/swoole-src-1.9.19/src/factory/FactoryProcess.c:86\r\n#20 0x00007f87449db667 in swServer_start (serv=serv@entry=0x56397d402900) at /root/swoole-src-1.9.19/src/network/Server.c:692\r\n#21 0x00007f87449b3582 in zim_swoole_http_server_start (execute_data=0x7f8745a13c20, return_value=0x7fff99437510) at /root/swoole-src-1.9.19/swoole_http_server.c:1578\r\n#22 0x000056397abf961d in ZEND_DO_FCALL_SPEC_RETVAL_UNUSED_HANDLER () at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:970\r\n#23 0x000056397aba0dcb in execute_ex (ex=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:429\r\n#24 0x000056397abfb5d8 in zend_execute (op_array=op_array@entry=0x7f8745a83000, return_value=return_value@entry=0x7f8745af6120) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:474\r\n#25 0x000056397ab57273 in zend_execute_scripts (type=1168194384, type@entry=8, retval=0x7f8745af6120, retval@entry=0x0, file_count=file_count@entry=3) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend.c:1476\r\n#26 0x000056397aaf3a20 in php_execute_script (primary_file=0x7fff99439b30) at /root/lnmp1.4-full/src/php-7.1.7/main/main.c:2537\r\n#27 0x000056397abfd84c in do_cli (argc=3, argv=0x56397d037f00) at /root/lnmp1.4-full/src/php-7.1.7/sapi/cli/php_cli.c:993\r\n#28 0x000056397a71e8d2 in main (argc=3, argv=0x56397d037f00) at /root/lnmp1.4-full/src/php-7.1.7/sapi/cli/php_cli.c:1381\r\n```\r\n\r\n\u7cfb\u7edf\u7248\u672c\r\n```shell\r\nLinux kpc 4.8.0-59-generic #64-Ubuntu SMP Thu Jun 29 19:38:34 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\ngcc version 6.2.0 20161005 (Ubuntu 6.2.0-5ubuntu12) \r\n\r\nOpenSSL 1.0.2g  1 Mar 2016\r\nbuilt on: reproducible build, date unspecified\r\nplatform: debian-amd64\r\noptions:  bn(64,64) rc4(16x,int) des(idx,cisc,16,int) blowfish(idx) \r\ncompiler: cc -I. -I.. -I../include  -fPIC -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -m64 -DL_ENDIAN -g -O2 -fdebug-prefix-map=/build/openssl-eVLBIi/openssl-1.0.2g=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -Wl,-Bsymbolic-functions -Wl,-z,relro -Wa,--noexecstack -Wall -DMD32_REG_T=int -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM -DECP_NISTZ256_ASM\r\nOPENSSLDIR: \"/usr/lib/ssl\"\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1344/comments",
    "author": "kakuilan",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-09-07T08:46:42Z",
        "body": "\u65e0\u6cd5\u91cd\u73b0\u4f60\u7684\u95ee\u9898\u3002\u8bf7\u4f7f\u7528 `USE_ZEND_ALLOC=0 valgrind php test.php` \u8fd0\u884c\u4f60\u7684\u4ee3\u7801\u3002\u7136\u540e\u5c06`valgrind`\u6253\u5370\u7684\u5185\u5b58\u9519\u8bef\u4fe1\u606f\u8d34\u51fa\u6765\u3002"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-09-07T09:38:53Z",
        "body": "\u4f60\u662f\u5426\u628a server \u4f5c\u4e3a\u4efb\u52a1\u53c2\u6570\u53d1\u9001\u4e86\uff1f"
      },
      {
        "user": "kakuilan",
        "created_at": "2017-09-08T01:50:41Z",
        "body": "\u4ee3\u7801\u5982\u4e0b\r\n```php\r\n<?php\r\n\r\nclass MyServer {\r\n\r\n    public $conf;\r\n    public $server;\r\n\r\n    public function __construct() {\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * \u8bbe\u7f6e\u914d\u7f6e\r\n     * @param array $conf\r\n     */\r\n    public function setConf(array $conf) {\r\n        $this->conf = $conf;\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u521d\u59cb\u5316\u670d\u52a1\r\n     * @return $this\r\n     */\r\n    public function initServer() {\r\n\r\n        $this->server = new \\swoole_http_server('0.0.0.0', 6666);\r\n        $this->server->set($this->conf);\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u542f\u52a8\u670d\u52a1\r\n     * @return $this\r\n     */\r\n    public function startServer() {\r\n        $this->server->on('Start', [$this, 'onStart']);\r\n        $this->server->on('WorkerStart', [$this, 'onWorkerStart']);\r\n        $this->server->on('WorkerStop', [$this, 'onWorkerStop']);\r\n        $this->server->on('WorkerError', [$this, 'onWorkerError']);\r\n        $this->server->on('Connect', [$this, 'onConnect']);\r\n        $this->server->on('Request', [$this, 'onRequest']);\r\n        $this->server->on('Close', [$this, 'onClose']);\r\n        $this->server->on('Task', [$this, 'onTask']);\r\n        $this->server->on('Finish', [$this, 'onFinish']);\r\n\r\n        echo(\"Service start success\\r\\n\");\r\n        $this->server->start();\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53\u670d\u52a1\u5668\u542f\u52a8\u65f6[\u4e8b\u4ef6]\r\n     * @param object $serv swoole_server\u5bf9\u8c61\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onStart($serv) {\r\n        echo \"Master Start...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53worker\u8fdb\u7a0b\u542f\u52a8[\u4e8b\u4ef6]\r\n     * @param object $serv swoole_server\u5bf9\u8c61\r\n     * @param int $workerId \u4ece0-$worker_num\u4e4b\u95f4\u7684\u6570\u5b57\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onWorkerStart($serv, $workerId) {\r\n        echo \"Worker Start:[{$workerId}]...\\r\\n\";\r\n\r\n        if ($workerId == 1) {\r\n            //\u542f\u52a8\u5b9a\u65f6\u5668\u4efb\u52a1\r\n            $timerId = swoole_timer_tick(100, function () use($serv) {\r\n                echo \"timer tick \\r\\n\";\r\n                $serv->task([]);\r\n            });\r\n        }\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53worker\u8fdb\u7a0b\u505c\u6b62[\u4e8b\u4ef6]\r\n     * @param object $serv swoole_server\u5bf9\u8c61\r\n     * @param int $workerId \u4ece0-$worker_num\u4e4b\u95f4\u7684\u6570\u5b57\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onWorkerStop($serv, $workerId) {\r\n        echo \"Worker Stop:[{$workerId}]...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53worker\u8fdb\u7a0b\u53d1\u751f\u5f02\u5e38\u65f6[\u4e8b\u4ef6]\r\n     * @param $serv\r\n     * @param $workerId\r\n     * @param $workerPid\r\n     * @param $exitCode\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onWorkerError($serv, $workerId, $workerPid, $exitCode) {\r\n        echo \"on WorkerError...\\r\\n\";\r\n        echo \"workerId[$workerId] workerPid[$workerPid] exitCode[$exitCode]\\r\\n\";\r\n        die;\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53\u6709\u65b0\u7684\u8fde\u63a5\u8fdb\u5165\u65f6[\u4e8b\u4ef6]\r\n     * @param object $serv swoole_server\u5bf9\u8c61\r\n     * @param mixed $fd \u8fde\u63a5\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26,\u53d1\u9001\u6570\u636e/\u5173\u95ed\u8fde\u63a5\u65f6\u9700\u8981\u6b64\u53c2\u6570\r\n     * @param int $fromId \u6765\u81ea\u90a3\u4e2aReactor\u7ebf\u7a0b\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onConnect($serv, $fd, $fromId) {\r\n        echo \"new Connect:[{$fromId}]...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53\u6709http\u8bf7\u6c42\u65f6[\u4e8b\u4ef6]\r\n     * @param object $request \u8bf7\u6c42\u5bf9\u8c61\r\n     * @param object $response \u54cd\u5e94\u5bf9\u8c61\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onRequest($request, $response) {\r\n        echo \"on Request...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * \u5f53\u5ba2\u6237\u7aef\u8fde\u63a5\u5173\u95ed\u65f6[\u4e8b\u4ef6]\r\n     * @param object $serv swoole_server\u5bf9\u8c61\r\n     * @param mixed $fd \u8fde\u63a5\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26,\u53d1\u9001\u6570\u636e/\u5173\u95ed\u8fde\u63a5\u65f6\u9700\u8981\u6b64\u53c2\u6570\r\n     * @param int $fromId \u6765\u81ea\u90a3\u4e2aReactor\u7ebf\u7a0b\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onClose($serv, $fd, $fromId) {\r\n        echo \"on Close:[{$fromId}]...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53\u4efb\u52a1\u88ab\u8c03\u7528\u65f6[\u4e8b\u4ef6]\r\n     * @param object $serv swoole_server\u5bf9\u8c61\r\n     * @param int $taskId \u4efb\u52a1ID\r\n     * @param int $fromId \u6765\u81ea\u90a3\u4e2aReactor\u7ebf\u7a0b\r\n     * @param array $taskData \u4efb\u52a1\u6570\u636e\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onTask($serv, $taskId, $fromId, $taskData) {\r\n        echo \"on Task...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53\u4efb\u52a1\u5b8c\u6210\u65f6[\u4e8b\u4ef6]\r\n     * @param object $serv swoole_server\u5bf9\u8c61\r\n     * @param int $taskId \u4efb\u52a1ID\r\n     * @param array $taskData \u4efb\u52a1\u6570\u636e\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onFinish($serv, $taskId, $taskData) {\r\n        echo \"on Finish...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n}//end class\r\n\r\n\r\n$conf = [\r\n    //\u5b88\u62a4\u8fdb\u7a0b\u5316\r\n    'daemonize' => 0,\r\n    //\u7ebf\u7a0b\u6570,=CPU\u6838\u6570\r\n    'reactor_num' => 2,\r\n    //worker\u8fdb\u7a0b\u6570,\u4e3aCPU\u76841-4\u500d\r\n    'worker_num' => 4,\r\n    //worker\u8fdb\u7a0b\u7684\u6700\u5927\u4efb\u52a1\u6570\r\n    'max_request' => 1024,\r\n    //\u670d\u52a1\u6700\u5927\u5141\u8bb8\u7684\u8fde\u63a5\u6570\r\n    'max_conn' => 1024,\r\n    //task\u8fdb\u7a0b\u7684\u6570\u91cf\r\n    'task_worker_num' => 5,\r\n    //task\u8fdb\u7a0b\u7684\u6700\u5927\u4efb\u52a1\u6570,0\u4e0d\u9650\u5236\r\n    'task_max_request' => 1024,\r\n    //task\u7684\u6570\u636e\u4e34\u65f6\u76ee\u5f55\r\n    'task_tmpdir' => '/tmp',\r\n    //\u6570\u636e\u5305\u5206\u53d1\u7b56\u7565\r\n    'dispatch_mode' => 2,\r\n    //Listen\u961f\u5217\u957f\u5ea6\r\n    'backlog' => 128,\r\n    //\u6307\u5b9aswoole\u9519\u8bef\u65e5\u5fd7\u6587\u4ef6\r\n    'log_file' => '/tmp/swoole.log',\r\n    //\u65e5\u5fd7\u7ea7\u522b\r\n    'log_level' => 0,\r\n    //\u542f\u7528\u5fc3\u8df3\u68c0\u6d4b,\u6bcf\u9694N\u79d2\u8f6e\u5faa\u4e00\u6b21\r\n    'heartbeat_check_interval' => 5,\r\n    //\u8868\u793a\u8fde\u63a5\u6700\u5927\u5141\u8bb8\u7a7a\u95f2\u7684\u65f6\u95f4,\u9700\u8981\u6bd4heartbeat_check_interval\u5927\r\n    'heartbeat_idle_time' => 10,\r\n\r\n    //\u6253\u5f00\u5305\u957f\u68c0\u6d4b\r\n    'open_length_check' => true,\r\n    //\u5305\u957f\u5ea6\u503c\u7684\u7c7b\u578b\r\n    'package_length_type' => 'N',\r\n    //\u6700\u5927\u6570\u636e\u5305\u5c3a\u5bf8\r\n    'package_max_length' => 2097152, //2M\r\n    'package_length_offset' => 0,\r\n    'package_body_offset' => 4,\r\n    //\u7ba1\u9053\u901a\u4fe1\u7684\u5185\u5b58\u7f13\u5b58\u533a\u957f\u5ea6\r\n    'pipe_buffer_size' => 33554432, //32M\r\n    //\u53d1\u9001\u7f13\u5b58\u533a\u5c3a\u5bf8\r\n    'buffer_output_size' => 3145728, //3M\r\n\r\n    //\u7acb\u5373\u53d1\u5f80\u5ba2\u6237\u7aef\u8fde\u63a5,\u63d0\u5347\u54cd\u5e94\u901f\u5ea6\r\n    'open_tcp_nodelay' => 1,\r\n    //\u542f\u7528CPU\u4eb2\u548c\u6027\u8bbe\u7f6e\r\n    'open_cpu_affinity' => 1,\r\n    //\u8bbe\u7f6e\u7aef\u53e3\u91cd\u7528\r\n    'enable_reuse_port' => 1,\r\n];\r\n$service = new MyServer();\r\n$service->setConf($conf)->initServer()->startServer();\r\n```\r\n\r\n\u6267\u884c USE_ZEND_ALLOC=0 valgrind php test.php MyServer.php\u540e\u8fd4\u56de\r\n==21254== Invalid read of size 8\r\n==21254==    at 0x1026F990: zim_swoole_server_port___destruct (swoole_server_port.c:93)\r\n==21254==    by 0x6701CF: zend_call_function (zend_execute_API.c:869)\r\n==21254==    by 0x69E963: zend_call_method (zend_interfaces.c:99)\r\n==21254==    by 0x6B9FC1: zend_objects_destroy_object (zend_objects.c:156)\r\n==21254==    by 0x6AA598: zend_gc_collect_cycles (zend_gc.c:1136)\r\n==21254==    by 0x6A9E0D: gc_possible_root (zend_gc.c:286)\r\n==21254==    by 0x5C5197: var_destroy (var_unserializer.c:234)\r\n==21254==    by 0x5C5311: php_var_unserialize_destroy (var_unserializer.c:53)\r\n==21254==    by 0x10268EEE: php_swoole_task_unpack (swoole_server.c:371)\r\n==21254==    by 0x1026922F: php_swoole_onFinish (swoole_server.c:905)\r\n==21254==    by 0x102B935D: swWorker_onTask (Worker.c:283)\r\n==21254==    by 0x102B9708: swWorker_onPipeReceive (Worker.c:670)\r\n==21254==  Address 0x1f8 is not stack'd, malloc'd or (recently) free'd\r\n==21254== \r\n==21254== \r\n==21254== Process terminating with default action of signal 11 (SIGSEGV): dumping core\r\n==21254==  Access not within mapped region at address 0x1F8\r\n==21254==    at 0x1026F990: zim_swoole_server_port___destruct (swoole_server_port.c:93)\r\n==21254==    by 0x6701CF: zend_call_function (zend_execute_API.c:869)\r\n==21254==    by 0x69E963: zend_call_method (zend_interfaces.c:99)\r\n==21254==    by 0x6B9FC1: zend_objects_destroy_object (zend_objects.c:156)\r\n==21254==    by 0x6AA598: zend_gc_collect_cycles (zend_gc.c:1136)\r\n==21254==    by 0x6A9E0D: gc_possible_root (zend_gc.c:286)\r\n==21254==    by 0x5C5197: var_destroy (var_unserializer.c:234)\r\n==21254==    by 0x5C5311: php_var_unserialize_destroy (var_unserializer.c:53)\r\n==21254==    by 0x10268EEE: php_swoole_task_unpack (swoole_server.c:371)\r\n==21254==    by 0x1026922F: php_swoole_onFinish (swoole_server.c:905)\r\n==21254==    by 0x102B935D: swWorker_onTask (Worker.c:283)\r\n==21254==    by 0x102B9708: swWorker_onPipeReceive (Worker.c:670)\r\n==21254==  If you believe this happened as a result of a stack\r\n==21254==  overflow in your program's main thread (unlikely but\r\n==21254==  possible), you can try to increase the size of the\r\n==21254==  main thread stack using the --main-stacksize= flag.\r\n==21254==  The main thread stack size used in this run was 8388608.\r\n==21254== \r\n==21254== HEAP SUMMARY:\r\n==21254==     in use at exit: 19,312,000 bytes in 112,056 blocks\r\n==21254==   total heap usage: 159,548 allocs, 47,492 frees, 36,081,415 bytes allocated\r\n==21254== \r\n==21254== LEAK SUMMARY:\r\n==21254==    definitely lost: 32 bytes in 1 blocks\r\n==21254==    indirectly lost: 2,048 bytes in 1 blocks\r\n==21254==      possibly lost: 11,013,714 bytes in 91,700 blocks\r\n==21254==    still reachable: 8,296,206 bytes in 20,354 blocks\r\n==21254==         suppressed: 0 bytes in 0 blocks\r\n==21254== Rerun with --leak-check=full to see details of leaked memory\r\n==21254== \r\n==21254== For counts of detected and suppressed errors, rerun with: -v\r\n==21254== Use --track-origins=yes to see where uninitialised values come from\r\n==21254== ERROR SUMMARY: 527 errors from 2 contexts (suppressed: 0 from 0)\r\n==21244== Warning: invalid file descriptor -1 in syscall write()\r\nopen(/tmp/swoole.log) failed. Error: Permission denied[13]write(log_fd, size=112) failed. Error: Bad file descriptor[9].\r\non WorkerError...\r\nworkerId[1] workerPid[21254] exitCode[0]\r\n==21244== Warning: invalid file descriptor -1 in syscall write()\r\nwrite(log_fd, size=119) failed. Error: Bad file descriptor[9].\r\n==21244== \r\n==21244== HEAP SUMMARY:\r\n==21244==     in use at exit: 1,355,388 bytes in 147 blocks\r\n==21244==   total heap usage: 55,939 allocs, 55,792 frees, 7,656,611 bytes allocated\r\n==21244== \r\n==21244== LEAK SUMMARY:\r\n==21244==    definitely lost: 1,052,056 bytes in 32 blocks\r\n==21244==    indirectly lost: 296,840 bytes in 65 blocks\r\n==21244==      possibly lost: 0 bytes in 0 blocks\r\n==21244==    still reachable: 6,492 bytes in 50 blocks\r\n==21244==         suppressed: 0 bytes in 0 blocks\r\n==21244== Rerun with --leak-check=full to see details of leaked memory\r\n==21244== \r\n==21244== For counts of detected and suppressed errors, rerun with: -v\r\n==21244== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)\r\n==21235== Warning: invalid file descriptor -1 in syscall write()\r\nwrite(log_fd, size=119) failed. Error: Bad file descriptor[9].\r\n\r\n\r\n\r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-09-08T02:19:14Z",
        "body": "\u8bf7\u52ff\u5728 `onTask` \u4e2d ` return $this;` \uff0c\u5426\u5219 `swoole_server`\u5bf9\u8c61\u4f5c\u4e3a \u5b83\u7684\u4e00\u4e2a\u5c5e\u6027\uff0c\u5e95\u5c42\u4f1a\u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\uff0c\u53d1\u9001\u7ed9 `worker` \u8fdb\u7a0b\u3002\r\n\u6700\u65b0\u7248\u672c\u7684`swoole`\u5df2\u7ecf\u7981\u6b62\u4e86\u5bf9`swoole`\u5bf9\u8c61\u5e8f\u5217\u5316\u3002\r\n"
      }
    ]
  },
  {
    "number": 1321,
    "title": "mqtt,\u4e00\u6b21on receive\u4f1a\u51fa\u73b0\u591a\u4e2a\u5305\u8fde\u5728\u4e00\u8d77\u7684\u60c5\u51b5",
    "created_at": "2017-08-09T13:23:53Z",
    "closed_at": "2017-08-10T02:12:58Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1321",
    "body": "\u4f7f\u7528\u7684\u662f2.0.7\u7248\u672c\u7684client \u505amqtt\u5ba2\u6237\u7aef\u8ba2\u9605\u3002\u53d1\u73b0on receive\u7684data \u5728\u5e76\u53d1\u60c5\u51b5\u4e0b \u4f1a\u51fa\u73b0\u591a\u4e2a\u5305\u8fde\u5728\u4e00\u8d77\u5728\u540c\u4e00\u6b21on receive\u4e2d\u8fd4\u56de\u7684\u60c5\u51b5 \u4f1a\u5f71\u54cd\u89e3\u6790\r\n\r\n\u5e0c\u671bonReceive\u6bcf\u6b21\u53ea\u8fd4\u56de\u4e00\u4e2a\u5b8c\u6574\u7684mqtt\u6570\u636e\u5305",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1321/comments",
    "author": "jesusslim",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-08-10T02:12:58Z",
        "body": "2.0.8 \u548c 1.9.17 \u5df2\u589e\u52a0 Client Mqtt\u534f\u8bae\u652f\u6301\u3002"
      },
      {
        "user": "jesusslim",
        "created_at": "2017-10-17T01:49:27Z",
        "body": "\u76ee\u524d\u662f2.0.8\u7248\u672c \u5728\u5e76\u53d1\u91cf\u5927\u7684\u60c5\u51b5\u4e0b\u5076\u5c14\u4f1a\u51fa\u73b0\u6570\u636e\u5305\u5206\u5272\u7684\u95ee\u9898 \u6b63\u5e38\u60c5\u51b5\u4e0b\u662f\u6bcf\u6b21onreceive\u5230\u7684\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u5305 \u4f46\u5076\u5c14\u4f1a\u51fa\u73b0\u8fd9\u4e2a\u5305\u7684\u957f\u5ea6\u4e0d\u5bf9 \u6bd4\u81ea\u8eab\u957f\u5ea6\u591a \u5bfc\u81f4\u89e3\u6790\u51fa\u73b0\u95ee\u9898 \u5e76\u4e14\u56e0\u4e3a\u591a\u4e86\u4e00\u4e9b\u672c\u6765\u4e0d\u5c5e\u4e8e\u8fd9\u4e2a\u5305\u7684\u5b57\u8282 \u5c06\u4f1a\u5bfc\u81f4\u540e\u7eed\u6240\u6709\u7684\u5305\u90fd\u4ea7\u751f\u95ee\u9898 "
      }
    ]
  },
  {
    "number": 1221,
    "title": "TCP server\u6267\u884c \u4e00\u76f4\u62a5check \u4e4b\u524d\u8fd0\u884c\u6ca1\u6709\u95ee\u9898",
    "created_at": "2017-05-24T05:23:10Z",
    "closed_at": "2017-05-24T08:25:40Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1221",
    "body": "\u5728\u672c\u5730\u865a\u62df\u673a\u6267\u884c\u4e5f\u6ca1\u6709\u62a5\u9519\uff0c\u5728\u516c\u53f8\u6d4b\u8bd5\u670d\u52a1\u5668\u62a5\u9519\u65e0\u6cd5\u8fde\u63a5\r\n`\r\n[root@localhost test]# php ChipPro.php\r\n[/usr/local/src/swoole-src-1.9.9/swoole_server.c:361@php_swoole_server_before_start]Create swoole_server host=0.0.0.0, port=6000, mode=3, type=1\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:359@swServer_start_proxy]hb timer start, time: 120 live time:600\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:1487@swHeartbeatThread_loop]check fd=3\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:1487@swHeartbeatThread_loop]check fd=3\r\n`\r\n\u8fde\u63a5\u65f6\u62a5\u9519\r\n`\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:1487@swHeartbeatThread_loop]check fd=3\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:1487@swHeartbeatThread_loop]check fd=3\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:145@swServer_master_onAccept][Master] Accept new connection. maxfd=3|reactor_id=4|conn=26\r\nSegmentation fault (core dumped)\r\n`\r\n\r\n\u6211\u4ee3\u7801\u5e94\u8be5\u6ca1\u6709\u95ee\u9898- -  \u672c\u5730\u8fd0\u884c\u6210\u529f\uff0c\u5bf9\u4e86  \u672c\u5730\u73af\u5883\u662fphp7 swoole 2.0.6\r\n\u6d4b\u8bd5\u670d\u52a1\u5668\u5f53\u524d\u7248\u672cphp5.6 swoole 1.9.9  \u4e4b\u524d2.0.5\u4e0d\u80fd\u7528\u624d\u6362\u76841.9.9\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1221/comments",
    "author": "RandalTeng",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-05-24T08:25:40Z",
        "body": "\u8bf7\u52ff\u5f00\u542f `--enable-swoole-debug` \u7f16\u8bd1\u9009\u9879"
      },
      {
        "user": "RandalTeng",
        "created_at": "2017-05-24T08:49:55Z",
        "body": "\u6ca1\u6709\u7528\u554a- -  \u6211\u91cd\u65b0\u7f16\u8bd1\u4e86swoole\u6a21\u5757- -  \u8fd8\u662f\u62a5\u4e00\u6837\u7684\u9519- -\r\n`\r\n./configure --enable-async-redis --enable-coroutine --with-php-config=/usr/local/php5/bin/php-config  --enable-openssl  --enable-sockets  --enable-swoole\r\n`"
      },
      {
        "user": "wangjinbei",
        "created_at": "2017-05-25T02:28:55Z",
        "body": "make clean\u8fc7\uff1f"
      }
    ]
  }
]