[
  {
    "number": 5580,
    "title": "Create a Swoole WebSocket server that subscribes to new messages from Redis using Redis Pub/Sub.",
    "created_at": "2024-11-21T20:06:44Z",
    "closed_at": "2024-11-26T08:54:34Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5580",
    "body": "Hi everyone, could someone tell how to send an event from a process to server. I am creating a WebSocket server with Redis pub/sub and subscribing to a Redis channel in the WebSocket server process, but how to pass data to server?\r\nOr is there another approach?\r\nIf I write the subscribing code in the workerStart event, the webSocket server will not accept new connections. \r\n```\r\n$this->server->on(\"workerStart\", function ($server, $workerId) use ($redis) {\r\n    $redis->subscribe(['chat_channel'], function ($redis, $channel, $message) {\r\n        foreach ($this->server->connections as $fd) {\r\n              $this->server->push($fd, json_encode($message));\r\n        }\r\n    });\r\n});\r\n```\r\nI guess this is because the phpredis client is blocking, but how to write a code that will accept messages from Redis and broadcast them to connected users? \r\n\r\nI am really struggling with this. Please help if you know how to solve it.  Thank you very much!\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n```\r\nphp --ri swoole\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 6.0.0-dev\r\nBuilt => Oct  7 2024 17:07:28\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nhttp2 => enabled\r\njson => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nbrotli => E16781312/D16781312\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_library => On => On\r\nswoole.enable_fiber_mock => Off => Off\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n```\r\nLinux developer-v3 5.4.0-26-generic #30-Ubuntu SMP Mon Apr 20 16:58:30 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nPHP 8.3.14 (cli) (built: Nov 21 2024 05:47:02) (NTS)\r\n\r\n``` \r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5580/comments",
    "author": "AnyutaH",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2024-11-23T16:38:43Z",
        "body": "You can use a custom process to do this.\r\n```\r\n$server = new Swoole\\Websocket\\Server('127.0.0.1', 9502, SWOOLE_PROCESS);\r\n\r\n$process = new Swoole\\Process(function() use ($server) {\r\n    $redis->subscribe(['chat_channel'], function ($redis, $channel, $message) {\r\n        foreach ($server->connections as $fd) {\r\n              $server->push($fd, json_encode($message));\r\n        }\r\n    });\r\n});\r\n$server->addProcess($process);\r\n\r\n.....\r\n$server->start();"
      },
      {
        "user": "AnyutaH",
        "created_at": "2024-11-23T21:00:35Z",
        "body": "Yes, it worked with SWOOLE_PROCESS set on server, thank you very much @NathanFreeman "
      },
      {
        "user": "matyhtf",
        "created_at": "2024-11-26T08:54:34Z",
        "body": "It is recommended to use the `isEstablished` method to determine whether the connection is an active WebSocket connection.\r\n\r\n```php\r\n$server = new Swoole\\Websocket\\Server('127.0.0.1', 9502, SWOOLE_PROCESS);\r\n\r\n$process = new Swoole\\Process(function() use ($server) {\r\n    $redis->subscribe(['chat_channel'], function ($redis, $channel, $message) {\r\n        foreach ($server->connections as $fd) {\r\n              if ($server->isEstablished($fd)) {\r\n                  $server->push($fd, json_encode($message));\r\n              }\r\n        }\r\n    });\r\n});\r\n$server->addProcess($process);\r\n\r\n.....\r\n$server->start();\r\n```"
      },
      {
        "user": "AnyutaH",
        "created_at": "2024-11-26T10:37:19Z",
        "body": "Ok, thanks a lot @matyhtf "
      }
    ]
  },
  {
    "number": 5545,
    "title": "\"PHP Deprecated\" warning",
    "created_at": "2024-10-25T15:18:39Z",
    "closed_at": "2024-10-26T00:11:41Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5545",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nRunning code:\r\n```php\r\n\r\nnamespace test;\r\n\r\nuse Swoole\\Runtime;\r\n\r\nRuntime::enableCoroutine(true, SWOOLE_HOOK_TCP);\r\n\r\ngo(function () {\r\n  $redis = new \\Redis();\r\n\r\n  if (!$redis->connect('127.0.0.1', 6379)) {\r\n    throw new \\RedisException(\"Unable to connect to Redis\", 2);\r\n  }\r\n\r\n  echo \"Redis connected\\n\";\r\n});\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n> Redis connected\r\n\r\n3. What did you see instead?\r\n\r\n> PHP Deprecated:  Swoole\\Event::rshutdown(): Event::wait() in shutdown function is deprecated in Unknown on line 0\r\n>\r\n> Deprecated: Swoole\\Event::rshutdown(): Event::wait() in shutdown function is deprecated in Unknown on line 0\r\n> Redis connected\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n**`> php --ri swoole`**\r\n> \r\n> swoole\r\n> \r\n> Swoole => enabled\r\n> Author => Swoole Team <team@swoole.com>\r\n> Version => 5.1.4\r\n> Built => Sep 17 2024 22:29:47\r\n> coroutine => enabled with boost asm context\r\n> eventfd => enabled\r\n> kqueue => enabled\r\n> cpu_affinity => enabled\r\n> spinlock => enabled\r\n> rwlock => enabled\r\n> http2 => enabled\r\n> json => enabled\r\n> zlib => 1.3\r\n> mutex_timedlock => enabled\r\n> pthread_barrier => enabled\r\n> mysqlnd => enabled\r\n> async_redis => enabled\r\n> \r\n> Directive => Local Value => Master Value\r\n> swoole.enable_coroutine => On => On\r\n> swoole.enable_library => Off => Off\r\n> swoole.enable_fiber_mock => Off => Off\r\n> swoole.enable_preemptive_scheduler => On => On\r\n> swoole.display_errors => On => On\r\n> swoole.use_shortname => On => On\r\n> swoole.unixsock_buffer_size => 2621440 => 2621440\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n**`> uname -a`**\r\n> FreeBSD web 14.1-RELEASE-p5 FreeBSD 14.1-RELEASE-p5 GENERIC amd64\r\n\r\n**`> php -v`**\r\n> PHP 8.3.12 (cli) (built: Sep 29 2024 01:11:14) (NTS)\r\n> Copyright (c) The PHP Group\r\n> Zend Engine v4.3.12, Copyright (c) Zend Technologies\r\n>     with Zend OPcache v8.3.12, Copyright (c), by Zend Technologies\r\n\r\n**`> gcc -v`**\r\n> Using built-in specs.\r\n> COLLECT_GCC=gcc\r\n> COLLECT_LTO_WRAPPER=/usr/local/libexec/gcc13/gcc/x86_64-portbld-freebsd14.0/13.3.0/lto-wrapper\r\n> Target: x86_64-portbld-freebsd14.0\r\n> Configured with: /wrkdirs/usr/ports/lang/gcc13/work/gcc-13.3.0/configure --enable-multilib --with-build-config=bootstrap-debug --disable-nls --enable-gnu-indirect-function --enable-host-shared --enable-plugin --libdir=/usr/local/lib/gcc13 --libexecdir=/usr/local/libexec/gcc13 --program-suffix=13 --with-as=/usr/local/bin/as --with-gmp=/usr/local --with-gxx-include-dir=/usr/local/lib/gcc13/include/c++/ --with-gxx-libcxx-include-dir=/usr/include/c++/v1 --with-ld=/usr/local/bin/ld --with-pkgversion='FreeBSD Ports Collection' --with-system-zlib --without-zstd --enable-languages=c,c++,objc,fortran,jit --prefix=/usr/local --localstatedir=/var --mandir=/usr/local/share/man --infodir=/usr/local/share/info/gcc13 --build=x86_64-portbld-freebsd14.0\r\n> Thread model: posix\r\n> Supported LTO compression algorithms: zlib\r\n> gcc version 13.3.0 (FreeBSD Ports Collection)",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5545/comments",
    "author": "mozart77",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2024-10-25T15:53:34Z",
        "body": "```php\r\n\r\nnamespace test;\r\n\r\nuse Swoole\\Runtime;\r\nuse function Swoole\\Coroutine\\run;\r\nuse function Swoole\\Coroutine\\go;\r\n\r\nRuntime::enableCoroutine(true, SWOOLE_HOOK_TCP);\r\n\r\nrun(function(){\r\n    $redis = new \\Redis();\r\n    if (!$redis->connect('127.0.0.1', 6379)) {\r\n        throw new \\RedisException(\"Unable to connect to Redis\", 2);\r\n    }\r\n    echo \"Redis connected\\n\";\r\n});\r\n```\r\n\r\nTry it like this."
      },
      {
        "user": "mozart77",
        "created_at": "2024-10-25T16:07:32Z",
        "body": "> ```\r\n> use Swoole\\Runtime;\r\n> use function Swoole\\Coroutine\\run;\r\n> use function Swoole\\Coroutine\\go;\r\n> \r\n> Runtime::enableCoroutine(true, SWOOLE_HOOK_TCP);\r\n> \r\n> run(function(){\r\n>     $redis = new \\Redis();\r\n>     if (!$redis->connect('127.0.0.1', 6379)) {\r\n>         throw new \\RedisException(\"Unable to connect to Redis\", 2);\r\n>     }\r\n>     echo \"Redis connected\\n\";\r\n> });\r\n> ```\r\n\r\nThe result:\r\n\r\n> PHP Fatal error:  Uncaught Error: Call to undefined function Swoole\\Coroutine\\run() in /usr/local/www/test/q.php:11\r\n> Stack trace:\r\n> #0 {main}\r\n>   thrown in /usr/local/www/test/q.php on line 11\r\n> \r\n> Fatal error: Uncaught Error: Call to undefined function Swoole\\Coroutine\\run() in /usr/local/www/test/q.php:11\r\n> Stack trace:\r\n> #0 {main}\r\n>   thrown in /usr/local/www/test/q.php on line 11"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2024-10-25T16:39:50Z",
        "body": "```php\r\nnamespace test;\r\n\r\nuse Swoole\\Runtime;\r\n\r\nRuntime::enableCoroutine(true, SWOOLE_HOOK_TCP);\r\n\r\ngo(function () {\r\n  $redis = new \\Redis();\r\n\r\n  if (!$redis->connect('127.0.0.1', 6379)) {\r\n    throw new \\RedisException(\"Unable to connect to Redis\", 2);\r\n  }\r\n\r\n  echo \"Redis connected\\n\";\r\n});\r\nSwoole\\Event::wait();\r\n```\r\n\r\nIt seems that the value of the configuration `swoole.enable_library` is set to Off, which is why it prompts that the function does not exist. So try adding `Swoole\\Event::wait();` at the end of this code."
      },
      {
        "user": "mozart77",
        "created_at": "2024-10-25T16:42:27Z",
        "body": "That's it! Works! Thank you!"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2024-10-25T16:42:27Z",
        "body": "I need to supplement this section with details in the Swoole documentation."
      }
    ]
  },
  {
    "number": 5017,
    "title": "swoole\u8fdb\u7a0b\u4e2d\u4f7f\u7528\u534f\u7a0b\u6b7b\u9501\u95ee\u9898",
    "created_at": "2023-03-29T10:07:31Z",
    "closed_at": "2023-04-14T09:53:57Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5017",
    "body": "### \u73b0\u8c61\r\nswoole\u8fdb\u7a0b\u4e2d\uff0c\u521b\u5efa\u534f\u7a0b\uff0c\u4f7f\u7528\u534f\u7a0b\u5ba2\u6237\u7aef\u4ece\u670d\u52a1\u7aef\u6536\u53d6\u6d88\u606f\uff0c\u7ed3\u679c\u62a5\u9519`[FATAL ERROR]: all coroutines (count: 1) are asleep - deadlock!`\r\n\r\n### \u7b80\u5316\u4ee3\u7801\r\n\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Process;\r\n\r\nclass DeadLock\r\n{\r\n    public function startProcess()\r\n    {\r\n        $t = new Swoole\\Process(function () {\r\n            swoole_async_set(['enable_coroutine' => true]);\r\n            go(function (){\r\n                for (; ;) {\r\n                    Swoole\\Coroutine\\System::sleep(1);\r\n                    var_dump('dd');\r\n                }\r\n            });\r\n        });\r\n        $t->start();\r\n    }\r\n}\r\n\r\n$proc = new Process(function () {\r\n    swoole_async_set(['enable_coroutine' => false]);\r\n    $cls = new DeadLock();\r\n    //$cls->startProcess(); 1. \u6b64\u5904\u8c03\u7528\u4e0d\u62a5\u9519\r\n    \\Swoole\\Timer::after(1000, function () use ($cls) {\r\n        $cls->startProcess(); //2. \u6b64\u5904\u8c03\u7528\u4f1a\u62a5\u9519\r\n    });\r\n});\r\n$proc->start();\r\n```\r\n\r\n### \u73af\u5883\u4fe1\u606f\r\nphp\u7248\u672c\uff1a7.2.34\r\nswoole\u7248\u672c\uff1a\r\n```\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.8.9\r\nBuilt => May 10 2022 20:17:44\r\ncoroutine => enabled with boost asm context\r\nkqueue => enabled\r\nrwlock => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 262144 => 262144\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5017/comments",
    "author": "suuhui",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2023-03-30T13:28:12Z",
        "body": "```php\r\n<?php\r\n\r\nuse Swoole\\Process;\r\nuse Swoole\\Event;\r\n\r\nclass DeadLock\r\n{\r\n    public function startProcess()\r\n    {\r\n        $t = new Swoole\\Process(function () {\r\n            swoole_async_set(['enable_coroutine' => true]);\r\n            go(function (){\r\n                for (; ;) {\r\n                        Swoole\\Coroutine\\System::sleep(1);\r\n                        var_dump('dd');\r\n                }\r\n            });\r\n            Swoole\\Event::wait();\r\n        });\r\n        $t->start();\r\n        Process::wait();\r\n    }\r\n}\r\n\r\n\r\n$proc = new Process(function () {\r\n    swoole_async_set(['enable_coroutine' => false]);\r\n    $cls = new DeadLock();\r\n    //$cls->startProcess();\r\n    \\Swoole\\Timer::after(1000, function () use ($cls) {\r\n            $cls->startProcess();\r\n    });\r\n    Event::wait();\r\n});\r\nvar_dump($proc->start());\r\nProcess::wait();\r\n```\r\n\r\n\u4f60\u53ef\u4ee5\u8bd5\u8bd5\u8fd9\u4e48\u5199\uff0c\u73b0\u5728\u662f\u63a8\u8350\u5728\u6587\u4ef6\u672b\u5c3e\u52a0\u4e0a`Swoole\\Event::wait()`\u542f\u52a8\u4e8b\u4ef6\u673a\u5236\u3002"
      },
      {
        "user": "suuhui",
        "created_at": "2023-03-31T04:21:39Z",
        "body": "@NathanFreeman \u8fd9\u6837\u5199\u5c31\u53ef\u4ee5\u4e86\uff0c\u80fd\u8bb2\u89e3\u4e0b\u4e3a\u4ec0\u4e48\u4e0d\u52a0`Swoole\\Event::wait()`\u5c31\u62a5\u9519\u5417"
      },
      {
        "user": "NathanFreeman",
        "created_at": "2023-04-01T03:45:12Z",
        "body": "\u8fd9\u4e2a\u5176\u5b9e\u662f\u56e0\u4e3a\u5982\u679c\u4e0d\u52a0`Swoole\\Event::wait()`\uff0c\u4f9d\u9760`php_swoole_register_shutdown_function`\u6ce8\u518c\u7684\u51fd\u6570\u6267\u884c\u4e8b\u4ef6\u673a\u5236\u7684\u8bdd\u5728\u4e00\u4e9b\u7279\u5b9a\u7684\u573a\u666f\u4e0b\u603b\u6709\u4e00\u4e9b\u5947\u5947\u602a\u602a\u7684\u95ee\u9898\u3002"
      }
    ]
  },
  {
    "number": 5011,
    "title": "Swoole 5.0.1 \u5728User Process\u4e2d\u904d\u5386 $server->connections \u4e3a\u7a7a\uff0c\u800c\u5728onReceive\u904d\u5386\u4e0d\u4e3a\u7a7a\uff0c\u8fd9\u662fBug\u5417\uff1f",
    "created_at": "2023-03-16T01:28:37Z",
    "closed_at": "2023-03-16T02:31:14Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5011",
    "body": null,
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5011/comments",
    "author": "MsZhu",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2023-03-16T02:31:14Z",
        "body": "5.0 \u9ed8\u8ba4\u4f7f\u7528 BASE \u6a21\u5f0f\uff0c\u4f60\u53ef\u4ee5\u6539\u4e3a PROCESS"
      },
      {
        "user": "MsZhu",
        "created_at": "2023-03-16T09:36:13Z",
        "body": "\u55ef\uff0c\u6539\u4e86\u5c31\u5bf9\u4e86\uff0c\u5f97\u56de\u5934\u591a\u7406\u89e3\u4e0b\u4e0b\uff0c\u8c22\u8c22\u5927\u795e\u89e3\u7b54\uff01~"
      }
    ]
  },
  {
    "number": 5004,
    "title": "Connect EVENT: \"Invalid frame header\"",
    "created_at": "2023-03-09T01:46:31Z",
    "closed_at": "2023-03-09T04:21:30Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/5004",
    "body": "### Invalid frame header\r\nPlease answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\u5ba2\u6237\u7aef\u8fde\u63a5\u65f6\uff0c\u7a81\u7136\u53d1\u73b0\u62a5\u201c**Invalid frame header**\u201d\r\n\r\n\u670d\u52a1\u7aef\u76f4\u63a5\u8fdb\u5165 Close\u4e8b\u4ef6\r\n\r\n2. What did you expect to see?\r\n\u5f53\u65f6\u5565\u90fd\u6b63\u5e38\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u95ee\u9898\u4e4b\u524d\u4e5f\u51fa\u73b0\u591a\u5f88\u591a\u6b21\uff0cInvalid frame header\uff0c\u540e\u6765\u89e3\u51b3\u4e86\uff0c\u5fd8\u8bb0\u600e\u4e48\u89e3\u51b3\u4e86\u3002\uff08\u5404\u79cd\u641c\u4e5f\u662f\u6ca1\u6709\u7ed3\u679c\uff0c\u6240\u4ee5\u4eca\u5929\u63d0\u4e00\u4e2aissue\u8bb0\u5f55\u4e00\u4e0b\u6700\u540e\u89e3\u51b3\u529e\u6cd5\uff0c\u4ee5\u5907\u540e\u67e5\u3002\uff09\r\n\r\n3. What did you see instead?\r\n\u8fde\u63a5\u63d0\u793a\u201cError\u201d\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nVersion => 4.4.17\r\nBuilt => Jun 29 2020 18:34:48\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.0.2k-fips  26 Jan 2017\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => 1.2.7\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\u90fd\u5f88\u6807\u51c6\u7684\u73af\u5883\uff0c\u6628\u5929\u53ef\u4ee5\uff0c\u4eca\u5929\u5c31\u4e0d\u884c\u3002\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/5004/comments",
    "author": "tengdengming",
    "comments": [
      {
        "user": "tengdengming",
        "created_at": "2023-03-09T01:56:06Z",
        "body": "### \u6ce8\u610f\u6ce8\u610f\uff0c\u4e0d\u662f\u914d\u7f6e\u95ee\u9898\uff0c\u4e0d\u662f\u4ee3\u7801\u903b\u8f91\u95ee\u9898\u3002Invalid frame header\r\n\u662f\u901a\u8baf\u4e8b\u4ef6\u7f16\u7a0b\u6b63\u5e38\u903b\u8f91\u7406\u89e3\u7684\u95ee\u9898\u3002\u5728Connect\uff0c\u6216\u8005OnOpen\u4e8b\u4ef6\u6ce8\u518c\u903b\u8f91\u4e2d\uff0c\u6709\u65f6\u5019\u4e3a\u4e86\u505a\u4e00\u4e9b\u6d4b\u8bd5\u6216\u8005\u540c\u6b65\u963b\u585e\u7684\u64cd\u4f5c\u65f6\uff0c\u5c06\u4e1a\u52a1\u903b\u8f91\u5199\u5230\u4e86\u9ed8\u8ba4\u4e8b\u4ef6\u4e2d\uff0c\u5bfc\u81f4\u4e0a\u4e0b\u6587\u53e5\u67c4\u903b\u8f91\u751f\u547d\u5468\u671f\u602a\u5708\u3002\r\n\r\n\u6bd4\u5982\u6211\u5728\u6d4b\u8bd5\u7684\u65f6\u5019\u4e3a\u4e86\u6d4b\u56de\u4e00\u4e2a\u5305\uff0c\u7b80\u5355\u7684\u5c06send\u53d1\u9001\u5199\u5728\u4e86OnOpen\u4e8b\u4ef6\u5904\u7406\u57df\u7684\u534f\u7a0b\u5904\u7406\u5355\u5143\uff0c\u5728\u534f\u7a0b\u53c8global\u5168\u5c40\u8c03\u7528\u4e3b\u7c7b\u7684send\u65b9\u6cd5\u3002\u5bfc\u81f4\u8fde\u63a5\u4e8b\u4ef6\u4e2d\u53bb\u6267\u884c\u4e00\u4e2a\u57fa\u4e8e\u8fde\u63a5\u4ee5\u540e\u7684\u53d1\u9001\u8c03\u7528\uff0c\u7136\u540e\u5c31\u51fa\u73b0\u4e86### Invalid frame header\r\n\u3002\u662f\u4e0d\u662f\u6709\u70b9\u5947\u602a\uff0c\uff08\u5b83\u662f\u4e0d\u4f1a\u660e\u786e\u7684\u544a\u8bc9\u4f60\u9519\u5728\u54ea\u91cc\uff09\r\n\r\n\u62ff\u6389\u540e\u5373\u53ef\u6062\u590d\u6b63\u5e38\uff0c\u8fd9\u4e2a\u95ee\u9898\u78b0\u5230\u8fc72\u6b21\u4ee5\u4e0a\uff0c\u4f46\u662f\u65f6\u95f4\u4e45\u4e86\uff0c\u5199\u522b\u7684\u53bb\u4e86\u5c31\u5fd8\u8bb0\u4e86\u3002\r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2023-03-09T04:21:30Z",
        "body": "\u4e0d\u8981\u4f7f\u7528 `Server::send()` \u65b9\u6cd5\uff0c\u8fd9\u662f\u539f\u59cb\u7684 `tcp send`\uff0c\u6539\u4e3a\u4f7f\u7528 `Server::push()`"
      },
      {
        "user": "tengdengming",
        "created_at": "2023-03-13T07:03:27Z",
        "body": "\u5b66\u4e60\u4e86\uff0cTCP\u5c42\u9762\u7684\u7528Server::push()\u3002 @matyhtf \u3002\u53e6\u5916\u8bf7\u6559\u4e00\u4e0b\uff0c\u53ef\u4ee5\u5728\u54ea\u91cc\u770b\u5230\u8fd9\u79cd\u5f02\u5e38\u4fe1\u606f\u65e5\u5fd7\uff1f"
      }
    ]
  },
  {
    "number": 4610,
    "title": "\u5173\u4e8eswoole-cli swoole\u7684\u914d\u7f6e\u4fee\u6539",
    "created_at": "2022-02-16T10:13:40Z",
    "closed_at": "2022-02-16T16:28:34Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4610",
    "body": "Please answer these questions before submitting your issue.\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n```\r\n\u4f7f\u7528 v4.8.6 swoole-cli \u542f\u52a8hyperf\u65f6\r\n ./swoole-cli bin/hyperf.php start\r\n```\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n**v4.8.6  swoole-cli\u600e\u4e48\u4fee\u6539swoole\u7684\u914d\u7f6e\u5440\uff1f\r\n\u4f8b\u5982 swoole.use_shortname \u4fee\u6539\u4e3a Off**\r\n\r\n3. What did you see instead?\r\n\r\n**\u9700\u8981\u5173\u95ed swoole.use_shortname**\r\n`ERROR Swoole short function names must be disabled before the server starts, please set swoole.use_shortname='Off' in your php.ini.`\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n./swoole-cli --ri swoole\r\n\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.8.6\r\nBuilt => Jan 11 2022 11:48:24\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1m  14 Dec 2021\r\ndtls => enabled\r\nhttp2 => enabled\r\njson => enabled\r\ncurl-native => enabled\r\nc-ares => 1.18.1\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n```\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4610/comments",
    "author": "shimianxiang",
    "comments": [
      {
        "user": "leocavalcante",
        "created_at": "2022-02-16T12:23:47Z",
        "body": "`swoole-cli --ini` \u7684\u8f93\u51fa\u662f\u4ec0\u4e48?\r\n\r\n\u4f5c\u4e3a\u4e00\u79cd\u89e3\u51b3\u65b9\u6cd5\uff0c\u60a8\u53ef\u4ee5\u5c1d\u8bd5 `swoole-cli -dswoole.use_shortname=Off bin/hyperf.php` "
      },
      {
        "user": "shimianxiang",
        "created_at": "2022-02-16T15:50:18Z",
        "body": "./swoole-cli --ini \u7684\u8f93\u51fa\u662f\r\n```\r\nConfiguration File (php.ini) Path: /usr/local/lib\r\nLoaded Configuration File:         (none)\r\nScan for additional .ini files in: (none)\r\nAdditional .ini files parsed:      (none)\r\n\r\n```\r\n\u60f3\u8981\u7684\u7b54\u6848\u5c31\u662f\u8fd9\u4e2a `swoole-cli -dswoole.use_shortname=Off bin/hyperf.php `\u611f\u8c22\u89e3\u7b54\r\n\u671f\u5f85swoole5.0 swoole-cli  \u7684\u6b63\u5f0f\u53d1\u5e03\r\n\r\n"
      }
    ]
  },
  {
    "number": 4438,
    "title": "How to stop the process pool so that it waits for all the workers to finish?",
    "created_at": "2021-10-15T20:44:58Z",
    "closed_at": "2021-10-21T08:50:01Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4438",
    "body": "In the my crawlers program with worker pool on kill (SIGTERM) signal program stops  immediately and doesn't wait until workers stop.\r\n\r\nPlease help to fix that prototype code, so it will exit after all workers stop:\r\n\r\n```\r\n<?php\r\n\r\ndeclare(strict_types=1);\r\n\r\n$workerNum = 5;\r\n\r\n$pool = new Swoole\\Process\\Pool($workerNum);\r\n\r\n$pool->on(\"WorkerStart\", function ($pool, $workerId) {\r\n    $sleep = rand(3, 6);\r\n    echo \"Worker#$workerId: sleep for $sleep seconds\\n\";\r\n    sleep($sleep);\r\n});\r\n\r\n$pool->on(\"WorkerStop\", function ($pool, $workerId) {\r\n    echo \"Worker#$workerId is stopped\\n\";\r\n    sleep(1);\r\n});\r\n\r\n$pool->start();\r\n\r\n```\r\n\r\nEnv parameters:\r\n\r\n```\r\nphp --ri swoole\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.6.5\r\nBuilt => Apr 24 2021 09:19:13\r\ncoroutine => enabled with boost asm context\r\nkqueue => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.1k  25 Mar 2021\r\ndtls => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nbrotli => E16777225/D16777225\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 262144 => 262144\r\n```\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n```\r\n[1] 7055\r\n[2] 7056\r\nDarwin MacBook-X.local 20.6.0 Darwin Kernel Version 20.6.0: Mon Aug 30 06:12:20 PDT 2021; root:xnu-7195.141.6~3/RELEASE_ARM64_T8101 arm64\r\n[1]  - done       uname -a\r\nPHP 7.4.23 (cli) (built: Aug 27 2021 10:07:08) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v3.4.0, Copyright (c) Zend Technologies\r\n[2]  + done       php -v\r\nConfigured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/c++/4.2.1\r\nApple clang version 13.0.0 (clang-1300.0.29.3)\r\nTarget: arm64-apple-darwin20.6.0\r\nThread model: posix\r\nInstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin\r\n```\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4438/comments",
    "author": "alebedev80",
    "comments": [
      {
        "user": "deminy",
        "created_at": "2021-10-16T00:17:43Z",
        "body": "The `SIGTERM` signal is handled in the manager process only, but not handled in each worker processes. You will need to handle signal `SIGTERM` in worker processes.\r\n\r\nHere are two examples to handle signal `SIGTERM` in worker processes.\r\n\r\n## If the worker process runs in non-blocking mode:\r\n\r\n```php\r\n<?php\r\n\r\ndeclare(strict_types=1);\r\n\r\nuse Swoole\\Coroutine;\r\nuse Swoole\\Process;\r\nuse Swoole\\Process\\Pool;\r\n\r\necho \"Current process ID is: \", posix_getpid(), \"\\n\";\r\n\r\n$pool = new Pool(2);\r\n$pool->set(['enable_coroutine' => true]);\r\n\r\n$pool->on(\"WorkerStart\", function (Pool $pool, int $workerId) {\r\n    Process::signal(SIGTERM, function() use ($pool, $workerId) {\r\n        echo \"Will shutdown process #{$workerId}\\n\";\r\n        // More clean up code before exiting the process.\r\n    });\r\n\r\n    $sleep = rand(3, 6);\r\n    echo \"Worker #$workerId: sleep for {$sleep} seconds\\n\";\r\n    Coroutine::sleep($sleep);\r\n});\r\n\r\n$pool->on(\"WorkerStop\", function ($pool, $workerId) {\r\n    echo \"Worker#$workerId is stopped\\n\";\r\n    sleep(1);\r\n});\r\n\r\n$pool->start();\r\n```\r\n\r\n## If the worker process runs in blocking mode:\r\n\r\n```php\r\n$pool->on(\"WorkerStart\", function ($pool, $workerId) {\r\n    $running = true;\r\n    pcntl_signal(SIGTERM, function () use (&$running) {\r\n        $running = false;\r\n    });\r\n    echo \"Worker#{$workerId} is started\\n\";\r\n    $redis = new Redis();\r\n    $redis->pconnect('127.0.0.1', 6379);\r\n    $key = \"key1\";\r\n    while ($running) {\r\n         $msg = $redis->brpop($key);\r\n         pcntl_signal_dispatch();\r\n         if ( $msg == null) continue;\r\n         var_dump($msg);\r\n     }\r\n});\r\n```"
      },
      {
        "user": "alebedev80",
        "created_at": "2021-10-16T10:56:22Z",
        "body": "@matyhtf thank you very much!\r\n\r\ni've fixed my prototype's code relate to blocking mode example and it's working fine. It would be great to correct the documentation, I think this is a quite common problem.\r\n\r\n```\r\n<?php\r\n\r\ndeclare(strict_types=1);\r\n\r\nuse Swoole\\Coroutine as Co;\r\n\r\n$workerNum = 3;\r\n\r\necho \"Current process ID is: \", posix_getpid(), \"\\n\";\r\n\r\n$pool = new Swoole\\Process\\Pool($workerNum);\r\n$pool->set(['enable_coroutine' => true]);\r\n$pool->on(\"WorkerStart\", function ($pool, $workerId) {\r\n    $running = true;\r\n    pcntl_signal(SIGTERM, function () use (&$running, $workerId) {\r\n        $t = date('H:i:s');\r\n        echo \"$t - Worker#$workerId: got SIGTERM at $t\\n\";\r\n        $running = false;\r\n    });\r\n    while ($running) {\r\n        $sleep = rand(5, 10);\r\n        $s = date('H:i:s');\r\n        echo \"$s - Worker#$workerId: start $s and sleep for $sleep seconds\\n\";\r\n        Co::exec(\"/bin/sleep $sleep\");\r\n        $f = date('H:i:s');\r\n        echo \"$f - Worker#$workerId: stop after sleep for $sleep seconds $s - $f\\n\";\r\n        pcntl_signal_dispatch();\r\n    }\r\n});\r\n\r\n$pool->on(\"WorkerStop\", function ($pool, $workerId) {\r\n    $t = date('H:i:s');\r\n    echo \"$t - Worker#$workerId is stopped\\n\";\r\n    sleep(1);\r\n});\r\n\r\n$pool->start();\r\n```\r\n\r\n\r\n\r\n"
      }
    ]
  },
  {
    "number": 4424,
    "title": "Question regarding file system security",
    "created_at": "2021-10-07T02:20:22Z",
    "closed_at": "2021-10-08T02:39:57Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4424",
    "body": "Hi, I was wondering if swoole prevents file system transversal in the Swoole\\Http\\Response->sendfile() and Swoole\\Coroutine\\FastCGI\\Client::call() methods. What are the security implications of these and similar methods in swoole?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4424/comments",
    "author": "ClosetGeek-Git",
    "comments": [
      {
        "user": "twose",
        "created_at": "2021-10-08T02:21:06Z",
        "body": "These APIs are just the non-blocking syscall wrappers.\r\nApplication security is guaranteed by the developer who wrote the service code.\r\nThe developer's code determines which requests are allowed by the service, and what Swoole does is just send data."
      },
      {
        "user": "ClosetGeek-Git",
        "created_at": "2021-10-08T03:12:27Z",
        "body": "Thank you. The documentation should make this clear."
      }
    ]
  },
  {
    "number": 4326,
    "title": "[BUG?] Coroutine::cancel not cancelling coroutine.",
    "created_at": "2021-07-19T12:18:16Z",
    "closed_at": "2021-08-02T05:04:23Z",
    "labels": [
      "question",
      "waiting on review"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/4326",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nWhile testing `Coroutine::cancel` I noticed that the call will only cancel one IO call within the cancelled coroutine.\r\nSo either the documentation lost something in translation, or it doesn't actually cancel the coroutine.\r\n\r\n```php\r\n<?php\r\nuse Swoole\\Coroutine;\r\n\r\nforeach (['php --ri swoole', 'uname -a', 'php -v', 'gcc -v'] as $cmd) {\r\n    echo \"\\n----- $cmd ----\\n\";\r\n    echo `$cmd`;\r\n    echo \"\\n------------\\n\";\r\n}\r\n\r\nCo\\run(function () {\r\n    echo \"\\n Hello - \" . time();\r\n    $c = Co\\go(function () {\r\n        Co\\defer(function () {\r\n            echo \"\\n Cancel - \" . time();\r\n        });\r\n        Co::sleep(2);\r\n        echo \"\\n Hello A - \" . time() . \" \" . (Coroutine::isCanceled() ? 'Y' : 'N');\r\n        Co::sleep(2);\r\n        echo \"\\n Hello B - \" . time() . \" \" . (Coroutine::isCanceled() ? 'Y' : 'N');\r\n    });\r\n    echo \"\\n Started: $c\";\r\n    if (Coroutine::cancel($c) === true) {\r\n        echo \"\\n Cancelled: $c\";\r\n    } else {\r\n        echo \"\\nswoole_last_error: \" . swoole_last_error();\r\n    }\r\n});\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\nExpected the coroutine #2 to be cancelled, and not be processed any more\r\n```\r\n Hello - 1626696957\r\n Started: 2\r\n Cancelled: 2\r\n Cancel - 1626696957 <-- should be the start time (+0-1sec on second change)\r\n```\r\n\r\n3. What did you see instead?\r\n\r\nThe first `sleep` was interrupted, the coroutine continued to run.\r\n```\r\n Hello - 1626696957\r\n Started: 2\r\n Hello A - 1626696957 Y\r\n Cancelled: 2\r\n Hello B - 1626696959 N  <--- at the very least, this should probably be Y for cid #2\r\n Cancel - 1626696959 <-- it's actually the start time +2sec, since the second `sleep` was not cancelled.\r\n```\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n```\r\n----- php --ri swoole ----\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.7.0\r\nBuilt => Jul 16 2021 10:49:14\r\ncoroutine => enabled with boost asm context\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.1.1d  10 Sep 2019\r\ndtls => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => 1.2.11\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.enable_library => On => On\r\nswoole.enable_preemptive_scheduler => Off => Off\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\n```\r\n----- uname -a ----\r\nLinux ca60602a12a0 4.15.0-46-generic #49-Ubuntu SMP Wed Feb 6 09:33:07 UTC 2019 x86_64 GNU/Linux\r\n\r\n\r\n----- php -v ----\r\nPHP 8.0.0 (cli) (built: Dec  1 2020 03:14:26) ( NTS )\r\nCopyright (c) The PHP Group\r\nZend Engine v4.0.0-dev, Copyright (c) Zend Technologies\r\n    with Zend OPcache v8.0.0, Copyright (c), by Zend Technologies\r\n\r\n\r\n----- gcc -v ----\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/8/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Debian 8.3.0-6' --with-bugurl=file:///usr/share/doc/gcc-8/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-8 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-bootstrap --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 8.3.0 (Debian 8.3.0-6) \r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/4326/comments",
    "author": "ValiDrv",
    "comments": [
      {
        "user": "NathanFreeman",
        "created_at": "2021-07-19T14:33:48Z",
        "body": "Hi. The canceled coroutine would continue to run and coroutine api that cause context switch would return false when canceling a coroutine successfully.\r\n\r\nit actually cancel the first coroutine api (Co::sleep(2)).\r\nCoroutine::cancel() cancel Co::sleep() api and resume the target coroutine to continue to run.\r\n\r\n\r\n```php\r\n    $c = Co\\go(function () {\r\n        Co\\defer(function () {\r\n            echo \"\\n Cancel - \" . time();\r\n        });\r\n        var_dump(Co::sleep(2)).PHP_EOL;\r\n        echo \"\\n Hello A - \" . time() . \" \" . (Coroutine::isCanceled() ? 'Y' : 'N');\r\n        var_dump(Co::sleep(2)).PHP_EOL;\r\n        echo \"\\n Hello B - \" . time() . \" \" . (Coroutine::isCanceled() ? 'Y' : 'N');\r\n    });\r\n```\r\n\r\nHello - 1626705129\r\n Started: 2\r\nbool(false)\r\n\r\n Hello A - 1626705129 Y\r\n Cancelled: 2\r\nbool(true)\r\n\r\n Hello B - 1626705131 N\r\n"
      },
      {
        "user": "ValiDrv",
        "created_at": "2021-07-23T14:48:23Z",
        "body": "Hi, if what @NathanFreeman answered is the correct answer, then I'm confused.\r\n\r\n`Coroutine::cancel($c)` should **a)** cancel a coroutine? or **b)** should cancel whatever IO block that coroutine is currently being suspended for, and resume said coroutine?\r\n\r\nIf **b)** is the correct answer, then the `::cancel` method name is very misleading _(in English, and most Latin based languages)_, since it actually means it should cancel and forget the coroutine with the `$c` id (and probably all it's shutdown function).\r\n\r\nIf this is the case, I suggest the method is renamed to `::cancelIo(...)`, '::cancelBlock(...)' or something along those lines.\r\n(That L and I in `cancelIo` camel case doesn't look to good tho...)"
      },
      {
        "user": "matyhtf",
        "created_at": "2021-08-02T05:04:23Z",
        "body": "The `Co::cancel()` method is to cancel an operation, not killing the coroutine. After cancellation, the coroutine will resume from the suspended state and continue to execute."
      },
      {
        "user": "matyhtf",
        "created_at": "2021-08-02T05:17:11Z",
        "body": "Thanks for your advice.Let's think about the naming here"
      },
      {
        "user": "ValiDrv",
        "created_at": "2021-08-02T10:57:12Z",
        "body": "Thanks, with that explanation or makes perfect sense. \r\n\r\nExcept for the misleading name... ( I suggest it's deprecated/renamed before to many people start to use it)"
      }
    ]
  },
  {
    "number": 3564,
    "title": "WARNING swPipeUnsock_create(:83): socketpair() failed, Error: Too many open files[24]",
    "created_at": "2020-08-12T03:25:42Z",
    "closed_at": "2020-08-12T08:43:12Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3564",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\nI'm downloading many small files from the Internet using file_get_contents, then writing using file_put_contents.  I have these inside a swoole process function.  At around the 500 file mark, I get this error:\r\n\r\n`WARNING swPipeUnsock_create(:83): socketpair() failed, Error: Too many open files[24]`\r\n\r\nExample script:\r\n\r\n```\r\n$data = array(<URLs of over 500 files>);\r\n\r\nforeach($data as $abc) {\r\n\r\n    $processes[ $abc ] = new \\Swoole\\Process(function () use ($abc) {\r\n\r\n        $bca = file_get_contents($abc);\r\n\r\n        file_put_contents(\"dir/path/to/new/file.abc\",$bca);\r\n\r\n    }\r\n\r\n    $processes[ $data ]->start();\r\n\r\n}\r\n```\r\n\r\nI even tried using the wait command after 100 processes at a time.  Do I need to allow more time for swoole to close the process?\r\n\r\n2. What did you expect to see?\r\n\r\nNo error\r\n\r\n\r\n3. What did you see instead?\r\n\r\n`WARNING swPipeUnsock_create(:83): socketpair() failed, Error: Too many open files[24]`\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nLatest\r\n\r\n5. What is your machine environment used (show your `uname -a` & `php -v` & `gcc -v`) ?\r\n\r\nDebian 10 Buster\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3564/comments",
    "author": "asheroto",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2020-08-12T08:43:12Z",
        "body": "@asheroto \r\n\r\nYou need to adjust the maximum number of handles, (`ulimit -n 100000`) or set the third parameter to `0` to close the process pipe. \r\n\r\n```php\r\nnew Swoole\\Process($fn, false, 0);\r\n```\r\n\r\n\r\n\r\n"
      },
      {
        "user": "asheroto",
        "created_at": "2020-08-13T02:08:58Z",
        "body": "Thanks.  Just curious, why would anyone want to leave the process pipe open?\r\n\r\nAlso, does closing the process pipe kill all of Swoole's process pipe or just for that file?  For example, if I have two PHP scripts running at the same time, both using the process pipe, will specifying 0 on the third parameter kill the pipe for both scripts?  Also, if I use a channel to communicate, do other scripts have access to that same channel, or is it only for the current instance of the php script.  So if I have test1.php and test2.php running, can they see each other's channels?\r\n\r\nThanks again, very much appreciated.  :)"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-08-13T06:19:50Z",
        "body": "@asheroto \r\n\r\n1. Pipes are used to communicate between processes. If processes need to communicate with each other, then you need to keep the pipes.\r\n2. Closing the pipes won't kill the process, just like opening a file and then closing the file. In fact, you can also use files for process communication.\r\n3. A Channel can be accessed between two processes, for example:\r\n\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Coroutine;\r\nuse Swoole\\Coroutine\\Channel;\r\nuse Swoole\\Process;\r\n\r\n$chan = new Channel();\r\n\r\n$process = new Process(function () use (&$chan) {\r\n    Coroutine::create(function () use (&$chan) {\r\n        var_dump('process: ' . getmypid());\r\n        $chan->push('data');\r\n    });\r\n});\r\n\r\nCoroutine::create(function () use (&$chan) {\r\n    var_dump('process: ' . getmypid());\r\n    $data = $chan->pop();\r\n    var_dump($data);\r\n});\r\n\r\n$process->start();\r\n$process->wait();\r\n```\r\n\r\nYou can see the following output on my machine:\r\n\r\n```bash\r\nstring(14) \"process: 94399\"\r\nstring(14) \"process: 94400\"\r\nstring(4) \"data\"\r\n```\r\n\r\nHowever, this approach relies on the operating system's write-time replication feature, where memory can be shared between multiple processes. However, there is no guarantee that all operating system versions will support this. It is recommended that a channel be used within a process's coroutine.\r\n"
      },
      {
        "user": "asheroto",
        "created_at": "2020-08-13T12:07:40Z",
        "body": "I see, okay, thank you for your help!"
      }
    ]
  },
  {
    "number": 3156,
    "title": "phpize \u62a5\u9519",
    "created_at": "2020-03-03T10:58:09Z",
    "closed_at": "2020-03-03T11:17:06Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3156",
    "body": "php\u7248\u672c 7.2.26\r\n\u64cd\u4f5c\u7cfb\u7edfcentos7\r\nswoole 4.4.16\r\n\r\nPackage libtool-2.4.2-22.el7_3.x86_64 already installed and latest version\r\nPackage automake-1.13.4-3.el7.noarch already installed and latest version\r\nPackage autoconf-2.69-11.el7.noarch already installed and latest version\r\n\r\n\u9700\u8981\u7684\u8f6f\u4ef6\u90fd\u88c5\u4e86\uff0c\u4f46\u662f\u5728\u6267\u884cphpize\u7684\u65f6\u5019\u4f1a\u62a5\u63aa\u5982\u4e0b\uff1a\r\n\r\n[root@lnp swoole]# phpize\r\nConfiguring for:\r\nPHP Api Version:         20170718\r\nZend Module Api No:      20170718\r\nZend Extension Api No:   320170718\r\nunknown channel 9: _AC_PROG_LIBTOOL is expanded from...\r\naclocal.m4:3326: AC_PROG_LIBTOOL is expanded from...\r\nconfigure.ac:149: the top level])\r\nobsolete at /usr/share/autoconf/Autom4te/Channels.pm line 638.\r\n\tAutom4te::Channels::msg('9: _AC_PROG_LIBTOOL is expanded from...\\x{a}aclocal.m4:3326: AC_P...', 'configure.ac:149', 'warning: The macro `AC_LANG_RESTORE\\' is obsolete.\\x{a}You should...', 'partial', 1) called at /usr/bin/autom4te line 1026\r\n\r\n\r\n\u6c42\u95ee\u89e3\u51b3\u529e\u6cd5\uff0c\u8c22\u8c22",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3156/comments",
    "author": "ezqliin",
    "comments": [
      {
        "user": "huanghantao",
        "created_at": "2020-03-03T11:06:32Z",
        "body": "@ezqliin \u8fd9\u4e2a\u95ee\u9898\u6211\u524d\u51e0\u5929\u9047\u5230\u8fc7\uff0c\u4f60\u662f\u4e0d\u662f\u5728\u865a\u62df\u673a\u91cc\u9762\u8dd1\u7684`phpize`\uff1f"
      },
      {
        "user": "ezqliin",
        "created_at": "2020-03-03T11:08:18Z",
        "body": "@huanghantao \u662f\u7684\uff0cmac\u4e0b\u7528vagrant\u91cc\u8dd1\u7684centos\u3002\u4f46\u662f\u6211\u4e0a\u6b21\u4e5f\u662f\u540c\u6837\u7684centos box\uff0c\u540c\u6837\u7684\u65b9\u6cd5\u5c31\u5b89\u88c5\u6210\u529f\u4e86\u3002\u4e0d\u5c0f\u5fc3\u628a\u90a3\u4e2a\u73af\u5883\u6e05\u7406\u4e86\uff0c\u8fd9\u6b21\u518d\u88c5\u5c31\u4e00\u76f4\u62a5\u8fd9\u4e2a\u9519\u8bef"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-03-03T11:10:38Z",
        "body": "@ezqliin \u4f60\u4e0b\u8f7d\u7684`swoole-src`\u5b58\u653e\u7684\u76ee\u5f55\u4e0d\u5bf9\u3002\u6211\u5f53\u65f6\u9047\u5230\u8fd9\u4e2a\u95ee\u9898\u662f\u56e0\u4e3a\u6211\u628a`swoole-src`\u4e0b\u8f7d\u5728\u4e86\u672c\u673a\u6302\u8f7d\u5728\u865a\u62df\u673a\u7684\u4e00\u4e2a\u76ee\u5f55\u91cc\u9762\u3002\u4f30\u8ba1\u4f60\u4e5f\u662f\u628a`swoole-src`\u4e0b\u8f7d\u5728\u4e86\u9519\u8bef\u7684\u76ee\u5f55\u91cc\u3002"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-03-03T11:11:21Z",
        "body": "@ezqliin \u4f60\u628a`swoole-src`\u79fb\u5230\u865a\u62df\u673a\u7684`/tmp`\u76ee\u5f55\u4e0b\u6267\u884c`phpize`\u8bd5\u8bd5\u3002"
      },
      {
        "user": "ezqliin",
        "created_at": "2020-03-03T11:15:58Z",
        "body": "@huanghantao  \u5367\u69fd \u725b\u903c\uff01\u6211\u60f3\u8d77\u6765\u4e86\uff0c\u6211\u4e0a\u6b21\u662f\u5728\u865a\u62df\u673a\u91cc\u6267\u884c\u7684git \u7136\u540e\u62c9\u53d6\u7684\u76ee\u5f55\u662f\u865a\u62df\u673a\u91cc\u7684\u76ee\u5f55\uff0c\u8fd9\u6b21\u662f\u5728\u5171\u4eab\u76ee\u5f55\u4e2d\u64cd\u4f5c\u7684\uff0c\u73b0\u5728\u53ef\u4ee5\u4e86\uff01\u611f\u8c22\uff01\uff01\uff01"
      },
      {
        "user": "huanghantao",
        "created_at": "2020-03-03T11:17:06Z",
        "body": "@ezqliin \u4e0d\u5ba2\u6c14\u3002\u8fd9\u4e2a\u95ee\u9898\u786e\u5b9e\u633a\u5751\u7684\u3002"
      }
    ]
  },
  {
    "number": 3126,
    "title": "coroutine::list  \u904d\u5386\u5f53\u524d\u8fdb\u7a0b\u4e2d\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0b\u603b\u662f\u591a\u4e00\u4e2a",
    "created_at": "2020-02-21T17:09:44Z",
    "closed_at": "2020-02-22T07:53:35Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3126",
    "body": "```php\r\n<?php\r\n\r\nuse  \\Swoole\\Coroutine;\r\nuse  \\Swoole\\Coroutine\\WaitGroup;\r\nuse  \\Swoole\\Coroutine\\Channel;\r\n\r\nCoroutine::create(function() {\r\n\t\r\n\t$wg=new  WaitGroup();\r\n\t\r\n\t$wg->add(1);\r\n\t//  \u7b2c\u4e00\u6b21\u6253\u5370CoroutineList\uff0c \u4f1a\u8f93\u51fa\u4e3b\u534f\u7a0bID\uff08=1\uff09\r\n\tforeach(Coroutine::list()  as $key=>$Cid){\r\n\t\tvar_dump(\"\u8fdb\u7a0b\u4e2d\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0bID:\".$Cid);\r\n\t}\r\n\t\r\n\tCoroutine::create(function()  use($wg) {\r\n\t\t$Cid=Coroutine::getCid();\r\n\t\tvar_dump(\"A.\u65b0\u542f\u52a8\u534f\u7a0bID\".$Cid);\r\n\t\tCoroutine::sleep(2);\r\n\t\t$wg->done();\r\n\t\t\r\n\t});\r\n\r\n\t$wg->wait();  //  \u7b49\u5f85A\u534f\u7a0b\u8fd0\u884c\u7ed3\u675f\r\n\t\r\n\t\tforeach(Coroutine::list()  as $key=>$Cid){\r\n\t\tvar_dump(\"\u8fdb\u7a0b\u4e2d\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0bID: \".$Cid);   //  \u8fd9\u91cc\u904d\u5386\u7684\u65f6\u5019A\u534f\u7a0b\uff08ID=2\uff09\u4e3a\u4ec0\u4e48\u4f1a\u88ab\u904d\u5386\u51fa\u6765\uff1f\r\n\t}\r\n\t\r\n\t$wg->add(1);\r\n\tCoroutine::create(function()  use($wg) {\r\n\t\t$Cid=Coroutine::getCid();\r\n\t\tvar_dump(\"B.\u65b0\u542f\u52a8\u534f\u7a0bID\".$Cid);\r\n\t\tCoroutine::sleep(2);\r\n\t\t$wg->done();\r\n\t\t\r\n\t});\t\r\n\t$wg->wait();  //  \u7b49\u5f85B\u534f\u7a0b\u8fd0\u884c\u7ed3\u675f\r\n\t\r\n\t\tforeach(Coroutine::list()  as $key=>$Cid){\r\n\t\tvar_dump(\"\u8fdb\u7a0b\u4e2d\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0bID: \".$Cid); //  \u8fd9\u91cc\u904d\u5386\u7684\u65f6\u5019B\u534f\u7a0b\uff08ID=3\uff09\u4e3a\u4ec0\u4e48\u4f1a\u88ab\u904d\u5386\u51fa\u6765\uff1f\r\n\t}\r\n\t\r\n});\r\n\r\n```\r\n\u8fd0\u884c\u4ee5\u4e0a\u4ee3\u7801\uff0c\u7ed3\u679c\uff1a\r\n```php\r\nstring(34) \"\u8fdb\u7a0b\u4e2d\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0bID:1\"\r\nstring(20) \"A.\u65b0\u542f\u52a8\u534f\u7a0bID2\"\r\n\r\nstring(35) \"\u8fdb\u7a0b\u4e2d\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0bID: 2\"   //  \u8fd9\u91cc$wg->wait()  \u7b49\u5f85 A\u534f\u7a0b\uff08ID=2\uff09\u7ed3\u675f\uff0c\u624d\u904d\u5386\u72b6\u6001\uff0c\u4e3a\u4ec0\u4e48A\u534f\u7a0b\u4f1a\u51fa\u73b0\u5728list\u5217\u8868\uff1f\r\n\r\nstring(35) \"\u8fdb\u7a0b\u4e2d\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0bID: 1\"\r\nstring(20) \"B.\u65b0\u542f\u52a8\u534f\u7a0bID3\"\r\n\r\nstring(35) \"\u8fdb\u7a0b\u4e2d\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0bID: 3\"  //  \u8fd9\u91cc$wg->wait()  \u7b49\u5f85 B\u534f\u7a0b\u7ed3\u675f\uff0c\u624d\u904d\u5386\u72b6\u6001\uff0c\u4e3a\u4ec0\u4e48B\u534f\u7a0b\uff08ID=3\uff09\u4f1a\u51fa\u73b0\u5728list\u5217\u8868\uff1f\r\nstring(35) \"\u8fdb\u7a0b\u4e2d\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0bID: 1\"\r\n\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3126/comments",
    "author": "qifengzhang007",
    "comments": [
      {
        "user": "huanghantao",
        "created_at": "2020-02-22T03:58:09Z",
        "body": "@qifengzhang007 \r\n`$wg->done();`\u4f1a\u53d1\u751f\u4e00\u6b21\u534f\u7a0b\u7684\u8c03\u5ea6\uff0c\u4f60\u53ef\u4ee5\u6253\u5370\u8ddf\u8e2a\u4e00\u4e0b\u3002\u6211\u8fd9\u91cc\u6709\u4e00\u4efd\u7b26\u5408\u4f60\u9884\u671f\u7684\u4ee3\u7801\uff1a\r\n\r\n```php\r\n<?php\r\n\r\nuse  \\Swoole\\Coroutine;\r\nuse  \\Swoole\\Coroutine\\WaitGroup;\r\nuse  \\Swoole\\Coroutine\\Channel;\r\n\r\nuse function Co\\run;\r\n\r\nCoroutine::create(function() {\r\n    \r\n    $wg = new WaitGroup();\r\n\r\n    $wg->add(1);\r\n    //  \u7b2c\u4e00\u6b21\u6253\u5370CoroutineList\uff0c \u4f1a\u8f93\u51fa\u4e3b\u534f\u7a0bID\uff08=1\uff09\r\n    foreach(Coroutine::list()  as $key=>$Cid){\r\n        var_dump(\"\u8fdb\u7a0b\u4e2d\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0bID:\".$Cid);\r\n    }\r\n\r\n    Coroutine::create(function()  use($wg) {\r\n        $Cid=Coroutine::getCid();\r\n        var_dump(\"A.\u65b0\u542f\u52a8\u534f\u7a0bID\".$Cid);\r\n        Coroutine::sleep(2);\r\n        var_dump(\"1\");\r\n        $wg->done();\r\n        var_dump(\"2\");\r\n    });\r\n\r\n    var_dump(\"3\");\r\n    $wg->wait();  //  \u7b49\u5f85A\u534f\u7a0b\u8fd0\u884c\u7ed3\u675f\r\n    var_dump(\"4\");\r\n    Coroutine::sleep(0.1);\r\n\r\n    foreach(Coroutine::list()  as $key=>$Cid){\r\n        var_dump(\"\u8fdb\u7a0b\u4e2d\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0bID: \".$Cid);   //  \u8fd9\u91cc\u904d\u5386\u7684\u65f6\u5019A\u534f\u7a0b\uff08ID=2\uff09\u4e3a\u4ec0\u4e48\u4f1a\u88ab\u904d\u5386\u51fa\u6765\uff1f\r\n    }\r\n\r\n    $wg->add(1);\r\n    Coroutine::create(function()  use($wg) {\r\n        $Cid=Coroutine::getCid();\r\n        var_dump(\"B.\u65b0\u542f\u52a8\u534f\u7a0bID\".$Cid);\r\n        Coroutine::sleep(2);\r\n        $wg->done();\r\n    });\t\r\n    $wg->wait();  //  \u7b49\u5f85B\u534f\u7a0b\u8fd0\u884c\u7ed3\u675f\r\n\r\n    Coroutine::sleep(0.1);\r\n\r\n    foreach(Coroutine::list()  as $key=>$Cid){\r\n        var_dump(\"\u8fdb\u7a0b\u4e2d\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0bID: \".$Cid); //  \u8fd9\u91cc\u904d\u5386\u7684\u65f6\u5019B\u534f\u7a0b\uff08ID=3\uff09\u4e3a\u4ec0\u4e48\u4f1a\u88ab\u904d\u5386\u51fa\u6765\uff1f\r\n    }\r\n});\r\n```"
      },
      {
        "user": "twose",
        "created_at": "2020-02-22T04:43:55Z",
        "body": "\u4f60\u53ef\u4ee5\u901a\u8fc7getBackTrace\u6765\u770b\u5230B\u534f\u7a0b\u4ecd\u5904\u4e8e`$wg->done`\u90a3\u4e00\u884c, \u5f53\u4f60\u7684\u4e3b\u534f\u7a0b\u7ed3\u675f\u540e\u624d\u4f1a\u91cd\u65b0\u8fd4\u56de\u5230B\u534f\u7a0b\u5e76\u91ca\u653e\u5b83\r\n"
      },
      {
        "user": "qifengzhang007",
        "created_at": "2020-02-22T07:53:35Z",
        "body": "@huanghantao @twose \r\n\u975e\u5e38\u611f\u8c22\u4e24\u4f4d\uff0c\u679c\u7136\u662f\u5927\u795e\u3002\r\n\u5c24\u5176\u662f@huanghantao \u4f7f\u7528\u4ee3\u7801\u793a\u4f8b\u7684\u65b9\u5f0f\uff0c\u901a\u8fc7\u672c\u4eba\u8fd0\u884c\u5bf9\u6bd4\u7ed3\u679c\uff0c\u5f7b\u5e95\u7406\u89e3\u4e86\u8fd9\u4e2a\u8fc7\u7a0b\u3002"
      }
    ]
  },
  {
    "number": 3052,
    "title": "Can we rely on websocket FD number not being repeated?",
    "created_at": "2020-01-07T17:26:22Z",
    "closed_at": "2020-01-13T11:28:32Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3052",
    "body": "This is a general question, not a bug, so I don't think the issue template applies.\r\n\r\nFor reference, I am using the latest version of swoole with PHP 7.4.0 on Alpine Linux (Docker).\r\n\r\nMy question: When running a websocket server, like so:\r\n\r\n```php\r\n$server = new Swoole\\WebSocket\\Server(\"0.0.0.0\", 9501);\r\n\r\n$server->on('message', function (Swoole\\WebSocket\\Server $server, $frame) \r\n{\r\n    echo \"receive from {$frame->fd}:{$frame->data},opcode:{$frame->opcode},fin:{$frame->finish}\\n\";\r\n    $server->push($frame->fd, \"this is server\");\r\n});\r\n```\r\nis it safe to assume that `$frame->fd` will be the same for messages for the same connection?\r\n\r\nAlso, if a particular `$frame->fd` is re-used, will this only be after an explicit `onClose` event?\r\n\r\nThe background for this question is that we want to allow users to log in via a websocket, and want to check whether it is sufficient to just authenticate users at the start and maintain a list of authenticated FDs on the backend, or whether we need to get the client to send us a session ID/token with every frame.\r\n\r\nThanks!",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3052/comments",
    "author": "osrec",
    "comments": [
      {
        "user": "twose",
        "created_at": "2020-01-09T03:09:31Z",
        "body": "> is it safe to assume that $frame->fd will be the same for messages for the same connection?\r\n\r\nyes, fd is almost never reused (unless it exceeds 16000k)\r\n"
      },
      {
        "user": "osrec",
        "created_at": "2020-01-10T00:24:00Z",
        "body": "Great, thank you! So basically only after FD > 16 million will it repeat?"
      },
      {
        "user": "matyhtf",
        "created_at": "2020-01-12T03:44:18Z",
        "body": "@osrec Yes,  it will skip the fd in use"
      },
      {
        "user": "osrec",
        "created_at": "2020-01-15T00:57:01Z",
        "body": "thanks for your help @matyhtf and @twose :)"
      }
    ]
  },
  {
    "number": 3042,
    "title": "\u534f\u7a0bserver\u4fe1\u53f7\u6355\u83b7\u7684\u7591\u95ee",
    "created_at": "2019-12-27T06:27:54Z",
    "closed_at": "2019-12-27T06:37:38Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/3042",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n\u6211\u5728\u4f7f\u7528\u534f\u7a0b\u7248http server\u65f6\u9700\u8981\u6355\u83b7\u7a0b\u5e8f\u9000\u51fa\u4fe1\u53f7\uff0c\u6bd4\u5982SIGINT/SIGTERM\uff0c\u4f46\u6839\u636e\u6587\u6863\u5e76\u4e0d\u80fd\u5f88\u597d\u7406\u89e3\u5982\u4f55\u4f7f\u7528\uff0c\u4ee5\u4e0b\u662f\u51e0\u4e2a\u5c1d\u8bd5\u7684\u5199\u6cd5\uff0c\u6709\u7684\u80fd\u6355\u83b7\uff0c\u4f46\u4e0d\u4f18\u96c5\uff0c\u6709\u7684\u5c31\u62a5\u9519\u6216\u65e0\u6cd5\u6355\u83b7\r\n\r\n\u2460 \u4f7f\u7528Process::signal()\uff0c\u5728scheduler->start()\u4e4b\u524d\u7ed1\u5b9a\u51fd\u6570\uff0c\u76f4\u63a5\u62a5\u9519\u4e86: eventLoop has already been created\uff0c\u5728start\u4e4b\u540e\u5199\u53c8\u65e0\u6cd5\u6355\u83b7\u4fe1\u53f7\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Coroutine;\r\nuse Swoole\\Coroutine\\Http\\Server;\r\nuse Swoole\\Event;\r\nuse Swoole\\Process;\r\nuse Swoole\\Timer;\r\n\r\n\r\n$scheduler = new Coroutine\\Scheduler();\r\n\r\n$handler = function ($signal) {\r\n    echo 'Caught signal: ' . $signal . PHP_EOL;\r\n\r\n    Event::exit();\r\n};\r\n\r\nProcess::signal(SIGINT, $handler);\r\n\r\n$scheduler->add(function () {\r\n    echo 'Starting server ...' . PHP_EOL;\r\n\r\n    $server = new Server('127.0.0.1', 3003);\r\n    $server->start();\r\n});\r\n\r\n$scheduler->start();\r\n```\r\n\u2461 \u4f7f\u7528pcntl_signal() + pcntl_async_signals(true)\uff0c\u65e0\u6cd5\u6355\u83b7\u4fe1\u53f7\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Coroutine;\r\nuse Swoole\\Coroutine\\Http\\Server;\r\nuse Swoole\\Event;\r\nuse Swoole\\Process;\r\nuse Swoole\\Timer;\r\n\r\n\r\n$scheduler = new Coroutine\\Scheduler();\r\n\r\n$handler = function ($signal) {\r\n    echo 'Caught signal: ' . $signal . PHP_EOL;\r\n\r\n    Event::exit();\r\n};\r\n\r\npcntl_async_signals(true);\r\npcntl_signal(SIGINT, $handler);\r\n\r\n$scheduler->add(function () {\r\n    echo 'Starting server ...' . PHP_EOL;\r\n\r\n    $server = new Server('127.0.0.1', 3003);\r\n    $server->start();\r\n});\r\n\r\n$scheduler->start();\r\n```\r\n\u2462 \u4f7f\u7528pcntl_signal() + pcntl_signal_dispatch() + Timer::tick() \u80fd\u6355\u83b7\u4fe1\u53f7\uff0c\u4f46\u4e0d\u591f\u4f18\u96c5\r\n```php\r\n<?php\r\n\r\nuse Swoole\\Coroutine;\r\nuse Swoole\\Coroutine\\Http\\Server;\r\nuse Swoole\\Event;\r\nuse Swoole\\Process;\r\nuse Swoole\\Timer;\r\n\r\n\r\n$scheduler = new Coroutine\\Scheduler();\r\n\r\n$handler = function ($signal) {\r\n    echo 'Caught signal: ' . $signal . PHP_EOL;\r\n\r\n    Event::exit();\r\n};\r\n\r\npcntl_signal(SIGINT, $handler);\r\n\r\n\r\n$scheduler->add(function () {\r\n    echo 'Starting server ...' . PHP_EOL;\r\n\r\n    Timer::tick(1000, function () {\r\n        pcntl_signal_dispatch();\r\n    });\r\n\r\n    $server = new Server('127.0.0.1', 3003);\r\n    $server->start();\r\n});\r\n\r\n$scheduler->start();\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n\u4f7f\u7528\u67d0\u4e2a\u6700\u4f73\u5b9e\u8df5\u7684\u5199\u6cd5\u5b9e\u73b0\u4fe1\u53f7\u6355\u83b7\u548c\u7a0b\u5e8f\u5e73\u6ed1\u9000\u51fa\r\n\r\n3. What did you see instead?\r\n\r\n\u6240\u4ee5\u6211\u60f3\u77e5\u9053\uff0c\u600e\u6837\u624d\u662f\u7b26\u5408\u6700\u4f73\u5b9e\u8df5\u7684\u5199\u6cd5\uff1f\u6211\u5728\u6587\u6863\u4e2d\u6ca1\u770b\u5230\u76f8\u5173\u4ecb\u7ecd\uff0c\u8c22\u8c22\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\nswoole: 4.4.14\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nphp: 7.4.1\r\ngcc: 7.3.0\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/3042/comments",
    "author": "crystoy",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-12-27T06:37:37Z",
        "body": "```php\r\nuse Swoole\\Coroutine;\r\nuse Swoole\\Coroutine\\Http\\Server;\r\nuse Swoole\\Process;\r\n\r\nCoroutine\\run(function () {\r\n    echo 'Starting server ...' . PHP_EOL;\r\n    $server = new Server('127.0.0.1', 3003);\r\n    Process::signal(SIGINT, function (int $signal) use ($server) {\r\n        echo 'Caught signal: ' . $signal . PHP_EOL;\r\n        $server->shutdown();\r\n    });\r\n    $server->start();\r\n});\r\n\r\n```"
      },
      {
        "user": "crystoy",
        "created_at": "2019-12-27T07:08:11Z",
        "body": "\u5efa\u8bae\u5728\u6587\u6863\u4e2d\u589e\u52a0\u8303\u4f8b\uff08\u6216\u662f\u5df2\u7ecf\u6709\u4e86\uff0c\u6211\u6ca1\u627e\u5230\uff1f\uff09\uff0c\u4ee5\u514d\u50cf\u6211\u8fd9\u6837\u7684\u65b0\u624b\u591a\u8d70\u5f2f\u8def\u548c\u53cd\u590d\u63d0\u95ee\uff0c\u611f\u8c22\u5927\u4f6c"
      },
      {
        "user": "twose",
        "created_at": "2019-12-27T09:03:40Z",
        "body": "\u7a0b\u5e8f\u9aa8\u67b6\u91cc\u5e94\u8be5\u5199\u4e86scheduler\u76f8\u5f53\u4e8emain\u51fd\u6570, \u90a3\u4e48\u6240\u6709\u4ee3\u7801\u7406\u5e94\u653e\u5728scheduler\u4e2d"
      },
      {
        "user": "crystoy",
        "created_at": "2019-12-27T09:10:40Z",
        "body": "\u597d\u7684\uff0c\u4e4b\u524d\u7406\u89e3\u4e0d\u5230\u4f4d\u3002\u8c8c\u4f3c\u5f53\u65f6\u8003\u8651\u7684\u4e00\u4e2a\u95ee\u9898\u662f\u8fdb\u7a0b\u6c60\u4e0d\u80fd\u5728\u534f\u7a0b\u4e2d\u521b\u5efa\uff0c\u6240\u4ee5\u628a\u4fe1\u53f7\u5904\u7406\u5355\u72ec\u62ff\u51fa\u6765\u6253\u7b97\u516c\u7528\u7684...\u73b0\u5728\u52a0\u4e86\u5224\u65ad\u5df2\u7ecf\u5b8c\u7f8e\u89e3\u51b3\u4e86\uff0c\u591a\u8c22"
      }
    ]
  },
  {
    "number": 2905,
    "title": "Socket::recvAll \u83b7\u5f97\u7684\u7ed3\u679c\u548c\u9884\u60f3\u7684\u4e0d\u592a\u4e00\u6837\u3002",
    "created_at": "2019-10-23T05:56:36Z",
    "closed_at": "2019-10-23T08:26:58Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2905",
    "body": "```php\r\n<?php\r\n\r\nuse Swoole\\Process;\r\n\r\n$process = new Process(function (Process $process) {\r\n    $socket = $process->exportSocket();\r\n    $head = $socket->recvAll(4,1);\r\n    var_dump($head);\r\n    $len = unpack('Nlen', $head)['len'];\r\n    var_dump($len);\r\n    $data = $socket->recvAll($len,1);\r\n    var_dump($data);\r\n\r\n    $socket->send('xxxx');\r\n}, false, 2, true);\r\n\r\n$process->start();\r\n\r\nSwoole\\Coroutine\\Run(function () use ($process) {\r\n    $socket = $process->exportSocket();\r\n    $data = 'Hello World.';\r\n    $socket->sendAll(pack('N', strlen($data)) . $data);\r\n    $socket->sendAll(pack('N', strlen($data)) . $data);\r\n    var_dump('send');\r\n    $socket->recv();\r\n});\r\n```\r\n\r\n\u7ed3\u679c\r\n\r\n```\r\n$ php demo.php\r\nstring(4) \"send\"\r\nstring(4) \"\r\n           \"\r\nint(12)\r\nstring(12) \"\r\n            Hello Wo\"\r\n```\r\n\r\n\u9884\u60f3\u7ed3\u679c\u5e94\u8be5\u662f\r\n\r\n```\r\n$ php demo.php\r\nstring(4) \"send\"\r\nstring(4) \"\r\n           \"\r\nint(12)\r\nstring(12) \"Hello World.\"\r\n```\r\n\r\n\u9ebb\u70e6\u5e2e\u5fd9\u770b\u4e00\u4e0b\u3002\u3002\u3002",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2905/comments",
    "author": "limingxinleo",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-10-23T08:26:58Z",
        "body": "pipe type \u8bbe\u7f6e\u4e3a 2 (SOCK_DGRAM) \u6a21\u5f0f\u4e0b, \u4e0d\u662f\u6d41\u5f0f\u4f20\u8f93\u7684, \u76f4\u63a5send\u548crecv\u5373\u53ef"
      },
      {
        "user": "limingxinleo",
        "created_at": "2019-10-23T08:36:34Z",
        "body": "\u602a\u4e0d\u5f97\uff0c\u6211\u600e\u4e48\u770b\u4ee3\u7801\uff0c\u600e\u4e48\u89c9\u5f97\u6ca1\u95ee\u9898\u3002\u3002\u3002"
      }
    ]
  },
  {
    "number": 2854,
    "title": "Swoole\\Timer::tick \u7684\u6267\u884c\u6b21\u6570round\u4e3a\u4f55\u6c38\u8fdc\u90fd\u662f0\uff1f",
    "created_at": "2019-09-25T07:13:45Z",
    "closed_at": "2019-09-25T08:29:00Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2854",
    "body": "\u4e1a\u52a1\u662f\u6839\u636e\u6267\u884c\u6b21\u6570\u81ea\u52a8\u7ec8\u6b62timer\uff0cSwoole\\Timer::info\uff08$timerid\uff09\u6240\u8fd4\u56de\u7684round\u6c38\u8fdc\u90fd\u662f0\uff1f\r\n```\r\n\t$limit_times=5;$interval=3;\r\n\tSwoole\\Timer::tick($interval*1000,function($timerid)use($limit_times){\r\n\t\t$timer_info=Swoole\\Timer::info($timerid);\r\n\t\tvar_dump($timer_info);\r\n\t     $round=$timer_info['round'];\r\n\t\tif($limit_times>0&&$round>=$limit_times){\r\n\t\t\tSwoole\\Timer::clear($timerid);\r\n\t\t}else{\r\n\t\t\techo 'job done by timer'.PHP_EOL;\r\n\t\t}\r\n\t});\r\n```\r\nphp\u7248\u672c\u662f 7.2 \r\n\r\n```\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.4.3\r\nBuilt => Aug 28 2019 17:51:00\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => OpenSSL 1.0.2l  25 May 2017\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2854/comments",
    "author": "15521956291",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-09-25T08:29:00Z",
        "body": "\u8fd9\u4e2around\u4e0d\u662f\u6307tick\u6267\u884c\u4e86\u51e0\u8f6e, \u800c\u662f\u5b9a\u65f6\u5668\u521b\u5efa\u65f6\u5168\u5c40\u4e8b\u4ef6\u5faa\u73af\u662f\u7b2c\u51e0\u8f6e, \u6240\u4ee5\u4f60\u7684\u4f8b\u5b50\u4e2d\u6052\u4e3a0\r\n"
      },
      {
        "user": "15521956291",
        "created_at": "2019-09-25T13:27:06Z",
        "body": "\u90a3\u6709\u6ca1\u6709\u529e\u6cd5\u53ef\u4ee5\u8fc7\u53bb\u5f53\u524d\u5faa\u73af\u7684\u6b21\u6570\uff1f\r\narray(4) {\r\n  [\"exec_msec\"]=>\r\n  int(162)\r\n  [\"interval\"]=>\r\n  int(0)\r\n  [\"round\"]=>\r\n  int(0)\r\n  [\"removed\"]=>\r\n  bool(false)\r\n}\r\n\u8fd9\u4e2a\u8fd4\u56de\u7684\u6570\u7ec4\u6ca1\u6709\u76f8\u5173\u4fe1\u606f\u5462\uff0c\u60f3\u8fd9\u4e2aexec_msec\u4ee3\u8868\u4ec0\u4e48\uff0c\u539f\u672c\u6253\u7b97\u901a\u8fc7\u8fd9\u4e2a\u9664\u4ee5inrerval\u8ba1\u7b97\u6267\u884c\u6b21\u6570\u7684\uff0c\u53ef\u662f\u53d1\u73b0\u5e76\u4e0d\u80fd\u7528\r\n\u8fd8\u6709\uff0c\u8fd9\u4e1c\u897f\u7248\u672c\u66f4\u65b0\u91cc\u9762\u8ddf\u6587\u6863\u91cc\u5c45\u7136\u90fd\u6ca1\u6709\u8bf4\u660e\uff0c\u5199\u66f4\u65b0\u8bb0\u5f55\u8ddf\u6587\u6863\u771f\u7684\u4e0d\u591f\u7528\u5fc3\uff01\r\n"
      },
      {
        "user": "twose",
        "created_at": "2019-09-26T03:07:50Z",
        "body": "\u8fd9\u4e2aAPI\u53ea\u662f\u66b4\u9732\u4e86\u5e95\u5c42\u7684\u4fe1\u606f\u65b9\u4fbfPHP\u5c42\u505a\u8c03\u8bd5\u5668\u7528\u7684\r\n\r\n\u5faa\u73af\u6b21\u6570\u9700\u8981\u81ea\u5df1\u8bb0\u5f55\r\n\r\n\u8981\u4e48\u5c31\u4f7f\u7528README\u91cc\u5199\u7684\u65b9\u6cd5\r\n\r\n```php\r\ngo(function(){\r\n$round = 0;\r\nwhile (true) {\r\n    $round++;\r\n    Co::sleep(0.001);\r\n}\r\n});\r\n```\r\n\r\n"
      },
      {
        "user": "15521956291",
        "created_at": "2019-09-26T03:37:46Z",
        "body": "\u597d\u7684\u8c22\u8c22"
      }
    ]
  },
  {
    "number": 2785,
    "title": "hook+ProcessPool bug",
    "created_at": "2019-08-27T06:06:16Z",
    "closed_at": "2019-08-31T00:19:26Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2785",
    "body": "\u5f00\u542fhook\u534f\u7a0b\u5316\u540e\uff0c\u5728\u8fdb\u7a0b\u6c60\u8fdb\u7a0b\u4e2d\u7684\u534f\u7a0b\u91cc\u6267\u884c\u5982 `file_get_contents`\u3001`sleep` \u88abhook\u7684\u51fd\u6570\u65f6\uff0c\u5c31\u4f1a\u5d29\r\n\r\nSwoole 4.4.3\u30014.4.4\r\n\r\n\u590d\u73b0\u4ee3\u7801\uff1a\r\n```php\r\n<?php\r\n$workerNum = 1;\r\n$pool = new Swoole\\Process\\Pool($workerNum);\r\n\r\n$pool->on(\"WorkerStart\", function ($pool, $workerId) {\r\n    var_dump(1);\r\n    \\Swoole\\Runtime::enableCoroutine(true); // hook \u540e\uff0c\u6267\u884c\u4e0b\u9762\u90a3\u53e5\u8bdd\u5c31\u5d29\r\n    go(function() use($pool, $workerId){\r\n        var_dump(2);\r\n        file_get_contents(__FILE__); // \u6267\u884c\u8fd9\u53e5\u8bdd\u5c31\u5d29\r\n        var_dump(3);\r\n        sleep(1000);\r\n    });\r\n});\r\n\r\n$pool->on(\"WorkerStop\", function ($pool, $workerId) {\r\n    echo \"Worker#{$workerId} is stopped\\n\";\r\n});\r\n\r\n$pool->start();\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2785/comments",
    "author": "Yurunsoft",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2019-08-27T06:28:41Z",
        "body": "\u8bf7\u5728`WorkerStart`\u672b\u5c3e\u6dfb\u52a0\u3000swoole\\event::wait();"
      },
      {
        "user": "Yurunsoft",
        "created_at": "2019-08-27T06:30:20Z",
        "body": "\u597d\u7684\uff0c\u52a0\u4e86\u5c31\u53ef\u4ee5\u4e86\u3002\u4ee5\u524d\u6211\u76f4\u63a5\u5728\u534f\u7a0b\u91cc`\\Swoole\\Event::wait();`\u7684\uff0c\u6700\u8fd1\u7684\u66f4\u65b0\u540e\u597d\u50cf\u5c31\u4e0d\u884c\u4e86"
      },
      {
        "user": "twose",
        "created_at": "2019-08-27T07:41:48Z",
        "body": "\u6784\u9020\u65b9\u6cd5\u6ca1\u5f00\u542fenable_coroutine, \u4e8b\u4ef6\u88ab\u5ffd\u7565\u4e86"
      }
    ]
  },
  {
    "number": 2679,
    "title": "MacOS MoJave10.14.5\u7f16\u8bd1\u5b89\u88c5swoolev4.4.0\u5931\u8d25",
    "created_at": "2019-07-12T07:03:49Z",
    "closed_at": "2019-07-12T13:48:20Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2679",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n```\r\n phpize-7.3.5 \r\n./configure  \r\nsudo make && make install\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n\u6b63\u5e38\u5b89\u88c5swoole\r\n\r\n3. What did you see instead?\r\n\r\n\u5b89\u88c5\u7684\u6269\u5c55\u76ee\u5f55\u4e0d\u662f\u6211\u9884\u671f\u7684\r\n```\r\nInstalling shared extensions:     /usr/lib/php/extensions/no-debug-non-zts-20160303/\r\ncp: /usr/lib/php/extensions/no-debug-non-zts-20160303/#INST@26485#: Permission denied\r\nmake: *** [install-modules] Error 1\r\n```\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\ngit clone\u7684\u6700\u65b0\u7248\u672cv4.4.0\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nOS: MacOS Mojave10.14.5 \uff0c\u5df2\u7ecf\u5173\u6389\u4e86rootless(csrutil disable)\r\nPHP:**\u5305\u542b\u9ed8\u8ba4\u7684php7.1.23 \u8fd8\u6709\u6211\u81ea\u5df1\u5b89\u88c5XAMPP\u5305\u542b\u76847.3.5**\r\n```\r\n$ gcc -v\r\nConfigured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/usr/include/c++/4.2.1\r\nApple LLVM version 10.0.1 (clang-1001.0.46.4)\r\nTarget: x86_64-apple-darwin18.6.0\r\nThread model: posix\r\nInstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin\r\n```\r\n\r\n\r\n\r\n-----------------------------\u5b89\u88c5\u8fc7\u7a0b\uff08\u4f7f\u7528XAMPP\u7684PHP7.3.5\uff09--------------------------\r\n```\r\n$ phpize-7.3.5 .\r\nConfiguring for:\r\nPHP Api Version:         20180731\r\nZend Module Api No:      20180731\r\nZend Extension Api No:   320180731\r\n\r\n$ ./configure\r\nchecking for grep that handles long lines and -e... /usr/bin/grep\r\nchecking for egrep... /usr/bin/grep -E\r\nchecking for a sed that does not truncate output... /usr/bin/sed\r\nchecking for cc... cc\r\nchecking whether the C compiler works... yes\r\nchecking for C compiler default output file name... a.out\r\nchecking for suffix of executables... \r\nchecking whether we are cross compiling... no\r\nchecking for suffix of object files... o\r\nchecking whether we are using the GNU C compiler... yes\r\nchecking whether cc accepts -g... yes\r\nchecking for cc option to accept ISO C89... none needed\r\nchecking how to run the C preprocessor... cc -E\r\nchecking for icc... no\r\nchecking for suncc... no\r\nchecking whether cc understands -c and -o together... yes\r\nchecking for system library directory... lib\r\nchecking if compiler supports -R... no\r\nchecking if compiler supports -Wl,-rpath,... yes\r\nchecking build system type... x86_64-apple-darwin18.6.0\r\nchecking host system type... x86_64-apple-darwin18.6.0\r\nchecking target system type... x86_64-apple-darwin18.6.0\r\nchecking for PHP prefix... /usr\r\nchecking for PHP includes... -I/usr/include/php -I/usr/include/php/main -I/usr/include/php/TSRM -I/usr/include/php/Zend -I/usr/include/php/ext -I/usr/include/php/ext/date/lib\r\nchecking for PHP extension directory... /usr/lib/php/extensions/no-debug-non-zts-20160303\r\nchecking for PHP installed headers prefix... /usr/include/php\r\n....\r\n\r\n```\r\n\r\n\u8fd9\u91cc\u53d1\u73b0\u9ed8\u8ba4\u7528\u7684\u662f\u7cfb\u7edf\u81ea\u5e26\u7684PHP\uff0c\u4ee5\u53ca\u9ed8\u8ba4\u7684\u6269\u5c55\u76ee\u5f55\r\n```\r\nsudo make && make install \r\nBuild complete.\r\nDon't forget to run 'make test'.\r\n....\r\ndsymutil .libs/swoole.so || :\r\ncreating swoole.la\r\n(cd .libs && rm -f swoole.la && ln -s ../swoole.la swoole.la)\r\n/bin/sh /Users/spark/work/downloads/swoole-src/libtool --mode=install cp ./swoole.la /Users/spark/work/downloads/swoole-src/modules\r\ncp ./.libs/swoole.so /Users/spark/work/downloads/swoole-src/modules/swoole.so\r\ncp ./.libs/swoole.lai /Users/spark/work/downloads/swoole-src/modules/swoole.la\r\n----------------------------------------------------------------------\r\nLibraries have been installed in:\r\n   /Users/spark/work/downloads/swoole-src/modules\r\n\r\nIf you ever happen to want to link against installed libraries\r\nin a given directory, LIBDIR, you must either use libtool, and\r\nspecify the full pathname of the library, or use the `-LLIBDIR'\r\nflag during linking and do at least one of the following:\r\n   - add LIBDIR to the `DYLD_LIBRARY_PATH' environment variable\r\n     during execution\r\n\r\nSee any operating system documentation about shared libraries for\r\nmore information, such as the ld(1) and ld.so(8) manual pages.\r\n----------------------------------------------------------------------\r\n\r\n\r\nInstalling shared extensions:     /usr/lib/php/extensions/no-debug-non-zts-20160303/\r\ncp: /usr/lib/php/extensions/no-debug-non-zts-20160303/#INST@26485#: Permission denied\r\nmake: *** [install-modules] Error 1\r\n```\r\n\r\n\r\n\u8bf7\u95ee\u5982\u4f55\u6307\u5b9a\u6211\u81ea\u5df1\u5b89\u88c5\u7684PHP\u8def\u5f84\u53ca\u6269\u5c55\u8def\u5f84\uff0c\u6307\u5b9a\u540e\u53ef\u5426\u89e3\u51b3\u6b64\u95ee\u9898\uff1f\r\n\r\n\u611f\u8c22\uff0c\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2679/comments",
    "author": "sparky1",
    "comments": [
      {
        "user": "phper08",
        "created_at": "2019-07-12T08:07:55Z",
        "body": "\u4e2a\u4eba\u5efa\u8bae\uff1a\r\n1\u3001phpize \u7528\u7edd\u5bf9\u8def\u5f84\uff1b\r\n2\u3001./configure \u52a0\u4e0a --with-phpize= \u52a0\u7edd\u5bf9\u8def\u5f84\r\n3\u3001make \u548c make install \u5206\u5f00\uff0c\u5148 make\uff0c\u7136\u540e sudo make install"
      },
      {
        "user": "sparky1",
        "created_at": "2019-07-12T09:22:33Z",
        "body": "> \u4e2a\u4eba\u5efa\u8bae\uff1a\r\n> 1\u3001phpize \u7528\u7edd\u5bf9\u8def\u5f84\uff1b\r\n> 2\u3001./configure \u52a0\u4e0a --with-phpize= \u52a0\u7edd\u5bf9\u8def\u5f84\r\n> 3\u3001make \u548c make install \u5206\u5f00\uff0c\u5148 make\uff0c\u7136\u540e sudo make install\r\n\r\n\u6211\u7528\u4e86\u7edd\u5bf9\u8def\u5f84\uff0c\u4e5f\u52a0\u4e86\u53c2\u6570\uff0c\u4f46\u8fd8\u662f\u627e\u7684\u7cfb\u7edf\u9ed8\u8ba4\u7684PHP\r\n`$ /Applications/XAMPP/bin/phpize-7.3.5 .\r\nConfiguring for:\r\nPHP Api Version:         20180731\r\nZend Module Api No:      20180731\r\nZend Extension Api No:   320180731\r\n(base) \r\n\r\n$ ./configure --with-phpize=/Applications/XAMPP/bin/phpize-7.3.5\r\nconfigure: WARNING: unrecognized options: --with-phpize\r\nchecking for grep that handles long lines and -e... /usr/bin/grep\r\nchecking for egrep... /usr/bin/grep -E\r\nchecking for a sed that does not truncate output... /usr/bin/sed\r\nchecking for cc... cc\r\nchecking whether the C compiler works... yes\r\nchecking for C compiler default output file name... a.out\r\nchecking for suffix of executables... \r\nchecking whether we are cross compiling... no\r\nchecking for suffix of object files... o\r\nchecking whether we are using the GNU C compiler... yes\r\nchecking whether cc accepts -g... yes\r\nchecking for cc option to accept ISO C89... none needed\r\nchecking how to run the C preprocessor... cc -E\r\nchecking for icc... no\r\nchecking for suncc... no\r\nchecking whether cc understands -c and -o together... yes\r\nchecking for system library directory... lib\r\nchecking if compiler supports -R... no\r\nchecking if compiler supports -Wl,-rpath,... yes\r\nchecking build system type... x86_64-apple-darwin18.6.0\r\nchecking host system type... x86_64-apple-darwin18.6.0\r\nchecking target system type... x86_64-apple-darwin18.6.0\r\nchecking for PHP prefix... /usr\r\nchecking for PHP includes... -I/usr/include/php -I/usr/include/php/main -I/usr/include/php/TSRM -I/usr/include/php/Zend -I/usr/include/php/ext -I/usr/include/php/ext/date/lib\r\nchecking for PHP extension directory... /usr/lib/php/extensions/no-debug-non-zts-20160303\r\nchecking for PHP installed headers prefix... /usr/include/php\r\n...\r\n`"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-07-12T13:48:20Z",
        "body": "php-config \u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\r\n```shell\r\n\r\n./configure --with-php-config=/Applications/XAMPP/bin/php-config\r\n```"
      },
      {
        "user": "sparky1",
        "created_at": "2019-07-15T03:11:27Z",
        "body": "> php-config \u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\r\n> \r\n> ```shell\r\n> ./configure --with-php-config=/Applications/XAMPP/bin/php-config\r\n> ```\r\n\r\n\u53ef\u4ee5\u5566\uff0c\u591a\u8c22\uff01"
      }
    ]
  },
  {
    "number": 2615,
    "title": "How to implement ini_set()",
    "created_at": "2019-06-08T00:36:44Z",
    "closed_at": "2019-06-08T17:59:54Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2615",
    "body": "I have got to set this\r\n     ini_set('session.cookie_httponly',1);\r\n\r\nbut I dont know if this is compatible with swoole registered cookie like\r\n     $res->cookie()\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2615/comments",
    "author": "jobs-git",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-06-08T04:37:46Z",
        "body": "This is a configuration item in FPM\r\n\r\nin Swoole:\r\n```php\r\nfunction Http\\Response->cookie(string $key, string $value = '', int $expire = 0 , string $path = '/', string $domain  = '', bool $secure = false , bool $httponly = false);\r\n```\r\n\r\nThere is no global configuration item\r\n"
      },
      {
        "user": "jobs-git",
        "created_at": "2019-06-08T17:59:54Z",
        "body": "this will do, thanks!"
      }
    ]
  },
  {
    "number": 2569,
    "title": "\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u521b\u5efa\u591a\u4e2a\u534f\u6210\u8bf7\u6c42redis\uff0c\u534f\u6210\u4e0d\u80fd\u6b63\u5e38\u7ed3\u675f\uff1f",
    "created_at": "2019-05-10T03:35:49Z",
    "closed_at": "2019-05-11T05:24:02Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2569",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\r\n### server.php\r\n```php\r\n<?php\r\nrequire_once 'redisPool.php';\r\nextension_loaded('swoole') ? '' : die (\"Please install swoole \");\r\nextension_loaded('redis') ? '' :die (\"Please install redis\");\r\nclass swooleServer{\r\n    private $server = '';\r\n    const LISTENHOST = '0.0.0.0';\r\n    const PORT = 9502;\r\n    private $config = [];\r\n    private $redisPool = '';\r\n\r\n    public function __construct($config = [])\r\n    {\r\n        $this->redisPool = new redisPool(true);\r\n        $this->server = new swoole_server(self::LISTENHOST, self::PORT, SWOOLE_PROCESS, SWOOLE_TCP);\r\n\r\n    }\r\n\r\n    public function onCallback()\r\n    {\r\n        $this->server->on('Receive', [$this, 'onReceive']);\r\n        $this->server->on('WorkerStart', [$this, 'onWorkerStart']);\r\n    }\r\n\r\n    public function onReceive(swoole_server $server, int $fd, int $reactor_id, string $data)\r\n    {\r\n        $data = $this->upack($data);\r\n        $message = $data['message'];\r\n        $this->handel($message);\r\n        $this->send($fd,2000, 'SUCCESS');\r\n    }\r\n\r\n    public function handel($data)\r\n    {\r\n        $type = $data['type'];\r\n        $key = $data['key'];\r\n        $value = intval($data['value']);\r\n\r\n        if ($value >1000) {\r\n            $ms = 1;\r\n            $num = intval($value/1000);\r\n        } else {\r\n            $ms = intval(1000/$value);\r\n            $num = 1;\r\n        }\r\n\r\n        if ($type == 'addSecondTick') {\r\n\r\n            swoole_timer_tick($ms,function($tick_id) use($key,$num,$value) {\r\n                swoole_timer_after(1000*60,function() use($tick_id,$key){\r\n                    swoole_timer_clear($tick_id);\r\n                    $redis = $this->redisPool->getRedis();\r\n                    $redis->del($key);\r\n                    $this->redisPool->relasePool($redis);\r\n                });\r\n\r\n                    $redis = $this->redisPool->getRedis();\r\n                    $now = $redis->get($key);\r\n                    if ($now < $value) {\r\n                        $redis->incrBy($key,$num);\r\n                    }\r\n                    $this->redisPool->relasePool($redis);\r\n\r\n\r\n\r\n            });\r\n\r\n        }\r\n        return;\r\n    }\r\n    public function upack($message)\r\n    {\r\n\r\n        $type = substr($message, 0,2);\r\n        $length = substr($message,2,4);\r\n        $message = substr($message,6);\r\n        $type = unpack('n', $type);\r\n        $length = unpack('N', $length);\r\n        return ['type'=>$type[1],'length'=>$length[1],'message'=>json_decode($message, true)];\r\n    }\r\n\r\n    public function send($fd, $code, $message)\r\n    {\r\n        $data['code'] = $code;\r\n        $data['message'] = $message;\r\n        $this->server->send($fd, json_encode($data));\r\n    }\r\n\r\n    public function setConfig()\r\n    {\r\n        $this->config  = [\r\n            'worker_num' =>2,\r\n            'dispatch_mode'=>2,\r\n            'open_length_check' => true,\r\n            'package_max_length' => 10*1024,\r\n            'package_length_type' => 'N',\r\n            'package_length_offset' => 2,\r\n            'package_body_offset' => 6,\r\n            'daemonize' =>0\r\n        ];\r\n    }\r\n\r\n    public function onWorkerStart(swoole_server $server, int $worker_id)\r\n    {\r\n\r\n    }\r\n\r\n    public function getRedis()\r\n    {\r\n        if (isset($this->server->redis)) {\r\n            if ($this->server->redis->ping() == 'pong') return $this->server->redis;\r\n        }\r\n        $this->server->redis = new \\Redis();\r\n        $this->server->redis->connect('127.0.0.1', 6379);\r\n        return $this->server->redis;\r\n    }\r\n\r\n\r\n\r\n    public function start()\r\n    {\r\n        $this->setConfig();\r\n        $this->server->set($this->config);\r\n        $this->onCallback();\r\n        $this->server->start();\r\n    }\r\n\r\n\r\n    public function pack($message)\r\n    {\r\n\r\n    }\r\n}\r\n$server = new swooleServer();\r\n$server->start();\r\n```\r\n\r\n### redisPool.php\r\n```php\r\n<?php\r\n/**\r\n * Created by PhpStorm.\r\n * User: shenyang.qiu\r\n * Date: 2019/5/9\r\n * Time: 15:21\r\n */\r\nclass redisPool {\r\n    const host = '127.0.0.1';\r\n    const port = 6379;\r\n    public $maxnum = 100;\r\n    public $nownum = 0;\r\n    public $pool = [];\r\n    public $coroutine = false;\r\n    public function __construct($coroutine = false)\r\n    {\r\n        $this->pool = new SplQueue();\r\n        $this->coroutine = $coroutine;\r\n    }\r\n\r\n    public function getRedis()\r\n    {\r\n        if ($this->pool->count()) {\r\n            return $this->pool->pop();\r\n        } else {\r\n            try {\r\n                if ($this->nownum >$this->maxnum) {\r\n                    $timeout = 1;\r\n                    while ($timeout) {\r\n                        co::sleep(0.05);\r\n                        $timeout = $timeout -0.05;\r\n                        if($this->pool->count()) {\r\n                            return $this->pool->pop();;\r\n                        }\r\n                    }\r\n                    return false;\r\n                } else {\r\n                    if ($this->coroutine) {\r\n                        $redis = new \\Swoole\\Coroutine\\Redis();\r\n                    } else {\r\n                        $redis = new \\Redis();\r\n                    }\r\n\r\n                    $this->nownum  ++;\r\n                    $redis->connect(self::host,self::port);\r\n\r\n                    return $redis;\r\n                }\r\n            } catch (RedisException $exception) {\r\n                return false;\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    public function relasePool($redis)\r\n    {\r\n        return $this->pool->push($redis);\r\n    }\r\n}\r\n```\r\n\r\n### client.php\r\n```php\r\n<?php\r\n/**\r\n * Created by PhpStorm.\r\n * User: shenyang.qiu\r\n * Date: 2019/4/29\r\n * Time: 11:35\r\n */\r\nrequire_once 'redisPool.php';\r\n$redisPool = new redisPool();\r\n$atomic = new \\Swoole\\Atomic();\r\nfor ($i = 0; $i < 200; $i++) {\r\n    go(function() use($redisPool,$atomic) {\r\n\r\n            $redis = $redisPool->getRedis();\r\n            $num = $redis->get('test');\r\n            var_dump($num);\r\n            if ($num === null || $num === false) {\r\n                $redis->set('test',0);\r\n                $client = new \\Swoole\\Client(SWOOLE_SOCK_TCP);\r\n                $client->connect('127.0.0.1', 9502);\r\n                $data['type'] = 'addSecondTick';\r\n                $data['key'] = 'test';\r\n                $data['value'] = 100;\r\n                $message = json_encode($data);\r\n                $length = strlen($message);\r\n                $client->send(pack('nN', 1, $length) . $message);\r\n                $msg = $client->recv();\r\n                $client->close();\r\n\r\n            } else {\r\n                if ($num > 0) {\r\n\r\n                    $redis->decr('test');\r\n\r\n                } else {\r\n\r\n                }\r\n            }\r\n\r\n    });\r\n}\r\nvar_dump('\u603b\u5171\u8c03\u7528\u4e86:');\r\nvar_dump($atomic->get());\r\n```\r\n\r\n\r\n\r\n2. What did you expect to see?\r\n\u5f53\u8fd0\u884c\u5b8cclient.php\u7684\u65f6\u5019\u5e94\u8be5\u80fd\u6b63\u5e38\u9000\u51fa\r\n\r\n\r\n3. What did you see instead?\r\n\u8fd0\u884c\u5b8c\u4e0d\u80fd\u6b63\u5e38\u9000\u51fa\uff0c\u4e0d\u77e5\u9053\u5361\u5728\u54ea\u91cc\u4e86\u3002 \u5f53\u628aclitent.php\u4e2d\u7684\u6539\u6210\u5faa\u73af100\u6b21\u5c31\u80fd\u6b63\u5e38\u9000\u51fa\uff0c\u8fd9\u662f\u4e3a\u4ec0\u4e48\uff1f\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.3.1\r\nBuilt => Mar 15 2019 13:09:57\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\u4f7f\u7528\u7684\u662fwin10\u5b50\u7cfb\u7edf\r\n\r\nPHP 7.1.29-1+ubuntu18.04.1+deb.sury.org+1 (cli) (built: May  3 2019 09:51:29) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.1.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.1.29-1+ubuntu18.04.1+deb.sury.org+1, Copyright (c) 1999-2018, by Zend Technologies\r\n\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/7/lto-wrapper\r\nOFFLOAD_TARGET_NAMES=nvptx-none\r\nOFFLOAD_TARGET_DEFAULT=1\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu 7.3.0-27ubuntu1~18.04' --with-bugurl=file:///usr/share/doc/gcc-7/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-7 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 7.3.0 (Ubuntu 7.3.0-27ubuntu1~18.04)\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2569/comments",
    "author": "qiushengyang",
    "comments": [
      {
        "user": "huanghantao",
        "created_at": "2019-05-10T04:57:16Z",
        "body": "@qiushengyang \u4f60\u4ee3\u7801\u7684\u903b\u8f91\u95ee\u9898\uff0c\u95ee\u9898\u51fa\u5728\u4e86`getRedis`\u8fd9\u4e2a\u51fd\u6570\u7684\r\n```php\r\nwhile ($timeout) {\r\n                        co::sleep(0.05);\r\n                        $timeout = $timeout -0.05;\r\n                        if($this->pool->count()) {\r\n                            return $this->pool->pop();;\r\n                        }\r\n                    }\r\n```\r\n\u9677\u5165\u4e86\u6b7b\u5faa\u73af\u3002"
      },
      {
        "user": "qiushengyang",
        "created_at": "2019-05-10T05:03:47Z",
        "body": "\u540e\u6765\u6211\u4e5f\u53d1\u73b0\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u7b2c\u4e00\u4e2a\u5c31\u662f\u8fd9\u4e2a$timeout\u51fa\u73b0\u7cbe\u5ea6\u95ee\u9898\u4e0d\u80fd\u9000\u51fa\u5faa\u73af\uff0c\u8fd8\u6709\u4e00\u4e2a\u5c31\u662f\u524d\u7aef\u6ca1\u6709\u56de\u6536redis\u5bf9\u8c61  \u8c22\u8c22\u6307\u51fa\r\n\r\n> @qiushengyang \u4f60\u4ee3\u7801\u7684\u903b\u8f91\u95ee\u9898\uff0c\u95ee\u9898\u51fa\u5728\u4e86`getRedis`\u8fd9\u4e2a\u51fd\u6570\u7684\r\n> \r\n> ```\r\n> while ($timeout) {\r\n>                         co::sleep(0.05);\r\n>                         $timeout = $timeout -0.05;\r\n>                         if($this->pool->count()) {\r\n>                             return $this->pool->pop();;\r\n>                         }\r\n>                     }\r\n> ```\r\n> \r\n> \u9677\u5165\u4e86\u6b7b\u5faa\u73af\u3002\r\n\r\n\u540e\u6765\u6211\u4e5f\u53d1\u73b0\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u7b2c\u4e00\u4e2a\u5c31\u662f\u8fd9\u4e2a$timeout\u51fa\u73b0\u7cbe\u5ea6\u95ee\u9898\u4e0d\u80fd\u9000\u51fa\u5faa\u73af\uff0c\u8fd8\u6709\u4e00\u4e2a\u5c31\u662f\u524d\u7aef\u6ca1\u6709\u56de\u6536redis\u5bf9\u8c61  \u8c22\u8c22\u6307\u51fa\r\n"
      },
      {
        "user": "huanghantao",
        "created_at": "2019-05-10T05:05:29Z",
        "body": "\u4e0d\u5ba2\u6c14"
      },
      {
        "user": "qiushengyang",
        "created_at": "2019-05-10T05:07:05Z",
        "body": "> \u4e0d\u5ba2\u6c14\r\n\r\n\u8bf7\u6559\u4e00\u4e0b\u6211\u8fd9\u4e2a\u9650\u901f\u4ee4\u724c\u6876\u8fd9\u4e2aserver\u8fd9\u4e48\u5199\u5408\u9002\u4e48"
      },
      {
        "user": "twose",
        "created_at": "2019-05-11T05:24:01Z",
        "body": "`while ($timeout > 0)`, \u592a\u57fa\u7840\u4e86"
      }
    ]
  },
  {
    "number": 2534,
    "title": "Connection gets outdated data.",
    "created_at": "2019-04-27T14:27:23Z",
    "closed_at": "2019-04-28T15:25:30Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2534",
    "body": "Hi! I have an issue with Swoole WebSocket Server. I created an object to use Swoole Server. Here is the constructor: \r\n\r\n`public function __construct()\r\n    {\r\n        $this->serverWS = new Swoole\\WebSocket\\Server(\"192.168.56.2\", 9502);\r\n        \r\n        $this->serverWS->on('open', \r\n            function(Server $serverWS, Request $request) \r\n            {\r\n                $this->onConnection($request);\r\n            }\r\n        );\r\n\r\n        $this->serverWS->on('message', \r\n            function(Server $serverWS, Frame $frame)\r\n            {\r\n                $this->onMessage($frame);\r\n            }\r\n        );\r\n\r\n        $this->serverWS->on('close',\r\n            function(Server $serverWS, int $fd)\r\n            {\r\n                $this->onClose($fd);\r\n            }\r\n        );\r\n\r\n        $this->serverWS->on('workerStart',\r\n            function(Server $serverWS)\r\n            {\r\n                $this->onWorkerStart($this->serverWS);\r\n            }\r\n        );\r\n\r\n        $this->serverWS->start();\r\n    }`\r\n\r\nAlso, I have a desktop client written in Python (I start it with Linux terminal). Connection is established by the following example:\r\n\r\n`if __name__ == \"__main__\":\r\n    websocket.enableTrace(True)\r\n    ws = websocket.WebSocketApp(\"ws://192.168.56.2:9502\",\r\n                            on_message = on_message,\r\n                            on_error = on_error,\r\n                            on_close = on_close,\r\n                            header   = {\r\n                                'User-Agent: RaspberryPi/3B+' + ' ' + str(os.uname()), \r\n                                'Access-Token: ' + generate_token()\r\n                            }\r\n    )\r\n    ws.on_open = on_open\r\n    ws.run_forever()`\r\n\r\nWhat I do on server side is set current Python connection ID (I'm defining a Python client by the certain request header) to private property of my custom WebsocketServer object (this property is equal 0 by default). And by triggering onClose event I set this property to 0 again. If this property is not 0 and the same client tries to establish the connection, server closes it.\r\nI do this because i need to identify this client and have only one instance of it's connection.\r\n\r\nAnd the problem is that I can have two connections at the same time (two terminal windows with started clients). If there's three or more clients - all works fine: server closes connections.\r\n\r\nI tried to debug and what I noticed is when the first PythonClient connection triggers, WebsocketServer sets ID property from 0 to 1 (and I can easily read this property and it will surely be equal 1). Then I'm running the second PythonClient and what i got on server is 0 ID property again, which will be setted to 2...\r\nThe third connection (and following ones) get ID that is equal 1, untill I'm keeping first connection opened. (As it should be)\r\n\r\nThis is so strange. I have no any idea why this happens. Please, tell me what I'm doing wrong!\r\n\r\nMy Swoole version is:\r\n`php --ri swoole\r\n\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.3.1\r\nBuilt => Mar 22 2019 11:50:29\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.1.0g  2 Nov 2017\r\nhttp2 => enabled\r\npcre => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n`\r\n\r\nMy Linux kernel is:\r\n`Linux elephant 4.15.0-47-generic #50-Ubuntu SMP Wed Mar 13 10:44:52 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux`\r\n\r\nMy PHP version is:\r\n`PHP 7.2.17-0ubuntu0.18.04.1 (cli) (built: Apr 18 2019 14:12:38) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.2.17-0ubuntu0.18.04.1, Copyright (c) 1999-2018, by Zend Technologies`\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2534/comments",
    "author": "shumichenko",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-04-28T06:19:46Z",
        "body": "I can only tell you the following points due to my poor English language proficiency:\r\n1. The server is asynchronous, multiple requests may be processed at the same time\r\n2. Server use multi-process mode by default, you can try `new Swoole\\WebSocket\\Server(\"192.168.56.2\", 9502, SWOOLE_BASE);` to make it be a single process Server\r\n"
      },
      {
        "user": "shumichenko",
        "created_at": "2019-04-28T15:25:00Z",
        "body": "> I can only tell you the following points due to my poor English language proficiency:\r\n> \r\n> 1. The server is asynchronous, multiple requests may be processed at the same time\r\n> 2. Server use multi-process mode by default, you can try `new Swoole\\WebSocket\\Server(\"192.168.56.2\", 9502, SWOOLE_BASE);` to make it be a single process Server\r\n\r\nThanks, it's working now!"
      }
    ]
  },
  {
    "number": 2479,
    "title": "request \u56de\u8c03\u4e2d\u5f02\u5e38\u9000\u51fa\u65f6  4.2.10 \u7248\u672c\u4f1a\u56de\u8c03 register_shutdown_function \u51fd\u6570,  \u4f464.2.11\u4e4b\u540e\u5c31\u4e0d\u4f1a\u56de\u8c03 register_shutdown_function",
    "created_at": "2019-04-03T08:45:16Z",
    "closed_at": "2019-04-03T09:37:23Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2479",
    "body": "\r\nrequest \u56de\u8c03\u4e2d\u5f02\u5e38\u9000\u51fa\u65f6\r\n\r\n4.2.10 \u7248\u672c\u4f1a\u56de\u8c03 register_shutdown_function \u51fd\u6570,  \u4f464.2.11\u4e4b\u540e\u5c31\u4e0d\u4f1a\u56de\u8c03 register_shutdown_function\r\n\r\n\u6d4b\u8bd5\u7a0b\u5e8f:\r\n```php\r\n<?php\r\n$http = new swoole_http_server(\"0.0.0.0\", 9501, SWOOLE_BASE);\r\n\r\nregister_shutdown_function ( function  ()\r\n{\r\n    echo \"===================================\\n\";\r\n    echo \"== do register_shutdown_function ==\\n\";\r\n    echo \"===================================\\n\";\r\n});\r\n\r\n$http->on('request', function ($req, $resp) {\r\n\r\n    //\u8ba9\u7a0b\u5e8f\u5f02\u5e38\u9000\u51fa\r\n    $s= new \\XXX();\r\n\r\n});\r\n\r\n$http->start();\r\n\r\n```\r\n\r\nVersion => 4.2.10\r\n\r\n\u6b63\u5e38\u6709\u56de\u8c03\u5230:  do register_shutdown_function \r\n\r\n\u5b83\u7684\u8f93\u51fa:\r\n```\r\nPHP Fatal error:  Uncaught Error: Class 'XXX' not found in /home/jim/server.php:20\r\nStack trace:\r\n#0 {main}\r\n  thrown in /home/jim/server.php on line 20\r\n===================================\r\n== do register_shutdown_function == \r\n===================================\r\n[2019-04-03 16:34:05 *3827.0]   ERROR   zm_deactivate_swoole (ERROR 503): Fatal error: Uncaught Error: Cl\r\nass 'XXX' not found in /home/jim/server.php:20                                                          \r\nStack trace:\r\n#0 {main}\r\n  thrown in /home/jim/server.php on line 20.\r\n```\r\n\r\nVersion => 4.2.11\r\n\r\n\u6ca1\u6709 \u5f02\u5e38\u9000\u51fa \u6ca1\u6709\u56de\u8c03\u5230:  register_shutdown_function \r\n\r\n\r\n\u5b83\u7684\u8f93\u51fa:\r\n```\r\nlocalhost:~$ php server.php \r\nPHP Fatal error:  Uncaught Error: Class 'XXX' not found in /home/jim/server.php:20\r\nStack trace:\r\n#0 {main}\r\n  thrown in /home/jim/server.php on line 20\r\n\r\n```\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2479/comments",
    "author": "xcwen",
    "comments": [
      {
        "user": "xcwen",
        "created_at": "2019-04-03T08:57:55Z",
        "body": "\r\n\r\n\u73af\u5883\r\nlocalhost:~/vipthink_core(master)$ php -v\r\nPHP 7.2.4-1+b1 (cli) (built: May 12 2018 13:03:02) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.2.4-1+b1, Copyright (c) 1999-2018, by Zend Technologies\r\n\r\n"
      },
      {
        "user": "twose",
        "created_at": "2019-04-03T09:11:04Z",
        "body": "\u534f\u7a0b\u5185\u51fa\u73b0\u672a\u5904\u7406\u7684\u5f02\u5e38\u4f1a\u76f4\u63a5\u5bfc\u81f4\u8fdb\u7a0bbailout, \u65e0\u6cd5\u7ee7\u7eed\u56de\u8c03shutdown\u51fd\u6570\r\n\u539f\u5148swoole\u7684\u867d\u7136\u4f1a\u56de\u8c03, \u4f46\u662f\u53ef\u80fd\u4f1a\u4ea7\u751f\u4e0d\u53ef\u9884\u671f\u7684\u9519\u8bef\r\n\r\n\u540e\u7eed\u7248\u672c\u53ef\u80fd\u4f1a\u6539\u6210\u534f\u7a0b\u5185\u6709\u672a\u6355\u83b7\u5f02\u5e38, \u53ea\u4f1a\u5bfc\u81f4\u534f\u7a0b\u9000\u51fa\r\n\u4f46\u81f4\u547d\u9519\u8bef\u4ecd\u4f1a\u5bfc\u81f4\u4e0d\u53ef\u9006\u8f6c\u7684\u8fdb\u7a0b\u9000\u51fa"
      },
      {
        "user": "xcwen",
        "created_at": "2019-04-03T09:29:06Z",
        "body": "\u90a3 .\u600e\u4e48\u622a\u83b7 \u7c7b\u4f3c\"\u7c7b\u4e0d\u5b58\u5728\"\u7684\u9519\u8bef.\r\n\r\n```php\r\n$http->on('request', function ($req, $resp) {\r\n\r\n    //\u8ba9\u7a0b\u5e8f\u5f02\u5e38\u9000\u51fa\r\n    try{\r\n        $s= new \\XXX();\r\n    }catch (\\Exception $e) {\r\n        echo \"111111111111111111\\n\";\r\n    }\r\n\r\n});\r\n```\r\n\u8fd8\u662f\u65e0\u6cd5\u622a\u83b7:<\r\n\r\n\u6211\u60f3\u5728\u8fd9\u662f, \u8fd4\u56de\u9519\u8bef\u7ed9\u524d\u7aef,\u800c\u4e0d\u662f\u4ec0\u4e48\u90fd\u6ca1\u6709\u8fd4\u56de.\r\n"
      },
      {
        "user": "twose",
        "created_at": "2019-04-03T09:37:20Z",
        "body": "\u4f60\u76f4\u63a5`class_exists`\u4e0d\u5c31\u597d\u4e86, \u53ef\u4ee5\u7528catch (Error $e)"
      },
      {
        "user": "xcwen",
        "created_at": "2019-08-31T09:28:57Z",
        "body": "\u8fd9\u6837\u53ef\u4ee5\u622a\u83b7\r\n\r\n$http->on('request', function ($req, $resp) {\r\n\r\n    //\u8ba9\u7a0b\u5e8f\u5f02\u5e38\u9000\u51fa\r\n    try{\r\n        $s= new \\XXX();\r\n    }catch (\\Error $e) {  // not Exception \r\n        echo \"111111111111111111\\n\";\r\n    }\r\n\r\n});"
      }
    ]
  },
  {
    "number": 2427,
    "title": "\u4e00\u4e2a\u7531max_request \u5bfc\u81f4\u7684\u5f02\u5e38",
    "created_at": "2019-03-12T13:58:23Z",
    "closed_at": "2019-03-13T02:23:05Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2427",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\nA\u6587\u4ef6\uff1a\r\n```\r\n<?php\r\n$http = new Swoole\\Http\\Server(\"127.0.0.1\", 9501);\r\n$http->set([\r\n        \"worker_num\"=>1,\r\n        \"max_request\"=>10\r\n]);\r\n$http->on('request', function ($request, $response) {\r\n        $cli = new Swoole\\Coroutine\\Http\\Client('127.0.0.1', 9502);\r\n        $cli->setHeaders([\r\n                'Host' => \"localhost\",\r\n                \"User-Agent\" => 'Chrome/49.0.2587.3',\r\n                'Accept' => 'text/html,application/xhtml+xml,application/xml',\r\n                'Accept-Encoding' => 'gzip',\r\n        ]);\r\n        $cli->set([ 'timeout' => 1]);\r\n        $cli->get('/');\r\n        echo $cli->body;\r\n        $cli->close();\r\n        $response->end(\"<h1>9501 Hello Swoole. #\".rand(1000, 9999).\"</h1>\");\r\n});\r\n$http->start();\r\n```\r\n\r\nB\u6587\u4ef6:\r\n```\r\n<?php\r\n$http = new Swoole\\Http\\Server(\"127.0.0.1\", 9502);\r\n$http->set([\r\n        \"worker_num\"=>1,\r\n        \"max_request\"=>1000\r\n]);\r\n$http->on('request', function ($request, $response) {\r\n    $response->end(\"<h1>Hello Swoole. #\".rand(1000, 9999).\"</h1>\");\r\n});\r\n$http->start();\r\n```\r\n\r\n\u542f\u52a8\u540e\uff0c\u8bf7\u6c42A\u670d\u52a1\uff0cA\u670d\u52a1\u903b\u8f91\u4f1a\u53d1\u9001\u4e00\u4e2a\u8bf7\u6c42\u5230B\u670d\u52a1\u3002\r\n\u6d4b\u8bd5\u65f6\u76f4\u63a5curl \u8bf7\u6c42A\u670d\u52a1\u7aef\u53e3\u3002\r\n\r\n2. What did you expect to see?\r\n\u670d\u52a1\u8bbe\u7f6emax_request\u4e3a10\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\u5e94\u8be5\u90fd\u662f\u6b63\u5e38\u8bf7\u6c42\u3002A\u670d\u52a110\u6b21\u8bf7\u6c42\u540e\u81ea\u52a8\u9000\u51faworker\u5e76\u4e14\u7528\u53e6\u5916\u4e00\u4e2aworker\u66ff\u4ee3\u3002\r\n\r\n\r\n3. What did you see instead?\r\n\u4f46curl\u7b2c\u5341\u6b21\u8bf7\u6c42\u65f6\u5361\u4f4f\u4e0d\u8fd4\u56de\u3002\u5982\u679c\u5c06A\u670d\u52a1\u6539\u6210SWOOLE_BASE\u6a21\u5f0f\uff0c\u4f1a\u5bfc\u81f4\u8fd4\u56decurl: (52) Empty reply from server\r\n\u7b2c\u5341\u4e00\u6b21\u8bf7\u6c42\u6b63\u5e38\u3002\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n\r\n```\r\nswoole\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.3.0\r\nBuilt => Mar 12 2019 21:45:06\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nopenssl => OpenSSL 1.0.1j 15 Oct 2014\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n```\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\ngcc version 4.8.5 20150623 (Red Hat 4.8.5-4) (GCC) \r\nlinux\u7248\u672c\uff1a3.10.104\r\nphp :\r\n```\r\nPHP 7.2.1 (cli) (built: Jan 11 2018 19:22:45) ( NTS )\r\nCopyright (c) 1997-2017 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2017 Zend Technologies\r\n```\r\n\r\n\u7f16\u8bd1\u65f6\u4fee\u6539\u4e86\uff1a\r\n\u53bb\u6389 SW_HTTP_100_CONTINUE \u6ce8\u91ca",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2427/comments",
    "author": "hemin3260",
    "comments": [
      {
        "user": "hemin3260",
        "created_at": "2019-03-13T02:22:17Z",
        "body": " reload_async => true \u53ef\u4ee5\u907f\u514d"
      },
      {
        "user": "twose",
        "created_at": "2019-03-13T06:36:22Z",
        "body": "\u6ca1\u5f00\u542f\u5f02\u6b65\u5b89\u5168\u91cd\u542f\u7279\u6027 \u670d\u52a1\u5f3a\u5236\u88ab\u5173\u95ed \u5bfc\u81f4\u8bf7\u6c42\u65e0\u6cd5\u5904\u7406"
      }
    ]
  },
  {
    "number": 2413,
    "title": "\u5173\u4e8edefer\u6a21\u5f0f\u4e0b\u534f\u7a0bhttp\u5ba2\u6237\u7aef\u8bbe\u7f6e\u8d85\u65f6\u7684\u4e00\u70b9\u7591\u95ee",
    "created_at": "2019-03-08T02:22:53Z",
    "closed_at": "2019-03-12T04:48:19Z",
    "labels": [
      "question",
      "good question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2413",
    "body": "\u6211\u8d774\u4e2a\u534f\u7a0bhttp\u5ba2\u6237\u7aef\uff0c\u8bbe\u7f6e\u8d85\u65f6\u4e3a10s\uff0c\u53d1post\u8bf7\u6c42(\u5373Coroutine\\Http\\Client->post\uff0c\u5e76set([ 'timeout' => 10 ]))\uff0c\u7ed3\u679c\u8fc7\u4e8640s\u624d\u8fd4\u56de\uff0c\u662f\u4e0d\u662f\u5e94\u8be510s\u8fd4\u56de\u5462\uff1f\r\n\r\n\u4e0b\u9762\u662f\u7248\u672c\u4fe1\u606f\uff1a\r\nCentOS Linux release 7.3.1611 (Core) \r\n\r\nPHP 7.2.15 (cli) (built: Mar  1 2019 11:41:54) ( NTS )\r\nCopyright (c) 1997-2018 The PHP Group\r\nZend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies\r\n    with Zend OPcache v7.2.15, Copyright (c) 1999-2018, by Zend Technologies\r\n\r\nSwoole => enabled\r\nAuthor => Swoole Team <team@swoole.com>\r\nVersion => 4.2.13\r\nBuilt => Mar  1 2019 11:43:30\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu_affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nasync_redis => enabled\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.display_errors => On => On\r\nswoole.use_shortname => On => On\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2413/comments",
    "author": "kant712",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-03-10T03:47:43Z",
        "body": "\u56db\u4e2aHTTP\u5ba2\u6237\u7aef\u4e32\u884c\u4e86, \u8d77\u56db\u4e2a\u534f\u7a0b\u5e76\u53d1\u6267\u884c\u624d\u4f1a\u662f10s"
      },
      {
        "user": "shenzhe",
        "created_at": "2019-03-10T09:37:54Z",
        "body": "\u4ee3\u7801\u7247\u6bb5\u8d34\u51fa\u6765"
      },
      {
        "user": "kant712",
        "created_at": "2019-03-10T11:03:52Z",
        "body": "\u4e0b\u8ff0\u4ee3\u7801\u5de5\u4f5c\u7b26\u5408\u9884\u671f\uff0c\u603b\u8017\u65f63s\uff1a\r\n```\r\n<?php\r\n$http = new Swoole\\Http\\Server( \"127.0.0.1\" , 9501 );\r\n$http->on( \"request\" , function( $request , $response )\r\n{\r\n    $c1 = new Swoole\\Coroutine\\Http\\Client( '1.1.1.1' , 8081 );\r\n    $c1->set( [ 'timeout' => 5 ] );\r\n    $c1->setDefer();\r\n    $c1->post( '/sleep' , [\r\n        'time' => 3000 , //\u8be5\u670d\u52a1\u8fc73s\u8fd4\u56de\r\n    ] );\r\n    $c2 = new Swoole\\Coroutine\\Http\\Client( '1.1.1.1' , 8081 );\r\n    $c2->set( [ 'timeout' => 5 ] );\r\n    $c2->setDefer();\r\n    $c2->post( '/sleep' , [\r\n        'time' => 3000 ,\r\n    ] );\r\n    $c1->recv();\r\n    $c2->recv();\r\n    $response->end( $c1->body . $c2->body );\r\n} );\r\n$http->start();\r\n```\r\n\u4e0b\u8ff0\u4ee3\u7801\u6d4b\u8bd5\u7684\u662f\u670d\u52a1\u5668\u7aef\u53e3\u4e0d\u53ef\u8fbe\u7684\u60c5\u5f62\uff0c\u8017\u65f610s\uff1a\r\n```\r\n<?php\r\n$http = new Swoole\\Http\\Server( \"127.0.0.1\" , 9501 );\r\n$http->on( \"request\" , function( $request , $response )\r\n{\r\n    $c1 = new Swoole\\Coroutine\\Http\\Client( '2.2.2.2' , 8081 ); //\u7aef\u53e3\u4e0d\u53ef\u8fbe\r\n    $c1->set( [ 'timeout' => 5 ] );\r\n    $c1->setDefer();\r\n    $c1->post( '/sleep' , [\r\n        'time' => 10000 ,\r\n    ] );\r\n    $c2 = new Swoole\\Coroutine\\Http\\Client( '2.2.2.2' , 8081 ); //\u7aef\u53e3\u4e0d\u53ef\u8fbe\r\n    $c2->set( [ 'timeout' => 5 ] );\r\n    $c2->setDefer();\r\n    $c2->post( '/sleep' , [\r\n        'time' => 10000 ,\r\n    ] );\r\n    $c1->recv();\r\n    $c2->recv();\r\n    $response->end( $c1->body . $c2->body );\r\n} );\r\n$http->start();\r\n```\r\n\r\n\u4e0b\u8ff0\u4ee3\u7801\u6d4b\u8bd5\u7684\u662f\u670d\u52a1\u5668\u7aef\u53e3\u53ef\u8fbe\uff0c\u4f46\u662f\u5728\u6307\u5b9a\u8d85\u65f6\u65f6\u95f4\u5185\u4e0d\u8fd4\u56de\u7684\u60c5\u5f62\uff0c\u8017\u65f610s\uff1a\r\n```\r\n<?php\r\n$http = new Swoole\\Http\\Server( \"127.0.0.1\" , 9501 );\r\n$http->on( \"request\" , function( $request , $response )\r\n{\r\n    $c1 = new Swoole\\Coroutine\\Http\\Client( '1.1.1.1' , 8081 ); //\u7aef\u53e3\u53ef\u8fbe\r\n    $c1->set( [ 'timeout' => 5 ] );\r\n    $c1->setDefer();\r\n    $c1->post( '/sleep' , [\r\n        'time' => 10000 ,\r\n    ] );\r\n    $c2 = new Swoole\\Coroutine\\Http\\Client( '1.1.1.1' , 8081 ); //\u7aef\u53e3\u53ef\u8fbe\r\n    $c2->set( [ 'timeout' => 5 ] );\r\n    $c2->setDefer();\r\n    $c2->post( '/sleep' , [\r\n        'time' => 10000 ,\r\n    ] );\r\n    $c1->recv();\r\n    $c2->recv();\r\n    $response->end( $c1->body . $c2->body );\r\n} );\r\n$http->start();\r\n```"
      },
      {
        "user": "kant712",
        "created_at": "2019-03-12T01:10:52Z",
        "body": "> \u56db\u4e2aHTTP\u5ba2\u6237\u7aef\u4e32\u884c\u4e86, \u8d77\u56db\u4e2a\u534f\u7a0b\u5e76\u53d1\u6267\u884c\u624d\u4f1a\u662f10s\r\n\r\n\u4ee3\u7801\u5df2\u8d34\uff0c\u9ebb\u70e6\u5e2e\u5fd9\u770b\u770b\uff0c\u8c22\u8c22\uff01"
      },
      {
        "user": "kant712",
        "created_at": "2019-03-12T01:11:02Z",
        "body": "> \u4ee3\u7801\u7247\u6bb5\u8d34\u51fa\u6765\r\n\r\n\u4ee3\u7801\u5df2\u8d34\uff0c\u9ebb\u70e6\u5e2e\u5fd9\u770b\u770b\uff0c\u8c22\u8c22\uff01"
      },
      {
        "user": "twose",
        "created_at": "2019-03-12T04:47:13Z",
        "body": "defer\u6a21\u5f0f\u662f\u652f\u6301\u5e76\u53d1\u6536\u5305(recv), \u800c\u4f60\u6b64\u5904\u5361\u5728\u4e86\u8fde\u63a5\u9636\u6bb5, \u5e76\u4e0d\u80fd\u901a\u8fc7defer\u7279\u6027\u5e76\u53d1\u8fde\u63a5\r\ndefer\u6a21\u5f0f\u5e76\u4e0d\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u7279\u6027, \u53ea\u662f\u4e00\u4e2a\u6709\u7f3a\u9677\u7684\u5386\u53f2\u4ea7\u7269, \u4f60\u9700\u8981\u4f7f\u7528CSP\u7684\u7f16\u7a0b\u6a21\u5f0f\r\n```php\r\ngo(function () {\r\n    $s = microtime(true);\r\n    $chan = new Co\\Channel;\r\n    for ($n = 2; $n--;) {\r\n        go(function () use ($chan) {\r\n            $cli = new Co\\Http\\Client('2.2.2.2', 8081); //\u7aef\u53e3\u4e0d\u53ef\u8fbe\r\n            $cli->set(['timeout' => 1]);\r\n            $cli->get('/');\r\n            $chan->push($cli);\r\n        });\r\n    }\r\n    for ($n = 2; $n--;) {\r\n        $result = $chan->pop();\r\n        var_dump($result->errMsg);\r\n    }\r\n    var_dump(microtime(true) - $s);\r\n});\r\n```"
      },
      {
        "user": "kant712",
        "created_at": "2019-03-12T05:07:05Z",
        "body": "> defer\u6a21\u5f0f\u662f\u652f\u6301\u5e76\u53d1\u6536\u5305(recv), \u800c\u4f60\u6b64\u5904\u5361\u5728\u4e86\u8fde\u63a5\u9636\u6bb5, \u5e76\u4e0d\u80fd\u901a\u8fc7defer\u7279\u6027\u5e76\u53d1\u8fde\u63a5\r\n> defer\u6a21\u5f0f\u5e76\u4e0d\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u7279\u6027, \u53ea\u662f\u4e00\u4e2a\u6709\u7f3a\u9677\u7684\u5386\u53f2\u4ea7\u7269, \u4f60\u9700\u8981\u4f7f\u7528CSP\u7684\u7f16\u7a0b\u6a21\u5f0f\r\n> \r\n> ```\r\n> go(function () {\r\n>     $s = microtime(true);\r\n>     $chan = new Co\\Channel;\r\n>     for ($n = 2; $n--;) {\r\n>         go(function () use ($chan) {\r\n>             $cli = new Co\\Http\\Client('2.2.2.2', 8081); //\u7aef\u53e3\u4e0d\u53ef\u8fbe\r\n>             $cli->set(['timeout' => 1]);\r\n>             $cli->get('/');\r\n>             $chan->push($cli);\r\n>         });\r\n>     }\r\n>     for ($n = 2; $n--;) {\r\n>         $result = $chan->pop();\r\n>         var_dump($result->errMsg);\r\n>     }\r\n>     var_dump(microtime(true) - $s);\r\n> });\r\n> ```\r\n\r\n\u5b66\u4e60\u4e86\uff0c\u6211\u518d\u8bd5\u8bd5\uff0c\u8c22\u8c22\uff01"
      }
    ]
  },
  {
    "number": 2389,
    "title": "\u5404\u4f4d\u5927\u795e\u5e2e\u5fd9\u770b\u4e0b\u8fd9\u4e2a\u662f\u4e0d\u662fswoole\u7684\u4e00\u4e2abug",
    "created_at": "2019-02-26T10:07:32Z",
    "closed_at": "2019-02-26T10:27:19Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2389",
    "body": "\u8bf7\u95ee\u4e0b\u6211\u5728swoole\\server\u4e2d\u65b0\u589e\u76d1\u542c\u4e00\u4e2a\u7aef\u53e3,\u542f\u7528\u4e86websocket\u534f\u8bae\u89e3\u6790.\u5728onOpen\u7684\u56de\u8c03\u4e2d\u62ff\u5230\u7684server\u5bf9\u8c61\u4e3a\u4ec0\u4e48\u662fswoole\\server\u5bf9\u8c61\u800c\u4e0d\u662fwebsocket\\server\u5bf9\u8c61,\u800c\u5728onMessage\u56de\u8c03\u4e2d\u62ff\u5230\u7684\u5374\u662fwebsocket\\server\u5bf9\u8c61,\u6309\u7406\u6765\u8bf4\u5728onOpen\u56de\u8c03\u4e2d\u7684server\u5bf9\u8c61\u4e0d\u5e94\u8be5\u662fwebsocket\\server\u5bf9\u8c61\u5417?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2389/comments",
    "author": "xyzj91",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-02-26T10:11:05Z",
        "body": "\u6ca1\u529e\u6cd5\u5347\u7ea7Server\u5bf9\u8c61, \u53ea\u80fd\u5148\u4f7f\u7528Websocket\\Server\u7136\u540e\u589e\u52a0tcp\u7684\u7aef\u53e3"
      },
      {
        "user": "xyzj91",
        "created_at": "2019-02-26T10:15:11Z",
        "body": "> \u6ca1\u529e\u6cd5\u5347\u7ea7Server\u5bf9\u8c61, \u53ea\u80fd\u5148\u4f7f\u7528Websocket\\Server\u7136\u540e\u589e\u52a0tcp\u7684\u7aef\u53e3\r\n\r\n\u597d\u5427,\u4e5f\u53ea\u80fd\u5148\u8fd9\u6837\u5b9e\u73b0\u4e86"
      }
    ]
  },
  {
    "number": 2384,
    "title": "\u8fdb\u5165redis\u534f\u7a0b\u5ba2\u6237\u7aef\u4e4b\u540e\u534f\u7a0bid\u4e0d\u4e00\u81f4",
    "created_at": "2019-02-25T06:49:56Z",
    "closed_at": "2019-02-26T01:43:11Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2384",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a simple script for reproducing the error.\r\n\u76d1\u542conRequest\u65b9\u6cd5\uff0cdisPatch\u8c03\u7528redis\u534f\u7a0b\u5ba2\u6237\u7aef\u6267\u884c\u4e86\u4e00\u6b21incr\u64cd\u4f5c\r\n```php\r\n$register->set($register::onRequest,function (\\swoole_http_request $request,\\swoole_http_response $response)use($dispatcher){\r\n            $request_psr = new Request($request);\r\n            $response_psr = new Response($response);\r\n            try{\r\n                EasySwooleEvent::onRequest($request_psr,$response_psr);\r\n                        file_put_contents(\"/tmp/ee.log\", \"put1\\t\" . SERVER_NAME . \"\\t\" . Coroutine::getUid() . \"\\t\" . var_export($response_psr,true) . \"\\n\", FILE_APPEND);\r\n                    $dispatcher->dispatch($request_psr,$response_psr);\r\n            file_put_contents(\"/tmp/ee.log\", \"put2\\t\" . SERVER_NAME . \"\\t\" . Coroutine::getUid() . \"\\t\" . var_export($response_psr, true) . \"\\n\", FILE_APPEND);\r\n}\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n\u534f\u7a0bid\u4e00\u81f4\r\n\r\n3. What did you see instead?\r\n```php\r\nput1    Demo    52641   EasySwoole\\Core\\Http\\Response::__set_state(array(\r\n   'response' =>\r\n  Swoole\\Http\\Response::__set_state(array(\r\n     'fd' => 52640,\r\n     'header' => NULL,\r\n     'cookie' => NULL,\r\n     'trailer' => NULL,\r\n  )),\r\n   'sendFile' => NULL,\r\n   'isEndResponse' => 0,\r\n   'statusCode' => 200,\r\n   'reasonPhrase' => 'OK',\r\n   'cookies' =>\r\n  array (\r\n  ),\r\n   'protocolVersion' => '1.1',\r\n   'headers' =>\r\n  array (\r\n  ),\r\n   'body' => NULL,\r\n))\r\nput2    Demo    52632   EasySwoole\\Core\\Http\\Response::__set_state(array(\r\n   'response' =>\r\n  Swoole\\Http\\Response::__set_state(array(\r\n     'fd' => 52631,\r\n     'header' =>\r\n    array (\r\n      'Content-Type' => 'application/json;charset=utf-8',\r\n    ),\r\n     'cookie' => NULL,\r\n     'trailer' => NULL,\r\n  )),\r\n   'sendFile' => NULL,\r\n   'isEndResponse' => 2,\r\n   'statusCode' => 200,\r\n   'reasonPhrase' => 'OK',\r\n   'cookies' =>\r\n  array (\r\n  ),\r\n   'protocolVersion' => '1.1',\r\n   'headers' =>\r\n  array (\r\n    'Content-type' =>\r\n    array (\r\n      0 => 'application/json;charset=utf-8',\r\n    ),\r\n  ),\r\n   'body' => NULL,\r\n))\r\n```\r\n\u534f\u7a0bid\u548creponse fd\u4e0d\u4e00\u81f4\r\n\r\n\r\n4. What version of Swoole are you using (show your `php --ri swoole`)?\r\n4.2.10\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ?\r\n\r\nkernel  Linux version 3.10.106\r\nphp 7.1\r\ngcc 4.8.5",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2384/comments",
    "author": "highwayliu",
    "comments": [
      {
        "user": "mabu233",
        "created_at": "2019-02-25T08:00:51Z",
        "body": "\u6211\u8bb0\u5f97\u4f60\u5728es\u7fa4\u8bf4\u8fc7\u8fd9\u662f\u538b\u6d4b\u65f6\u51fa\u73b0\u7684\uff0c\u9ad8\u5e76\u53d1\u7684\u65f6\u5019\u4e24\u4e2a file_put_contents\u4e4b\u95f4\u53ef\u80fd\u4f1a\u6709\u53e6\u4e00\u4e2a\u8bf7\u6c42\u7684file_put_contents\u63d2\u5165\uff0c\u8fd9\u4e0d\u662f\u5f88\u6b63\u5e38\u5417\uff1f"
      },
      {
        "user": "highwayliu",
        "created_at": "2019-02-25T08:05:52Z",
        "body": "> \u6211\u8bb0\u5f97\u4f60\u5728es\u7fa4\u8bf4\u8fc7\u8fd9\u662f\u538b\u6d4b\u65f6\u51fa\u73b0\u7684\uff0c\u9ad8\u5e76\u53d1\u7684\u65f6\u5019\u4e24\u4e2a file_put_contents\u4e4b\u95f4\u53ef\u80fd\u4f1a\u6709\u53e6\u4e00\u4e2a\u8bf7\u6c42\u7684file_put_contents\u63d2\u5165\uff0c\u8fd9\u4e0d\u662f\u5f88\u6b63\u5e38\u5417\uff1f\r\n\r\n\u662f\u591a\u8f6e\u9ad8\u5e76\u53d1\u4e4b\u540e\u505c\u6b62\u7b56\u7565\uff0c\u5355\u72ec\u53d1\u4e00\u4e2acurl\uff0c\u4f1a\u51fa\u73b0\u8fd9\u6837\u7684\u60c5\u51b5\uff0c\u8fd9\u65f6\u5019swoole\u7684\u65e5\u5fd7\u663e\u793a\u56de\u5305\u56de\u4e0d\u51fa\u53bb\uff0c\u8fde\u63a5\u5df2\u65ad\u5f00\u3002\r\n[2019-02-25 15:18:54 *30295.0]\tNOTICE\tswFactoryProcess_finish (ERROR 1005): connection[fd=9172] does not exists.\r\n[2019-02-25 15:18:54 *30295.0]\tNOTICE\tswFactoryProcess_finish (ERROR 1005): connection[fd=9173] does not exists.\r\n[2019-02-25 15:18:54 *30295.0]\tNOTICE\tswFactoryProcess_finish (ERROR 1005): connection[fd=9174] does not exists.\r\n"
      },
      {
        "user": "highwayliu",
        "created_at": "2019-02-25T08:06:41Z",
        "body": "> \u6211\u8bb0\u5f97\u4f60\u5728es\u7fa4\u8bf4\u8fc7\u8fd9\u662f\u538b\u6d4b\u65f6\u51fa\u73b0\u7684\uff0c\u9ad8\u5e76\u53d1\u7684\u65f6\u5019\u4e24\u4e2a file_put_contents\u4e4b\u95f4\u53ef\u80fd\u4f1a\u6709\u53e6\u4e00\u4e2a\u8bf7\u6c42\u7684file_put_contents\u63d2\u5165\uff0c\u8fd9\u4e0d\u662f\u5f88\u6b63\u5e38\u5417\uff1f\r\n\r\n\u5347\u7ea7\u4e3a4.2.13 \u5728\u540c\u6837\u7684\u591a\u8f6e\u538b\u6d4b\u7b56\u7565\u4e4b\u540e\uff0c\u6ca1\u53d1\u73b0\u8fd9\u6837\u7684\u95ee\u9898"
      },
      {
        "user": "matyhtf",
        "created_at": "2019-02-26T01:43:11Z",
        "body": "\u8bf4\u660e\u8fd9\u662f\u4e0d\u540c\u7684\u8bf7\u6c42\u3002\u6240\u4ee5\u534f\u7a0bID\u4e0d\u4e00\u6837\u3002"
      }
    ]
  },
  {
    "number": 2312,
    "title": "Coroutine Channel question",
    "created_at": "2019-01-14T05:07:54Z",
    "closed_at": "2019-01-14T05:16:26Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2312",
    "body": "```php\r\n// a.php\r\n$chan = new \\Swoole\\Coroutine\\Channel();\r\ngo(function () use ($chan) {\r\n    $chan->push(1);\r\n//    $chan->push(2);\r\n});\r\n// php a.php\r\n// \u6267\u884c\u5b8c\u9000\u51fa\r\n\r\n// a.php\r\n$chan = new \\Swoole\\Coroutine\\Channel();\r\ngo(function () use ($chan) {\r\n    $chan->push(1);\r\n    $chan->push(2);\r\n});\r\n// php a.php\r\n// \u4e3a\u4ec0\u4e48\u4f1a\u963b\u585e\r\n\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2312/comments",
    "author": "lizhichao",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-01-14T05:09:43Z",
        "body": "\u56e0\u4e3a\u901a\u9053\u5bb9\u91cf\u53ea\u67091, \u7b2c\u4e8c\u6b21push\u4f1a\u6302\u8d77"
      },
      {
        "user": "lizhichao",
        "created_at": "2019-01-14T05:16:26Z",
        "body": "3q "
      }
    ]
  },
  {
    "number": 2304,
    "title": "\u540c\u6b65\u6a21\u5f0f\u4e0b\uff0c\u7b49\u5f85\u67d0\u4e2a\u534f\u7a0b\u7ed3\u675f\u518d\u54cd\u5e94\uff0c\u600e\u4e48\u5904\u7406\u5462\uff1fchan\u53ea\u80fd\u5728\u534f\u7a0b\u91cc\u7528",
    "created_at": "2019-01-10T07:27:28Z",
    "closed_at": "2019-01-11T03:49:04Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2304",
    "body": "",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2304/comments",
    "author": "thinkcmf",
    "comments": [
      {
        "user": "twose",
        "created_at": "2019-01-10T08:01:40Z",
        "body": "\u628a\u5168\u5c40\u4ee3\u7801\u5305\u5230\u534f\u7a0b\u91cc\u4f7f\u7528"
      },
      {
        "user": "windrunner414",
        "created_at": "2019-01-10T10:14:18Z",
        "body": "\u5728\u534f\u7a0b\u5185\u54cd\u5e94"
      },
      {
        "user": "thinkcmf",
        "created_at": "2019-01-10T12:42:55Z",
        "body": "> \u628a\u5168\u5c40\u4ee3\u7801\u5305\u5230\u534f\u7a0b\u91cc\u4f7f\u7528\r\n\r\n\u4e3b\u8981\u662f\u4e0d\u60f3\u5927\u6539\u539f\u6709\u9879\u76ee\u7684\u903b\u8f91\uff0c\u53c8\u60f3\u4f7f\u7528\u534f\u7a0b"
      },
      {
        "user": "thinkcmf",
        "created_at": "2019-01-10T13:00:13Z",
        "body": "\u5176\u5b9e\u7ed9\u5f53\u524d worker\u52a0\u4e2a\u6807\u8bb0\u522b\u63a5\u53d7\u65b0\u7684\u8bf7\u6c42\u5c31\u53ef\u4ee5\u4e86"
      },
      {
        "user": "windrunner414",
        "created_at": "2019-01-10T15:29:44Z",
        "body": "```\r\nfunction onRequest($request, $response) {\r\n    go(function () use (&$request, &$response) {\r\n        // do something...\r\n        $response->end();\r\n    });\r\n}\r\n```\r\n\u8fd9\u6837\u8bd5\u8bd5\u5462\uff1f\r\n\u800c\u4e14\u5305\u5728\u534f\u7a0b\u91cc\u4e5f\u65e0\u9700\u6539\u903b\u8f91\u5440"
      },
      {
        "user": "thinkcmf",
        "created_at": "2019-01-11T02:13:38Z",
        "body": "> ```\r\n> function onRequest($request, $response) {\r\n>     go(function () use (&$request, &$response) {\r\n>         // do something...\r\n>         $response->end();\r\n>     });\r\n> }\r\n> ```\r\n> \u8fd9\u6837\u8bd5\u8bd5\u5462\uff1f\r\n> \u800c\u4e14\u5305\u5728\u534f\u7a0b\u91cc\u4e5f\u65e0\u9700\u6539\u903b\u8f91\u5440\r\n\r\n\u539f\u6709\u903b\u8f91\u91cc\u6709\u5f88\u591a\u9759\u6001\u53d8\u91cf\u548c\u9759\u6001\u5c5e\u6027\uff0c\u653e\u534f\u7a0b\u91cc\uff0c\u5982\u679c\u534f\u7a0b\u91cc\u6709\u963b\u585e\u4ee3\u7801\uff0c\u534f\u7a0b\u5c31\u4f1a\u6302\u8d77\uff0c\u7136\u540e\u65b0\u8bf7\u6c42\u65f6\u6765\uff0c\u9759\u6001\u53d8\u91cf\u548c\u9759\u6001\u5c5e\u6027\u5c31\u53ef\u80fd\u4f1a\u88ab\u8986\u76d6"
      },
      {
        "user": "twose",
        "created_at": "2019-01-11T02:19:10Z",
        "body": "\u4f60\u8fd9\u79cd\u60c5\u51b5, \u540c\u6b65\u548c\u5f02\u6b65\u4e00\u8d77\u4f7f\u7528, \u6ca1\u6709\u610f\u4e49, \u4f1a\u4ea7\u751f\u9519\u8bef"
      },
      {
        "user": "thinkcmf",
        "created_at": "2019-01-11T02:25:45Z",
        "body": "> \u4f60\u8fd9\u79cd\u60c5\u51b5, \u540c\u6b65\u548c\u5f02\u6b65\u4e00\u8d77\u4f7f\u7528, \u6ca1\u6709\u610f\u4e49, \u4f1a\u4ea7\u751f\u9519\u8bef\r\n\r\n\u5176\u5b9e\u5c31\u662f\u8ba9 worker \u53ea\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\uff0c\u8fd9\u4e2a\u8bf7\u6c42\u5904\u7406\u5b8c\uff0c\u518d\u63a5\u7740\u5904\u7406\u65b0\u7684\u8bf7\u6c42\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u62c5\u5fc3\uff0c\u9759\u6001\u53d8\u91cf\u88ab\u8986\u76d6\u4e86\u3002\r\n\r\n```\r\nfunction onRequest($request, $response) {\r\n     // \u8fd9\u91cc\u6807\u8bb0 worker \u522b\u63a5\u53d7\u65b0\u8bf7\u6c42\u4e86\r\n\r\n    go(function () use (&$request, &$response) {\r\n        // do something...\r\n        // \u8fd9\u91cc\u53ef\u4ee5\u5f00\u5fc3\u5730\u4f7f\u7528\u534f\u7a0b\u4e86\r\n        $response->end();\r\n        // \u8bf7\u6c42\u5904\u7406\u5b8c,\u544a\u8bc9worker\u53ef\u4ee5\u63a5\u53d7\u65b0\u8bf7\u6c42\u4e86\r\n    });\r\n\r\n}\r\n```\r\n\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u8ba9\u5f88\u591a\u8001\u7a0b\u5e8f\u4f7f\u7528\u4e0a\u534f\u7a0b\uff0c\u611f\u89c9\u53ef\u4ee5\u662f\u534a\u5f02\u6b65\u534a\u540c\u6b65\u4e86"
      },
      {
        "user": "twose",
        "created_at": "2019-01-11T02:28:26Z",
        "body": "\u90a3\u4e3a\u4ec0\u4e48\u8981\u7528\u534f\u7a0b?.."
      },
      {
        "user": "thinkcmf",
        "created_at": "2019-01-11T02:34:01Z",
        "body": "> \u90a3\u4e3a\u4ec0\u4e48\u8981\u7528\u534f\u7a0b?..\r\n\r\n```\r\nfunction onRequest($request, $response)\r\n{\r\n    // \u8fd9\u91cc\u6807\u8bb0 worker \u522b\u63a5\u53d7\u65b0\u8bf7\u6c42\u4e86\r\n    \r\n    go(function () use (&$request, &$response) {\r\n        // do something...\r\n        //\u5e76\u53d1\u8bf7\u6c42 n\r\n        $n = 5;\r\n        for ($i = 0; $i < $n; $i++) {\r\n            $cli = new Swoole\\Coroutine\\Http\\Client('127.0.0.1', 80);\r\n            $cli->setHeaders([\r\n                'Host'            => \"local.ad.oa.com\",\r\n                \"User-Agent\"      => 'Chrome/49.0.2587.3',\r\n                'Accept'          => 'text/html,application/xhtml+xml,application/xml',\r\n                'Accept-Encoding' => 'gzip',\r\n            ]);\r\n            $cli->set(['timeout' => 2]);\r\n            $cli->setDefer();\r\n            $cli->get('/test.php');\r\n            $clients[] = $cli;\r\n        }\r\n\r\n        for ($i = 0; $i < $n; $i++) {\r\n            $r        = $clients [$i]->recv();\r\n            $result[] = $clients[$i]->body;\r\n        }\r\n        $response->end(json_encode($data));\r\n\r\n        // \u8bf7\u6c42\u5904\u7406\u5b8c,\u544a\u8bc9worker\u53ef\u4ee5\u63a5\u53d7\u65b0\u8bf7\u6c42\u4e86\r\n    });\r\n\r\n}\r\n```\r\n\r\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u4f7f\u7528\u534f\u7a0b\u5e76\u53d1\u5904\u7406\u6b64\u7c7b\u95ee\u9898\uff0c\u540c\u65f6\u4e5f\u4e0d\u5f71\u54cd\u8001\u4ee3\u7801"
      },
      {
        "user": "thinkcmf",
        "created_at": "2019-01-11T02:42:14Z",
        "body": "\u53ea\u8981\u80fd\u6807\u8bb0 worker \u662f\u5426\u63a5\u53d7\u65b0\u8bf7\u6c42\u7684\u5f00\u5173\uff0c\u8fd9\u79cd\u60f3\u6cd5\u611f\u89c9\u8fd8\u662f\u6709\u610f\u4e49\u7684\uff0c\u81f3\u5c11\u6bd4\u5168\u540c\u6b65\u597d\u70b9"
      },
      {
        "user": "twose",
        "created_at": "2019-01-11T02:44:28Z",
        "body": "\u5f00\u542f\u534f\u7a0b, \u505a\u4e00\u4e2a\u5168\u5c40\u7684channel, \u7136\u540e\u5411\u91cc\u9762push([$request, $response]), \u7136\u540e\u5355\u72ec\u5f00\u4e00\u4e2a\u534f\u7a0b, pop\u51fa\u6765, \u9010\u4e2a\u5904\u7406."
      },
      {
        "user": "thinkcmf",
        "created_at": "2019-01-11T03:26:23Z",
        "body": "> \u5f00\u542f\u534f\u7a0b, \u505a\u4e00\u4e2a\u5168\u5c40\u7684channel, \u7136\u540e\u5411\u91cc\u9762push([$request, $response]), \u7136\u540e\u5355\u72ec\u5f00\u4e00\u4e2a\u534f\u7a0b, pop\u51fa\u6765, \u9010\u4e2a\u5904\u7406.\r\n\r\n\u611f\u8c22\uff0c\u5b8c\u7f8e\u89e3\u51b3\u4e86\r\n"
      }
    ]
  },
  {
    "number": 2162,
    "title": "[bug]\u5728\u5b9a\u65f6\u5668\u4e2d\u521b\u5efa\u5b50\u7a0b\u5e8f\u4f1a\u76f4\u63a5\u53d8\u6210\u50f5\u5c38",
    "created_at": "2018-11-29T06:38:24Z",
    "closed_at": "2018-11-29T10:53:51Z",
    "labels": [
      "question",
      "coroutine",
      "good question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2162",
    "body": "timer \u672c\u8eab\u662f\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u6258\u7ba1\u5728manager\u4e0b\u3002\r\n\u770b\u5b98\u65b9\u6587\u6863\uff0c\u597d\u50cf\u8bf4 start\u4f1a\u6e05\u9664\u7236\u8fdb\u7a0b\u7684 timer\uff0c\u4f46\u662f\u6211\u8fd9\u4e2atimer\u53ef\u4ee5\u4e00\u76f4\u6253\u5370log\uff0c\u4f46\u662f\u5b59\u8fdb\u7a0b\u521b\u5efa\u51fa\u6765\u5c31\u662f\u50f5\u5c38\uff08\u5b83\u7684\u7236\u8fdb\u7a0b\u662f\u8fd9\u4e2atimer\u8fdb\u7a0b\uff0c\u800ctimer\u8fdb\u7a0b\u6ca1\u6b7b\uff09\r\n\r\n\u8bf4\u660e\uff1a\u521b\u5efa\u5b59\u8fdb\u7a0b\u65f6\u65e0\u62a5\u9519\uff0c\u6210\u529f\u8fd4\u56depid\u3002\u5b59\u8fdb\u7a0b\u91cc\u7684 exec \u4e0d\u4f1a\u6709\u9519\uff0c\u8ddf\u5b83\u6ca1\u5173\uff0c\u5199\u4ec0\u4e48\u90fd\u8fd9\u6837\u3002\r\n\r\n```php\r\n<?php\r\n\r\nnamespace Pkg\\Swoola\\Components\\Swoole\\Process;\r\n\r\ntrait QueueWorkerTrait\r\n{\r\n    protected $queueWorkerPids = [];\r\n\r\n    public function addQueueWorker()\r\n    {\r\n        $self = $this;\r\n        $process = new \\Swoole\\Process(function(\\Swoole\\Process $worker) {\r\n            \\Pkg\\Swoola\\set_process_name('swoola - timer process ');\r\n            \\Swoole\\Process::signal(SIGCHLD, function($sig) {\r\n                // \u5fc5\u987b\u4e3afalse\uff0c\u975e\u963b\u585e\u6a21\u5f0f\r\n                while($ret = \\Swoole\\Process::wait(false)) {\r\n                    echo \"PID={$ret['pid']}\\n\";\r\n                }\r\n            });\r\n\r\n            swoole_timer_tick(1000, function() {\r\n                if (!$this->queueWorkerPids) {\r\n                    $this->createQueueWorker();\r\n                } else {\r\n                    foreach ($this->queueWorkerPids as $idx => $pid) {\r\n                        $current_time = date('H:i:s');\r\n                        if (\\Swoole\\Process::kill($pid, 0)) {\r\n                            echo \"PID[{$pid}] is alived({$current_time}).\\n\";\r\n                        } else {\r\n                            echo \"PID[{$pid}] is died.\\n\";\r\n                            unset($this->queueWorkerPids[$idx]);\r\n                            $this->createQueueWorker($idx);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        });\r\n\r\n        $this->server->addProcess($process);\r\n        // $process->start();\r\n    }\r\n\r\n    protected function createQueueWorker($idx = null)\r\n    {\r\n        $num = is_null($idx) ? 2 : 1;\r\n\r\n        for ($i = 0; $i < $num; $i++) {\r\n            $process = new \\Swoole\\Process(function(\\Swoole\\Process $worker) use($i, $idx) {\r\n                $worker->exec(PHP_BINARY, [SWOOLA_APP_DIR.'/artisan', 'queue:work']);\r\n            });\r\n\r\n            $pid = $process->start();\r\n            if (is_null($idx)) {\r\n                $this->queueWorkerPids[$i] = $pid;\r\n            } else {\r\n                $this->queueWorkerPids[$idx] = $pid;\r\n            }\r\n\r\n            // if ($pid) {\r\n\r\n            // } else {\r\n            //     $errno = swoole_errno();\r\n            //     var_dump(swoole_strerror($errno));\r\n            // }\r\n        }\r\n    }\r\n}\r\n\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2162/comments",
    "author": "fanybook",
    "comments": [
      {
        "user": "fanybook",
        "created_at": "2018-11-29T06:55:05Z",
        "body": "```\r\n            // swoole_timer_tick(1000, function() {\r\n            while (true) {\r\n                if (!$this->queueWorkerPids) {\r\n                    $this->createQueueWorker();\r\n                } else {\r\n                    foreach ($this->queueWorkerPids as $idx => $pid) {\r\n                        $current_time = date('H:i:s');\r\n                        if (\\Swoole\\Process::kill($pid, 0)) {\r\n                            echo \"PID[{$pid}] is alived({$current_time}).\\n\";\r\n                        } else {\r\n                            echo \"PID[{$pid}] is died.\\n\";\r\n                            unset($this->queueWorkerPids[$idx]);\r\n                            $this->createQueueWorker($idx);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                sleep(1);\r\n            }\r\n            // });\r\n```\r\n\u6539\u6210\u6b7b\u5faa\u73af\uff0c\u521b\u5efa\u7684\u5b59\u7a0b\u5e8f\u5c31\u6ca1\u95ee\u9898\r\n\r\n\r\n```\r\n            swoole_timer_tick(1000, function() {\r\n                echo '2333333';\r\n            });\r\n\r\n            // swoole_timer_tick(1000, function() {\r\n            while (true) {\r\n                if (!$this->queueWorkerPids) {\r\n                    $this->createQueueWorker();\r\n                } else {\r\n                    foreach ($this->queueWorkerPids as $idx => $pid) {\r\n                        $current_time = date('H:i:s');\r\n                        if (\\Swoole\\Process::kill($pid, 0)) {\r\n                            echo \"PID[{$pid}] is alived({$current_time}).\\n\";\r\n                        } else {\r\n                            echo \"PID[{$pid}] is died.\\n\";\r\n                            unset($this->queueWorkerPids[$idx]);\r\n                            $this->createQueueWorker($idx);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                sleep(1);\r\n            }\r\n            // });\r\n```\r\n\u5728\u6b7b\u5faa\u73af\u5916\uff0c\u52a0timer\uff0c\u521b\u5efa\u51fa\u5b59\u7a0b\u5e8f\u4e5f\u53d8\u6210\u50f5\u5c38"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-11-29T10:49:00Z",
        "body": "\u8bf7\u4f7f\u7528\u534f\u7a0b\u6a21\u5f0f\r\n\r\n```php\r\n<?php\r\ngo(function() {\r\n    while(1)\r\n    {\r\n        co::sleep(1);\r\n        var_dump(co::exec(\"ps aux\"));\r\n    }\r\n});\r\n\r\nswoole_event_wait();\r\n```\r\n"
      },
      {
        "user": "fanybook",
        "created_at": "2018-11-29T11:14:47Z",
        "body": "\u61c2\u4e86  \ud83d\udc4d"
      }
    ]
  },
  {
    "number": 2055,
    "title": "\u4f7f\u7528idea \u5f00\u53d1\uff0c\u5e76\u6253\u5f00xdebug \u76d1\u63a7\u540e\uff0c\u5982\u679c\u4f7f\u7528\u540c\u4e00\u4e2a\u7aef\u53e3\u505a\u76d1\u542c\uff0c\u4f1a\u5bfc\u81f4\u65e0\u6cd5\u6267\u884c\u7b2c\u4e8c\u4e2aphp \u547d\u4ee4",
    "created_at": "2018-10-23T06:44:44Z",
    "closed_at": "2018-10-23T08:47:39Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2055",
    "body": "\u4f7f\u7528idea \u5f00\u53d1\uff0c\u5e76\u6253\u5f00xdebug \u76d1\u63a7\u540e\uff0c\u5982\u679c\u4f7f\u7528\u540c\u4e00\u4e2a\u7aef\u53e3\u505a\u76d1\u542c\uff0c\u4f1a\u5bfc\u81f4\u65e0\u6cd5\u6267\u884c\u7b2c\u4e8c\u4e2aphp \u547d\u4ee4",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2055/comments",
    "author": "monkeycraps",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-10-23T08:47:39Z",
        "body": "1. \u4e0d\u80fd\u5728swoole\u91cc\u4f7f\u7528xdebug\r\n2. \u4e00\u4e2a\u7aef\u53e3\u4e00\u4e2a\u670d\u52a1\r\n3. \u7528idea\u5f00\u53d1\u548c\u95ee\u9898\u65e0\u5173, \u4e0d\u5c5e\u4e8eswoole\u7684bug, \u60f3\u6267\u884c\u4e24\u4e2a\u53ea\u80fd\u6539\u7aef\u53e3\r\n\r\n\u53ef\u4ee5\u5148\u53bb\u6587\u6863\u91cc\u641c\u7d22\u76f8\u5173\u95ee\u9898"
      },
      {
        "user": "monkeycraps",
        "created_at": "2018-11-02T04:42:00Z",
        "body": "\u6069\uff0c\u53ea\u662f\u8868\u73b0\u5f88\u8be1\u5f02\uff0c\u662f\u76f4\u63a5\u5361\u4e3b\u4e86\uff0c\u670d\u52a1\u542f\u52a8\u4e5f\u6b63\u5e38\uff0c\u4f46\u662f\u6267\u884c\u7b2c\u4e8c\u6761 cli \u7684\u547d\u4ee4\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5361\u4e3b\uff0c\u95ee\u9898\u4e0d\u592a\u597d\u627e\uff0c\u6240\u4ee5\uff0c\u6211\u63d0\u4e86\u4e2aissue\uff0c\u65b9\u4fbf\u5927\u5bb6\u786e\u8ba4\u95ee\u9898 "
      }
    ]
  },
  {
    "number": 2031,
    "title": "Does not work installed signal if in swoole_process run a sleep(1) function",
    "created_at": "2018-10-12T00:49:55Z",
    "closed_at": "2018-10-12T21:23:32Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/2031",
    "body": "Hi,\r\n\r\nI wrote a simple daemon program that starts up a few subprocesses. I also set up a signal handler for the master and child processes with swoole::signal(). If I use sleep(1) within the child process, the child process does not respond to the signal given by swoole::kill(). usleep (1000000) function does not have this problem.\r\n\r\n// $worker is master process\r\n```php \r\n        $process = new swoole_process(function(swoole_process $process) use($worker, $id){\r\n            \r\n            if (self::$status === self::STATUS_STARTING) {\r\n                self::resetStd();\r\n            }\r\n            \r\n            self::$pidMap  = array();\r\n            self::$workers = array($worker->workerId => $worker);\r\n            Timer::delAll();\r\n            \r\n            $process->name('Messenger: worker process  ' . $worker->name);\r\n            $worker->setUserAndGroup();\r\n            $worker->id = $id;\r\n            \r\n            self::$status = self::STATUS_RUNNING;\r\n        \r\n            register_shutdown_function(array(\"\\\\Jetmail\\\\Server\\\\Messenger\", 'checkErrors'));\r\n            self::reinstallSignal();\r\n            \r\n            // Init Timer.\r\n            Timer::init();\r\n            \r\n            $timerid = Timer::add(3,function()use($process,&$timerid){\r\n                \r\n                while($msg = $process->pop()){\r\n                    if ($msg === false) {\r\n                        break;\r\n                    }\r\n\r\n                    sleep(1);\r\n                    //usleep(1000000);\r\n                }\r\n            },[1,2,3],true);            \r\n        });\r\n        \r\n        $process->useQueue(rand(1,1000), swoole_process::IPC_NOWAIT);\r\n        $pid = $process->start();\r\n```\r\n\r\n\r\nI do not know this is a bug or my knowledge is incomplete. I applied sleep (1) instead of a specific task until I did the daemon program. Program execution is waiting for 1 second to simulate the execution time of the real task\r\n\r\nSubprocess's reactions to the signal were never responded, and there was a program state when child processes ceased as soon as they received a signal. I always sent the SIGUSR2 signal.\r\n\r\n\r\nswoole support => enabled\r\nVersion => 4.1.2\r\nAuthor => Swoole Group[email: team@swoole.com]\r\ncoroutine => enabled\r\nepoll => enabled\r\neventfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nsockets => enabled\r\nopenssl => enabled\r\nhttp2 => enabled\r\npcre => enabled\r\nzlib => enabled\r\nbrotli => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\nfutex => enabled\r\nmysqlnd => enabled\r\nredis client => enabled\r\npostgresql client => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.enable_coroutine => On => On\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => On => On\r\nswoole.use_shortname => On => On\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\nPhp version: PHP 7.2.9 (cli) (built: Aug 17 2018 16:21:18) ( NTS )\r\nKernel: Arch Linux, Linux malinal-arch 4.18.6-arch1-1-ARCH #1 SMP PREEMPT Wed Sep 5 11:54:09 UTC 2018 x86_64 GNU/Linux\r\ngcc: gcc 8.2.1+20180831-1\r\n\r\n\r\nThanks for your help.\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/2031/comments",
    "author": "optimode",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-10-12T02:31:57Z",
        "body": "swoole::signal() is based on signalfd and\r\n eventloop, can not use it in sync blocked server, please use pcntl_signal."
      },
      {
        "user": "optimode",
        "created_at": "2018-10-12T13:23:15Z",
        "body": "Oh, I understand, thank you. So with swoole i can use pcntl_ functions (eg signal, kill)? Actually, I do not want to use sleep (), it was just an occasional idea.\r\n\r\nI would like to develop an email sender application (composer and symfony based) that currently retrieves the data from a redis queue and logs sending data into a mysql database.\r\nWhat php functions or classes can not I use?\r\n\r\nAn another question: in php the sleep() function works in the background: \r\nsleep() -> php_sleep() -> SleepEx() ?"
      },
      {
        "user": "twose",
        "created_at": "2018-10-12T13:45:51Z",
        "body": "as I know, just system call `sleep`."
      }
    ]
  },
  {
    "number": 1991,
    "title": "Unable to load dynamic library 'swoole'",
    "created_at": "2018-09-19T14:16:40Z",
    "closed_at": "2018-09-19T15:41:06Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1991",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\n    `updated php from 7.1.x to 7.2.10 and rebuilt and reinstalled php-swoole AUR package`\r\n\r\n\r\n2. What did you expect to see?\r\n    `swoole ext loaded with php properly`\r\n\r\n\r\n3. What did you see instead?\r\n`PHP Warning:  PHP Startup: Unable to load dynamic library 'swoole' (tried: /usr/lib/php/modules/swoole (/usr/lib/php/modules/swoole: cannot open shared object file: No such file or directory), /usr/lib/php/modules/swoole.so (/usr/lib/php/modules/swoole.so: undefined symbol: strpprintf)) in Unknown on line 0`\r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\n    `4.2.1`\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n```\r\nArch Linux \r\n4.17.14.a-1-hardened x86_64\r\nphp 7.2.10\r\ngcc 8.2.1+20180831-1\r\n```\r\n\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n    `openssl 1.1.1-1`\r\n\r\nNOTE: `/usr/lib/php/modules/swoole.so does exist in filesystem.`\r\n`swoole ext won't load whether i have .so in php.ini or not.`\r\n\r\nThanks",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1991/comments",
    "author": "ITwrx",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-09-19T15:13:21Z",
        "body": "if you `make clean` and rerun the right(new version's) `phpize` then `./configure xxx && make && sudo make install`?\r\n\r\ncheck your phpize version, it may shows these:\r\n```C\r\nConfiguring for:\r\nPHP Api Version:         20170718\r\nZend Module Api No:      20170718\r\nZend Extension Api No:   320170718\r\n```\r\n\r\ncheck your version num is PHP72"
      },
      {
        "user": "ITwrx",
        "created_at": "2018-09-19T15:41:06Z",
        "body": "@twose just running \"make clean\" in the src directory of the previous build then re-running \"makepkg\" did the trick. thanks for the help."
      }
    ]
  },
  {
    "number": 1977,
    "title": "Does \\Co::getUid() has the possibility to return same number in a worker process?",
    "created_at": "2018-09-17T11:51:31Z",
    "closed_at": "2018-09-19T12:41:35Z",
    "labels": [
      "question",
      "coroutine"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1977",
    "body": "for example:\r\n\\Co:;getUid() return 117, after some time, but before worker reload, may it return 117 again?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1977/comments",
    "author": "scil",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-09-18T02:27:15Z",
        "body": "it will start at 1."
      },
      {
        "user": "matyhtf",
        "created_at": "2018-09-18T02:51:58Z",
        "body": "Like the process id, It will be reused"
      },
      {
        "user": "scil",
        "created_at": "2018-09-18T11:28:26Z",
        "body": "Thank you.\r\n\r\ndoes the id start with 1 and grow by step 1, and  go back to 1  when reaching a max number ?"
      },
      {
        "user": "twose",
        "created_at": "2018-09-19T07:54:11Z",
        "body": "@scil \r\ncid map uses the bitmap, it will find the first available position.\r\nWe have also considered this problem (use string like uuid is better?)\r\n\r\nwe can confirm it by\r\n```php\r\n\r\nco::set([\r\n    'max_coroutine' => PHP_INT_MAX,\r\n    'log_level' => SWOOLE_LOG_INFO,\r\n    'trace_flags' => 0\r\n]);\r\n$map = [];\r\nwhile (true) {\r\n    if (empty($map)){\r\n        $cid = go(function () {co::sleep(5);});\r\n    }else{\r\n        $cid = go(function () { });\r\n    }\r\n    if (!isset($map[$cid])) {\r\n        $map[$cid] = $cid;\r\n    } else {\r\n        var_dump(end($map));\r\n        var_dump($cid);\r\n        exit;\r\n    }\r\n}\r\n```"
      },
      {
        "user": "twose",
        "created_at": "2018-09-19T07:54:12Z",
        "body": "@scil \r\ncid map uses the bitmap, it will find the first available position.\r\nWe have also considered this problem (use string like uuid is better?)\r\n\r\nwe can confirm it by:\r\n```php\r\nco::set([\r\n    'max_coroutine' => PHP_INT_MAX,\r\n    'log_level' => SWOOLE_LOG_INFO,\r\n    'trace_flags' => 0\r\n]);\r\n$map = [];\r\nwhile (true) {\r\n    if (empty($map)){\r\n        $cid = go(function () {co::sleep(5);});\r\n    }else{\r\n        $cid = go(function () { });\r\n    }\r\n    if (!isset($map[$cid])) {\r\n        $map[$cid] = $cid;\r\n    } else {\r\n        var_dump(end($map));\r\n        var_dump($cid);\r\n        exit;\r\n    }\r\n}\r\n```\r\n\r\nit will print like:\r\n```php\r\nint(524288)\r\nint(2)\r\n```"
      },
      {
        "user": "twose",
        "created_at": "2018-09-19T08:00:34Z",
        "body": "We have MAX_CORO_NUM_LIMIT => 0x80000, coroutine num can not be bigger than 524288 on the same time"
      },
      {
        "user": "scil",
        "created_at": "2018-09-19T12:41:35Z",
        "body": "@twose Thank you! I've got it.  For me, bitmap is good enough!"
      }
    ]
  },
  {
    "number": 1886,
    "title": "http_sever and websocket_server",
    "created_at": "2018-08-15T17:32:56Z",
    "closed_at": "2018-08-20T06:20:47Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1886",
    "body": "I don't get it. How can I make a http_server and a websocket_server in one process? \r\n\r\ntried to create two instanced but wont work\r\n\r\nWarning: Swoole\\Server::__construct(): server is running. unable to create swoole_server.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1886/comments",
    "author": "Kapsonfire",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-08-16T01:26:14Z",
        "body": "Easy, you should know WebSocket is upgraded by HTTP\r\n```php\r\n<?php\r\n\r\n$server = new swoole_websocket_server('127.0.0.1', 9501);\r\n\r\n$server->on('open', function (swoole_websocket_server $server, swoole_http_request $req) {\r\n    echo \"connection open: {$req->fd}\\n\";\r\n});\r\n\r\n//websocket\r\n$server->on('message', function (swoole_websocket_server $server, swoole_websocket_frame $frame) {\r\n    echo \"received message: {$frame->data}\\n\";\r\n    $server->push($frame->fd, json_encode([\"hello\", \"world\"]));\r\n});\r\n\r\n//http\r\n$server->on('request', function (swoole_http_request $req, swoole_http_response $resp) {\r\n    $resp->end(\"<h1>hello world</h1>\");\r\n});\r\n\r\n$server->on('close', function (swoole_websocket_server $server, int $fd) {\r\n    echo \"connection close: {$fd}\\n\";\r\n});\r\n\r\n$server->start();\r\n```"
      },
      {
        "user": "Kapsonfire",
        "created_at": "2018-08-16T06:33:30Z",
        "body": "ok, i tried it already that way, but with http2 in the option.\r\n\r\nso im not able to use http2 then, since websocket server cant use http2 "
      },
      {
        "user": "Kapsonfire",
        "created_at": "2018-08-18T11:47:10Z",
        "body": "any way to allow http2 in websocket server?"
      },
      {
        "user": "twose",
        "created_at": "2018-08-20T02:30:42Z",
        "body": "@Kapsonfire \r\nNot yet, but on the roadmap. Please use nginx to proxy it."
      },
      {
        "user": "Kapsonfire",
        "created_at": "2018-08-20T06:20:47Z",
        "body": "thanks - this is the only reason for me to use a apache2 reverse proxy to achieve http2 - may be closed"
      }
    ]
  },
  {
    "number": 1710,
    "title": "Enable sockets support, require sockets extension.",
    "created_at": "2018-06-12T11:17:00Z",
    "closed_at": "2018-06-13T02:09:59Z",
    "labels": [
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1710",
    "body": "\u770b\u4e86 make.sh \u91cc\u7684\u811a\u672c\uff0c\u542f\u7528\u90a3\u51e0\u4e2a\u53c2\u6570\u7f16\u8bd1\u7684\u8bdd\u4f1a\u62a5\u9519\uff0c\u5230\u5904\u627e\u4e86\u6ca1\u627e\u5230\u5982\u4f55\u5904\u7406\u8fd9\u91cc\u7684\u7f16\u8bd1\u9519\u8bef\uff0c\u8bf7\u5b98\u65b9\u51fa\u4e00\u4e2a\u6587\u6863\u8bf4\u660e\u4e00\u4e0b\u554a\uff0c\u6c42\u52a9\u4e86",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1710/comments",
    "author": "huye",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-06-13T02:09:59Z",
        "body": "\u4f7f\u7528\u6700\u65b0\u7248\u672c 4.0.0-rc1 \u5df2\u53bb\u6389\u4e86\u6b64\u9879\u68c0\u6d4b\u3002"
      },
      {
        "user": "huye",
        "created_at": "2018-06-13T06:36:19Z",
        "body": "\u597d\u5427\uff0c\u770b\u6765\u5148\u4e0d\u7528\u8fd9\u4e9b\u529f\u80fd\uff0c\u53cd\u6b63\u73b0\u5728\u4e5f\u7528\u4e0d\u5230"
      }
    ]
  },
  {
    "number": 1583,
    "title": "Segmentation fault \u9519\u8bef",
    "created_at": "2018-04-25T10:37:06Z",
    "closed_at": "2018-04-26T02:35:55Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1583",
    "body": "CentOS 6.9 x64 Kernel 4.4.127\r\nphp 7.1.16 with yac\r\nswoole 2.1.3\r\n\r\n\r\n\r\n\u4e0b\u9762\u662f\u6709\u6548\u7684\u8c03\u8bd5\u4fe1\u606f\r\n\r\n(gdb) bt\r\n#0  0x00007fea2e0f595d in swShareMemory_mmap_create (object=0x7ffcc05f0950, size=2097248, mapfile=0x0)\r\n    at /opt/distfiles/php/swoole-src-2.1.3/src/memory/ShareMemory.c:122\r\n#1  0x00007fea2e0f56a5 in sw_shm_malloc (size=2097248) at /opt/distfiles/php/swoole-src-2.1.3/src/memory/ShareMemory.c:25\r\n#2  0x00007fea2e0f5e4e in swMemoryGlobal_new_page (gm=0x7ffcc05f0a10)\r\n    at /opt/distfiles/php/swoole-src-2.1.3/src/memory/MemoryGlobal.c:80\r\n#3  0x00007fea2e0f5d52 in swMemoryGlobal_new (pagesize=2097152, shared=1 '\\001')\r\n    at /opt/distfiles/php/swoole-src-2.1.3/src/memory/MemoryGlobal.c:51\r\n#4  0x00007fea2e0e8985 in swoole_init () at /opt/distfiles/php/swoole-src-2.1.3/src/core/base.c:64\r\n#5  0x00007fea2dff89fb in zm_startup_swoole (type=1, module_number=62) at /opt/distfiles/php/swoole-src-2.1.3/swoole.c:1024\r\n#6  0x0000000000a21478 in zend_startup_module_ex (module=0x27a6f50) at /opt/distfiles/php/php-7.1.16/Zend/zend_API.c:1843\r\n#7  0x0000000000a214da in zend_startup_module_zval (zv=0x2765510) at /opt/distfiles/php/php-7.1.16/Zend/zend_API.c:1858\r\n#8  0x0000000000a2f192 in zend_hash_apply (ht=0x14b10e0, apply_func=0xa214b7 <zend_startup_module_zval>)\r\n    at /opt/distfiles/php/php-7.1.16/Zend/zend_hash.c:1507\r\n#9  0x0000000000a21a9f in zend_startup_modules () at /opt/distfiles/php/php-7.1.16/Zend/zend_API.c:1969\r\n#10 0x0000000000988d00 in php_module_startup (sf=0x1488d80, additional_modules=0x0, num_additional_modules=0)\r\n    at /opt/distfiles/php/php-7.1.16/main/main.c:2300\r\n#11 0x0000000000af930f in php_cli_startup (sapi_module=0x1488d80) at /opt/distfiles/php/php-7.1.16/sapi/cli/php_cli.c:427\r\n#12 0x0000000000afb22a in main (argc=2, argv=0x2722070) at /opt/distfiles/php/php-7.1.16/sapi/cli/php_cli.c:1348\r\n(gdb) f 1\r\n#1  0x00007fea2e0f56a5 in sw_shm_malloc (size=2097248) at /opt/distfiles/php/swoole-src-2.1.3/src/memory/ShareMemory.c:25\r\n25          mem = swShareMemory_mmap_create(&object, size, NULL);\r\n(gdb) f 0\r\n#0  0x00007fea2e0f595d in swShareMemory_mmap_create (object=0x7ffcc05f0950, size=2097248, mapfile=0x0)\r\n    at /opt/distfiles/php/swoole-src-2.1.3/src/memory/ShareMemory.c:122\r\n122             swWarn(\"mmap(%ld) failed. Error: %s[%d]\", size, strerror(errno), errno);\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1583/comments",
    "author": "yxgong",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-04-25T10:45:10Z",
        "body": "\u8bf7\u52ff\u4f7f\u7528 ` --enable-hugepage` \u7f16\u8bd1\u53c2\u6570"
      },
      {
        "user": "yxgong",
        "created_at": "2018-04-25T11:07:35Z",
        "body": "\u591a\u8c22\u554a\uff0c\u679c\u7136\r\n\u4e0d\u7528--enable-hugepage \u5168\u65b0\u7f16\u8bd1\u540e\u5c31\u89e3\u51b3\u4e86\r\n\r\n"
      }
    ]
  },
  {
    "number": 1551,
    "title": "TCP Server onReceive wrong $data",
    "created_at": "2018-04-07T11:23:36Z",
    "closed_at": "2018-04-09T02:50:42Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1551",
    "body": " Please help. What can I do with it?\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\nClients:\r\n```php\r\n for( $i = 0; $i <=1; $i++) {\r\n            $client = new \\swoole_client(SWOOLE_SOCK_TCP, SWOOLE_SOCK_ASYNC);\r\n\r\n            $client->on(\"connect\", function($cli) use ($serial_number) {\r\n                $cli->send(\"Data\\r\\n\");\r\n            });\r\n\r\n            $client->on(\"receive\", function($cli, $data) use ($serial_number) {\r\n                echo \"Received: \".$data.' '.date(\"Y-m-d H:i:s\").\"\\r\\n\";\r\n            });\r\n\r\n            $client->on(\"error\", function($cli) use ($client){\r\n                echo \"Connect failed\\n\";\r\n            });\r\n\r\n            $client->on(\"close\", function($cli) use ($serial_number) {\r\n                echo \"Connection close\\n\";\r\n            });\r\n\r\n            $client->connect($ip, $port, 0.5);\r\n        }\r\n```\r\n\r\nServer (short)\r\n```php\r\n$server = new \\swoole_server($ip, $port, SWOOLE_BASE, SWOOLE_SOCK_TCP);\r\n        $server->set(array(\r\n            'task_worker_num'           =>4,\r\n            'worker_num'                => 4,\r\n            'debug_mode'                => 1,\r\n            'open_eof_check'           => true,\r\n            'package_eof'              => \"\\r\\n\",\r\n            'open_eof_split'           => true,\r\n        ));\r\n\r\n\r\n    public function onReceive(\\swoole_server $server, $fd, $from_id, $data )\r\n    {\r\n        var_dump($data);\r\n        echo \"Get Message From Client {$fd}:{$data}\\n\";\r\n    }\r\n```\r\n2. What did you expect to see?\r\n\r\n`string(6) \"Data\r\n\"`\r\n\r\n3. What did you see instead?\r\n\r\n`string(6) \"Data\r\n\"\r\nstring(6) \"Data\r\n\"`\r\n\r\n`string(6) \"string(6) \"Data\r\nData\r\n\"\r\n\"`\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\n 1.10.3\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\nphp  7.1.14\r\nmac os 10.13.4\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1551/comments",
    "author": "iihres",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-04-09T02:48:42Z",
        "body": "This is because multiple processes output the screen at the same time, You can write to file, or set worker_num to 1"
      },
      {
        "user": "iihres",
        "created_at": "2018-04-10T09:38:41Z",
        "body": "Thanks)"
      }
    ]
  },
  {
    "number": 1538,
    "title": "Warning: Swoole\\Server::on(): Unknown event types[WorkerExit]",
    "created_at": "2018-03-24T02:20:16Z",
    "closed_at": "2018-03-24T02:51:18Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1538",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\n```PHP\r\n$swoole = new \\swoole_http_server('127.0.0.1', 52100, \\SWOOLE_PROCESS);\r\n$swoole->on('WorkerExit', function(){\r\n});\r\n$swoole->on('Request', function(){\r\n});\r\n$swoole->start();\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\nstart without this warning\r\n\r\n3. What did you see instead?\r\n`Warning: Swoole\\Server::on(): Unknown event types[WorkerExit] in xxx.php on line 4`\r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\nswoole\r\n\r\nswoole support => enabled\r\nVersion => 2.0.7\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\nepoll => enabled\r\neventfd => enabled\r\ntimerfd => enabled\r\nsignalfd => enabled\r\ncpu affinity => enabled\r\nspinlock => enabled\r\nrwlock => enabled\r\nasync http/websocket client => enabled\r\nLinux Native AIO => enabled\r\npcre => enabled\r\nzlib => enabled\r\nmutex_timedlock => enabled\r\npthread_barrier => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => On => On\r\nswoole.fast_serialize => Off => Off\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n- `uname -a`: Linux e4ddd26a0eff 4.9.60-linuxkit-aufs #1 SMP Mon Nov 6 16:00:12 UTC 2017 x86_64 GNU/Linux\r\n- `cat /etc/issue`:  Debian GNU/Linux 8 \\n \\l\r\n- `php -v`: \r\nHP 5.6.32 (cli) (built: Nov  4 2017 11:29:44)\r\nCopyright (c) 1997-2016 The PHP Group\r\nZend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies\r\n    with Zend OPcache v7.0.6-dev, Copyright (c) 1999-2016, by Zend Technologies\r\n- `gcc -v`:\r\nUsing built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/4.9/lto-wrapper\r\nTarget: x86_64-linux-gnu\r\nConfigured with: ../src/configure -v --with-pkgversion='Debian 4.9.2-10' --with-bugurl=file:///usr/share/doc/gcc-4.9/README.Bugs --enable-languages=c,c++,java,go,d,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.9 --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.9 --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-gnu-unique-object --disable-vtable-verify --enable-plugin --with-system-zlib --disable-browser-plugin --enable-java-awt=gtk --enable-gtk-cairo --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-4.9-amd64/jre --enable-java-home --with-jvm-root-dir=/usr/lib/jvm/java-1.5.0-gcj-4.9-amd64 --with-jvm-jar-dir=/usr/lib/jvm-exports/java-1.5.0-gcj-4.9-amd64 --with-arch-directory=amd64 --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --enable-objc-gc --enable-multiarch --with-arch-32=i586 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\r\nThread model: posix\r\ngcc version 4.9.2 (Debian 4.9.2-10)\r\n\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\nno ssl\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1538/comments",
    "author": "hhxsv5",
    "comments": [
      {
        "user": "yoigo",
        "created_at": "2018-03-24T02:38:17Z",
        "body": "$swoole->set(['reload_async' => true]);"
      },
      {
        "user": "hhxsv5",
        "created_at": "2018-03-24T02:45:52Z",
        "body": "@yoigo Still get the warning message"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-03-24T02:48:25Z",
        "body": " Extension version is too low, please upgrade to the latest version"
      },
      {
        "user": "hhxsv5",
        "created_at": "2018-03-24T02:51:18Z",
        "body": "Thank you."
      }
    ]
  },
  {
    "number": 1537,
    "title": "1.10.2\u30012.1.1\u7248swoole_websocket_server->on\u7684BUG",
    "created_at": "2018-03-23T02:34:41Z",
    "closed_at": "2018-03-23T03:06:33Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1537",
    "body": "\u4ee3\u7801\uff1a\r\n```php\r\nclass Server extends \\swoole_websocket_server\r\n{\r\n\tpublic function __construct($ip, $port)\r\n\t{\r\n\t\tparent::__construct($ip, $port);\r\n\t\t$this->init();\r\n\t}\r\n\r\n\tprotected function init()\r\n\t{\r\n\t\t$this->on('open', [$this, '__open']);\r\n\t\t$this->on('message', [$this, '__message']);\r\n\t\t$this->on('close', [$this, '__close']);\r\n\t}\r\n\r\n\tprotected function __open($server, $request)\r\n\t{\r\n\t\techo \"server: handshake success with fd{$request->fd}\\n\";\r\n\t}\r\n\t\r\n\tprotected function __message($server, $frame)\r\n\t{\r\n\t\techo \"receive from {$frame->fd}:{$frame->data},opcode:{$frame->opcode},fin:{$frame->finish}\\n\";\r\n\t\t$this->push($frame->fd, \"this is server\");\r\n\t}\r\n\r\n\tprotected function __close($server, $fd)\r\n\t{\r\n\t\techo \"client {$fd} closed\\n\";\r\n\t}\r\n}\r\n```\r\n\r\n\u9519\u8bef\u4fe1\u606f\uff1a\r\n\r\n> PHP Fatal error:  swoole_server_port::on(): Function 'Server::__close' is not callable in /xxx/Server.php on line 16\r\n\r\nopen\u548cmessage\u6ca1\u6709\u95ee\u9898\uff0c\u53ea\u6709close\u6709\u95ee\u9898\r\n\r\n\u8fd8\u6709\u5c31\u662f\u901a\u8fc7pecl\u65e0\u6cd5\u66f4\u65b0\u52302.x\u7248\u672c\uff0c\u6700\u65b0\u53ea\u67091.10.2",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1537/comments",
    "author": "Yurunsoft",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-03-23T03:06:33Z",
        "body": "**\u8bf7\u6240\u6709\u4e8b\u4ef6\u56de\u8c03\u51fd\u6570\u8bbe\u7f6e\u4e3a`public`**\r\n\r\n\u867d\u7136\u53e6\u5916\u4e24\u4e2a\u4e8b\u4ef6\u56de\u8c03\u8bbe\u7f6e\u6210\u529f\u4e86\uff0c\u4f46\u662f\u8fd9\u53ea\u662f\u7ed5\u5f00\u4e86`swoole_websocekt_server::on`\u65b9\u6cd5\u7684\u68c0\u6d4b\uff0c\u5728\u56de\u8c03\u8fd9\u4e9b\u51fd\u6570\u65f6\u4ecd\u7136\u53ef\u80fd\u9047\u5230\u4f5c\u7528\u57df\u7684\u95ee\u9898\u3002\r\n\r\n`__close`\u8bbe\u7f6e\u672a\u6210\u529f\u662f\u56e0\u4e3a\u9700\u8981\u8c03\u7528`swoole_server_port::on`\u65b9\u6cd5\u5c06\u56de\u8c03\u51fd\u6570\u8bbe\u7f6e\u5230\u76d1\u542c\u7aef\u53e3\u4e0a\uff0c\u8fd9\u4e2a\u7c7b\u548c`swoole_websocekt_server`\u6ca1\u6709\u4efb\u4f55\u7ee7\u627f\u5173\u7cfb\u3002"
      },
      {
        "user": "Yurunsoft",
        "created_at": "2018-03-23T03:08:31Z",
        "body": "\u660e\u767d\u4e86"
      }
    ]
  },
  {
    "number": 1527,
    "title": "Swoole not supported HTTP Client SSL SNI? (ssl handshake failure)",
    "created_at": "2018-03-18T03:38:36Z",
    "closed_at": "2018-03-19T10:59:40Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1527",
    "body": "Swoole not supported HTTP_Client SSL SNI?\r\n\r\nTest script:\r\n\r\n```\r\n<?php\r\n\r\n$domain = 'intoconsultoria.com';\r\n$ip = gethostbyname($domain);\r\n\r\n$cli = new swoole_http_client($ip, 443, true);\r\n\r\n$cli->set(array(\r\n    'timeout' => -1,\r\n    'debug_mode'=> 1,\r\n));\r\n\r\n$cli->setHeaders([\r\n    'Host' => $domain,\r\n    'cache-control' => 'no-cache',\r\n]);\r\n\r\n$cli->get('/', function ($cli) {\r\n    print_r($cli->body);\r\n});\r\n\r\n?>\r\n```\r\n\r\nOutput: WARNING swSSL_connect: SSL_connect() failed. Error: (null)[1]\r\n\r\nTest SSL with openssl (without SNI):\r\n```\r\nshell: openssl s_client -connect intoconsultoria.com:443\r\n\r\noutput: SSL routines:ssl3_read_bytes:tlsv1 alert internal error:ssl/record/rec_layer_s3.c:1399:SSL alert number 80\r\n```\r\n\r\nTest SSL with openssl (with SNI):\r\n\r\n```\r\nshell: openssl s_client -connect intoconsultoria.com:443 -servername intoconsultoria.com\r\n\r\nSsl test successfully.\r\n```\r\n\r\nHow to make swoole work properly with SSL-SNI?\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1527/comments",
    "author": "emdfreeman",
    "comments": [
      {
        "user": "emdfreeman",
        "created_at": "2018-03-18T16:02:14Z",
        "body": "How to enable ssl_tls_sni in swoole?"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-03-19T06:56:56Z",
        "body": "Please set the `ssl_host_name` option.\r\n\r\n```php\r\n<?php\r\n\r\n$domain = 'intoconsultoria.com';\r\n$ip = gethostbyname($domain);\r\n\r\n$cli = new swoole_http_client($ip, 443, true);\r\n\r\n$cli->set(array(\r\n    'timeout' => -1,\r\n    'ssl_host_name' => $domain,\r\n    'debug_mode'=> 1,\r\n));\r\n\r\n$cli->setHeaders([\r\n    'Host' => $domain,\r\n    'cache-control' => 'no-cache',\r\n]);\r\n\r\n$cli->get('/', function ($cli) {\r\n    print_r($cli->body);\r\n});\r\n\r\n?>\r\n```"
      },
      {
        "user": "emdfreeman",
        "created_at": "2018-03-19T10:59:40Z",
        "body": "Thank you!\r\n\r\nP.S. I checked but with an error ('ssl_host_name' => 'https: /intoconsultoria.com',)"
      }
    ]
  },
  {
    "number": 1524,
    "title": "php\u7684\u5185\u90e8\u5f02\u5e38,\u5728error_handle\u5904\u7406\u540e,worker\u8fdb\u7a0b\u9000\u51fa,\u4e0d\u7ba1\u662f\u534f\u7a0b\u7248\u672c\u6216\u975e\u534f\u7a0b\u7248\u672c\u90fd\u662f\u5982\u6b64",
    "created_at": "2018-03-17T02:45:00Z",
    "closed_at": "2018-03-28T10:51:28Z",
    "labels": [
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1524",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n```php\r\n<?php\r\n\r\nset_error_handler('errorHandle');\r\n$http = new swoole_http_server(\"127.0.0.1\", 9501);\r\n\r\nfunction testWeb(\\Swoole\\Http\\Response $response)\r\n{\r\n    $response->header(\"Content-Type\", \"text/html\");\r\n    //\u5185\u90e8\u5f02\u5e38\r\n    require 'ab.php';\r\n    //\u666e\u901a\u53ef\u6355\u83b7\r\n    //$a = $b;\r\n    //throw new \\Exception('aaa');\r\n    $response->end('<html>hello</html>');\r\n}\r\n\r\n$http->on(\"request\", function (\\Swoole\\Http\\Request $request, $response) {\r\n    try{\r\n        testWeb($response);\r\n    }catch (Exception $e){\r\n        echo 'e';\r\n    }catch (Throwable $t){\r\n        echo 't';\r\n    }finally{\r\n        echo 'f';\r\n    }\r\n});\r\n\r\nfunction errorHandle($errno, $errstr, $errfile, $errline)\r\n{\r\n    if (!(error_reporting() & $errno)) {\r\n        // This error code is not included in error_reporting, so let it fall\r\n        // through to the standard PHP error handler\r\n        return false;\r\n    }\r\n    /* Don't execute PHP internal error handler */\r\n    return true;\r\n}\r\n\r\n$http->start();\r\n```\r\n\r\n2. What did you expect to see?\r\n\r\n\u8fdb\u7a0b\u4e0d\u5e94\u9000\u51fa,\u4e0d\u5e94\u8be5\u4e2d\u65ad\u4ee3\u7801\u7684\u6267\u884c,\u540e\u679c\u4e5f\u662f\u4e25\u91cd\u7684,\u6bd4\u5982\u534f\u7a0b\u5904\u7406\u4e2d\u65ad\u4e86\r\n\r\n3. What did you see instead?\r\n\r\n/usr/local/Cellar/php71/7.1.13_24/bin/php -dxdebug.remote_enable=1 -dxdebug.remote_mode=req -dxdebug.remote_port=9000 -dxdebug.remote_host=127.0.0.1 /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php\r\nPHP Fatal error:  require(): Failed opening required 'ab.php' (include_path='.:') in /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php on line 12\r\nPHP Stack trace:\r\nPHP   1. {main}() /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:0\r\nPHP   2. swoole_http_server->start() /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:40\r\nPHP   3. {closure:/Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:16-27}($request = *uninitialized*, $response = *uninitialized*) /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:40\r\nPHP   4. testWeb($response = *uninitialized*) /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:18\r\n\r\nFatal error: require(): Failed opening required 'ab.php' (include_path='.:') in /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php on line 12\r\n\r\nCall Stack:\r\n    0.0387     358592   1. {main}() /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:0\r\n    0.0463     362440   2. swoole_http_server->start() /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:40\r\n    3.5838     367992   3. {closure:/Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:16-27}(???, ???) /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:40\r\n    3.5839     367992   4. testWeb(???) /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php:18\r\n\r\n[2018-03-17 10:43:15 *2497.0]\tERROR\tzm_deactivate_swoole (ERROR 503): Fatal error: require(): Failed opening required 'ab.php' (include_path='.:') in /Users/tsingsun/workspace/ThirdTools/yii2-swoole/demo/web/swoole_ori_server.php on line 12.\r\n[2018-03-17 10:43:15 $2496.0]\tWARNING\tswManager_check_exit_status: worker#0 abnormal exit, status=255, signal=0\r\n\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\nswoole 1.10.1 2.1.1 ,2.0.12 \r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n\r\nmac\r\nphp 7.1.8\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\n\r\n\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1524/comments",
    "author": "tsingsun",
    "comments": [
      {
        "user": "twose",
        "created_at": "2018-03-24T17:07:59Z",
        "body": "\u597d\u9669, \u4f5c\u4e3aphp\u840c\u65b0, \u5dee\u70b9\u88ab\u8fd9\u4e2a\u95ee\u9898\u8ff7\u60d1\u4e86.\r\n\u8fd9\u548cswoole\u65e0\u5173, \u800c\u4e14\u987a\u5e26require\u662f\u6709IO\u64cd\u4f5c\u7684.\r\n\r\n### Fatal error\r\n\u8bf7\u628a\u4f60\u7684\u4ee3\u7801\u8d34\u5230php-cli\u4e2d\u8dd1\u4e00\u4e0b, \u4f60\u4f1a\u5f97\u5230\u4e00\u4e2a`Fatal error`.\r\n\u7136\u540e\u8bf7\u770bPHP\u5b98\u7f51\u6587\u6863\r\n> \u4ee5\u4e0b\u7ea7\u522b\u7684\u9519\u8bef\u4e0d\u80fd\u7531\u7528\u6237\u5b9a\u4e49\u7684\u51fd\u6570\u6765\u5904\u7406\uff1a E_ERROR\u3001 E_PARSE\u3001 E_CORE_ERROR\u3001 E_CORE_WARNING\u3001 E_COMPILE_ERROR\u3001 E_COMPILE_WARNING\uff0c\u548c\u5728 \u8c03\u7528 set_error_handler() \u51fd\u6570\u6240\u5728\u6587\u4ef6\u4e2d\u4ea7\u751f\u7684\u5927\u591a\u6570 E_STRICT\u3002\r\n\r\n----\r\n### \u5f02\u5e38\u6355\u83b7\u7684\u4f5c\u7528\r\n\r\n\u5bf9\u4e8e`\u8fdb\u7a0b\u4e0d\u5e94\u9000\u51fa,\u4e0d\u5e94\u8be5\u4e2d\u65ad\u4ee3\u7801\u7684\u6267\u884c,\u540e\u679c\u4e5f\u662f\u4e25\u91cd\u7684,\u6bd4\u5982\u534f\u7a0b\u5904\u7406\u4e2d\u65ad\u4e86`\u8fd9\u6bb5\u8bdd\u6211\u4e5f\u6709\u4e0d\u540c\u7684\u610f\u89c1, \u6211\u8ba4\u4e3a\u4e25\u91cd\u7684\u9519\u8bef\u5e94\u8be5\u5c3d\u5feb\u89e3\u51b3\u98ce\u9669\u800c\u4e0d\u662f\u6291\u5236\u5b83, \u4e25\u91cd\u7684\u9519\u8bef\u629b\u51fa\u963b\u6b62\u4ee3\u7801\u6267\u884c\u662f\u975e\u5e38\u6709\u5fc5\u8981\u7684(\u5982set_error_handler\u4f1a\u4f7f\u5f97\u4ee3\u7801\u7ee7\u7eed\u8fd0\u884c,\u8fd9\u5f88\u5371\u9669), \u771f\u6b63\u9700\u8981\u6355\u83b7\u5e76\u6291\u5236\u7684\u5e94\u8be5\u662f\u7531\u5f00\u53d1\u8005(\u5e93)\u5b9a\u4e49\u7684\u5404\u79cdexception\u6216trigger_error\u548c\u4e00\u4e9b(\u9884\u6599\u4e2d\u7684)\u53ef\u5ffd\u89c6\u9519\u8bef(\u5bf9\u540e\u7eed\u6267\u884c\u65e0\u5a01\u80c1\u7684).\r\n\r\n**\u6211\u5b81\u613f\u8ba9\u670d\u52a1\u5b95\u673a\u4e5f\u4e0d\u4f1a\u8ba9\u9519\u8bef\u4ee3\u7801\u4e00\u76f4\u8dd1\u4e0b\u53bb**\r\n\r\n\r\n\u5e76\u4e14\u5728php\u5b98\u65b9\u6587\u6863\u4e2d\u4e5f\u6709\u8be6\u7ec6\u89e3\u91ca\r\n\u9519\u8bef\u6355\u83b7\u81ea\u5b9a\u4e49\u51fd\u6570\u7684\u7528\u9014\r\n>\u672c\u51fd\u6570\u53ef\u4ee5\u7528\u4f60\u81ea\u5df1\u5b9a\u4e49\u7684\u65b9\u5f0f\u6765\u5904\u7406\u8fd0\u884c\u4e2d\u7684\u9519\u8bef\uff0c \u4f8b\u5982\uff0c\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u4e25\u91cd\u9519\u8bef\u53d1\u751f\u65f6\uff0c\u6216\u8005\u5728\u7279\u5b9a\u6761\u4ef6\u4e0b\u89e6\u53d1\u4e86\u4e00\u4e2a\u9519\u8bef(\u4f7f\u7528 trigger_error())\uff0c\u4f60\u9700\u8981\u5bf9\u6570\u636e/\u6587\u4ef6\u505a\u6e05\u7406\u56de\u6536\u3002\r\n\u5e76\u4e14\r\n>\u540c\u65f6\u6ce8\u610f\uff0c\u5728\u9700\u8981\u65f6\u4f60\u6709\u8d23\u4efb\u4f7f\u7528 die()\u3002 \u5982\u679c\u9519\u8bef\u5904\u7406\u7a0b\u5e8f\u8fd4\u56de\u4e86\uff0c\u811a\u672c\u5c06\u4f1a\u7ee7\u7eed\u6267\u884c\u53d1\u751f\u9519\u8bef\u7684\u540e\u4e00\u884c\u3002\r\n\r\n----\r\n### Swoole\u7684exit\r\n\u6bd4\u5982\u5728swoole,\u4e2d\u9014\u8df3\u51fa\u4e1a\u52a1\u903b\u8f91\u5c42,\u5b9e\u73b0php\u7684exit\u6548\u679c\r\n```php\r\ntry{\r\n  // \u4ee3\u7801\u53c8\u81ed\u53c8\u957f, \u4e0d\u80fd\u7528if\u5757\u6765\u5206\u5272\u5f71\u54cd\u7f8e\u89c2\r\n  if (\u547d\u4e2d\u7f13\u5b58\u63d0\u524d\u8f93\u51fa\u4e86, \u540e\u7eed\u4ee3\u7801\u4e0d\u518d\u6267\u884c){\r\n    throw new \\ExitException(); //\u6211\u8981\u9000\u51fa\u5566\r\n  }\r\n // \u6162\u67e5\u8be2\r\n // balabala\r\n} catch (\\ExitException $e){\r\n  // \u51fa\u6765\u5566\r\n} catch (\\Exception $e) {\r\n  // \u5411\u7528\u6237\u89e3\u91ca\u9519\u8bef\u539f\u56e0\u6216\u8005\u8f93\u51fa500\r\n} finally {\r\n   $response->end();\r\n}\r\n```\r\n----\r\n### \u6355\u83b7\u4e25\u91cd\u9519\u8bef\r\n\r\n\u7136\u540e, \u8fd9\u79cd\u7ea7\u522b\u7684\u9519\u8bef, \u8fdb\u7a0b\u9000\u51fa\u662f\u5408\u7406\u4e14\u4e0d\u53ef\u907f\u514d\u7684, \u5982\u679c\u4f60\u8981\u505a\u64e6\u5c41\u80a1\u5904\u7406, \u9700\u8981\u7528**register_shutdown_function()\u642d\u914derror_get_last() \u5904\u7406**, \u9001\u4e0a\u7b80\u5355\u7684\u5b9e\u73b0\u4ee3\u7801.\r\n\r\n```php\r\nfunction serializeTrace($traces):string {\r\n    $default_trace = [\r\n        'file'     => 'unknown',\r\n        'line'     => 0,\r\n        'function' => 'unknown'\r\n    ];\r\n    $r = '';\r\n    foreach ($traces as $i => $t) {\r\n        $t = $t + $default_trace;\r\n        $r .= \"#$i {$t['file']}({$t['line']}): \";\r\n        if (isset($t['object']) and is_object($t['object'])) {\r\n            $r .= get_class($t['object']).'->';\r\n        }\r\n        $r .= \"{$t['function']}()\\n\";\r\n    }\r\n    \r\n    return $r;\r\n}\r\n$shutdown_error_handle = function () {\r\n    $error = error_get_last();\r\n    if (!empty($error)) {\r\n        $log = \"Shutdown Error: [{$error['type']}] {$error['message']} \".\r\n            \"in {$error['file']}:{$error['line']}\\n\".\r\n            \"Stack trace:\";\r\n        $log .= serializeTrace(debug_backtrace());\r\n        $this->errorLog($log);\r\n    }\r\n};\r\nregister_shutdown_function($shutdown_error_handle);\r\n```"
      },
      {
        "user": "tsingsun",
        "created_at": "2018-03-26T15:08:50Z",
        "body": "\u5f88\u4e0d\u5e78, \u8fd9\u662fswoole\u7684\u7f3a\u9677,php\u672c\u6765\u6709register_exception_handle+register_error_handle\u6765\u5904\u7406\u5404\u79cd\u7c7b\u578b\u7684exception\u548cerror,\u4f46\u662fswoole\u5e76\u4e0d\u652f\u6301register_exception_handle,\u5bfc\u81f4\u5728\u5904\u7406\u73af\u8282\u4e2d\u5374\u4e86\u4e00\u73af,\u5e76\u4e14\u8fd9\u4e2aerror\u662f\u65e0\u6cd5\u88ab\u6355\u83b7,\u4e0d\u53ef\u6015\u5417?\u7531\u4e8e\u534f\u7a0b\u7684\u5b58\u5728\u8fd8\u653e\u5927\u4e86\u8be5\u95ee\u9898,\u60f3\u50cf\u4e00\u4e0b,\u5728\u4e00\u6b21\u652f\u4ed8\u8bf7\u6c42,\u7531\u4e8e\u67d0\u4e9b\u4e0d\u53ef\u6355\u83b7\u7684error,\u5bfc\u81f4\u8fdb\u7a0b\u4e2d\u7684\u8bf7\u6c42\u5168\u8d25\u4e86."
      },
      {
        "user": "twose",
        "created_at": "2018-03-26T16:43:14Z",
        "body": "@tsingsun \r\nswoole\u53ea\u662f\u4e0d\u80fd\u4f7f\u7528`set_exception_handler`, \u4f46\u4efb\u610fexception\u90fd\u53ef\u4ee5\u7528try\u6355\u83b7.\r\n\u56e0\u4e3a\u4f60\u793a\u4f8b\u4ee3\u7801\u4e2d\u8d34\u51fa\u7684`require\u9519\u8bef`\u5e76\u4e0d\u662f`exception`\u800c\u662f\u4e00\u4e2a`\u4e25\u91cderror`, \u5c31\u7b97\u4f60\u5728php-cli\u73af\u5883\u4e0b\u8fd0\u884c\u4e5f\u4f1a\u5f02\u5e38\u9000\u51fa\u800c\u4e0d\u80fd\u88ab\u6355\u83b7.\r\n\u800c\u4e14\u6211\u4e5f\u8d34\u4e86\r\n>\u4ee5\u4e0b\u7ea7\u522b\u7684\u9519\u8bef\u4e0d\u80fd\u7531\u7528\u6237\u5b9a\u4e49\u7684\u51fd\u6570\u6765\u5904\u7406\uff1a E_ERROR\u3001 E_PARSE\u3001 E_CORE_ERROR\u3001 E_CORE_WARNING\u3001 E_COMPILE_ERROR\u3001 E_COMPILE_WARNING\uff0c\u548c\u5728 \u8c03\u7528 set_error_handler() \u51fd\u6570\u6240\u5728\u6587\u4ef6\u4e2d\u4ea7\u751f\u7684\u5927\u591a\u6570 E_STRICT\u3002"
      },
      {
        "user": "twose",
        "created_at": "2018-03-26T16:52:18Z",
        "body": "@tsingsun \u8fd9\u662f\u5728\u666e\u901a\u7684php\u73af\u5883\u4e0b\u8fd0\u884c, \u5e76\u6ca1\u6709\u4efb\u4f55\u6355\u83b7\u65b9\u6cd5\u594f\u6548, \u53ea\u6253\u5370\u51fa\u4e86error_handle, \u8fdb\u7a0b\u4ecd\u65e7\u5f02\u5e38\u9000\u51fa\u4e86\u540e\u7eed\u4ee3\u7801\u4e5f\u672a\u6267\u884c.\r\n```php\r\n<?php\r\nset_error_handler(function () {\r\n    echo 'error_handle';\r\n    \r\n    return true;\r\n});\r\n\r\nset_exception_handler(function () {\r\n    echo 'exception_handle';\r\n    \r\n    return true;\r\n});\r\n\r\ntry {\r\n    require 'ab.php';\r\n} catch (Error $e) {\r\n    echo 'catch error';\r\n} catch (Exception $e) {\r\n    echo 'catch exception';\r\n} catch (Throwable $t) {\r\n    echo 'catch throwable';\r\n} finally {\r\n    echo 'finally';\r\n}\r\n```\r\n\r\n```bash\r\nPHP Fatal error:  require(): Failed opening required 'ab.php' (include_path='.:/usr/local/Cellar/php/7.2.3_3/share/pear') in /Users/twosee/Toast/test/error.php on line 21\r\nerror_handle\r\nFatal error: require(): Failed opening required 'ab.php' (include_path='.:/usr/local/Cellar/php/7.2.3_3/share/pear') in /Users/twosee/Toast/test/error.php on line 21\r\n\r\nProcess finished with exit code 255\r\n```"
      },
      {
        "user": "tsingsun",
        "created_at": "2018-03-27T12:52:44Z",
        "body": "@twose \u4ece\u65b0\u770b\u4e86php\u6587\u6863,\u4f60\u662f\u5bf9\u7684,E_ERROR\u7b49\u5f02\u5e38\u4f1a\u5bfc\u81f4\u811a\u672c\u4e2d\u65ad,\u8fd9\u6837swoole\u80fd\u505a\u7684\u786e\u5b9e\u6709\u9650,\u4f46\u8fd8\u662f\u89c9\u5f97\u8fdb\u7a0b\u9000\u51fa\u7684\u4ee3\u4ef7\u592a\u5927."
      }
    ]
  },
  {
    "number": 1520,
    "title": "How create new process when parent process already set timer",
    "created_at": "2018-03-14T16:14:22Z",
    "closed_at": "2018-03-15T10:53:19Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1520",
    "body": "I know I should set timer when all child process created. \r\nBut, I want to catch `SIGCHLD` signal and create a new child process.\r\n```PHP\r\nSwoole\\Process::signal(SIGCHLD, function ($sig) {\r\n    while ($ret = Swoole\\Process::wait(false)) {\r\n        // create a new child process\r\n        $p = new Swoole\\Process('callback_function');\r\n        $p->start();\r\n    }\r\n});\r\n```\r\nThis new child process inherit parent timer ? \r\nHow can I avoid this problem ? \r\nClear timer in child process callback function ?",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1520/comments",
    "author": "iyaozhen",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-03-15T09:46:04Z",
        "body": "Do not need to clear the parent process timer, the swoole extension will automatically clear the parent process timer & signal listener & event listener when the child process starts.\r\n\r\ndemo\r\n----\r\n```php\r\nfunction callback_function () {\r\n    Swoole\\Timer::after(10000, function () {\r\n        echo \"hello world\";\r\n    });\r\n};\r\n\r\nSwoole\\Timer::tick(1000, function () {\r\n    echo \"parent timer\\n\";\r\n});\r\n\r\nSwoole\\Process::signal(SIGCHLD, function ($sig) {\r\n    while ($ret = Swoole\\Process::wait(false)) {\r\n        // create a new child process\r\n        $p = new Swoole\\Process('callback_function');\r\n        $p->start();\r\n    }\r\n});\r\n\r\n// create a new child process\r\n$p = new Swoole\\Process('callback_function');\r\n$p->start();\r\n```"
      },
      {
        "user": "iyaozhen",
        "created_at": "2018-03-15T10:53:19Z",
        "body": "Thx\r\nI find you already update document. \r\n\r\n\u975e\u5e38\u611f\u8c22\u97e9\u8001\u5927\u89e3\u7b54"
      }
    ]
  },
  {
    "number": 1442,
    "title": "Swoole\\Http\\Server swoole_http_server is same\uff1f",
    "created_at": "2018-01-09T05:48:19Z",
    "closed_at": "2018-05-30T05:55:38Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1442",
    "body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What did you do? If possible, provide a recipe for reproducing the error.\r\n\r\n    I see use `Swoole\\Http\\Server` but not `swoole_http_server` in readme document.\r\n\r\n    It means i can use `Swoole\\Server` or `Swoole\\Client` too ? I want know how many class i can use by the namespace way.\r\n\r\n\r\n\r\n2. What did you expect to see?\r\n\r\n    Changelog about this.\r\n\r\n3. What did you see instead?\r\n\r\n    none.\r\n\r\n4. What version of Swoole are you using (`php --ri swoole`)?\r\n\r\n    none.\r\n\r\n5. What is your machine environment used (including version of kernel & php & gcc) ? \r\n\r\n    none.\r\n\r\n6. If you are using ssl, what is your openssl version?\r\n\r\n    none.\r\n\r\n\r\n\r\n\r\n  ",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1442/comments",
    "author": "godtail",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2018-01-09T05:49:37Z",
        "body": "Yes, `swoole_http_server` is an alias for `Swoole\\Http\\Server`"
      },
      {
        "user": "matyhtf",
        "created_at": "2018-01-09T05:50:32Z",
        "body": "<table>\r\n<thead>\r\n<tr>\r\n<th>Class</th>\r\n<th>Alias</th>\r\n</tr>\r\n</thead>\r\n<tbody>\r\n<tr><td>swoole_server</td><td>Swoole\\Server</td></tr>\r\n<tr><td>swoole_client</td><td>Swoole\\Client</td></tr>\r\n<tr><td>swoole_process</td><td>Swoole\\Process</td></tr>\r\n<tr><td>swoole_timer</td><td>Swoole\\Timer</td></tr>\r\n<tr><td>swoole_table</td><td>Swoole\\Table</td></tr>\r\n<tr><td>swoole_lock</td><td>Swoole\\Lock</td></tr>\r\n<tr><td>swoole_atomic</td><td>Swoole\\Atomic</td></tr>\r\n<tr><td>swoole_buffer</td><td>Swoole\\Buffer</td></tr>\r\n<tr><td>swoole_redis</td><td>Swoole\\Redis</td></tr>\r\n<tr><td>swoole_event</td><td>Swoole\\Event</td></tr>\r\n<tr><td>swoole_mysql</td><td>Swoole\\MySQL</td></tr>\r\n<tr><td>swoole_mmap</td><td>Swoole\\Mmap</td></tr>\r\n<tr><td>swoole_channel</td><td>Swoole\\Channel</td></tr>\r\n<tr><td>swoole_serialize</td><td>Swoole\\Serialize</td></tr>\r\n<tr><td>swoole_http_server</td><td>Swoole\\Http\\Server</td></tr>\r\n<tr><td>swoole_http_client</td><td>Swoole\\Http\\Client</td></tr>\r\n<tr><td>swoole_http_request</td><td>Swoole\\Http\\Request</td></tr>\r\n<tr><td>swoole_http_response</td><td>Swoole\\Http\\Response</td></tr>\r\n<tr><td>swoole_websocket_server</td><td>Swoole\\WebSocket\\Server</td></tr>\r\n</tbody>\r\n</table>"
      },
      {
        "user": "godtail",
        "created_at": "2018-01-09T05:55:16Z",
        "body": "Thanks, It's excellent."
      },
      {
        "user": "twose",
        "created_at": "2018-01-09T08:11:17Z",
        "body": "| Class                      | Alias                           |\r\n| -------------------------- | ------------------------------- |\r\n| swoole_server              | Swoole\\\\Server                  |\r\n| swoole_timer               | Swoole\\\\Timer                   |\r\n| swoole_event               | Swoole\\\\Event                   |\r\n| swoole_async               | Swoole\\\\Async                   |\r\n| swoole_connection_iterator | Swoole\\\\Connection\\\\Iterator    |\r\n| swoole_exception           | Swoole\\\\Exception               |\r\n| swoole_atomic              | Swoole\\\\Atomic                  |\r\n| swoole_atomic_long         | Swoole\\\\Atomic\\\\Long            |\r\n| swoole_buffer              | Swoole\\\\Buffer                  |\r\n| swoole_channel             | Swoole\\\\Channel                 |\r\n| swoole_client              | Swoole\\\\Client                  |\r\n| swoole_client_coro         | Swoole\\\\Client                  |\r\n| swoole_http_client         | Swoole\\\\Http\\\\Client            |\r\n| swoole_http_client_coro    | Swoole\\\\Coroutine\\\\Http\\\\Client |\r\n| swoole_http_server         | Swoole\\\\Http\\\\Server            |\r\n| swoole_http_response       | Swoole\\\\Http\\\\Response          |\r\n| swoole_http_request        | Swoole\\\\Http\\\\Request           |\r\n| swoole_http2_client        | Swoole\\\\Http2\\\\Client           |\r\n| swoole_http2_response      | Swoole\\\\Http2\\\\Response         |\r\n| swoole_lock                | Swoole\\\\Lock                    |\r\n| swoole_mmap                | Swoole\\\\Mmap                    |\r\n| swoole_mysql               | Swoole\\\\MySQL                   |\r\n| swoole_mysql_exception     | Swoole\\\\MySQL\\\\Exception        |\r\n| swoole_process             | Swoole\\\\Process                 |\r\n| swoole_redis               | Swoole\\\\Redis                   |\r\n| swoole_redis_server        | Swoole\\\\Redis\\\\Server           |\r\n| swoole_serialize           | Swoole\\\\Serialize               |\r\n| swoole_server_port         | Swoole\\\\Server\\\\Port            |\r\n| swoole_table               | Swoole\\\\Table                   |\r\n| swoole_table_row           | Swoole\\\\Table\\\\Row              |\r\n| swoole_websocket_server    | Swoole\\\\WebSocket\\\\Server       |\r\n| swoole_websocket_frame     | Swoole\\\\WebSocket\\\\Frame        |\r\n\r\nreplace ```SWOOLE_CLASS_ALIAS\\(([\\w_]+), *\"([\\w\\\\]+)\"\\);``` to  ```|$1|$2|```\r\n\r\nit's full-fledged version.\r\nRango can consider completing Alias for coroutine Class."
      }
    ]
  },
  {
    "number": 1344,
    "title": "onWorkerStart\u56de\u8c03\u91cc\u5b9a\u65f6\u5668\u6295\u9012task\u62a5\u9519",
    "created_at": "2017-09-05T08:30:45Z",
    "closed_at": "2017-09-08T02:19:14Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1344",
    "body": "\u5728http server\u7684onWorkerStart\u56de\u8c03\u91cc\u9762\u5f00\u542f\u4e00\u4e2a\u5b9a\u65f6\u5668\u6295\u9012\u4efb\u52a1\r\n//\u6700\u540e\u4e00\u4e2aworker\u5904\u7406\u542f\u52a8\u5b9a\u65f6\u5668\r\n```php\r\nif ($workerId == $this->conf['worker_num'] - 1) {\r\n\t//\u542f\u52a8\u5b9a\u65f6\u5668\u4efb\u52a1\r\n\t$timerId = swoole_timer_tick(100, function () {\r\n\t\t$server->task([]);\r\n\t});\r\n}\r\n```\r\n\u5927\u6982\u8dd1\u4e86118\u6b21\u540e\uff0c\u89e6\u53d1WorkerError\uff0c\u7136\u540eworker\u8fdb\u7a0b\u4e0d\u65ad\u62a5\u9519\u548c\u91cd\u542f\r\n\r\nswoole.log\u91cc\u9762\u7684\u65e5\u5fd7\u5185\u5bb9\r\n```shell\r\n[2017-09-05 16:21:30 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:21:42 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:21:54 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:22:05 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:22:17 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:22:29 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n[2017-09-05 16:22:41 $24546.0]\tWARNING\tswManager_check_exit_status: worker#3 abnormal exit, status=0, signal=11\r\n```\r\n\r\ngdb \u6253\u5370\u7684core\u4fe1\u606f\r\n\r\nswoole1.9.18\u7248\u672c\r\n```shell\r\nProgram terminated with signal SIGSEGV, Segmentation fault.\r\n#0  zim_swoole_server_port___destruct (execute_data=0x7f2667013c70, return_value=<optimized out>) at /root/swoole-1.9.18/swoole_server_port.c:76\r\n76\t/root/swoole-1.9.18/swoole_server_port.c: \u6ca1\u6709\u90a3\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55.\r\n(gdb) bt\r\n#0  zim_swoole_server_port___destruct (execute_data=0x7f2667013c70, return_value=<optimized out>) at /root/swoole-1.9.18/swoole_server_port.c:76\r\n#1  0x000055d282be71d0 in zend_call_function (fci=fci@entry=0x7ffd7fb95ba0, fci_cache=fci_cache@entry=0x7ffd7fb95b70) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_execute_API.c:869\r\n#2  0x000055d282c15964 in zend_call_method (object=object@entry=0x7ffd7fb95c80, obj_ce=0x55d284146f90, fn_proxy=fn_proxy@entry=0x7ffd7fb95c78, function_name=function_name@entry=0x55d282ec0482 \"__destruct\", \r\n    function_name_len=function_name_len@entry=10, retval_ptr=retval_ptr@entry=0x0, param_count=0, arg1=0x0, arg2=0x0) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_interfaces.c:99\r\n#3  0x000055d282c30fc2 in zend_objects_destroy_object (object=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_objects.c:156\r\n#4  0x000055d282c21599 in zend_gc_collect_cycles () at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.c:1136\r\n#5  0x000055d282c20e0e in gc_possible_root (ref=0x7f265495ffc0) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.c:286\r\n#6  0x000055d282be5815 in gc_check_possible_root (z=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.h:149\r\n#7  i_zval_ptr_dtor (zval_ptr=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_variables.h:50\r\n#8  _zval_ptr_dtor (zval_ptr=zval_ptr@entry=0x7f26548fd330) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_execute_API.c:550\r\n#9  0x000055d282b3c198 in var_destroy (var_hashx=var_hashx@entry=0x7ffd7fb95e08) at /root/lnmp1.4-full/src/php-7.1.7/ext/standard/var_unserializer.c:234\r\n#10 0x000055d282b3c312 in php_var_unserialize_destroy (d=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/ext/standard/var_unserializer.c:53\r\n#11 0x00007f2665f9a3af in php_swoole_task_unpack (task_result=task_result@entry=0x7ffd7fb96160) at /root/swoole-1.9.18/swoole_server.c:314\r\n#12 0x00007f2665f9a6d0 in php_swoole_onFinish (serv=<optimized out>, req=0x7ffd7fb96160) at /root/swoole-1.9.18/swoole_server.c:840\r\n#13 0x00007f2665fe8b0e in swWorker_onTask (factory=factory@entry=0x55d2841879a8, task=task@entry=0x7ffd7fb96160) at /root/swoole-1.9.18/src/network/Worker.c:278\r\n#14 0x00007f2665fe8eb9 in swWorker_onPipeReceive (reactor=<optimized out>, event=0x7ffd7fb981d0) at /root/swoole-1.9.18/src/network/Worker.c:639\r\n#15 0x00007f2665fd8c0c in swReactorEpoll_wait (reactor=0x55d2841bc8c0, timeo=<optimized out>) at /root/swoole-1.9.18/src/reactor/ReactorEpoll.c:250\r\n#16 0x00007f2665fe9380 in swWorker_loop (factory=factory@entry=0x55d2841879a8, worker_id=worker_id@entry=3) at /root/swoole-1.9.18/src/network/Worker.c:597\r\n#17 0x00007f2665fe6b6b in swManager_spawn_worker (factory=0x55d2841879a8, worker_id=3) at /root/swoole-1.9.18/src/network/Manager.c:435\r\n#18 0x00007f2665fe71bc in swManager_start (factory=factory@entry=0x55d2841879a8) at /root/swoole-1.9.18/src/network/Manager.c:145\r\n#19 0x00007f2665fd5359 in swFactoryProcess_start (factory=0x55d2841879a8) at /root/swoole-1.9.18/src/factory/FactoryProcess.c:86\r\n#20 0x00007f2665fdd008 in swServer_start (serv=serv@entry=0x55d284187570) at /root/swoole-1.9.18/src/network/Server.c:686\r\n#21 0x00007f2665fb58a2 in zim_swoole_http_server_start (execute_data=0x7f2667013c20, return_value=0x7ffd7fb983f0) at /root/swoole-1.9.18/swoole_http_server.c:1561\r\n#22 0x000055d282c9961d in ZEND_DO_FCALL_SPEC_RETVAL_UNUSED_HANDLER () at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:970\r\n#23 0x000055d282c40dcb in execute_ex (ex=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:429\r\n#24 0x000055d282c9b5d8 in zend_execute (op_array=op_array@entry=0x7f2667083000, return_value=return_value@entry=0x7f26670f6120) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:474\r\n#25 0x000055d282bf7273 in zend_execute_scripts (type=1728133968, type@entry=8, retval=0x7f26670f6120, retval@entry=0x0, file_count=file_count@entry=3) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend.c:1476\r\n#26 0x000055d282b93a20 in php_execute_script (primary_file=0x7ffd7fb9aa10) at /root/lnmp1.4-full/src/php-7.1.7/main/main.c:2537\r\n```\r\n\r\n\u6362\u4e861.9.19\u7248\u672c\r\n```shell\r\nProgram terminated with signal SIGSEGV, Segmentation fault.\r\n#0  zim_swoole_server_port___destruct (execute_data=0x7f8745a13c70, return_value=<optimized out>) at /root/swoole-src-1.9.19/swoole_server_port.c:93\r\n93\t        if (property->caches[j])\r\n(gdb) bt\r\n#0  zim_swoole_server_port___destruct (execute_data=0x7f8745a13c70, return_value=<optimized out>) at /root/swoole-src-1.9.19/swoole_server_port.c:93\r\n#1  0x000056397ab471d0 in zend_call_function (fci=fci@entry=0x7fff99434cb0, fci_cache=fci_cache@entry=0x7fff99434c80) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_execute_API.c:869\r\n#2  0x000056397ab75964 in zend_call_method (object=object@entry=0x7fff99434d90, obj_ce=0x56397d3bc180, fn_proxy=fn_proxy@entry=0x7fff99434d88, function_name=function_name@entry=0x56397ae20482 \"__destruct\", \r\n    function_name_len=function_name_len@entry=10, retval_ptr=retval_ptr@entry=0x0, param_count=0, arg1=0x0, arg2=0x0) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_interfaces.c:99\r\n#3  0x000056397ab90fc2 in zend_objects_destroy_object (object=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_objects.c:156\r\n#4  0x000056397ab81599 in zend_gc_collect_cycles () at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.c:1136\r\n#5  0x000056397ab80e0e in gc_possible_root (ref=0x7f873339c578) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.c:286\r\n#6  0x000056397ab45815 in gc_check_possible_root (z=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_gc.h:149\r\n#7  i_zval_ptr_dtor (zval_ptr=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_variables.h:50\r\n#8  _zval_ptr_dtor (zval_ptr=zval_ptr@entry=0x7f873332b330) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_execute_API.c:550\r\n#9  0x000056397aa9c198 in var_destroy (var_hashx=var_hashx@entry=0x7fff99434f18) at /root/lnmp1.4-full/src/php-7.1.7/ext/standard/var_unserializer.c:234\r\n#10 0x000056397aa9c312 in php_var_unserialize_destroy (d=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/ext/standard/var_unserializer.c:53\r\n#11 0x00007f8744996eef in php_swoole_task_unpack (task_result=task_result@entry=0x7fff99435270) at /root/swoole-src-1.9.19/swoole_server.c:371\r\n#12 0x00007f8744997230 in php_swoole_onFinish (serv=<optimized out>, req=0x7fff99435270) at /root/swoole-src-1.9.19/swoole_server.c:905\r\n#13 0x00007f87449e735e in swWorker_onTask (factory=factory@entry=0x56397d402d30, task=task@entry=0x7fff99435270) at /root/swoole-src-1.9.19/src/network/Worker.c:283\r\n#14 0x00007f87449e7709 in swWorker_onPipeReceive (reactor=<optimized out>, event=0x7fff994372e0) at /root/swoole-src-1.9.19/src/network/Worker.c:670\r\n#15 0x00007f87449d725c in swReactorEpoll_wait (reactor=0x56397d437a90, timeo=<optimized out>) at /root/swoole-src-1.9.19/src/reactor/ReactorEpoll.c:250\r\n#16 0x00007f87449e7bd0 in swWorker_loop (factory=factory@entry=0x56397d402d30, worker_id=worker_id@entry=3) at /root/swoole-src-1.9.19/src/network/Worker.c:628\r\n#17 0x00007f87449e52ab in swManager_spawn_worker (factory=0x56397d402d30, worker_id=3) at /root/swoole-src-1.9.19/src/network/Manager.c:437\r\n#18 0x00007f87449e58fc in swManager_start (factory=factory@entry=0x56397d402d30) at /root/swoole-src-1.9.19/src/network/Manager.c:145\r\n#19 0x00007f87449d3969 in swFactoryProcess_start (factory=0x56397d402d30) at /root/swoole-src-1.9.19/src/factory/FactoryProcess.c:86\r\n#20 0x00007f87449db667 in swServer_start (serv=serv@entry=0x56397d402900) at /root/swoole-src-1.9.19/src/network/Server.c:692\r\n#21 0x00007f87449b3582 in zim_swoole_http_server_start (execute_data=0x7f8745a13c20, return_value=0x7fff99437510) at /root/swoole-src-1.9.19/swoole_http_server.c:1578\r\n#22 0x000056397abf961d in ZEND_DO_FCALL_SPEC_RETVAL_UNUSED_HANDLER () at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:970\r\n#23 0x000056397aba0dcb in execute_ex (ex=<optimized out>) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:429\r\n#24 0x000056397abfb5d8 in zend_execute (op_array=op_array@entry=0x7f8745a83000, return_value=return_value@entry=0x7f8745af6120) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend_vm_execute.h:474\r\n#25 0x000056397ab57273 in zend_execute_scripts (type=1168194384, type@entry=8, retval=0x7f8745af6120, retval@entry=0x0, file_count=file_count@entry=3) at /root/lnmp1.4-full/src/php-7.1.7/Zend/zend.c:1476\r\n#26 0x000056397aaf3a20 in php_execute_script (primary_file=0x7fff99439b30) at /root/lnmp1.4-full/src/php-7.1.7/main/main.c:2537\r\n#27 0x000056397abfd84c in do_cli (argc=3, argv=0x56397d037f00) at /root/lnmp1.4-full/src/php-7.1.7/sapi/cli/php_cli.c:993\r\n#28 0x000056397a71e8d2 in main (argc=3, argv=0x56397d037f00) at /root/lnmp1.4-full/src/php-7.1.7/sapi/cli/php_cli.c:1381\r\n```\r\n\r\n\u7cfb\u7edf\u7248\u672c\r\n```shell\r\nLinux kpc 4.8.0-59-generic #64-Ubuntu SMP Thu Jun 29 19:38:34 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\ngcc version 6.2.0 20161005 (Ubuntu 6.2.0-5ubuntu12) \r\n\r\nOpenSSL 1.0.2g  1 Mar 2016\r\nbuilt on: reproducible build, date unspecified\r\nplatform: debian-amd64\r\noptions:  bn(64,64) rc4(16x,int) des(idx,cisc,16,int) blowfish(idx) \r\ncompiler: cc -I. -I.. -I../include  -fPIC -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -m64 -DL_ENDIAN -g -O2 -fdebug-prefix-map=/build/openssl-eVLBIi/openssl-1.0.2g=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -Wl,-Bsymbolic-functions -Wl,-z,relro -Wa,--noexecstack -Wall -DMD32_REG_T=int -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM -DECP_NISTZ256_ASM\r\nOPENSSLDIR: \"/usr/lib/ssl\"\r\n```",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1344/comments",
    "author": "kakuilan",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-09-07T08:39:35Z",
        "body": "\u611f\u8c22\u53cd\u9988\uff0c\u6211\u4f1a\u5c3d\u5feb\u786e\u8ba4\u4e00\u4e0b\u3002"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-09-07T08:46:42Z",
        "body": "\u65e0\u6cd5\u91cd\u73b0\u4f60\u7684\u95ee\u9898\u3002\u8bf7\u4f7f\u7528 `USE_ZEND_ALLOC=0 valgrind php test.php` \u8fd0\u884c\u4f60\u7684\u4ee3\u7801\u3002\u7136\u540e\u5c06`valgrind`\u6253\u5370\u7684\u5185\u5b58\u9519\u8bef\u4fe1\u606f\u8d34\u51fa\u6765\u3002"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-09-07T09:38:53Z",
        "body": "\u4f60\u662f\u5426\u628a server \u4f5c\u4e3a\u4efb\u52a1\u53c2\u6570\u53d1\u9001\u4e86\uff1f"
      },
      {
        "user": "kakuilan",
        "created_at": "2017-09-08T01:50:41Z",
        "body": "\u4ee3\u7801\u5982\u4e0b\r\n```php\r\n<?php\r\n\r\nclass MyServer {\r\n\r\n    public $conf;\r\n    public $server;\r\n\r\n    public function __construct() {\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * \u8bbe\u7f6e\u914d\u7f6e\r\n     * @param array $conf\r\n     */\r\n    public function setConf(array $conf) {\r\n        $this->conf = $conf;\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u521d\u59cb\u5316\u670d\u52a1\r\n     * @return $this\r\n     */\r\n    public function initServer() {\r\n\r\n        $this->server = new \\swoole_http_server('0.0.0.0', 6666);\r\n        $this->server->set($this->conf);\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u542f\u52a8\u670d\u52a1\r\n     * @return $this\r\n     */\r\n    public function startServer() {\r\n        $this->server->on('Start', [$this, 'onStart']);\r\n        $this->server->on('WorkerStart', [$this, 'onWorkerStart']);\r\n        $this->server->on('WorkerStop', [$this, 'onWorkerStop']);\r\n        $this->server->on('WorkerError', [$this, 'onWorkerError']);\r\n        $this->server->on('Connect', [$this, 'onConnect']);\r\n        $this->server->on('Request', [$this, 'onRequest']);\r\n        $this->server->on('Close', [$this, 'onClose']);\r\n        $this->server->on('Task', [$this, 'onTask']);\r\n        $this->server->on('Finish', [$this, 'onFinish']);\r\n\r\n        echo(\"Service start success\\r\\n\");\r\n        $this->server->start();\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53\u670d\u52a1\u5668\u542f\u52a8\u65f6[\u4e8b\u4ef6]\r\n     * @param object $serv swoole_server\u5bf9\u8c61\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onStart($serv) {\r\n        echo \"Master Start...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53worker\u8fdb\u7a0b\u542f\u52a8[\u4e8b\u4ef6]\r\n     * @param object $serv swoole_server\u5bf9\u8c61\r\n     * @param int $workerId \u4ece0-$worker_num\u4e4b\u95f4\u7684\u6570\u5b57\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onWorkerStart($serv, $workerId) {\r\n        echo \"Worker Start:[{$workerId}]...\\r\\n\";\r\n\r\n        if ($workerId == 1) {\r\n            //\u542f\u52a8\u5b9a\u65f6\u5668\u4efb\u52a1\r\n            $timerId = swoole_timer_tick(100, function () use($serv) {\r\n                echo \"timer tick \\r\\n\";\r\n                $serv->task([]);\r\n            });\r\n        }\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53worker\u8fdb\u7a0b\u505c\u6b62[\u4e8b\u4ef6]\r\n     * @param object $serv swoole_server\u5bf9\u8c61\r\n     * @param int $workerId \u4ece0-$worker_num\u4e4b\u95f4\u7684\u6570\u5b57\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onWorkerStop($serv, $workerId) {\r\n        echo \"Worker Stop:[{$workerId}]...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53worker\u8fdb\u7a0b\u53d1\u751f\u5f02\u5e38\u65f6[\u4e8b\u4ef6]\r\n     * @param $serv\r\n     * @param $workerId\r\n     * @param $workerPid\r\n     * @param $exitCode\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onWorkerError($serv, $workerId, $workerPid, $exitCode) {\r\n        echo \"on WorkerError...\\r\\n\";\r\n        echo \"workerId[$workerId] workerPid[$workerPid] exitCode[$exitCode]\\r\\n\";\r\n        die;\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53\u6709\u65b0\u7684\u8fde\u63a5\u8fdb\u5165\u65f6[\u4e8b\u4ef6]\r\n     * @param object $serv swoole_server\u5bf9\u8c61\r\n     * @param mixed $fd \u8fde\u63a5\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26,\u53d1\u9001\u6570\u636e/\u5173\u95ed\u8fde\u63a5\u65f6\u9700\u8981\u6b64\u53c2\u6570\r\n     * @param int $fromId \u6765\u81ea\u90a3\u4e2aReactor\u7ebf\u7a0b\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onConnect($serv, $fd, $fromId) {\r\n        echo \"new Connect:[{$fromId}]...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53\u6709http\u8bf7\u6c42\u65f6[\u4e8b\u4ef6]\r\n     * @param object $request \u8bf7\u6c42\u5bf9\u8c61\r\n     * @param object $response \u54cd\u5e94\u5bf9\u8c61\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onRequest($request, $response) {\r\n        echo \"on Request...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * \u5f53\u5ba2\u6237\u7aef\u8fde\u63a5\u5173\u95ed\u65f6[\u4e8b\u4ef6]\r\n     * @param object $serv swoole_server\u5bf9\u8c61\r\n     * @param mixed $fd \u8fde\u63a5\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26,\u53d1\u9001\u6570\u636e/\u5173\u95ed\u8fde\u63a5\u65f6\u9700\u8981\u6b64\u53c2\u6570\r\n     * @param int $fromId \u6765\u81ea\u90a3\u4e2aReactor\u7ebf\u7a0b\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onClose($serv, $fd, $fromId) {\r\n        echo \"on Close:[{$fromId}]...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53\u4efb\u52a1\u88ab\u8c03\u7528\u65f6[\u4e8b\u4ef6]\r\n     * @param object $serv swoole_server\u5bf9\u8c61\r\n     * @param int $taskId \u4efb\u52a1ID\r\n     * @param int $fromId \u6765\u81ea\u90a3\u4e2aReactor\u7ebf\u7a0b\r\n     * @param array $taskData \u4efb\u52a1\u6570\u636e\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onTask($serv, $taskId, $fromId, $taskData) {\r\n        echo \"on Task...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n    /**\r\n     * \u5f53\u4efb\u52a1\u5b8c\u6210\u65f6[\u4e8b\u4ef6]\r\n     * @param object $serv swoole_server\u5bf9\u8c61\r\n     * @param int $taskId \u4efb\u52a1ID\r\n     * @param array $taskData \u4efb\u52a1\u6570\u636e\r\n     *\r\n     * @return $this\r\n     */\r\n    public function onFinish($serv, $taskId, $taskData) {\r\n        echo \"on Finish...\\r\\n\";\r\n\r\n        return $this;\r\n    }\r\n\r\n\r\n}//end class\r\n\r\n\r\n$conf = [\r\n    //\u5b88\u62a4\u8fdb\u7a0b\u5316\r\n    'daemonize' => 0,\r\n    //\u7ebf\u7a0b\u6570,=CPU\u6838\u6570\r\n    'reactor_num' => 2,\r\n    //worker\u8fdb\u7a0b\u6570,\u4e3aCPU\u76841-4\u500d\r\n    'worker_num' => 4,\r\n    //worker\u8fdb\u7a0b\u7684\u6700\u5927\u4efb\u52a1\u6570\r\n    'max_request' => 1024,\r\n    //\u670d\u52a1\u6700\u5927\u5141\u8bb8\u7684\u8fde\u63a5\u6570\r\n    'max_conn' => 1024,\r\n    //task\u8fdb\u7a0b\u7684\u6570\u91cf\r\n    'task_worker_num' => 5,\r\n    //task\u8fdb\u7a0b\u7684\u6700\u5927\u4efb\u52a1\u6570,0\u4e0d\u9650\u5236\r\n    'task_max_request' => 1024,\r\n    //task\u7684\u6570\u636e\u4e34\u65f6\u76ee\u5f55\r\n    'task_tmpdir' => '/tmp',\r\n    //\u6570\u636e\u5305\u5206\u53d1\u7b56\u7565\r\n    'dispatch_mode' => 2,\r\n    //Listen\u961f\u5217\u957f\u5ea6\r\n    'backlog' => 128,\r\n    //\u6307\u5b9aswoole\u9519\u8bef\u65e5\u5fd7\u6587\u4ef6\r\n    'log_file' => '/tmp/swoole.log',\r\n    //\u65e5\u5fd7\u7ea7\u522b\r\n    'log_level' => 0,\r\n    //\u542f\u7528\u5fc3\u8df3\u68c0\u6d4b,\u6bcf\u9694N\u79d2\u8f6e\u5faa\u4e00\u6b21\r\n    'heartbeat_check_interval' => 5,\r\n    //\u8868\u793a\u8fde\u63a5\u6700\u5927\u5141\u8bb8\u7a7a\u95f2\u7684\u65f6\u95f4,\u9700\u8981\u6bd4heartbeat_check_interval\u5927\r\n    'heartbeat_idle_time' => 10,\r\n\r\n    //\u6253\u5f00\u5305\u957f\u68c0\u6d4b\r\n    'open_length_check' => true,\r\n    //\u5305\u957f\u5ea6\u503c\u7684\u7c7b\u578b\r\n    'package_length_type' => 'N',\r\n    //\u6700\u5927\u6570\u636e\u5305\u5c3a\u5bf8\r\n    'package_max_length' => 2097152, //2M\r\n    'package_length_offset' => 0,\r\n    'package_body_offset' => 4,\r\n    //\u7ba1\u9053\u901a\u4fe1\u7684\u5185\u5b58\u7f13\u5b58\u533a\u957f\u5ea6\r\n    'pipe_buffer_size' => 33554432, //32M\r\n    //\u53d1\u9001\u7f13\u5b58\u533a\u5c3a\u5bf8\r\n    'buffer_output_size' => 3145728, //3M\r\n\r\n    //\u7acb\u5373\u53d1\u5f80\u5ba2\u6237\u7aef\u8fde\u63a5,\u63d0\u5347\u54cd\u5e94\u901f\u5ea6\r\n    'open_tcp_nodelay' => 1,\r\n    //\u542f\u7528CPU\u4eb2\u548c\u6027\u8bbe\u7f6e\r\n    'open_cpu_affinity' => 1,\r\n    //\u8bbe\u7f6e\u7aef\u53e3\u91cd\u7528\r\n    'enable_reuse_port' => 1,\r\n];\r\n$service = new MyServer();\r\n$service->setConf($conf)->initServer()->startServer();\r\n```\r\n\r\n\u6267\u884c USE_ZEND_ALLOC=0 valgrind php test.php MyServer.php\u540e\u8fd4\u56de\r\n==21254== Invalid read of size 8\r\n==21254==    at 0x1026F990: zim_swoole_server_port___destruct (swoole_server_port.c:93)\r\n==21254==    by 0x6701CF: zend_call_function (zend_execute_API.c:869)\r\n==21254==    by 0x69E963: zend_call_method (zend_interfaces.c:99)\r\n==21254==    by 0x6B9FC1: zend_objects_destroy_object (zend_objects.c:156)\r\n==21254==    by 0x6AA598: zend_gc_collect_cycles (zend_gc.c:1136)\r\n==21254==    by 0x6A9E0D: gc_possible_root (zend_gc.c:286)\r\n==21254==    by 0x5C5197: var_destroy (var_unserializer.c:234)\r\n==21254==    by 0x5C5311: php_var_unserialize_destroy (var_unserializer.c:53)\r\n==21254==    by 0x10268EEE: php_swoole_task_unpack (swoole_server.c:371)\r\n==21254==    by 0x1026922F: php_swoole_onFinish (swoole_server.c:905)\r\n==21254==    by 0x102B935D: swWorker_onTask (Worker.c:283)\r\n==21254==    by 0x102B9708: swWorker_onPipeReceive (Worker.c:670)\r\n==21254==  Address 0x1f8 is not stack'd, malloc'd or (recently) free'd\r\n==21254== \r\n==21254== \r\n==21254== Process terminating with default action of signal 11 (SIGSEGV): dumping core\r\n==21254==  Access not within mapped region at address 0x1F8\r\n==21254==    at 0x1026F990: zim_swoole_server_port___destruct (swoole_server_port.c:93)\r\n==21254==    by 0x6701CF: zend_call_function (zend_execute_API.c:869)\r\n==21254==    by 0x69E963: zend_call_method (zend_interfaces.c:99)\r\n==21254==    by 0x6B9FC1: zend_objects_destroy_object (zend_objects.c:156)\r\n==21254==    by 0x6AA598: zend_gc_collect_cycles (zend_gc.c:1136)\r\n==21254==    by 0x6A9E0D: gc_possible_root (zend_gc.c:286)\r\n==21254==    by 0x5C5197: var_destroy (var_unserializer.c:234)\r\n==21254==    by 0x5C5311: php_var_unserialize_destroy (var_unserializer.c:53)\r\n==21254==    by 0x10268EEE: php_swoole_task_unpack (swoole_server.c:371)\r\n==21254==    by 0x1026922F: php_swoole_onFinish (swoole_server.c:905)\r\n==21254==    by 0x102B935D: swWorker_onTask (Worker.c:283)\r\n==21254==    by 0x102B9708: swWorker_onPipeReceive (Worker.c:670)\r\n==21254==  If you believe this happened as a result of a stack\r\n==21254==  overflow in your program's main thread (unlikely but\r\n==21254==  possible), you can try to increase the size of the\r\n==21254==  main thread stack using the --main-stacksize= flag.\r\n==21254==  The main thread stack size used in this run was 8388608.\r\n==21254== \r\n==21254== HEAP SUMMARY:\r\n==21254==     in use at exit: 19,312,000 bytes in 112,056 blocks\r\n==21254==   total heap usage: 159,548 allocs, 47,492 frees, 36,081,415 bytes allocated\r\n==21254== \r\n==21254== LEAK SUMMARY:\r\n==21254==    definitely lost: 32 bytes in 1 blocks\r\n==21254==    indirectly lost: 2,048 bytes in 1 blocks\r\n==21254==      possibly lost: 11,013,714 bytes in 91,700 blocks\r\n==21254==    still reachable: 8,296,206 bytes in 20,354 blocks\r\n==21254==         suppressed: 0 bytes in 0 blocks\r\n==21254== Rerun with --leak-check=full to see details of leaked memory\r\n==21254== \r\n==21254== For counts of detected and suppressed errors, rerun with: -v\r\n==21254== Use --track-origins=yes to see where uninitialised values come from\r\n==21254== ERROR SUMMARY: 527 errors from 2 contexts (suppressed: 0 from 0)\r\n==21244== Warning: invalid file descriptor -1 in syscall write()\r\nopen(/tmp/swoole.log) failed. Error: Permission denied[13]write(log_fd, size=112) failed. Error: Bad file descriptor[9].\r\non WorkerError...\r\nworkerId[1] workerPid[21254] exitCode[0]\r\n==21244== Warning: invalid file descriptor -1 in syscall write()\r\nwrite(log_fd, size=119) failed. Error: Bad file descriptor[9].\r\n==21244== \r\n==21244== HEAP SUMMARY:\r\n==21244==     in use at exit: 1,355,388 bytes in 147 blocks\r\n==21244==   total heap usage: 55,939 allocs, 55,792 frees, 7,656,611 bytes allocated\r\n==21244== \r\n==21244== LEAK SUMMARY:\r\n==21244==    definitely lost: 1,052,056 bytes in 32 blocks\r\n==21244==    indirectly lost: 296,840 bytes in 65 blocks\r\n==21244==      possibly lost: 0 bytes in 0 blocks\r\n==21244==    still reachable: 6,492 bytes in 50 blocks\r\n==21244==         suppressed: 0 bytes in 0 blocks\r\n==21244== Rerun with --leak-check=full to see details of leaked memory\r\n==21244== \r\n==21244== For counts of detected and suppressed errors, rerun with: -v\r\n==21244== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)\r\n==21235== Warning: invalid file descriptor -1 in syscall write()\r\nwrite(log_fd, size=119) failed. Error: Bad file descriptor[9].\r\n\r\n\r\n\r\n"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-09-08T02:19:14Z",
        "body": "\u8bf7\u52ff\u5728 `onTask` \u4e2d ` return $this;` \uff0c\u5426\u5219 `swoole_server`\u5bf9\u8c61\u4f5c\u4e3a \u5b83\u7684\u4e00\u4e2a\u5c5e\u6027\uff0c\u5e95\u5c42\u4f1a\u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\uff0c\u53d1\u9001\u7ed9 `worker` \u8fdb\u7a0b\u3002\r\n\u6700\u65b0\u7248\u672c\u7684`swoole`\u5df2\u7ecf\u7981\u6b62\u4e86\u5bf9`swoole`\u5bf9\u8c61\u5e8f\u5217\u5316\u3002\r\n"
      },
      {
        "user": "kakuilan",
        "created_at": "2017-09-08T02:23:59Z",
        "body": "\u597d\u7684\uff0c\u8c22\u8c22"
      }
    ]
  },
  {
    "number": 1321,
    "title": "mqtt,\u4e00\u6b21on receive\u4f1a\u51fa\u73b0\u591a\u4e2a\u5305\u8fde\u5728\u4e00\u8d77\u7684\u60c5\u51b5",
    "created_at": "2017-08-09T13:23:53Z",
    "closed_at": "2017-08-10T02:12:58Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1321",
    "body": "\u4f7f\u7528\u7684\u662f2.0.7\u7248\u672c\u7684client \u505amqtt\u5ba2\u6237\u7aef\u8ba2\u9605\u3002\u53d1\u73b0on receive\u7684data \u5728\u5e76\u53d1\u60c5\u51b5\u4e0b \u4f1a\u51fa\u73b0\u591a\u4e2a\u5305\u8fde\u5728\u4e00\u8d77\u5728\u540c\u4e00\u6b21on receive\u4e2d\u8fd4\u56de\u7684\u60c5\u51b5 \u4f1a\u5f71\u54cd\u89e3\u6790\r\n\r\n\u5e0c\u671bonReceive\u6bcf\u6b21\u53ea\u8fd4\u56de\u4e00\u4e2a\u5b8c\u6574\u7684mqtt\u6570\u636e\u5305",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1321/comments",
    "author": "jesusslim",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-08-10T02:12:58Z",
        "body": "2.0.8 \u548c 1.9.17 \u5df2\u589e\u52a0 Client Mqtt\u534f\u8bae\u652f\u6301\u3002"
      },
      {
        "user": "jesusslim",
        "created_at": "2017-08-10T05:28:30Z",
        "body": "\u786e\u5b9e \u5347\u52302.0.8\u5c31ok\u4e86 \u611f\u8c22"
      },
      {
        "user": "jesusslim",
        "created_at": "2017-10-17T01:49:27Z",
        "body": "\u76ee\u524d\u662f2.0.8\u7248\u672c \u5728\u5e76\u53d1\u91cf\u5927\u7684\u60c5\u51b5\u4e0b\u5076\u5c14\u4f1a\u51fa\u73b0\u6570\u636e\u5305\u5206\u5272\u7684\u95ee\u9898 \u6b63\u5e38\u60c5\u51b5\u4e0b\u662f\u6bcf\u6b21onreceive\u5230\u7684\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u5305 \u4f46\u5076\u5c14\u4f1a\u51fa\u73b0\u8fd9\u4e2a\u5305\u7684\u957f\u5ea6\u4e0d\u5bf9 \u6bd4\u81ea\u8eab\u957f\u5ea6\u591a \u5bfc\u81f4\u89e3\u6790\u51fa\u73b0\u95ee\u9898 \u5e76\u4e14\u56e0\u4e3a\u591a\u4e86\u4e00\u4e9b\u672c\u6765\u4e0d\u5c5e\u4e8e\u8fd9\u4e2a\u5305\u7684\u5b57\u8282 \u5c06\u4f1a\u5bfc\u81f4\u540e\u7eed\u6240\u6709\u7684\u5305\u90fd\u4ea7\u751f\u95ee\u9898 "
      }
    ]
  },
  {
    "number": 1299,
    "title": "swoole\u505aRPC client\u7aef\u8c03\u7528\u9891\u7e41\u53d1\u751f8002\u62168009\u62a5\u9519",
    "created_at": "2017-07-26T06:16:25Z",
    "closed_at": "2017-07-31T02:52:18Z",
    "labels": [
      "question",
      "wontfix"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1299",
    "body": "Swoole/Client/RPC.php\r\n`\r\n /**\r\n     * \u5c1d\u8bd5\u91cd\u8fde\u4e00\u6b21\r\n     */\r\n    for ($i = 0; $i < 2; $i++)\r\n    {\r\n        $ret = $socket->connect($host, $port, $this->timeout);\r\n        if ($ret === false and ($socket->errCode == 114 or $socket->errCode == 115))\r\n        {\r\n            //\u5f3a\u5236\u5173\u95ed\uff0c\u91cd\u8fde\r\n            $socket->close(true);\r\n            continue;\r\n        }\r\n        else\r\n        {\r\n            break;\r\n        }\r\n    }\r\n`\r\n$socket->errCode\u8fd4\u56de114\uff0c115\r\n\r\n\u8bf7\u95ee\u8fd9\u662f\u4ec0\u4e48\u539f\u56e0\r\n ",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1299/comments",
    "author": "congjunwei",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-07-26T07:41:19Z",
        "body": "8002 \u8868\u793a\u8fde\u63a5\u5931\u8d25\uff0c114/115 \u90fd\u8868\u793a\u8fde\u63a5\u8d85\u65f6\u4e86\uff0c\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u628a\u8d85\u65f6\u65f6\u95f4\u8c03\u5927\u4e00\u4e9b\u3002\r\n8009 \u8868\u793a\u670d\u52a1\u5668\u5173\u95ed\u4e86\u8fde\u63a5\uff0c\u68c0\u67e5\u4f60\u7684\u4ee3\u7801\u903b\u8f91"
      },
      {
        "user": "congjunwei",
        "created_at": "2017-07-26T07:57:26Z",
        "body": "RPC.php\u91cc,\r\n$socket->connect($host, $port, $this->timeout)\r\n\u9ed8\u8ba4\u662ftimeout=0.5\uff0c\u6211\u6539\u621030\u4e86\uff0c\u89c2\u5bdf\u5df2\u7ecf\u6ca1\u6709114\uff0c115\u9519\u8bef\u4e86\uff0c\u4f46\u662f\u4f1a\r\n88 \uff08Socket operation on non-socket\uff09\r\n"
      },
      {
        "user": "congjunwei",
        "created_at": "2017-07-27T03:43:24Z",
        "body": "swoole \u6269\u5c55Version => 1.7.16"
      },
      {
        "user": "matyhtf",
        "created_at": "2017-07-27T08:09:28Z",
        "body": "\u5982\u679c\u6709\u6761\u4ef6\u66f4\u65b0\u7248\u672c\uff0c\u5efa\u8bae\u5347\u7ea7\u4e00\u4e0b 1.9 \u6700\u65b0\u7248\u672c\u3002\u518d\u6765\u89c2\u5bdf\u4e00\u4e0b"
      },
      {
        "user": "congjunwei",
        "created_at": "2017-08-02T03:41:45Z",
        "body": "\u5347\u7ea7\u81f3v1.7.20\u540e\u95ee\u9898\u89e3\u51b3\u3002"
      }
    ]
  },
  {
    "number": 1270,
    "title": "\u534f\u7a0bmysql\u5ba2\u6237\u7aef",
    "created_at": "2017-07-04T08:58:32Z",
    "closed_at": "2017-07-04T09:22:40Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1270",
    "body": "\u6700\u8fd1\u5728\u9879\u76ee\u91cc\u4f7f\u7528\u534f\u7a0bMysql\u5ba2\u6237\u7aef\uff0c\u6709\u90e8\u5206\u4e1a\u52a1\u5fc5\u987b\u4f7f\u7528\u4e8b\u52a1\u64cd\u4f5c\uff0c\u4f46\u662f\u76ee\u524d\u6ca1\u6709\u652f\u6301\u4e8b\u52a1\uff0c\u8bf7\u95ee\u4e0b\uff0c\u6709\u540e\u7eed\u589e\u52a0\u8ba1\u5212\u4e48\u3002",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1270/comments",
    "author": "stelin",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-07-04T09:22:39Z",
        "body": "\u5728Swoole\\MySQL\u4e2d\u6267\u884c\u4e0b\u5217SQL\u8bed\u53e5\u53ef\u4ee5\u5b9e\u73b0\u4e8b\u52a1\u5904\u7406\u3002\r\n\r\n\u542f\u52a8\u4e8b\u52a1\uff1aSTART TRANSACTION\r\n\u63d0\u4ea4\u4e8b\u52a1\uff1aCOMMIT\r\n\u56de\u6eda\u4e8b\u52a1\uff1aROLLBACK"
      },
      {
        "user": "stelin",
        "created_at": "2017-07-04T13:46:10Z",
        "body": "\u660e\u767d\u600e\u4e48\u505a\u4e86\uff0c\u8c22\u8c22\u5cf0\u54e5\uff01"
      }
    ]
  },
  {
    "number": 1221,
    "title": "TCP server\u6267\u884c \u4e00\u76f4\u62a5check \u4e4b\u524d\u8fd0\u884c\u6ca1\u6709\u95ee\u9898",
    "created_at": "2017-05-24T05:23:10Z",
    "closed_at": "2017-05-24T08:25:40Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1221",
    "body": "\u5728\u672c\u5730\u865a\u62df\u673a\u6267\u884c\u4e5f\u6ca1\u6709\u62a5\u9519\uff0c\u5728\u516c\u53f8\u6d4b\u8bd5\u670d\u52a1\u5668\u62a5\u9519\u65e0\u6cd5\u8fde\u63a5\r\n`\r\n[root@localhost test]# php ChipPro.php\r\n[/usr/local/src/swoole-src-1.9.9/swoole_server.c:361@php_swoole_server_before_start]Create swoole_server host=0.0.0.0, port=6000, mode=3, type=1\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:359@swServer_start_proxy]hb timer start, time: 120 live time:600\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:1487@swHeartbeatThread_loop]check fd=3\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:1487@swHeartbeatThread_loop]check fd=3\r\n`\r\n\u8fde\u63a5\u65f6\u62a5\u9519\r\n`\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/memory/ShareMemory.c:66@sw_shm_free]check:\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:1487@swHeartbeatThread_loop]check fd=3\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:1487@swHeartbeatThread_loop]check fd=3\r\n[/usr/local/src/swoole-src-1.9.9/src/network/Server.c:145@swServer_master_onAccept][Master] Accept new connection. maxfd=3|reactor_id=4|conn=26\r\nSegmentation fault (core dumped)\r\n`\r\n\r\n\u6211\u4ee3\u7801\u5e94\u8be5\u6ca1\u6709\u95ee\u9898- -  \u672c\u5730\u8fd0\u884c\u6210\u529f\uff0c\u5bf9\u4e86  \u672c\u5730\u73af\u5883\u662fphp7 swoole 2.0.6\r\n\u6d4b\u8bd5\u670d\u52a1\u5668\u5f53\u524d\u7248\u672cphp5.6 swoole 1.9.9  \u4e4b\u524d2.0.5\u4e0d\u80fd\u7528\u624d\u6362\u76841.9.9\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1221/comments",
    "author": "RandalTeng",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-05-24T08:25:40Z",
        "body": "\u8bf7\u52ff\u5f00\u542f `--enable-swoole-debug` \u7f16\u8bd1\u9009\u9879"
      },
      {
        "user": "RandalTeng",
        "created_at": "2017-05-24T08:49:55Z",
        "body": "\u6ca1\u6709\u7528\u554a- -  \u6211\u91cd\u65b0\u7f16\u8bd1\u4e86swoole\u6a21\u5757- -  \u8fd8\u662f\u62a5\u4e00\u6837\u7684\u9519- -\r\n`\r\n./configure --enable-async-redis --enable-coroutine --with-php-config=/usr/local/php5/bin/php-config  --enable-openssl  --enable-sockets  --enable-swoole\r\n`"
      },
      {
        "user": "wangjinbei",
        "created_at": "2017-05-25T02:28:55Z",
        "body": "make clean\u8fc7\uff1f"
      },
      {
        "user": "RandalTeng",
        "created_at": "2017-05-25T03:02:24Z",
        "body": "- -  \u597d\u5427- -  \u6ca1\u6709clean- -   \u91cd\u65b0make\u53ef\u4ee5\u4e86  \u8c22\u8c22\u5927\u4f6c~~"
      }
    ]
  },
  {
    "number": 1083,
    "title": "How i can check is connecton was closed clean or not in WebsocketServer?",
    "created_at": "2017-02-14T01:21:37Z",
    "closed_at": "2017-02-14T06:15:27Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1083",
    "body": "In JavaScript i can check is connection was normaly closed or not by this code:\r\n```\r\n                var socket = new WebSocket(\"ws://127.0.0.1:9501\");\r\n                socket.onclose = function(event){\r\n                  if(event.wasClean){\r\n                    alert('Good close.');\r\n                  }else{\r\n                    alert('Bad close. Connection broken');\r\n                  }\r\n                };\r\n```\r\n\r\nCan I check it in Swoole WebsocketServer?\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1083/comments",
    "author": "kse300489",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-02-14T05:53:39Z",
        "body": "```php\r\n$info = $serv->getClientInfo($fd);\r\n$errno = $info['close_errno'];\r\n```\r\n\r\nIf it is abnormal, the value of errno is non-zero."
      },
      {
        "user": "kse300489",
        "created_at": "2017-02-14T06:14:07Z",
        "body": "Big thanks for fast answer."
      },
      {
        "user": "matyhtf",
        "created_at": "2017-02-14T06:15:27Z",
        "body": ":)"
      }
    ]
  },
  {
    "number": 1011,
    "title": "Mac OS X 10.11.6 \u6e90\u7801\u7f16\u8bd1 swoole-src-1.9.0-stable  \u5f00\u542f --enable-openssl \u7f16\u8bd1\u4e0d\u901a\u8fc7",
    "created_at": "2017-01-07T08:27:27Z",
    "closed_at": "2017-01-07T13:09:35Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/1011",
    "body": "**gcc -v** \u7248\u672c                                                 \r\nConfigured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/usr/include/c++/4.2.1\r\nApple LLVM version 8.0.0 (clang-800.0.42.1)\r\nTarget: x86_64-apple-darwin15.6.0\r\nThread model: posix\r\nInstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin\r\n\r\n**openssl version -a** \u7248\u672c\r\nOpenSSL 1.0.2j  26 Sep 2016\r\nbuilt on: reproducible build, date unspecified\r\nplatform: darwin64-x86_64-cc\r\noptions:  bn(64,64) rc4(ptr,int) des(idx,cisc,16,int) idea(int) blowfish(idx)\r\ncompiler: clang -I. -I.. -I../include  -fPIC -fno-common -DOPENSSL_PIC -DZLIB_SHARED -DZLIB -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -arch x86_64 -O3 -DL_ENDIAN -Wall -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM -DECP_NISTZ256_ASM\r\nOPENSSLDIR: \"/usr/local/etc/openssl\"\r\n\r\n**Mac OS X \u7248\u672c**\r\nProductName:\tMac OS X\r\nProductVersion:\t10.11.6\r\nBuildVersion:\t15G1108\r\n\r\n**PHP\u7248\u672c**\r\n\r\nPHP 5.6.29 (cli) (built: Dec  8 2016 23:03:30)\r\nCopyright (c) 1997-2016 The PHP Group\r\nZend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies\r\n\r\n**\u7f16\u8bd1\u53c2\u6570\uff1a**\r\n\r\n./configure --with-php-config=/usr/bin/php-config --enable-openssl\r\n\r\n**\u62a5\u9519\u4fe1\u606f\uff1a\uff08\u6709\u7701\u7565\uff09**\r\n/Users/ws/Downloads/swoole-src-1.9.0-stable/include/swoole.h/Users/ws/Downloads/swoole-src-1.9.0-stable/include/swoole.h::353353::1010::  fatal errorfatal error: : 'openssl/ssl.h''openssl/ssl.h'  filefile  notnot  foundfound\r\n\r\n#include <openssl/ssl.h>#include <openssl/ssl.h>\r\n\r\n         ^         ^\r\n\r\n1 error generated.\r\n\r\n/Users/ws/Downloads/swoole-src-1.9.0-stable/include/swoole.h:353:10: fatal error: 'openssl/ssl.h' file not found\r\n#include <openssl/ssl.h>\r\n         ^\r\n\r\n/Users/ws/Downloads/swoole-src-1.9.0-stable/include/swoole.h:353:10: fatal error: 'openssl/ssl.h' file not found\r\n#include <openssl/ssl.h>\r\n         ^\r\nmake: *** [swoole_websocket_server.lo] Error 1\r\n1 error generated.\r\n1 error generated.\r\nmake: *** [swoole_mmap.lo] Error 1\r\nmake: *** [src/protocol/MimeTypes.lo] Error 1\r\n1 error generated.\r\nmake: *** [swoole_mysql.lo] Error 1\r\n1 error generated.\r\nmake: *** [swoole_http_server.lo] Error 1\r\n1 error generated.\r\n1 error generated.\r\nmake: *** [swoole_module.lo] Error 1\r\nmake: *** [swoole_http_client.lo] Error 1\r\n1 error generated.\r\n1 error generated.\r\nmake: *** [swoole_server.lo] Error 1\r\nmake: *** [swoole_client.lo] Error 1\r\n1 error generated.\r\nmake: *** [swoole.lo] Error 1\r\n\r\n\u539f\u6765\u662f\u901a\u8fc7 brew \u5b89\u88c5\u7684swoole\r\n\r\nswoole\r\n\r\nswoole support => enabled\r\nVersion => 1.8.11\r\nAuthor => tianfeng.han[email: mikan.tenny@gmail.com]\r\nkqueue => enabled\r\nrwlock => enabled\r\nasync http/websocket client => enabled\r\npcre => enabled\r\nzlib => enabled\r\n\r\nDirective => Local Value => Master Value\r\nswoole.aio_thread_num => 2 => 2\r\nswoole.display_errors => On => On\r\nswoole.use_namespace => Off => Off\r\nswoole.message_queue_key => 0 => 0\r\nswoole.unixsock_buffer_size => 8388608 => 8388608\r\n\r\n\u73b0\u5728\u60f3\u4f7f\u7528 wss \uff0c\u6240\u4ee5\u60f3\u91cd\u65b0\u7f16\u8bd1 \u5f00\u542f openssl \u652f\u6301",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/1011/comments",
    "author": "iMactool",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2017-01-07T13:09:35Z",
        "body": "\u4f60\u7684\u7cfb\u7edf\u6ca1\u6709\u5b89\u88c5openssl\u5934\u6587\u4ef6\uff0c\u8bf7\u5148\u5b89\u88c5"
      },
      {
        "user": "iMactool",
        "created_at": "2017-01-09T02:29:04Z",
        "body": "\u8c22\u8c22\uff0c\u89e3\u51b3\u65b9\u6848\uff1a\r\n\u4e0b\u8f7d openssl-1.0.*\r\n ./config --prefix=/usr/local --openssldir=/usr/local/openssl\r\nmake \r\nmake install\r\n\r\n\u7136\u540e\u91cd\u65b0\u7f16\u8bd1swoole"
      },
      {
        "user": "zsmhub",
        "created_at": "2018-12-26T07:27:41Z",
        "body": "MACOS X 10.11\u5f00\u59cb\u79fb\u9664\u4e86openssl\u5934\u6587\u4ef6\uff0c\u4f46\u662f\u4fdd\u7559\u4e86openssl\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u53bb\u652f\u6301\u73b0\u6709\u7684\u7a0b\u5e8f\u3002 \u6545\u5982\u679c\u4f60\u5728\u82f9\u679c\u7cfb\u7edfpecl install swoole\u65f6\uff0c\u8bf7\u9009\u62e9disable openssl support\u5373\u53ef\u3002"
      }
    ]
  },
  {
    "number": 940,
    "title": "zend_mm_heap corrupted",
    "created_at": "2016-12-09T18:52:38Z",
    "closed_at": "2016-12-12T03:01:25Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/940",
    "body": "When declare swoole server in class, like so :\r\n\r\n```\r\n<?php\r\nclass Server {\r\n  private $server;\r\n  public function run() {\r\n    $this->server = new swoole_websocket_server(\"0.0.0.0\", 443, SWOOLE_BASE, SWOOLE_SOCK_TCP | SWOOLE_SSL);\r\n    $this->server->start();\r\n  }\r\n}\r\n$srv = new Server();\r\n$srv->run();\r\n```\r\n\r\nI get \"zend_mm_heap corrupted\" error\r\nBUT\r\nwhen you run the server directly :\r\n\r\n```\r\n<?php\r\n$server = new swoole_websocket_server(\"0.0.0.0\", 443, SWOOLE_BASE, SWOOLE_SOCK_TCP | SWOOLE_SSL);\r\n```\r\n\r\nit's ok",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/940/comments",
    "author": "laurenti",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-12-12T03:01:25Z",
        "body": "This is caused by the `server::set` method.\r\nThe latest code has been fixed."
      },
      {
        "user": "laurenti",
        "created_at": "2016-12-12T13:57:12Z",
        "body": "with latest code it's ok."
      }
    ]
  },
  {
    "number": 921,
    "title": "coredump with swoole_http_server",
    "created_at": "2016-11-24T15:00:09Z",
    "closed_at": "2016-11-25T05:41:43Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/921",
    "body": "swoole\u914d\u7f6e\uff1a\r\n\r\n> \r\n            'worker_num'      => 8, //worker process num\r\n            'backlog'         => 16, //listen backlog \r\n            'max_request'     => 5000,\r\n            'task_worker_num' => 8,\r\n            'task_worker_max' => 16,\r\n            'dispatch_mode'      => 3,   \r\n            'user'               => 'rrxuser',\r\n            'group'              => 'rrxuser',\r\n            'open_tcp_nodelay'   => 1,   \r\n            'enable_reuse_port'  => 1,\r\n            'log_file'           => '/data/logs/swoole.log',\r\n            'log_level'          => 0,   \r\n            'daemonize'          => 1,   \r\n            'package_max_length' => 5242880,\r\n\r\n\r\n\r\n\r\ncore bt:\r\n\r\n#0  zend_mm_alloc_small (heap=0x7fa343800040, ptr=0x7fa31fb3c540, size=<value optimized out>, copy_size=352) at /data/php7-src/php-7.0.9/Zend/zend_alloc.c:1295\r\n#1  zend_mm_alloc_heap (heap=0x7fa343800040, ptr=0x7fa31fb3c540, size=<value optimized out>, copy_size=352) at /data/php7-src/php-7.0.9/Zend/zend_alloc.c:1366\r\n#2  zend_mm_realloc_heap (heap=0x7fa343800040, ptr=0x7fa31fb3c540, size=<value optimized out>, copy_size=352) at /data/php7-src/php-7.0.9/Zend/zend_alloc.c:1644\r\n#3  0x0000000000850dc2 in zend_string_realloc (execute_data=0x7fa343814bf0) at /data/php7-src/php-7.0.9/Zend/zend_string.h:187\r\n#4  ZEND_CONCAT_SPEC_TMPVAR_TMPVAR_HANDLER (execute_data=0x7fa343814bf0) at /data/php7-src/php-7.0.9/Zend/zend_vm_execute.h:44737\r\n#5  0x0000000000805190 in execute_ex (ex=<value optimized out>) at /data/php7-src/php-7.0.9/Zend/zend_vm_execute.h:417\r\n#6  0x00000000007b8ba8 in zend_call_function (fci=0x7ffdaf001620, fci_cache=0x7ffdaf001670) at /data/php7-src/php-7.0.9/Zend/zend_execute_API.c:866\r\n#7  0x00000000006be0b9 in zif_array_map (execute_data=<value optimized out>, return_value=0x7fa3438147c0) at /data/php7-src/php-7.0.9/ext/standard/array.c:5349\r\n#8  0x000000000083c998 in ZEND_DO_FCALL_BY_NAME_SPEC_HANDLER (execute_data=0x7fa343814710) at /data/php7-src/php-7.0.9/Zend/zend_vm_execute.h:714\r\n#9  0x0000000000805190 in execute_ex (ex=<value optimized out>) at /data/php7-src/php-7.0.9/Zend/zend_vm_execute.h:417\r\n#10 0x00000000007b8ba8 in zend_call_function (fci=0x7ffdaf0018a0, fci_cache=0x7ffdaf001820) at /data/php7-src/php-7.0.9/Zend/zend_execute_API.c:866\r\n#11 0x00000000007b913a in call_user_function_ex (function_table=<value optimized out>, object=<value optimized out>, function_name=<value optimized out>, retval_ptr=<value optimized out>, \r\n    param_count=<value optimized out>, params=<value optimized out>, no_separation=0, symbol_table=0x0) at /data/php7-src/php-7.0.9/Zend/zend_execute_API.c:685\r\n#12 0x00007fa342c4a311 in sw_call_user_function_ex (serv=0x193bc20, req=<value optimized out>) at /data/php7-src/swoole-src/php7_wrapper.h:232\r\n#13 http_onReceive (serv=0x193bc20, req=<value optimized out>) at /data/php7-src/swoole-src/swoole_http_server.c:981\r\n#14 0x00007fa342c75b02 in swWorker_onTask (factory=<value optimized out>, task=0x7ffdaf001b30) at /data/php7-src/swoole-src/src/network/Worker.c:193\r\n#15 0x00007fa342c75c6b in swWorker_onPipeReceive (reactor=<value optimized out>, event=0x7ffdaf003ba0) at /data/php7-src/swoole-src/src/network/Worker.c:563\r\n#16 0x00007fa342c675d0 in swReactorEpoll_wait (reactor=0x193cdd0, timeo=<value optimized out>) at /data/php7-src/swoole-src/src/reactor/ReactorEpoll.c:258\r\n#17 0x00007fa342c76abf in swWorker_loop (factory=<value optimized out>, worker_id=<value optimized out>) at /data/php7-src/swoole-src/src/network/Worker.c:510\r\n#18 0x00007fa342c73d63 in swManager_spawn_worker (factory=0x193c050, worker_id=2) at /data/php7-src/swoole-src/src/network/Manager.c:669\r\n#19 0x00007fa342c747a9 in swManager_start (factory=0x193c050) at /data/php7-src/swoole-src/src/network/Manager.c:133\r\n#20 0x00007fa342c6464a in swFactoryProcess_start (factory=0x193c050) at /data/php7-src/swoole-src/src/factory/FactoryProcess.c:86\r\n#21 0x00007fa342c6a4ff in swServer_start (serv=0x193bc20) at /data/php7-src/swoole-src/src/network/Server.c:658\r\n#22 0x00007fa342c48eaf in zim_swoole_http_server_start (execute_data=0x7fa343813a50, return_value=0x7fa343813a40) at /data/php7-src/swoole-src/swoole_http_server.c:1388\r\n#23 0x000000000083d2b8 in ZEND_DO_FCALL_SPEC_HANDLER (execute_data=0x7fa343813840) at /data/php7-src/php-7.0.9/Zend/zend_vm_execute.h:842\r\n#24 0x0000000000805190 in execute_ex (ex=<value optimized out>) at /data/php7-src/php-7.0.9/Zend/zend_vm_execute.h:417\r\n#25 0x00000000008582eb in zend_execute (op_array=0x7fa34387d000, return_value=<value optimized out>) at /data/php7-src/php-7.0.9/Zend/zend_vm_execute.h:458\r\n#26 0x00000000007c5b43 in zend_execute_scripts (type=8, retval=0x0, file_count=3) at /data/php7-src/php-7.0.9/Zend/zend.c:1427\r\n#27 0x00000000007680b0 in php_execute_script (primary_file=0x7ffdaf0072b0) at /data/php7-src/php-7.0.9/main/main.c:2494\r\n#28 0x000000000085c64a in do_cli (argc=3, argv=0x1803440) at /data/php7-src/php-7.0.9/sapi/cli/php_cli.c:974\r\n#29 0x000000000085ce4a in main (argc=3, argv=0x1803440) at /data/php7-src/php-7.0.9/sapi/cli/php_cli.c:1344\r\n\r\n\r\nphp\u7248\u672c\uff1a7.0.\r\nswoole\u7248\u672c\uff1a1.9.0\r\n\u628aworker_num\u548cbacklog\u8c03\u62104\u5c31\u6ca1\u95ee\u9898\uff0c8\u5c31\u4f1acore,16\u4e5f\u4f1a\uff0c\r\n\r\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/921/comments",
    "author": "lscgzwd",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-11-25T05:41:42Z",
        "body": "\u5173\u95edopcache\u8bd5\u8bd5\u3002\u6216\u8005\u8bbe\u7f6e php.ini  `opcache.enable_cli = off`"
      },
      {
        "user": "lscgzwd",
        "created_at": "2016-11-28T05:10:26Z",
        "body": "\u786e\u5b9e\u5173\u95ed\u540e\u53ef\u4ee5\u4e86\uff0c\u4f46\u662f\u540c\u6837\u7684\u53c2\u6570\u6216\u8005\u66f4\u5927\u7684\u53c2\u6570\uff0c\u5728\u67d0\u4e9b\u73af\u5883\u4e0b\u786e\u4e0d\u4f1acoredump,  \u751f\u4ea7\u4e0a\u4e5f\u662f\u5f00\u4e86Opcache,\u5e76\u4e14\u53c2\u6570\u662f256\u4e5f\u6ca1\u6709\u62a5\u9519\uff0c\u7ebf\u4e0b\u73af\u5883\u786e\u62a5\u9519\u3002"
      }
    ]
  },
  {
    "number": 912,
    "title": "\u5728swoole_websocket_server start\u56de\u8c03\u542f\u52a8\u7684swoole_process\u4e2d\u65e0\u6cd5\u5411\u5ba2\u6237\u7aefpush\u6d88\u606f?",
    "created_at": "2016-11-15T02:39:40Z",
    "closed_at": "2016-11-15T07:56:16Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/912",
    "body": "\u5b9e\u4f8b\u4ee3\u7801\u5982\u4e0b:\r\n```php\r\n<?php\r\n$server = new \\swoole_websocket_server(\"0.0.0.0\", 9443);\r\n\r\n$server->set(array(\r\n    'worker_num' => 1,\r\n    'max_request' => 500,\r\n    'task_worker_num' => 1,\r\n    'max_connection' => 1024\r\n));\r\n\r\n$server->on('start', function (\\swoole_websocket_server $server) {\r\n    $pid = getmypid();\r\n    $mPid = getmypid();\r\n    echo \"this is Master pid: $mPid\\n\";\r\n    \r\n    $process = new swoole_process('process');\r\n    $pid = $process->start();\r\n});\r\n\r\n$server->on('message', function (\\swoole_websocket_server $server, $frame) {\r\n    echo \"receive from {$frame->fd}:{$frame->data},opcode:{$frame->opcode},fin:{$frame->finish} workerid: {$server->worker_id}\\n\";\r\n});\r\n\r\n$server->on('task', function (\\swoole_server $serv, $task_id, $from_id, $data) {});\r\n$server->on('finish', function (\\swoole_server $serv, $task_id, $from_id, $data) {});\r\n\r\n$server->start();\r\n\r\nfunction process(swoole_process $process)\r\n{\r\n    global $server;\r\n    swoole_set_process_name(\"php processor\");\r\n    // \u7b49\u5f85\u5ba2\u6237\u7aef\u8fde\u63a5, 20\u79d2\u540e\u5411\u5ba2\u6237\u7aef\u5faa\u73af\u53d1\u9001\u6570\u636e\r\n    swoole_timer_after(20 * 1000, function() use ($server){\r\n        foreach ($server->connections as $fd) {\r\n            var_dump($fd);\r\n            $server->push($fd, 'hello');\r\n        }\r\n    });\r\n    \r\n}\r\n```\r\n20\u79d2\u540e, var_dump\u51fa\u4e86fd, \u4f46\u662f\u5ba2\u6237\u7aef\u6ca1\u6709\u6536\u5230\u6570\u636e.",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/912/comments",
    "author": "kings36503",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-11-15T07:56:16Z",
        "body": "\u4f7f\u7528`addProcess`\uff0c\u4e0d\u8981\u5728`onStart`\u56de\u8c03\u51fd\u6570\u4e2d\u521b\u5efaprocess\n"
      },
      {
        "user": "kings36503",
        "created_at": "2016-11-15T09:04:16Z",
        "body": "ok, \u53ef\u4ee5\u4e86, \u591a\u8c22.\n"
      },
      {
        "user": "kings36503",
        "created_at": "2016-11-15T09:04:52Z",
        "body": "\u8d34\u4e0a\u4fee\u6539\u540e\u7684\u5b9e\u4f8b\u4ee3\u7801:\n\n``` php\n<?php\n$server = new \\swoole_websocket_server(\"0.0.0.0\", 9443);\n\n$server->set(array(\n    'worker_num' => 1,\n    'max_request' => 500,\n    'task_worker_num' => 1,\n    'max_connection' => 1024\n));\n\n$process = new swoole_process('process');\n$pid = $process->start();\n$server->addProcess($process);\n\n\n$server->on('start', function (\\swoole_websocket_server $server) {\n    $pid = getmypid();\n    echo \"this is Master pid: $pid\\n\";\n});\n\n$server->on('message', function (\\swoole_websocket_server $server, $frame) {\n    echo \"receive from {$frame->fd}:{$frame->data},opcode:{$frame->opcode},fin:{$frame->finish} workerid: {$server->worker_id}\\n\";\n});\n\n$server->on('task', function (\\swoole_server $serv, $task_id, $from_id, $data) {});\n$server->on('finish', function (\\swoole_server $serv, $task_id, $from_id, $data) {});\n\n$server->start();\n\nfunction process(swoole_process $process)\n{\n    global $server;\n    swoole_set_process_name(\"php processor\");\n\n    swoole_timer_after(10 * 1000, function() use ($server){\n        foreach ($server->connections as $fd) {\n            var_dump($fd);\n            $server->push($fd, 'hello');\n        }\n    });\n\n}\n```\n"
      }
    ]
  },
  {
    "number": 870,
    "title": "\u8bf7\u95eeswoole_http_request->header \u80fd\u652f\u6301\u53d1\u9001 nginx sendfile \u7684X-Accel-Redirect \u5417",
    "created_at": "2016-10-10T12:08:30Z",
    "closed_at": "2016-10-11T10:04:41Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/870",
    "body": "\u5982\u9898\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/870/comments",
    "author": "hackingluoluo",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-10-11T10:04:41Z",
        "body": "header\u65b9\u6cd5\u53ef\u4ee5\u53d1\u9001\u4efb\u610fHttp\u5934\u3002\n"
      },
      {
        "user": "hackingluoluo",
        "created_at": "2016-10-12T03:44:56Z",
        "body": "\u8c22\u8c22!  \u90a3\u5e94\u8be5\u662f\u6211nginx\u914d\u7f6e\u6709\u95ee\u9898\n"
      }
    ]
  },
  {
    "number": 636,
    "title": "Unix domain Socket\u5957\u63a5\u5b57\u6587\u4ef6\u5c5e\u6027\u5982\u4f55\u66f4\u6539\uff1f",
    "created_at": "2016-04-19T08:51:19Z",
    "closed_at": "2016-04-19T09:12:14Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/636",
    "body": "\u589e\u52a0linux domain socket\u7684\u652f\u6301\n$serv->addlistener(\"/var/run/myserv.sock\", 0, SWOOLE_UNIX_STREAM);\n\n\u672c\u673afpm\u6a21\u5f0f(nobody\u7528\u6237)\u4e0b\uff0cphp\u65e0\u6cd5\u901a\u8fc7 /var/run/myserv.sock \u8fde\u63a5\u670d\u52a1\n/var/run/myserv.sock\u6587\u4ef6\u53ea\u6709root\u7528\u6237\u624d\u5177\u6709\u8bfb\u5199\u6743\u9650\uff0c\u5982\u4f55\u6539\u53d8\u6b64\u6587\u4ef6\u5c5e\u6027\uff0c\u8ba9\u5176\u5b83\u7528\u6237\u53ef\u4ee5\u8fde\u63a5\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/636/comments",
    "author": "stcer",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2016-04-19T09:10:04Z",
        "body": "\u53ef\u4ee5\u5728`onStart`\u56de\u8c03\u51fd\u6570\u4e2d\u4fee\u6539`unixsock`\u6587\u4ef6\u7684\u6743\u9650\u3002\n\n``` php\nchmod('/var/run/myserv.sock', 0777);\n```\n"
      },
      {
        "user": "stcer",
        "created_at": "2016-04-20T01:23:11Z",
        "body": "ok, thanks\n"
      }
    ]
  },
  {
    "number": 464,
    "title": "onReceive\u4e2d\u4f1a\u6536\u5230\u622a\u65ad\u7684\u6570\u636e",
    "created_at": "2015-12-31T09:01:10Z",
    "closed_at": "2016-01-02T10:57:19Z",
    "labels": [
      "question"
    ],
    "url": "https://github.com/swoole/swoole-src/issues/464",
    "body": "\u8bbe\u7f6e\u4e86\\r\\n\\r\\n\u4e3a\u7ed3\u675f\u7b26,\u8fde\u7eed\u53d1\u9001100\u6bb5\u6570\u636e(\u7528fsockopen\u6253\u5f00, \u7136\u540e\u901a\u8fc7write\u53d1\u9001, \u5faa\u73af100\u6b21, \u6700\u540eclose), \u5176\u4e2d\u6bcf\u6bb5\u6570\u636e\u7684\u6700\u540e\u4e5f\u7528\\r\\n\\r\\n\u4f5c\u4e3a\u7ed3\u675f\n\u4f46\u662f\u6709\u4e9b\u65f6\u5019, \u53d1\u9001\u7684100\u6bb5\u6570\u636e\u4e2d,\u4f1a\u67091-2\u6bb5\u6570\u636e\u51fa\u9519, \u7ecf\u8fc7\u65e5\u5fd7\u6253\u5370, \u53d1\u73b0\u6570\u636e\u88ab\u622a\u65ad\u4e86\n\u4e2d\u95f4\u5e76\u6ca1\u6709\\r\\n\\r\\n, \u4f46\u662f\u88ab\u62c6\u6210\u4e862\u6b21onReceive\n\n\u6211\u81ea\u5df1\u7528\u65e5\u5fd7\u6253\u5370\u4e86\u4e00\u4e0b, \u53d1\u73b0onReceive\u7684\u56de\u8c03\u51fd\u6570\u91cc\u9762\u6253\u5370\u7684\u6570\u636e, \u88ab\u62c6\u6210\u4e862\u6b21\n[2015-12-31 16:52:53][DEBUG][Command][IndexManager/save_log:81][0][save_log]{\"logger_name\":\"Story_online\",\"timestamp\":\"2015-12-31 16:52:53\",\"file\":\"App\\/Lib\\/Action\\/Story\\/T\n[2015-12-31 16:52:53][DEBUG][Command][IndexManager/save_log:89]save log to db error: <E9><9D><9E><E6><B3><95><E6><95><B0><E6><8D><AE>\n<E5><AF><B9><E8><B1><A1><EF><BC><81>\n[2015-12-31 16:52:53][DEBUG][Command][IndexManager/save_log:81][0][save_log]estAction.class.php\",\"line\":23,\"class_name\":\"TestAction\",\"method\":\"log\",\"level\":6,\"message\":\"bianwei42\",\"thread\":\"29697\"}\n[2015-12-31 16:52:53][DEBUG][Command][IndexManager/save_log:89]save log to db error: <E9><9D><9E><E6><B3><95><E6><95><B0><E6><8D><AE>\n<E5><AF><B9><E8><B1><A1><EF><BC><81>\n[2015-12-31 16:52:53][DEBUG][Command][IndexManager/save_log:81][0][save_log]{\"logger_name\":\"Story_online\",\"timestamp\":\"2015-12-31 16:52:53\",\"file\":\"App\\/Lib\\/Action\\/Story\\/TestAction.class.php\",\"line\":23,\"class_name\":\"TestAction\",\"method\":\"log\",\"level\":6,\"message\":\"bianwei43\",\"thread\":\"29697\"}\n[2015-12-31 16:52:53][DEBUG][Command][IndexManager/save_log:81][0][save_log]{\"logger_name\":\"Story_online\",\"timestamp\":\"2015-12-31 16:52:53\",\"file\":\"App\\/Lib\\/Action\\/Story\\/TestAction.class.php\",\"line\":23,\"class_name\":\"TestAction\",\"method\":\"log\",\"level\":6,\"message\":\"bianwei44\",\"thread\":\"29697\"}\n",
    "comments_url": "https://api.github.com/repos/swoole/swoole-src/issues/464/comments",
    "author": "poisonbian",
    "comments": [
      {
        "user": "matyhtf",
        "created_at": "2015-12-31T09:20:31Z",
        "body": "\u662f\u5426\u542f\u7528\u4e86 open_eof_split\n"
      },
      {
        "user": "poisonbian",
        "created_at": "2016-01-02T06:28:58Z",
        "body": "\u4e4b\u524d\u6ca1\u6709\u5f00\u542fopen_eof_split\uff0c\u56e0\u4e3a\u4f1a\u51fa\u9519\uff0c\u770b\u5230\u4f60\u53e6\u5916\u4e00\u4e2a\u56de\u590d\uff0c\u5173\u95ed\u4e86ringbuffer\uff0c\u91cd\u65b0\u5f00\u542f\u4e86open_eof_split\u4e4b\u540e\uff0c\u8fd9\u4e2a\u95ee\u9898\u5c31\u6ca1\u6709\u518d\u590d\u73b0\u4e86~\n"
      }
    ]
  }
]