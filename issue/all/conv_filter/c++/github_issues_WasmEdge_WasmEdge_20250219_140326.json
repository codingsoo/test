[
  {
    "number": 1820,
    "title": "run rust binding demo error",
    "created_at": "2022-09-03T17:03:23Z",
    "closed_at": "2022-09-04T14:32:15Z",
    "labels": [
      "question",
      "binding-rust"
    ],
    "url": "https://github.com/WasmEdge/WasmEdge/issues/1820",
    "body": "## Description\r\n\r\n### Current State\r\n\r\n/Users/lux/.cargo/bin/cargo build --color=always --message-format=json-diagnostic-rendered-ansi --bin wasmedge-demo --manifest-path /Users/lux/src/github.com/xunfeng1980/rust-study/crates/wasmedge-demo/Cargo.toml\r\n   Compiling wasmedge-sys v0.9.0\r\nerror[E0425]: cannot find function, tuple struct or tuple variant `WasmEdge_CompilerCompileFromBuffer` in module `ffi`\r\n    --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/compiler.rs:102:24\r\n     |\r\n102  |               check(ffi::WasmEdge_CompilerCompileFromBuffer(\r\n     |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: a function with a similar name exists: `WasmEdge_CompilerCompile`\r\n     |\r\n    ::: /Users/lux/src/github.com/xunfeng1980/rust-study/target/debug/build/wasmedge-sys-043900d69375825d/out/wasmedge.rs:2258:5\r\n     |\r\n2258 | /     pub fn WasmEdge_CompilerCompile(\r\n2259 | |         Cxt: *mut WasmEdge_CompilerContext,\r\n2260 | |         InPath: *const ::std::os::raw::c_char,\r\n2261 | |         OutPath: *const ::std::os::raw::c_char,\r\n2262 | |     ) -> WasmEdge_Result;\r\n     | |_________________________- similarly named function `WasmEdge_CompilerCompile` defined here\r\n\r\nerror[E0412]: cannot find type `WasmEdge_CallingFrameContext` in module `ffi`\r\n   --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/frame.rs:12:33\r\n    |\r\n12  |     pub(crate) ctx: *const ffi::WasmEdge_CallingFrameContext,\r\n    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: a struct with a similar name exists: `WasmEdge_ConfigureContext`\r\n    |\r\n   ::: /Users/lux/src/github.com/xunfeng1980/rust-study/target/debug/build/wasmedge-sys-043900d69375825d/out/wasmedge.rs:964:1\r\n    |\r\n964 | pub struct WasmEdge_ConfigureContext {\r\n    | ------------------------------------ similarly named struct `WasmEdge_ConfigureContext` defined here\r\n\r\nerror[E0412]: cannot find type `WasmEdge_CallingFrameContext` in module `ffi`\r\n   --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/frame.rs:16:43\r\n    |\r\n16  |     pub(crate) fn create(ctx: *const ffi::WasmEdge_CallingFrameContext) -> Self {\r\n    |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: a struct with a similar name exists: `WasmEdge_ConfigureContext`\r\n    |\r\n   ::: /Users/lux/src/github.com/xunfeng1980/rust-study/target/debug/build/wasmedge-sys-043900d69375825d/out/wasmedge.rs:964:1\r\n    |\r\n964 | pub struct WasmEdge_ConfigureContext {\r\n    | ------------------------------------ similarly named struct `WasmEdge_ConfigureContext` defined here\r\n\r\nerror[E0425]: cannot find function, tuple struct or tuple variant `WasmEdge_CallingFrameGetExecutor` in module `ffi`\r\n  --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/frame.rs:22:33\r\n   |\r\n22 |         let ctx = unsafe { ffi::WasmEdge_CallingFrameGetExecutor(self.ctx) };\r\n   |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not found in `ffi`\r\n\r\nerror[E0425]: cannot find function, tuple struct or tuple variant `WasmEdge_CallingFrameGetModuleInstance` in module `ffi`\r\n  --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/frame.rs:42:33\r\n   |\r\n42 |         let ctx = unsafe { ffi::WasmEdge_CallingFrameGetModuleInstance(self.ctx) };\r\n   |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not found in `ffi`\r\n\r\nerror[E0425]: cannot find function, tuple struct or tuple variant `WasmEdge_CallingFrameGetMemoryInstance` in module `ffi`\r\n  --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/frame.rs:66:33\r\n   |\r\n66 |         let ctx = unsafe { ffi::WasmEdge_CallingFrameGetMemoryInstance(self.ctx, idx) };\r\n   |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not found in `ffi`\r\n\r\nerror[E0412]: cannot find type `WasmEdge_CallingFrameContext` in module `ffi`\r\n   --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/instance/function.rs:17:33\r\n    |\r\n17  |     call_frame_ctx: *const ffi::WasmEdge_CallingFrameContext,\r\n    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: a struct with a similar name exists: `WasmEdge_ConfigureContext`\r\n    |\r\n   ::: /Users/lux/src/github.com/xunfeng1980/rust-study/target/debug/build/wasmedge-sys-043900d69375825d/out/wasmedge.rs:964:1\r\n    |\r\n964 | pub struct WasmEdge_ConfigureContext {\r\n    | ------------------------------------ similarly named struct `WasmEdge_ConfigureContext` defined here\r\n\r\nerror[E0425]: cannot find function, tuple struct or tuple variant `WasmEdge_ResultGen` in module `ffi`\r\n    --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/instance/function.rs:62:22\r\n     |\r\n62   |                 ffi::WasmEdge_ResultGen(ffi::WasmEdge_ErrCategory_UserLevelError, code)\r\n     |                      ^^^^^^^^^^^^^^^^^^ help: a function with a similar name exists: `WasmEdge_ResultOK`\r\n     |\r\n    ::: /Users/lux/src/github.com/xunfeng1980/rust-study/target/debug/build/wasmedge-sys-043900d69375825d/out/wasmedge.rs:1331:5\r\n     |\r\n1331 |     pub fn WasmEdge_ResultOK(Res: WasmEdge_Result) -> bool;\r\n     |     ------------------------------------------------------- similarly named function `WasmEdge_ResultOK` defined here\r\n\r\nerror[E0425]: cannot find value `WasmEdge_ErrCategory_UserLevelError` in module `ffi`\r\n  --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/instance/function.rs:62:46\r\n   |\r\n62 |                 ffi::WasmEdge_ResultGen(ffi::WasmEdge_ErrCategory_UserLevelError, code)\r\n   |                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not found in `ffi`\r\n\r\nerror[E0425]: cannot find function, tuple struct or tuple variant `WasmEdge_ResultGen` in module `ffi`\r\n    --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/instance/function.rs:65:22\r\n     |\r\n65   |                 ffi::WasmEdge_ResultGen(ffi::WasmEdge_ErrCategory_WASM, code)\r\n     |                      ^^^^^^^^^^^^^^^^^^ help: a function with a similar name exists: `WasmEdge_ResultOK`\r\n     |\r\n    ::: /Users/lux/src/github.com/xunfeng1980/rust-study/target/debug/build/wasmedge-sys-043900d69375825d/out/wasmedge.rs:1331:5\r\n     |\r\n1331 |     pub fn WasmEdge_ResultOK(Res: WasmEdge_Result) -> bool;\r\n     |     ------------------------------------------------------- similarly named function `WasmEdge_ResultOK` defined here\r\n\r\nerror[E0425]: cannot find value `WasmEdge_ErrCategory_WASM` in module `ffi`\r\n  --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/instance/function.rs:65:46\r\n   |\r\n65 |                 ffi::WasmEdge_ResultGen(ffi::WasmEdge_ErrCategory_WASM, code)\r\n   |                                              ^^^^^^^^^^^^^^^^^^^^^^^^^ not found in `ffi`\r\n\r\nerror[E0412]: cannot find type `WasmEdge_CallingFrameContext` in module `ffi`\r\n   --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/instance/function.rs:75:33\r\n    |\r\n75  |     call_frame_ctx: *const ffi::WasmEdge_CallingFrameContext,\r\n    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: a struct with a similar name exists: `WasmEdge_ConfigureContext`\r\n    |\r\n   ::: /Users/lux/src/github.com/xunfeng1980/rust-study/target/debug/build/wasmedge-sys-043900d69375825d/out/wasmedge.rs:964:1\r\n    |\r\n964 | pub struct WasmEdge_ConfigureContext {\r\n    | ------------------------------------ similarly named struct `WasmEdge_ConfigureContext` defined here\r\n\r\nerror[E0425]: cannot find function, tuple struct or tuple variant `WasmEdge_ResultGen` in module `ffi`\r\n    --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/instance/function.rs:121:22\r\n     |\r\n121  |                 ffi::WasmEdge_ResultGen(ffi::WasmEdge_ErrCategory_UserLevelError, code)\r\n     |                      ^^^^^^^^^^^^^^^^^^ help: a function with a similar name exists: `WasmEdge_ResultOK`\r\n     |\r\n    ::: /Users/lux/src/github.com/xunfeng1980/rust-study/target/debug/build/wasmedge-sys-043900d69375825d/out/wasmedge.rs:1331:5\r\n     |\r\n1331 |     pub fn WasmEdge_ResultOK(Res: WasmEdge_Result) -> bool;\r\n     |     ------------------------------------------------------- similarly named function `WasmEdge_ResultOK` defined here\r\n\r\nerror[E0425]: cannot find value `WasmEdge_ErrCategory_UserLevelError` in module `ffi`\r\n   --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/instance/function.rs:121:46\r\n    |\r\n121 |                 ffi::WasmEdge_ResultGen(ffi::WasmEdge_ErrCategory_UserLevelError, code)\r\n    |                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not found in `ffi`\r\n\r\nerror[E0425]: cannot find function, tuple struct or tuple variant `WasmEdge_ResultGen` in module `ffi`\r\n    --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/instance/function.rs:124:22\r\n     |\r\n124  |                 ffi::WasmEdge_ResultGen(ffi::WasmEdge_ErrCategory_WASM, code)\r\n     |                      ^^^^^^^^^^^^^^^^^^ help: a function with a similar name exists: `WasmEdge_ResultOK`\r\n     |\r\n    ::: /Users/lux/src/github.com/xunfeng1980/rust-study/target/debug/build/wasmedge-sys-043900d69375825d/out/wasmedge.rs:1331:5\r\n     |\r\n1331 |     pub fn WasmEdge_ResultOK(Res: WasmEdge_Result) -> bool;\r\n     |     ------------------------------------------------------- similarly named function `WasmEdge_ResultOK` defined here\r\n\r\nerror[E0425]: cannot find value `WasmEdge_ErrCategory_WASM` in module `ffi`\r\n   --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/instance/function.rs:124:46\r\n    |\r\n124 |                 ffi::WasmEdge_ResultGen(ffi::WasmEdge_ErrCategory_WASM, code)\r\n    |                                              ^^^^^^^^^^^^^^^^^^^^^^^^^ not found in `ffi`\r\n\r\nerror[E0425]: cannot find function, tuple struct or tuple variant `WasmEdge_ModuleInstanceWASIGetNativeHandler` in module `ffi`\r\n    --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/instance/module.rs:682:18\r\n     |\r\n682  |               ffi::WasmEdge_ModuleInstanceWASIGetNativeHandler(\r\n     |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: a function with a similar name exists: `WasmEdge_ModuleInstanceWASIGetExitCode`\r\n     |\r\n    ::: /Users/lux/src/github.com/xunfeng1980/rust-study/target/debug/build/wasmedge-sys-043900d69375825d/out/wasmedge.rs:2659:5\r\n     |\r\n2659 | /     pub fn WasmEdge_ModuleInstanceWASIGetExitCode(\r\n2660 | |         Cxt: *const WasmEdge_ModuleInstanceContext,\r\n2661 | |     ) -> u32;\r\n     | |_____________- similarly named function `WasmEdge_ModuleInstanceWASIGetExitCode` defined here\r\n\r\nerror[E0425]: cannot find function, tuple struct or tuple variant `WasmEdge_ResultGetCategory` in module `ffi`\r\n    --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/utils.rs:44:34\r\n     |\r\n44   |     let category = unsafe { ffi::WasmEdge_ResultGetCategory(result) };\r\n     |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: a function with a similar name exists: `WasmEdge_ResultGetCode`\r\n     |\r\n    ::: /Users/lux/src/github.com/xunfeng1980/rust-study/target/debug/build/wasmedge-sys-043900d69375825d/out/wasmedge.rs:1339:5\r\n     |\r\n1339 |     pub fn WasmEdge_ResultGetCode(Res: WasmEdge_Result) -> u32;\r\n     |     ----------------------------------------------------------- similarly named function `WasmEdge_ResultGetCode` defined here\r\n\r\nerror[E0531]: cannot find unit struct, unit variant or constant `WasmEdge_ErrCategory_UserLevelError` in module `ffi`\r\n  --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/utils.rs:54:14\r\n   |\r\n54 |         ffi::WasmEdge_ErrCategory_UserLevelError => Err(WasmEdgeError::User(code)),\r\n   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not found in `ffi`\r\n\r\nerror[E0531]: cannot find unit struct, unit variant or constant `WasmEdge_ErrCategory_WASM` in module `ffi`\r\n  --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/utils.rs:55:14\r\n   |\r\n55 |         ffi::WasmEdge_ErrCategory_WASM => gen_runtime_error(code),\r\n   |              ^^^^^^^^^^^^^^^^^^^^^^^^^ not found in `ffi`\r\n\r\nerror[E0425]: cannot find function, tuple struct or tuple variant `WasmEdge_PluginLoadWithDefaultPaths` in module `ffi`\r\n    --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/utils.rs:317:19\r\n     |\r\n317  |     unsafe { ffi::WasmEdge_PluginLoadWithDefaultPaths() }\r\n     |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: a function with a similar name exists: `WasmEdge_Plugin_loadWithDefaultPluginPaths`\r\n     |\r\n    ::: /Users/lux/src/github.com/xunfeng1980/rust-study/target/debug/build/wasmedge-sys-043900d69375825d/out/wasmedge.rs:4391:5\r\n     |\r\n4391 |     pub fn WasmEdge_Plugin_loadWithDefaultPluginPaths();\r\n     |     ---------------------------------------------------- similarly named function `WasmEdge_Plugin_loadWithDefaultPluginPaths` defined here\r\n\r\nerror[E0308]: mismatched types\r\n   --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/instance/function.rs:225:22\r\n    |\r\n225 |                 Some(wraper_fn),\r\n    |                 ---- ^^^^^^^^^ types differ in mutability\r\n    |                 |\r\n    |                 arguments to this enum variant are incorrect\r\n    |\r\n    = note: expected fn pointer `unsafe extern \"C\" fn(_, _, *mut WasmEdge_MemoryInstanceContext, _, _, _, _) -> WasmEdge_Result`\r\n                  found fn item `extern \"C\" fn(_, _, *const [type error], _, _, _, _) -> WasmEdge_Result {wraper_fn}`\r\nnote: tuple variant defined here\r\n   --> /Users/lux/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/src/rust/library/core/src/option.rs:526:5\r\n    |\r\n526 |     Some(#[stable(feature = \"rust1\", since = \"1.0.0\")] T),\r\n    |     ^^^^\r\n\r\nerror[E0308]: mismatched types\r\n   --> /Users/lux/.cargo/registry/src/mirrors.tuna.tsinghua.edu.cn-df7c3c540f42cdbd/wasmedge-sys-0.9.0/src/instance/function.rs:287:22\r\n    |\r\n287 |                 Some(wraper_fn_single),\r\n    |                 ---- ^^^^^^^^^^^^^^^^ types differ in mutability\r\n    |                 |\r\n    |                 arguments to this enum variant are incorrect\r\n    |\r\n    = note: expected fn pointer `unsafe extern \"C\" fn(_, _, *mut WasmEdge_MemoryInstanceContext, _, _, _, _) -> WasmEdge_Result`\r\n                  found fn item `extern \"C\" fn(_, _, *const [type error], _, _, _, _) -> WasmEdge_Result {wraper_fn_single}`\r\nnote: tuple variant defined here\r\n   --> /Users/lux/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/src/rust/library/core/src/option.rs:526:5\r\n    |\r\n526 |     Some(#[stable(feature = \"rust1\", since = \"1.0.0\")] T),\r\n    |     ^^^^\r\n\r\nerror: aborting due to 23 previous errors\r\n\r\nSome errors have detailed explanations: E0308, E0412, E0425, E0531.\r\nFor more information about an error, try `rustc --explain E0308`.\r\nThe following warnings were emitted during compilation:\r\nwarning: [wasmedge-sys] Use default dir: \"/Users/lux/.wasmedge\"\r\nerror: could not compile `wasmedge-sys` due to 24 previous errors\r\nProcess finished with exit code 101\r\n### Expected\r\n\r\nit work\r\n\r\n## Environment\r\n\r\nDarwin luxdeMacBook-Pro.local 22.1.0 Darwin Kernel Version 22.1.0: Mon Aug 15 20:06:40 PDT 2022; root:xnu-8792.40.29.161.2~1/RELEASE_ARM64_T8103 arm64\r\n\r\n\r\n\r\n## Steps to Reproduce\r\n\r\n<!-- Please provide as much information as necessary to reproduce the bug. -->\r\n",
    "comments_url": "https://api.github.com/repos/WasmEdge/WasmEdge/issues/1820/comments",
    "author": "xunfeng1980",
    "comments": [
      {
        "user": "hydai",
        "created_at": "2022-09-04T13:59:34Z",
        "body": "Hi @xunfeng1980 \r\n\r\nAccording to your error msg `error[E0425]: cannot find function, tuple struct or tuple variant WasmEdge_CompilerCompileFromBuffer in module ffi`, it looks like your wasmedge library version is not updated to the latest one. This API is added in the 0.11.0 release. Please check that you have updated the wasmedge version. Thanks."
      },
      {
        "user": "xunfeng1980",
        "created_at": "2022-09-04T14:32:15Z",
        "body": "thx,it work."
      }
    ]
  },
  {
    "number": 3503,
    "title": "O_TRUNC print bug.",
    "created_at": "2024-06-24T07:52:21Z",
    "closed_at": "2024-07-24T11:08:07Z",
    "labels": [
      "bug",
      "good first issue",
      "help wanted",
      "WASI",
      "fuzz-different-behavior"
    ],
    "url": "https://github.com/WasmEdge/WasmEdge/issues/3503",
    "body": "### Summary\r\n\r\nThe file is opened with O_RDWR and O_TRUNC, but do not print`Access mode: O_TRUNC`.\r\nI'm not sure whether this is a bug.\r\n\r\n### Current State\r\n\r\nWasmEdge print:\r\n```\r\nGet file descriptor of file subdir_2/subfile_3 succeed!\r\nAccess mode: Read/Write\r\nEnter function fd_fdstat_set_flags_00018_ZJtyU\r\nSetting flags succeed!\r\nAfter setting flags\r\nAccess mode: Read/Write\r\nAccess mode: O_APPEND\r\n```\r\n\r\n### Expected State\r\nPrint:\r\n```\r\nGet file descriptor of file subdir_2/subfile_3 succeed!\r\nAccess mode: Read/Write\r\nAccess mode: O_TRUNC\r\nEnter function fd_fdstat_set_flags_00018_ZJtyU\r\nSetting flags succeed!\r\nAfter setting flags\r\nAccess mode: Read/Write\r\nAccess mode: O_TRUNC\r\nAccess mode: O_APPEND\r\n```\r\n\r\n### Reproduction steps\r\n\r\nThe test case is :\r\n```\r\n\r\n#include <stdio.h>\r\n#include <stdlib.h>\r\n#include <fcntl.h>\r\n#include <unistd.h>\r\n\r\nint get_fd(const char *filename, int flags) {\r\n    int fd = open(filename, flags);\r\n    \r\n    if (fd == -1) {\r\n        printf(\"Get file descriptor of file %s failed!\\n\", filename);\r\n        return -1;\r\n    } else {\r\n        printf(\"Get file descriptor of file %s succeed!\\n\", filename);\r\n        return fd;\r\n    }\r\n}\r\n\r\nvoid closebyfd(int fd) {\r\n    if (close(fd) == -1) {\r\n        printf(\"Close the file %d by descriptor failed!\\n\", fd);\r\n    }\r\n}\r\n\r\nvoid fd_fdstat_set_flags_00018_ZJtyU(int fd) {\r\n    printf(\"Enter function fd_fdstat_set_flags_00018_ZJtyU\\n\");\r\n\r\n    int flags = fcntl(fd, F_GETFL);\r\n    flags = flags | O_APPEND;\r\n    \r\n    if (fcntl(fd, F_SETFL, flags) == -1) {\r\n        printf(\"Setting flags failed!\\n\");\r\n    } else {\r\n        printf(\"Setting flags succeed!\\n\");\r\n    }\r\n}\r\n\r\n\r\n    \r\nvoid print_flags(int fd){\r\n    int flags1 = fcntl(fd, F_GETFL);\r\n    int access_mode1 = flags1 & O_ACCMODE;\r\n    if (access_mode1 == O_RDONLY) {\r\n        printf(\"Access mode: Read Only\\n\");\r\n    }\r\n    if (access_mode1 == O_WRONLY) {\r\n        printf(\"Access mode: Write Only\\n\");\r\n    }\r\n    if (access_mode1 == O_RDWR) {\r\n        printf(\"Access mode: Read/Write\\n\");\r\n    }\r\n    if (flags1 & O_TRUNC) {\r\n        printf(\"Access mode: O_TRUNC\\n\");\r\n    }\r\n    if (flags1 & O_APPEND) {\r\n        printf(\"Access mode: O_APPEND\\n\");\r\n    }\r\n    if (flags1 & O_CREAT) {\r\n        printf(\"Access mode: O_CREAT\\n\");\r\n    }\r\n    if (flags1 & O_EXCL) {\r\n        printf(\"Access mode: O_EXCL\\n\");\r\n    }\r\n    if (flags1 & O_NONBLOCK) {\r\n        printf(\"Access mode: Non-blocking\\n\");\r\n    }\r\n    if (flags1 & O_SYNC) {\r\n        printf(\"Access mode: Synchronous Write\\n\");\r\n    }\r\n    if (flags1 & O_DSYNC) {\r\n        printf(\"Access mode: Data Synchronization Write\\n\");\r\n    }\r\n}\r\n    \r\nint main() {\r\n    \r\n    int fd = get_fd(\"subdir_2/subfile_3\", O_RDWR | O_TRUNC);\r\n\r\n    if (fd == -1) {\r\n        return 1;\r\n    }\r\n\r\n    \r\n    print_flags(fd);\r\n    fd_fdstat_set_flags_00018_ZJtyU(fd);\r\n    printf(\"After setting flags\\n\");\r\n    print_flags(fd);\r\n\r\n\r\n    closebyfd(fd);\r\n\r\n    return 0;\r\n}\r\n\r\n```\r\n\r\nSteps to reproduce:\r\n(1)compile to wasm:`./wasi-sdk-21.0/bin/clang --target=wasm32-unkown-wasi --sysroot=./wasi-sdk-21.0/share/wasi-sysroot test.c -o test.wasm`\r\n\r\n(2)Running wasm:\r\n(Before run the Wasm file, subdir_2/subfile_3 exists.)\r\nwasmedge --dir=. test.wasm\r\n\r\n\r\n\r\n### Components\r\n\r\nCLI\r\n\r\n### WasmEdge Version or Commit you used\r\n\r\n0.13.5 and 0.13.3\r\n\r\n### Operating system information\r\n\r\nUbuntu 20.04\r\n\r\n### Hardware Architecture\r\n\r\nx86_64\r\n",
    "comments_url": "https://api.github.com/repos/WasmEdge/WasmEdge/issues/3503/comments",
    "author": "Userzxcvbvnm",
    "comments": [
      {
        "user": "ayushrakesh",
        "created_at": "2024-06-28T07:50:47Z",
        "body": "@Userzxcvbvnm In which file is error coming?"
      },
      {
        "user": "Userzxcvbvnm",
        "created_at": "2024-06-29T02:33:11Z",
        "body": "> @Userzxcvbvnm In which file is error coming?\r\n\r\nWasmEdge does not print \"Access mode: O_TRUNC\""
      },
      {
        "user": "arujjval",
        "created_at": "2024-07-02T05:26:12Z",
        "body": "@Userzxcvbvnm Can you give more info on the `subdir_2/subfile_3` file? I guess the file above is reading it. "
      },
      {
        "user": "Userzxcvbvnm",
        "created_at": "2024-07-03T04:33:39Z",
        "body": "It is a file with random generated string as the content \"asadsdwedfwe34r34r\""
      },
      {
        "user": "guojidan",
        "created_at": "2024-07-17T07:50:58Z",
        "body": "This is not a bug. `O_TRUNC` is not a flag of `fcntl`, so the `fcntl` function cannot be used to obtain this flag.  \r\nEven if we run this test case directly, such as `gcc test.c -o test` and then `./test`, it still does not output the text `Access mode: O_APPEND`.  \r\n\r\nand, I ran this test case mentioned above and it worked well, the size of `subdir_2/subfile_3` is 0"
      },
      {
        "user": "Userzxcvbvnm",
        "created_at": "2024-07-24T11:08:05Z",
        "body": "Thanks for your reply!"
      }
    ]
  }
]