[
  {
    "number": 169,
    "title": "[Bug] climate shouldn't set temperature when added",
    "created_at": "2024-11-18T16:47:47Z",
    "closed_at": "2024-11-22T13:27:56Z",
    "labels": [
      "bug"
    ],
    "url": "https://github.com/t0bst4r/home-assistant-matter-hub/issues/169",
    "body": "I have Wiser (Schneider rebranded as Wiser in the UK) thermostats and they're connected to Home Assistant. I noticed that when I add `climate.wiser_*` devices to the bridge, the rooms that are \"off\" would be switched on, which is really unexpected.\r\n\r\nDebug-level logs:\r\n\r\n```\r\n[ 2024-11-18T16:41:48.014Z ] [ DEBUG ] [ climate.wiser_study / device                       ]: Initializing climate.wiser_study with state:\r\n{\r\n  \"entity_id\": \"climate.wiser_study\",\r\n  \"state\": \"off\",\r\n  \"attributes\": {\r\n    \"hvac_modes\": [\r\n      \"auto\",\r\n      \"heat\",\r\n      \"off\"\r\n    ],\r\n    \"min_temp\": 5,\r\n    \"max_temp\": 30,\r\n    \"target_temp_step\": 0.5,\r\n    \"preset_modes\": [\r\n      \"Advance Schedule\",\r\n      \"Cancel Overrides\",\r\n      \"Boost 30m\",\r\n      \"Boost 1h\",\r\n      \"Boost 2h\",\r\n      \"Boost 3h\"\r\n    ],\r\n    \"current_temperature\": 19,\r\n    \"temperature\": null,\r\n    \"current_humidity\": 60,\r\n    \"hvac_action\": \"idle\",\r\n    \"preset_mode\": \"\",\r\n    \"name\": \"Study\",\r\n    \"window_state\": \"Unknown\",\r\n    \"window_detection_active\": false,\r\n    \"away_mode_supressed\": false,\r\n    \"heating_type\": \"HydronicRadiator\",\r\n    \"number_of_heating_actuators\": 0,\r\n    \"demand_type\": \"Modulating\",\r\n    \"target_temperature_origin\": \"FromManualMode\",\r\n    \"is_boosted\": false,\r\n    \"is_override\": false,\r\n    \"is_heating\": false,\r\n    \"is_passive\": false,\r\n    \"control_output_state\": \"Off\",\r\n    \"heating_rate\": 1200,\r\n    \"boost_time_remaining\": 0,\r\n    \"percentage_demand\": 0,\r\n    \"comfort_mode_score\": 0,\r\n    \"control_direction\": \"Heat\",\r\n    \"displayed_setpoint\": -20,\r\n    \"schedule_id\": 5,\r\n    \"schedule_name\": \"Guest Bedroom\",\r\n    \"current_schedule_temp\": 15,\r\n    \"next_day_change\": \"Monday\",\r\n    \"next_schedule_change\": \"17:30:00\",\r\n    \"next_schedule_datetime\": \"2024-11-18 17:30:00\",\r\n    \"next_schedule_temp\": 21,\r\n    \"number_of_trvs\": 0,\r\n    \"number_of_trvs_locked\": 0,\r\n    \"is_roomstat_locked\": false,\r\n    \"icon\": \"mdi:radiator-off\",\r\n    \"friendly_name\": \"Small Bedroom\",\r\n    \"supported_features\": 401\r\n  },\r\n  \"last_changed\": \"2024-11-18T10:18:00.009061+00:00\",\r\n  \"last_reported\": \"2024-11-18T16:39:46.145125+00:00\",\r\n  \"last_updated\": \"2024-11-18T16:39:46.145125+00:00\",\r\n  \"context\": {\r\n    \"id\": \"01JD029Z714M6QRZ1ZZMTF4S0F\",\r\n    \"parent_id\": null,\r\n    \"user_id\": null\r\n  }\r\n}\r\n[ 2024-11-18T16:41:48.024Z ] [ DEBUG ] [ matter.js / Transaction                            ]: Transaction initialize<e3570612ab524248a16f2f8988b950de.aggregator.climate_wiser_study>#289 locked e3570612ab524248a16f2f8988b950de.aggregator.climate_wiser_study.identify.state\r\n[ 2024-11-18T16:41:48.043Z ] [ DEBUG ] [ matter.js / Transaction                            ]: Transaction initialize<e3570612ab524248a16f2f8988b950de.aggregator.climate_wiser_study>#289 locked e3570612ab524248a16f2f8988b950de.aggregator.climate_wiser_study.descriptor.state\r\n[ 2024-11-18T16:41:48.049Z ] [ DEBUG ] [ matter.js / Transaction                            ]: Transaction initialize<e3570612ab524248a16f2f8988b950de.aggregator.climate_wiser_study>#289 locked e3570612ab524248a16f2f8988b950de.aggregator.climate_wiser_study.relativeHumidityMeasurement.state\r\n[ 2024-11-18T16:41:48.052Z ] [ DEBUG ] [ matter.js / Transaction                            ]: Transaction initialize<e3570612ab524248a16f2f8988b950de.aggregator.climate_wiser_study>#289 locked e3570612ab524248a16f2f8988b950de.aggregator.climate_wiser_study.thermostat.state\r\n[ 2024-11-18T16:41:48.055Z ] [ DEBUG ] [ matter.js / Transaction                            ]: Transaction reactor<e3570612ab524248a16f2f8988b950de.descriptor.#updatePartsList>#28c locked e3570612ab524248a16f2f8988b950de.descriptor.state\r\n[ 2024-11-18T16:41:48.056Z ] [ DEBUG ] [ matter.js / Transaction                            ]: Transaction reactor<e3570612ab524248a16f2f8988b950de.aggregator.descriptor.#updatePartsList>#28d locked e3570612ab524248a16f2f8988b950de.aggregator.descriptor.state\r\n[ 2024-11-18T16:41:48.067Z ] [ DEBUG ] [ matter.js / Transaction                            ]: Transaction reactor<e3570612ab524248a16f2f8988b950de.descriptor.#updatePartsList>#28c committed and unlocked 1 resource\r\n[ 2024-11-18T16:41:48.069Z ] [ DEBUG ] [ matter.js / Transaction                            ]: Transaction reactor<e3570612ab524248a16f2f8988b950de.aggregator.descriptor.#updatePartsList>#28d committed and unlocked 1 resource\r\n[ 2024-11-18T16:41:48.075Z ] [ DEBUG ] [ matter.js / Transaction                            ]: Transaction initialize<e3570612ab524248a16f2f8988b950de.aggregator.climate_wiser_study>#289 locked e3570612ab524248a16f2f8988b950de.aggregator.climate_wiser_study.bridgedDeviceBasicInformation.state\r\n[ 2024-11-18T16:41:48.091Z ] [ DEBUG ] [ matter.js / Transaction                            ]: Transaction initialize<e3570612ab524248a16f2f8988b950de.aggregator.climate_wiser_study>#289 committed and unlocked 5 resources\r\n[ 2024-11-18T16:41:48.096Z ] [ DEBUG ] [ HomeAssistantClient                                ]: Calling action 'climate.set_temperature' for target {\"entity_id\":\"climate.wiser_study\"} with data {\"temperature\":20}\r\n[ 2024-11-18T16:41:50.055Z ] [ INFO  ] [ matter.js / Endpoint                               ]: e3570612ab524248a16f2f8988b950de.aggregator.climate_wiser_study ready endpoint#: 7 type: Thermostat (0x301) behaviors: \u2713identify \u2713bridgedDeviceBasicInformation \u2713homeAssistant \u2713relativeHumidityMeasurement \u2713thermostat \u2713descriptor\r\n```\r\n\r\nYou can see that the current state `temperature` is `null`, and `state` is `off`, but later on the logs show the bridge is calling an action `climate.set_temperature` that seems to be what's causing this unexpected behaviour",
    "comments_url": "https://api.github.com/repos/t0bst4r/home-assistant-matter-hub/issues/169/comments",
    "author": "librehat",
    "comments": [
      {
        "user": "t0bst4r",
        "created_at": "2024-11-21T15:31:51Z",
        "body": "Unfortunately Matter forces me to set a target temperature. If this is null, it is autoamtically defaulted to `20 \u00b0C`.\r\nI'll add a another check to not allow changing the target temperature if the device is off. At least this is what Alexa is doing, too.\r\n\r\nCan you please validate if your controller (e.g. Goggle Home or Apple Home) has a similar behavior? Can you set temperature when the device is off?"
      },
      {
        "user": "librehat",
        "created_at": "2024-11-21T21:42:32Z",
        "body": "My controller is SmartThings, and yes I can confirm that it does let me set the heating temperature when it's off.\n\nAnother issue that I noticed is that I see both settings for heating and cooling, which seems wrong as there is no cooling capability in this thermostat."
      },
      {
        "user": "t0bst4r",
        "created_at": "2024-11-22T12:26:45Z",
        "body": "Can you please post the debug logs when the device is off and you change the temperature.\r\nI need to know if its first turned on and then the temperature is set, or if only the \"set temperature\" command is called.\r\n\r\nRegarding the wrong \"cooling\" capability: this is related to \"auto\" mode. in matter \"auto\" requires both \"cooling\" and \"heating\". i still need to figure out, what to do."
      }
    ]
  }
]